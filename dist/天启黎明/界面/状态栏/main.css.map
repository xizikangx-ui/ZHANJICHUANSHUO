{"version":3,"file":"main.css","mappings":"AAilDA,uBACE,UAAW,CACX,eAAgB,CAChB,aAAc,CACd,8BAA+B,CAC/B,kBAAmB,CACnB,yBAA0B,CAC1B,0CAA8C,CAC9C,eACF,CACA,kCACE,cAAe,CACf,OAAQ,CACR,aAAc,CACd,WAAY,CACZ,cAAe,CACf,QAAS,CACT,cAAe,CACf,eAAgB,CAChB,eAAgB,CAChB,eACF,CACA,8BACE,YAAa,CACb,iFACF,CACA,8BACE,gBAAiB,CACjB,YAAa,CACb,kBAAmB,CACnB,oBAAqB,CACrB,QAAS,CACT,wBAAyB,CACzB,kBAAmB,CACnB,sEACF,CACA,uBACE,8BAAiC,CACjC,aAAc,CACd,kBAAmB,CACnB,aAAc,CACd,yDACF,CACA,yBACE,cAAe,CACf,aACF,CACA,gCACE,YAAa,CACb,QAAS,CACT,cAAe,CACf,sBACF,CACA,+BACE,YAAa,CACb,QAAS,CACT,YAAa,CACb,wBAAyB,CACzB,kBAAmB,CACnB,0DACF,CACA,kCACE,qBAAsB,CACtB,cAAe,CACf,oBACF,CACA,wBACE,YAAa,CACb,OACF,CACA,6BACE,cACF,CACA,6DAEE,wBAAyB,CACzB,iBAAkB,CAClB,gBAAiB,CACjB,eAAgB,CAChB,4BACF,CACA,iCACE,wBAAyB,CACzB,iBAAkB,CAClB,gBAAiB,CACjB,eAAgB,CAChB,4BAA6B,CAC7B,eACF,CACA,sBACE,cAAe,CACf,kBACF,CACA,6BACE,eAAgB,CAChB,aACF,CACA,sCACE,aAAc,CACd,eACF,CACA,0BACE,cAAe,CACf,kBACF,CACA,wBACE,aAAc,CACd,cACF,CACA,0BACE,YAAa,CACb,6BAA8B,CAC9B,OACF,CACA,4DAEE,mBAAoB,CACpB,eAAgB,CAChB,gBAAiB,CACjB,cACF,CACA,4BACE,wBAAyB,CACzB,0DAA6D,CAC7D,aACF,CACA,kCACE,cAAe,CACf,iBACF,CACA,2BACE,wBAAyB,CACzB,kBAAmB,CACnB,aAAc,CACd,mBAAoB,CACpB,gBAAiB,CACjB,eAAgB,CAChB,cACF,CACA,kCACE,kBAAmB,CACnB,UACF,CACA,iCACE,cAAe,CACf,iBACF,CACA,4BACE,wBAAyB,CACzB,kBAAmB,CACnB,aAAc,CACd,mBAAoB,CACpB,gBAAiB,CACjB,eAAgB,CAChB,cACF,CACA,mCACE,kBAAmB,CACnB,UACF,CACA,gCACE,wBAAyB,CACzB,eAAgB,CAChB,aACF,CACA,gKAKE,eAAgB,CAChB,YAAa,CACb,OACF,CACA,+KAKE,YAAa,CACb,6BAA8B,CAC9B,kBAAmB,CACnB,OAAQ,CACR,gCAAiC,CACjC,kBACF,CACA,8BACE,UAAW,CACX,eAAgB,CAChB,wBAAyB,CACzB,kBAAmB,CACnB,YAAa,CACb,eAAgB,CAChB,cAAe,CACf,YAAa,CACb,OACF,CACA,qCACE,oBAAqB,CACrB,kBACF,CACA,mCACE,eACF,CACA,oCACE,aACF,CACA,iCACE,aAAc,CACd,cACF,CACA,8BACE,QAAS,CACT,oBAAqB,CACrB,yBAA0B,CAC1B,iBAAkB,CAClB,WAAY,CACZ,kBAAmB,CACnB,cAAe,CACf,aACF,CACA,0BACE,YAAa,CACb,OAAQ,CACR,kBACF,CACA,iCACE,UAAW,CACX,WAAY,CACZ,wBAAyB,CACzB,iBAAkB,CAClB,eAAgB,CAChB,cACF,CACA,8BACE,YAAa,CACb,gCAAiC,CACjC,kBACF,CACA,+BACE,YAAa,CACb,gCAAiC,CACjC,kBACF,CACA,kCACE,cAAe,CACf,iBAAkB,CAClB,qBACF,CACA,oCACE,YAAa,CACb,6CAAgD,CAChD,OACF,CACA,kCACE,wBAAyB,CACzB,iBAAkB,CAClB,gBAAiB,CACjB,kBAAmB,CACnB,aAAc,CACd,cAAe,CACf,eACF,CACA,wCACE,kBACF,CACA,8BACE,YAAa,CACb,gCAAiC,CACjC,kBACF,CACA,uCACE,wBAAyB,CACzB,kBAAmB,CACnB,kBACF,CACA,iCACE,cAAe,CACf,iBAAkB,CAClB,qBACF,CACA,gCACE,UAAW,CACX,eAAgB,CAChB,wBAAyB,CACzB,iBAAkB,CAClB,kBAAmB,CACnB,aAAc,CACd,eAAgB,CAChB,gBAAiB,CACjB,cAAe,CACf,iBACF,CACA,sCACE,kBACF,CACA,+BACE,eAAgB,CAChB,YAAa,CACb,OACF,CACA,kCACE,wBAAyB,CACzB,iBAAkB,CAClB,WAAY,CACZ,eACF,CACA,4CACE,mBAAoB,CACpB,aAAc,CACd,iBAAkB,CAClB,kBACF,CACA,+BACE,YAAa,CACb,cAAe,CACf,QAAS,CACT,kBACF,CACA,gCACE,YAAa,CACb,cAAe,CACf,aACF,CACA,kCACE,cAAe,CACf,cAAe,CACf,eACF,CACA,iCACE,cAAe,CACf,iBAAkB,CAClB,qBACF,CACA,2BACE,QAAS,CACT,oBAAqB,CACrB,qBAAsB,CACtB,cAAe,CACf,gBAAiB,CACjB,gBAAiB,CACjB,aAAc,CACd,YAAa,CACb,wBAAyB,CACzB,iBAAkB,CAClB,kBACF,CACA,kCACE,YAAa,CACb,+BAAgC,CAChC,0DACF,CACA,qCACE,cAAe,CACf,cAAe,CACf,aACF,CACA,oCACE,QAAS,CACT,cAAe,CACf,aACF,CACA,uBACE,YAAa,CACb,6BAA8B,CAC9B,QAAS,CACT,kBAAmB,CACnB,iBAAkB,CAClB,0DAA6D,CAC7D,+BACF,CACA,gCACE,YAAa,CACb,kBAAmB,CACnB,OACF,CACA,0BACE,cACF,CACA,yBACE,cAAe,CACf,kBACF,CACA,yBACE,gCAAiC,CACjC,mBAAoB,CACpB,eAAgB,CAChB,qBAAsB,CACtB,eAAgB,CAChB,kBACF,CACA,4FAGE,8BAA+B,CAC/B,mBAAoB,CACpB,eAAgB,CAChB,mBAAoB,CACpB,gBAAiB,CACjB,cAAe,CACf,cAAe,CACf,yBACF,CACA,8GAGE,+BACF,CACA,wBACE,YAAa,CACb,wDAA2D,CAC3D,OAAQ,CACR,iBAAkB,CAClB,sCACF,CACA,uBACE,YAAa,CACb,OAAQ,CACR,iBAAkB,CAClB,sCACF,CACA,qCACE,0BAA2B,CAC3B,UAAW,CACX,4BACF,CACA,wBACE,sBAAuB,CACvB,YAAa,CACb,QACF,CACA,uBACE,YAAa,CACb,OACF,CACA,sBACE,YAAa,CACb,8BAA+B,CAC/B,kBAAmB,CACnB,OACF,CACA,0BACE,UAAW,CACX,WACF,CACA,uBACE,YAAa,CACb,QACF,CACA,2BACE,wDACF,CACA,gDAEE,wBAAyB,CACzB,kBAAmB,CACnB,YAAa,CACb,kBACF,CACA,sDAEE,cAAe,CACf,iBAAkB,CAClB,qBACF,CACA,sBACE,cAAe,CACf,eAAgB,CAChB,iBACF,CACA,qBACE,eAAgB,CAChB,YAAa,CACb,OACF,CACA,wBACE,YAAa,CACb,6BAA8B,CAC9B,QAAS,CACT,gCAAiC,CACjC,kBACF,CACA,+BACE,gBACF,CACA,2BACE,wBAAyB,CACzB,kBAAmB,CACnB,YAAa,CACb,0DACF,CACA,+BACE,YAAa,CACb,wDAA2D,CAC3D,OAAQ,CACR,YACF,CACA,kCACE,cACF,CACA,oCACE,eAAgB,CAChB,cACF,CACA,8BACE,YAAa,CACb,cAAe,CACf,OAAQ,CACR,YACF,CACA,oCACE,aAAc,CACd,oBAAqB,CACrB,kBACF,CACA,yBACE,uBACE,sBAAuB,CACvB,qBACF,CACA,uBACE,cACF,CACA,oCACE,yBACF,CACF;;AC/lEA,MACE,cAAe,CACf,iBAAkB,CAClB,gBAAiB,CACjB,eAAgB,CAChB,kBAAmB,CACnB,uBAAwB,CACxB,uFACF,CAEA,EACE,qBAAsB,CACtB,QAAS,CACT,SACF,CAEA,KACE,UAAW,CACX,0EAA6E,CAC7E,mBAAoB,CACpB,4BAA6B,CAC7B,gBACF","sources":["src://tavern_helper_template/src/天启黎明/界面/状态栏/App.vue","src://tavern_helper_template/src/天启黎明/界面/状态栏/global.css"],"sourcesContent":["<template>\n  <div class=\"card\" :class=\"{ fullscreen: is_fullscreen }\">\n    <section v-if=\"show_create\" class=\"create-flow\">\n      <section v-if=\"create_stage === 'cover'\" class=\"cover-panel\">\n        <h1 class=\"logo\">天启黎明</h1>\n        <p class=\"author\">作者：未来</p>\n        <div class=\"cover-actions\">\n          <button type=\"button\" class=\"start-btn large\" @click=\"create_stage = 'profile'\">开始游戏</button>\n          <button type=\"button\" class=\"plot-btn large\" :class=\"{ active: plot_mode }\" @click=\"plot_mode = !plot_mode\">\n            {{ plot_mode ? '剧情模式：开启' : '剧情模式：关闭' }}\n          </button>\n        </div>\n        <button type=\"button\" class=\"cheat-btn\" :class=\"{ active: cheat_mode }\" @click=\"cheat_mode = !cheat_mode\">\n          {{ cheat_mode ? '作弊模式：开启' : '作弊模式：关闭' }}\n        </button>\n      </section>\n\n      <section v-else-if=\"create_stage === 'profile'\" class=\"create-panel\">\n        <h2>建卡 - 基础信息</h2>\n\n        <label class=\"field\">\n          <span>角色姓名：</span>\n          <input v-model.trim=\"create_form.角色姓名\" type=\"text\" placeholder=\"输入角色姓名\" />\n        </label>\n\n        <label class=\"field\">\n          <span>职业：</span>\n          <select v-model=\"create_form.职业\">\n            <option value=\"指挥官\">指挥官</option>\n            <option value=\"战姬\">战姬</option>\n            <option value=\"权柄使役者\">权柄使役者</option>\n          </select>\n        </label>\n\n        <label v-if=\"create_form.职业 === '战姬'\" class=\"field\">\n          <span>战姬类型：</span>\n          <select v-model=\"create_form.战姬类型\">\n            <option v-for=\"kind in warmaid_types\" :key=\"kind\" :value=\"kind\">{{ kind }}</option>\n          </select>\n        </label>\n\n        <label class=\"field\">\n          <span>年龄：</span>\n          <input v-model.number=\"create_form.年龄\" type=\"number\" :min=\"age_limit.min\" :max=\"age_limit.max\" />\n        </label>\n\n        <label class=\"field\">\n          <span>性别：</span>\n          <select v-model=\"create_form.性别\" :disabled=\"create_form.职业 === '战姬'\">\n            <option value=\"男性\">男性</option>\n            <option value=\"女性\">女性</option>\n          </select>\n        </label>\n        <p v-if=\"create_form.职业 === '战姬'\" class=\"tip\">战姬角色性别固定为女性。</p>\n\n        <p class=\"age-tip\">年龄限制：{{ age_limit.min }} - {{ age_limit.max }}</p>\n        <p v-if=\"create_error\" class=\"error\">{{ create_error }}</p>\n\n        <div class=\"actions\">\n          <button type=\"button\" class=\"secondary-btn\" @click=\"create_stage = 'cover'\">返回</button>\n          <button type=\"button\" class=\"start-btn\" @click=\"go_human_step\">下一步</button>\n        </div>\n      </section>\n\n      <section v-else-if=\"create_stage === 'human'\" class=\"create-panel\">\n        <h2>建卡 - 人类属性</h2>\n        <p class=\"tip\">初始属性均为 1，自由分配 5 点。人类属性上限统一为 5。</p>\n        <p class=\"tip strong\">剩余可分配点数：{{ human_points_left }}</p>\n\n        <ul class=\"allocate-list\">\n          <li v-for=\"key in human_keys\" :key=\"key\">\n            <span>{{ key }}（上限 {{ human_caps[key] }}）</span>\n            <div class=\"counter\">\n              <button type=\"button\" @click=\"change_human(key, -1)\">-</button>\n              <strong>{{ human_attr[key] }}</strong>\n              <button type=\"button\" @click=\"change_human(key, 1)\">+</button>\n            </div>\n          </li>\n        </ul>\n\n        <p v-if=\"create_error\" class=\"error\">{{ create_error }}</p>\n        <div class=\"actions\">\n          <button type=\"button\" class=\"secondary-btn\" @click=\"create_stage = 'profile'\">上一步</button>\n          <button type=\"button\" class=\"start-btn\" @click=\"go_next_after_human\">下一步</button>\n        </div>\n      </section>\n\n      <section v-else-if=\"create_stage === 'abilities'\" class=\"create-panel\">\n        <h2>建卡 - 基础能力选择</h2>\n        <p class=\"tip\">{{ current_ability_hint }}</p>\n        <p class=\"tip profession-mark\">{{ current_ability_title }}</p>\n        <p class=\"tip strong\">已选择：{{ selected_abilities.length }}/{{ ability_pick_limit }}</p>\n\n        <ul class=\"ability-list\">\n          <li v-for=\"ability in current_base_abilities\" :key=\"ability.name\">\n            <button\n              type=\"button\"\n              class=\"ability-btn\"\n              :class=\"{ active: selected_abilities.includes(ability.name) }\"\n              @click=\"toggle_ability(ability.name)\"\n            >\n              <span>{{ ability.name }}</span>\n              <small>{{ ability.desc }}</small>\n              <small class=\"ability-source\">{{ ability.source }}</small>\n            </button>\n          </li>\n        </ul>\n\n        <p v-if=\"create_error\" class=\"error\">{{ create_error }}</p>\n        <div class=\"actions\">\n          <button type=\"button\" class=\"secondary-btn\" @click=\"create_stage = 'human'\">上一步</button>\n          <button type=\"button\" class=\"start-btn\" @click=\"go_next_after_abilities\">下一步</button>\n        </div>\n      </section>\n\n      <section v-else-if=\"create_stage === 'profession'\" class=\"create-panel\">\n        <h2>建卡 - 职业专属</h2>\n        <p class=\"tip profession-mark\">{{ create_form.职业 }}</p>\n\n        <template v-if=\"create_form.职业 === '战姬'\">\n          <p class=\"tip\">技能点：{{ skill_points_left }}/{{ skill_points_total }}（初始4点，后续每次晋级+2）</p>\n          <ul class=\"skill-list\">\n            <li v-for=\"node in current_warmaid_skills\" :key=\"node.id\">\n              <button\n                type=\"button\"\n                class=\"ability-btn\"\n                :class=\"{ active: selected_warmaid_skills.includes(node.id) }\"\n                @click=\"toggle_warmaid_skill(node.id)\"\n              >\n                <span>{{ node.id }} {{ node.name }}（{{ node.cost }}点）</span>\n                <small>{{ node.desc }}</small>\n                <small class=\"ability-source\" v-if=\"node.prerequisites.length > 0\">\n                  前置：{{ node.prerequisites.join('、') }}\n                </small>\n              </button>\n            </li>\n          </ul>\n          <label v-if=\"cheat_mode\" class=\"field\">\n            <span>作弊模式：自定义技能记录（可任意填写）</span>\n            <textarea v-model=\"warmaid_custom_skills\" rows=\"4\" placeholder=\"例：终焉炮击, 无限位移\"></textarea>\n          </label>\n        </template>\n\n        <template v-else-if=\"create_form.职业 === '权柄使役者'\">\n          <label class=\"field\">\n            <span>权柄途径：</span>\n            <select v-model=\"authority_build.途径\">\n              <option v-for=\"path in authority_paths\" :key=\"path\" :value=\"path\">{{ path }}</option>\n            </select>\n          </label>\n          <label class=\"field\">\n            <span>权柄名称：</span>\n            <input v-model.trim=\"authority_build.名称\" type=\"text\" placeholder=\"例：史前爬行动物\" />\n          </label>\n          <label class=\"field\">\n            <span>赋予技能：</span>\n            <textarea\n              v-model.trim=\"authority_build.技能描述\"\n              rows=\"8\"\n              placeholder=\"梦幻变化(强化0级)：\\n将自身以梦想之权柄转变为你希望化形的动物……\"\n            />\n          </label>\n          <pre class=\"example-box\">权柄名称：史前爬行动物\n权柄途径：梦想\n碎片数：1\n赋予技能：\n梦幻变化(强化0级)：\n将自身以梦想之权柄转变为你希望化形的动物。\n生命将额外获得200点，失去后次日或消耗等量魔力可以恢复。\n攻击调整为2d15纯物理攻击并附带权柄魔力，防御调整为20点物理护甲。\n最多不得变换为体型超过3（长宽高4米），魔力消耗：每5分钟100点。</pre>\n          <p class=\"tip\">等级固定从【信徒】开始。禁止无敌、神化、直接成为权柄之主等超限设定。</p>\n        </template>\n\n        <template v-else>\n          <p class=\"tip\">指挥官无额外职业树，后续可在游戏中通过学习解锁阵型与战术模块。</p>\n        </template>\n\n        <p v-if=\"create_error\" class=\"error\">{{ create_error }}</p>\n        <div class=\"actions\">\n          <button type=\"button\" class=\"secondary-btn\" @click=\"create_stage = 'abilities'\">上一步</button>\n          <button type=\"button\" class=\"start-btn\" @click=\"go_next_after_profession\">下一步</button>\n        </div>\n      </section>\n\n      <section v-else-if=\"create_stage === 'background'\" class=\"create-panel\">\n        <h2>建卡 - 人物背景</h2>\n        <p class=\"tip\">可填写约1000字背景。武器/能力/装备将被过滤，不计入有效背景。</p>\n        <label class=\"field\">\n          <span>背景原文：</span>\n          <textarea v-model.trim=\"background_input\" rows=\"12\" maxlength=\"1200\" placeholder=\"输入角色背景（约1000字）\" />\n        </label>\n        <p class=\"tip\">当前字数：{{ background_input.length }}/1200</p>\n        <label v-if=\"cheat_mode\" class=\"field\">\n          <span>作弊模式：背景摘要可手动覆盖</span>\n          <textarea v-model.trim=\"background_summary_override\" rows=\"5\" placeholder=\"留空则自动摘要\" />\n        </label>\n        <p v-if=\"create_error\" class=\"error\">{{ create_error }}</p>\n        <div class=\"actions\">\n          <button type=\"button\" class=\"secondary-btn\" @click=\"create_stage = 'profession'\">上一步</button>\n          <button type=\"button\" class=\"start-btn\" @click=\"go_next_after_background\">下一步</button>\n        </div>\n      </section>\n\n      <section v-else class=\"create-panel\">\n        <h2>建卡 - 战姬六维骰点</h2>\n        <p class=\"tip\">按《天启黎明V0.5》战姬类型规则进行骰点：{{ create_form.战姬类型 }}</p>\n\n        <ul class=\"dice-rule-list\">\n          <li v-for=\"item in current_dice_rules\" :key=\"item.key\">\n            <span>{{ item.key }}</span>\n            <strong>{{ item.rule }}</strong>\n          </li>\n        </ul>\n\n        <button type=\"button\" class=\"start-btn\" @click=\"roll_warmaid_stats\">掷骰</button>\n\n        <ul v-if=\"warmaid_rolled\" class=\"dice-result-list\">\n          <li v-for=\"item in warmaid_result_list\" :key=\"item.key\">\n            <span>{{ item.key }}</span>\n            <strong>{{ item.value }}</strong>\n          </li>\n        </ul>\n\n        <p v-if=\"create_error\" class=\"error\">{{ create_error }}</p>\n        <div class=\"actions\">\n          <button type=\"button\" class=\"secondary-btn\" @click=\"create_stage = 'background'\">上一步</button>\n          <button type=\"button\" class=\"start-btn\" @click=\"finish_create\">完成建卡并开始</button>\n        </div>\n      </section>\n    </section>\n\n    <template v-else>\n      <section class=\"mvu-textbox\">\n        <h2>MVU正文与可选行动</h2>\n        <pre v-if=\"display_floor_text\" class=\"mvu-body\">{{ display_floor_text }}</pre>\n        <p v-else class=\"empty-tip\">当前暂无可展示正文</p>\n        <div class=\"next-actions\">\n          <h3>接下来可进行（自动生成，可点击）</h3>\n          <div class=\"next-actions-grid\">\n            <button\n              v-for=\"action in next_action_options\"\n              :key=\"action\"\n              type=\"button\"\n              class=\"next-action-btn\"\n              @click=\"send_next_action(action)\"\n            >\n              {{ action }}\n            </button>\n          </div>\n        </div>\n      </section>\n      <section v-if=\"data.界面.游戏结束.已结束\" class=\"gameover-banner\">\n        <h2>本局已结束</h2>\n        <p>{{ data.界面.游戏结束.原因 || '生命值归零' }}</p>\n      </section>\n\n      <header class=\"hero\">\n        <div>\n          <h1>天启黎明</h1>\n          <p>{{ data.主角.档案.代号 }} | {{ profession }} | {{ data.主角.档案.身份路径 }}</p>\n          <p>性别: {{ display_gender }}</p>\n        </div>\n        <div class=\"hero-controls\">\n          <span class=\"threat\">威胁: {{ data.世界.战区威胁等级 }}</span>\n          <button type=\"button\" class=\"fullscreen-btn\" @click=\"is_fullscreen = !is_fullscreen\">\n            {{ is_fullscreen ? '退出全屏' : '全屏' }}\n          </button>\n        </div>\n      </header>\n\n      <section class=\"world\">\n        <p>时间: {{ data.世界.当前时间 }}</p>\n        <p>地点: {{ data.世界.当前地点 }}</p>\n        <p>天气: {{ data.世界.天气 }}</p>\n      </section>\n\n      <nav class=\"tabs\">\n        <button type=\"button\" :class=\"{ active: active_tab === 'main' }\" @click=\"active_tab = 'main'\">主状态栏</button>\n        <button type=\"button\" :class=\"{ active: active_tab === 'battle' }\" @click=\"active_tab = 'battle'\">战场</button>\n        <button type=\"button\" :class=\"{ active: active_tab === 'recent' }\" @click=\"active_tab = 'recent'\">近期事务</button>\n        <button type=\"button\" :class=\"{ active: active_tab === 'warehouse' }\" @click=\"active_tab = 'warehouse'\">仓库</button>\n      </nav>\n      <section v-if=\"active_tab === 'main'\" class=\"panel\">\n        <div class=\"bars\">\n          <div class=\"bar\"><label>生命</label><progress :value=\"data.主角.资源.当前生命\" :max=\"data.主角.资源.最大生命\" /></div>\n          <div class=\"bar\"><label>魔力</label><progress :value=\"data.主角.资源.当前魔力\" :max=\"data.主角.资源.最大魔力\" /></div>\n          <div class=\"bar\"><label>污染</label><progress :value=\"data.主角.资源.污染值\" max=\"100\" /></div>\n        </div>\n\n        <div class=\"grid two\">\n          <article>\n            <h3>人类属性（七项）</h3>\n            <ul class=\"kv\">\n              <li v-for=\"item in human_attributes\" :key=\"item.key\">\n                <span>{{ item.key }}</span>\n                <strong>{{ item.value }}（锻炼 {{ item.training }}/100）</strong>\n              </li>\n            </ul>\n          </article>\n\n          <article v-if=\"is_warmaid\">\n            <h3>战姬属性（六项）</h3>\n            <ul class=\"kv\">\n              <li v-for=\"item in warmaid_attributes\" :key=\"item.key\">\n                <span>{{ item.key }}</span>\n                <strong>{{ item.value }}</strong>\n              </li>\n            </ul>\n          </article>\n        </div>\n\n        <div class=\"grid two\">\n          <article>\n            <h3>{{ level_label }}</h3>\n            <p class=\"big\">{{ level_value }}</p>\n            <p v-for=\"line in level_meta_lines\" :key=\"line\">{{ line }}</p>\n          </article>\n\n          <article v-if=\"is_warmaid\">\n            <h3>灵装状态</h3>\n            <p>当前状态: {{ data.主角.灵装化.启用 ? '已灵装化' : '未启用' }}（{{ data.主角.灵装化.灵装模式 }}）</p>\n            <p>灵装槽: {{ data.主角.资源.灵装槽当前 }}/{{ data.主角.资源.灵装槽上限 }}</p>\n            <button type=\"button\" class=\"toggle-btn\" @click=\"toggle_transform\">\n              {{ data.主角.灵装化.启用 ? '手动解除灵装' : '手动开启灵装' }}\n            </button>\n          </article>\n        </div>\n\n        <article>\n          <h3>最近技能检定</h3>\n          <p>属性: {{ data.主角.技能检定.关联属性 }}</p>\n          <p>难度: {{ data.主角.技能检定.难度说明 }}（减值 {{ data.主角.技能检定.难度减值 }}）</p>\n          <p>骰点: {{ data.主角.技能检定.原始骰点 }} + {{ data.主角.技能检定.属性加值 }} - {{ data.主角.技能检定.难度减值 }} = {{ data.主角.技能检定.总值 }}</p>\n          <p>结果: {{ data.主角.技能检定.结果 }}</p>\n          <p>{{ data.主角.技能检定.结果描述 }}</p>\n        </article>\n      </section>\n\n      <section v-else-if=\"active_tab === 'battle'\" class=\"panel\">\n        <div class=\"grid two\">\n          <article>\n            <h3>战术态势</h3>\n            <p>模式: {{ data.主角.战术.战斗模式 }} / {{ data.主角.战术.是否战斗中 ? '战斗中' : '非战斗' }}</p>\n            <p>阵线: {{ data.主角.战术.当前阵线 }}</p>\n            <p>制空权: {{ data.主角.战术.制空权 }}</p>\n            <p>轮次: {{ data.主角.战术.当前轮次 }}</p>\n            <p>行动/移动: {{ data.主角.资源.行动点 }}/{{ data.主角.资源.移动点 }}</p>\n            <p>火力惩罚: {{ data.主角.战术.火力惩罚 }}</p>\n            <p v-if=\"is_warmaid\">灵装每回合消耗: 魔力{{ data.主角.灵装化.每回合耗魔 }} / 槽{{ data.主角.灵装化.每回合耗槽 }}</p>\n          </article>\n\n          <article>\n            <h3>异常状态</h3>\n            <p v-if=\"_.isEmpty(data.主角.异常状态)\">无</p>\n            <ul v-else class=\"kv\">\n              <li v-for=\"(v, k) in data.主角.异常状态\" :key=\"k\">\n                <span>{{ k }}({{ v.等级 }})</span>\n                <strong>x{{ v.剩余轮次 }}</strong>\n              </li>\n            </ul>\n          </article>\n        </div>\n\n        <article v-if=\"data.主角.战术.战斗模式 === '空战'\" class=\"air-menu\">\n          <h3>空战系统入口</h3>\n          <button type=\"button\" class=\"toggle-btn\" disabled>空战系统 [未完成系统别开]</button>\n        </article>\n\n        <article>\n          <h3>最近技能检定</h3>\n          <p>属性: {{ data.主角.技能检定.关联属性 }}</p>\n          <p>难度: {{ data.主角.技能检定.难度说明 }}（减值 {{ data.主角.技能检定.难度减值 }}）</p>\n          <p>骰点: {{ data.主角.技能检定.原始骰点 }} + {{ data.主角.技能检定.属性加值 }} - {{ data.主角.技能检定.难度减值 }} = {{ data.主角.技能检定.总值 }}</p>\n          <p>结果: {{ data.主角.技能检定.结果 }}</p>\n          <p>{{ data.主角.技能检定.结果描述 }}</p>\n        </article>\n\n        <article v-if=\"data.战利品.显示战利品\" class=\"loot\">\n          <h3>战利品</h3>\n          <p v-if=\"_.isEmpty(data.战利品.最近获取)\">暂无</p>\n          <ul v-else class=\"kv\">\n            <li v-for=\"(v, k) in data.战利品.最近获取\" :key=\"k\">\n              <span>{{ k }}({{ v.品质 }})</span>\n              <strong>x{{ v.数量 }}</strong>\n            </li>\n          </ul>\n        </article>\n      </section>\n\n      <section v-else-if=\"active_tab === 'recent'\" class=\"panel\">\n        <article>\n          <h3>近期事务</h3>\n          <p v-if=\"_.isEmpty(data.世界.近期事务)\">无</p>\n          <ul v-else class=\"kv\">\n            <li v-for=\"(v, k) in data.世界.近期事务\" :key=\"k\">\n              <span>{{ k }}</span>\n              <strong>{{ v }}</strong>\n            </li>\n          </ul>\n        </article>\n\n        <article>\n          <h3>战场日志</h3>\n          <p v-if=\"_.isEmpty(data.战场日志)\">无</p>\n          <ul v-else class=\"kv\">\n            <li v-for=\"(v, k) in data.战场日志\" :key=\"k\">\n              <span>{{ k }}</span>\n              <strong>{{ v }}</strong>\n            </li>\n          </ul>\n        </article>\n      </section>\n      <section v-else class=\"panel\">\n        <div class=\"grid two\">\n          <article>\n            <h3>仓库总览</h3>\n            <p>联合币：{{ data.战利品.仓库.联合币 }}</p>\n            <p>芯片：{{ data.战利品.仓库.芯片 }}</p>\n            <p>独特收藏品：{{ data.战利品.仓库.独特收藏品.length }}</p>\n          </article>\n          <article>\n            <h3>副本状态</h3>\n            <p v-if=\"!data.战利品.副本.已激活\">当前未在副本内</p>\n            <template v-else>\n              <p>{{ data.战利品.副本.副本名称 }} / {{ data.战利品.副本.实验室等级 }}</p>\n              <p>规模：{{ data.战利品.副本.地图规模 }}（{{ data.战利品.副本.房间总数 }}房）</p>\n              <p>探索：{{ data.战利品.副本.已探索房间 }}/{{ data.战利品.副本.房间总数 }}</p>\n              <p>当前房间：{{ data.战利品.副本.最近房间 || '未知' }}</p>\n            </template>\n          </article>\n        </div>\n        <article>\n          <h3>物品列表</h3>\n          <p v-if=\"warehouse_items.length === 0\">暂无物品</p>\n          <ul v-else class=\"kv\">\n            <li v-for=\"item in warehouse_items\" :key=\"item.name\">\n              <span>{{ item.name }}（{{ item.quality }}）</span>\n              <strong>x{{ item.count }} / {{ item.category }} / {{ item.value }}联合币</strong>\n            </li>\n          </ul>\n        </article>\n      </section>\n      <section class=\"onstage-box in-panel\">\n        <button type=\"button\" class=\"module-toggle\" @click=\"toggle_module('在场角色')\">\n          当前在场角色（{{ onstage_characters.length }}）{{ is_onstage_folded ? '展开' : '折叠' }}\n        </button>\n        <ul v-if=\"!is_onstage_folded\" class=\"onstage-list\">\n          <li v-if=\"onstage_characters.length === 0\" class=\"empty-tip\">暂无在场角色数据</li>\n          <li v-for=\"char in onstage_characters\" :key=\"char.姓名\">\n            <div class=\"onstage-head\">\n              <strong>{{ char.姓名 }}</strong>\n              <span>好感度 {{ char.好感度 }}</span>\n              <span>态度 {{ char.态度 }}</span>\n            </div>\n            <p class=\"onstage-attrs\">{{ format_attr_text(char.基础属性) }}</p>\n            <details>\n              <summary>内心想法（隐藏，点击查看）</summary>\n              <p class=\"onstage-thought\">{{ char.内心想法 || '暂无' }}</p>\n            </details>\n          </li>\n        </ul>\n      </section>\n      <section class=\"onstage-box in-panel\">\n        <button type=\"button\" class=\"module-toggle\" @click=\"toggle_module('长期NPC')\">\n          长期NPC列表（{{ longterm_npc_list.length }}）{{ is_longterm_folded ? '展开' : '折叠' }}\n        </button>\n        <ul v-if=\"!is_longterm_folded\" class=\"onstage-list\">\n          <li v-if=\"longterm_npc_list.length === 0\" class=\"empty-tip\">暂无长期NPC数据</li>\n          <li v-for=\"npc in longterm_npc_list\" :key=\"npc.姓名\">\n            <div class=\"onstage-head\">\n              <strong>{{ npc.姓名 }}</strong>\n              <span>好感度 {{ npc.好感度 }}</span>\n              <span>阶段 {{ npc.好感阶段 }}</span>\n              <span>态度 {{ npc.态度 }}</span>\n            </div>\n            <p class=\"onstage-attrs\">{{ format_attr_text(npc.基础属性) }}</p>\n            <p class=\"onstage-attrs\">关系标签：{{ (npc.关系标签 || []).join(' / ') || '无' }}</p>\n            <p class=\"onstage-attrs\">性行为次数：{{ npc.性行为次数 }} | 贞洁状态：{{ npc.贞洁状态 }}</p>\n            <details>\n              <summary>内心想法（隐藏，点击查看）</summary>\n              <p class=\"onstage-thought\">{{ npc.内心想法 || '暂无' }}</p>\n            </details>\n          </li>\n        </ul>\n      </section>\n    </template>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport _ from 'lodash';\nimport { useDataStore } from './store';\n\ntype Profession = '指挥官' | '战姬' | '权柄使役者';\ntype WarmaidType = '侦察型' | '轻型' | '中型' | '重型' | '要塞型' | '地面支援姬';\ntype CreateStage = 'cover' | 'profile' | 'human' | 'abilities' | 'profession' | 'background' | 'warmaid';\ntype Gender = '男性' | '女性';\ntype HumanKey = '力量' | '敏捷' | '体质' | '感知' | '意志' | '魅力' | '学识';\ntype WarmaidAttrKey = '魔力评级' | '力量加成' | '体质加成' | '抗污染值' | '飞行速度' | '防御评级';\ntype AbilityItem = { name: string; desc: string; source: string };\ntype SkillNode = { id: string; name: string; cost: number; desc: string; prerequisites: string[] };\ntype AuthorityPath = '生命' | '历史' | '群星' | '黎明' | '黑夜' | '力量' | '希望' | '勇气' | '梦想';\n\ntype WarmaidStats = Record<WarmaidAttrKey, number>;\n\nconst store = useDataStore();\nconst data = computed(() => store.data);\nconst is_fullscreen = useLocalStorage('apocalypse_dawn:status_fullscreen', false);\nconst active_tab = useLocalStorage<'main' | 'battle' | 'recent' | 'warehouse'>('apocalypse_dawn:active_tab', 'main');\nconst display_floor_text = computed(() => {\n  const direct = String(data.value.界面.楼层文本.正文 ?? '').trim();\n  if (direct) return direct;\n  return extractFloorTextFromRaw(String(data.value.界面.楼层文本.原文 ?? ''));\n});\nconst default_next_action_options = [\n  '前往报到处完成登记',\n  '查看学院地图并确认任务点',\n  '向教官申请首次训练',\n  '与在场角色进行交流',\n];\nconst next_action_options = ref<string[]>([...default_next_action_options]);\nconst onstage_characters = computed(() => {\n  const list = data.value.界面.在场角色;\n  return Array.isArray(list) ? list : [];\n});\nconst module_fold_state = useLocalStorage('apocalypse_dawn:module_fold_state', {\n  在场角色: false,\n  长期NPC: false,\n});\nconst is_onstage_folded = computed(() => Boolean(data.value.界面.模块折叠?.在场角色 ?? module_fold_state.value.在场角色));\nconst is_longterm_folded = computed(() => Boolean(data.value.界面.模块折叠?.长期NPC ?? module_fold_state.value.长期NPC));\nconst longterm_npc_list = computed(() => {\n  const source = data.value.世界?.长期NPC列表;\n  if (!source || typeof source !== 'object') return [];\n  return Object.values(source as Record<string, any>);\n});\nconst warehouse_items = computed(() => {\n  const source = data.value.战利品?.仓库?.物品;\n  if (!source || typeof source !== 'object') return [];\n  return Object.entries(source as Record<string, any>)\n    .map(([name, raw]) => ({\n      name,\n      quality: String(raw?.品质 ?? '通用'),\n      count: Number(raw?.数量 ?? 0),\n      category: String(raw?.分类 ?? '杂项'),\n      value: Number(raw?.价值 ?? 0),\n    }))\n    .filter(v => v.count > 0)\n    .sort((a, b) => b.count - a.count);\n});\nconst show_create = computed(() => !data.value.界面.建卡.已开始);\n\nconst create_stage = ref<CreateStage>('cover');\nconst create_error = ref('');\nconst cheat_mode = ref(false);\nconst plot_mode = ref(false);\nconst draft_initialized = ref(false);\n\nconst warmaid_types: WarmaidType[] = ['侦察型', '轻型', '中型', '重型', '要塞型', '地面支援姬'];\nconst human_keys: HumanKey[] = ['力量', '敏捷', '体质', '感知', '意志', '魅力', '学识'];\nconst air_phase_options = ['遭遇', '行动点计算', '站位划分', '制空判定', '行动序列', '回合执行', '空战结算'] as const;\nconst air_layer_options = ['湍流层', '云层', '高空', '标准空域', '低空', '地面'] as const;\nconst scout_unit_options = ['侦察型', '轻型', '中型', '重型及以上'] as const;\nconst scout_target_options = ['侦察型', '轻型', '中型', '重型', '要塞'] as const;\nconst ability_pick_limit = 2;\nconst base_ability_map: Record<Profession, AbilityItem[]> = {\n  指挥官: [\n    { name: '指挥通畅', desc: '维持编队链路稳定，减少战术执行混乱。', source: '对应DOCX“指挥官专用/综合指挥链路”' },\n    { name: '调律校准', desc: '更快完成战姬频率调律，缩短战前准备。', source: '对应DOCX“指挥官可进行调律”' },\n    { name: '无人补给', desc: '补给舰调度更高效，提升队伍续航。', source: '对应DOCX“指挥官补给舰与补给链”' },\n    { name: '阵型推演', desc: '更早解锁并熟练使用编队阵型。', source: '对应DOCX“阵型由指挥官决定”' },\n    { name: '后卫协同', desc: '在后卫/支援阵线进行更稳定的协同支援。', source: '对应DOCX“指挥官适合支援阵线”' },\n    { name: '战术复盘', desc: '战后快速总结，提升后续行动判定质量。', source: '对应DOCX“读书/学习解锁编队能力”' },\n  ],\n  战姬: [\n    { name: '灵装预热', desc: '灵装化启动更平滑，降低开场波动。', source: '对应DOCX“战姬灵装化规则”' },\n    { name: '高机动切入', desc: '进入交锋区时更容易建立优势。', source: '对应DOCX“空战分层与机动”' },\n    { name: '火力压制', desc: '持续火力更稳定，压制敌方行动。', source: '对应DOCX“连射/多武器火力流程”' },\n    { name: '污染耐受', desc: '对异种污染与持续损伤的承受更强。', source: '对应DOCX“抗污染值与灵装维持”' },\n    { name: '近战反制', desc: '在近距交锋中更易抓住反击窗口。', source: '对应DOCX“地面战动作与反射动作”' },\n    { name: '空域感知', desc: '对空域变化与目标动向更敏锐。', source: '对应DOCX“空战侦查/制空信息”' },\n  ],\n  权柄使役者: [\n    { name: '仪式构筑', desc: '更快完成基础仪式框架部署。', source: '对应DOCX“权柄使役者通过仪式施术”' },\n    { name: '圣器引导', desc: '借由象征物与圣器稳定权柄输出。', source: '对应DOCX“圣器与契约表象”' },\n    { name: '权柄共鸣', desc: '更容易触发权柄碎片的有效回应。', source: '对应DOCX“家族血脉中的权柄碎片”' },\n    { name: '精神锚定', desc: '降低高压施术时的精神失稳风险。', source: '对应DOCX“超自然力量承载风险”' },\n    { name: '象征施术', desc: '以简化行为完成可控施术。', source: '对应DOCX“书写者可用简化仪式”' },\n    { name: '契约缄默', desc: '在风险边界内控制权柄代价外溢。', source: '对应DOCX“高位契约与代价”' },\n  ],\n};\n\nconst human_caps: Record<HumanKey, number> = {\n  力量: 5,\n  敏捷: 5,\n  体质: 5,\n  感知: 5,\n  意志: 5,\n  魅力: 5,\n  学识: 5,\n};\n\nconst warmaid_dice_rules: Record<WarmaidType, Record<WarmaidAttrKey, string>> = {\n  侦察型: { 魔力评级: '4D6', 力量加成: '2D6', 体质加成: '2D6', 抗污染值: '2D6', 飞行速度: '6D6', 防御评级: '1D4' },\n  轻型: { 魔力评级: '4D6', 力量加成: '3D6', 体质加成: '3D6', 抗污染值: '3D6', 飞行速度: '5D6', 防御评级: '2D6' },\n  中型: { 魔力评级: '4D6', 力量加成: '4D6', 体质加成: '3D6', 抗污染值: '5D6', 飞行速度: '4D6', 防御评级: '3D8' },\n  重型: { 魔力评级: '4D6', 力量加成: '6D6', 体质加成: '5D6', 抗污染值: '6D6', 飞行速度: '3D5', 防御评级: '4D8' },\n  要塞型: { 魔力评级: '4D6', 力量加成: '10D6', 体质加成: '7D6', 抗污染值: '10D6', 飞行速度: '1D2', 防御评级: '7D10' },\n  地面支援姬: { 魔力评级: '4D6', 力量加成: '5D6', 体质加成: '4D6', 抗污染值: '10D6', 飞行速度: '1D1', 防御评级: '4D12' },\n};\n\nconst age_limit_map: Record<Profession, { min: number; max: number }> = {\n  指挥官: { min: 21, max: 70 },\n  战姬: { min: 12, max: 21 },\n  权柄使役者: { min: 12, max: 80 },\n};\nconst skill_points_total = 4;\nconst authority_paths: AuthorityPath[] = ['生命', '历史', '群星', '黎明', '黑夜', '力量', '希望', '勇气', '梦想'];\nconst authority_forbidden_pattern = /无敌|神|成神|全能|直接成为权柄之主|权柄之主|永生|秒杀|无限|必胜|无上限/i;\nconst background_filter_pattern = /武器|装备|能力|技能|灵装|道具|神器|无敌|神格|权柄之主/i;\nconst training_keyword_pattern = /军人|军队|部队|训练|受训|战术|服役|教官|军校|实战/;\nconst warmaid_skill_tree: Record<WarmaidType, SkillNode[]> = {\n  侦察型: [\n    { id: '1', name: '侦察升级', cost: 1, desc: '侦察骰点提升1D6，侦察大成功范围增加。', prerequisites: [] },\n    { id: '1.1', name: '精锐侦察', cost: 2, desc: '侦察完毕后压制敌方侦察并夺取制空。', prerequisites: ['1'] },\n    { id: '2', name: '灵能提升', cost: 1, desc: '防御评级提升2D5。', prerequisites: [] },\n    { id: '2.1', name: '灵装升级', cost: 2, desc: '额外2级武器槽位并增加1D5魔力评级。', prerequisites: ['2'] },\n    { id: '3', name: '滑翔', cost: 2, desc: '无声行动，降低被侦察概率。', prerequisites: [] },\n    { id: '4', name: '空战适应性', cost: 1, desc: '生存能力提高并增加一个武器槽。', prerequisites: [] },\n    { id: '4.1', name: '空战高手', cost: 3, desc: '飞行速度提升，可短暂魔力加压再提速。', prerequisites: ['4'] },\n    { id: '5', name: '炮火通讯协议', cost: 2, desc: '辅助瞄准叠加重武器命中直至必中。', prerequisites: [] },\n  ],\n  轻型: [\n    { id: '1', name: '追猎者', cost: 1, desc: '低生命目标伤害提升并提高追击速度。', prerequisites: [] },\n    { id: '1.1', name: '寻血猎犬', cost: 2, desc: '追击时减目标移动并放宽近战触发。', prerequisites: ['1'] },\n    { id: '1.2', name: '猎血狂犬', cost: 3, desc: '低血量目标额外伤害并施加强压制。', prerequisites: ['1', '1.1'] },\n    { id: '2', name: '自由飞翔', cost: 1, desc: '飞行速度增加1D6。', prerequisites: [] },\n    { id: '2.1', name: '空中雄鹰', cost: 2, desc: '速度优势时所有武器命中+20。', prerequisites: ['2'] },\n    { id: '2.2', name: '王牌猎鹰', cost: 3, desc: '速度优势时所有武器伤害+10。', prerequisites: ['2', '2.1'] },\n    { id: '3', name: '武装巡逻', cost: 1, desc: '保留行动可阻断敌方侦察/辅助并必中反制。', prerequisites: [] },\n  ],\n  中型: [\n    { id: '1', name: '空中战法', cost: 1, desc: '全属性增加2点。', prerequisites: [] },\n    { id: '1.1', name: '竞争战法', cost: 2, desc: '自选两项属性增加1D6。', prerequisites: ['1'] },\n    { id: '1.2', name: '精锐战法', cost: 3, desc: '额外武器槽与自由分配点数。', prerequisites: ['1', '1.1'] },\n    { id: '2', name: '扩散压制', cost: 1, desc: '可同时压制两个区域。', prerequisites: [] },\n    { id: '2.1', name: '空中骑士', cost: 2, desc: '对同级及以下目标伤害/穿甲/命中提升。', prerequisites: ['2'] },\n    { id: '2.2', name: '空中领主', cost: 3, desc: '同空域小体型敌方全面削弱。', prerequisites: ['2', '2.1'] },\n    { id: '2.3', name: '空中霸权', cost: 4, desc: '同空域敌方持续削弱，抗污染底线锁定。', prerequisites: ['2', '2.1', '2.2'] },\n    { id: '3', name: '卫戍协议', cost: 3, desc: '可伴飞重型并令敌方视为后卫状态。', prerequisites: [] },\n  ],\n  重型: [\n    { id: '1', name: '高度防御', cost: 1, desc: '防御评级增加1D10。', prerequisites: [] },\n    { id: '2', name: '密集编队', cost: 1, desc: '同阵线有友方时命中和速度提升。', prerequisites: [] },\n    { id: '2.1', name: '支援', cost: 2, desc: '前线可无损使用重武器，交锋区命中提升。', prerequisites: ['2'] },\n    { id: '3', name: '先进瞄准', cost: 1, desc: '瞄准命中增加。', prerequisites: [] },\n    { id: '3.1', name: '魔力侦测', cost: 2, desc: '同目标失误后下次命中加值累计。', prerequisites: ['3'] },\n    { id: '4', name: '密集打击', cost: 3, desc: '额外装载两武器槽并降低多武器惩罚。', prerequisites: [] },\n  ],\n  要塞型: [\n    { id: '1', name: '不落要塞', cost: 1, desc: '防御增加2D10。', prerequisites: [] },\n    { id: '1.1', name: '托布鲁克的铭记', cost: 2, desc: '单次伤害上限压制至40%。', prerequisites: ['1'] },\n    { id: '1.2', name: '马奇诺的警示', cost: 3, desc: '半血强化防御，低抗污染时减伤。', prerequisites: ['1', '1.1'] },\n    { id: '2', name: '密集炮火', cost: 2, desc: '额外携带1门武器并提升负重。', prerequisites: [] },\n    { id: '2.1', name: '超密集火炮', cost: 2, desc: '再增武器槽并降低多武器惩罚。', prerequisites: ['2'] },\n    { id: '2.2', name: '饱和式打击', cost: 3, desc: '一次战斗一次的全武器齐射。', prerequisites: ['2', '2.1'] },\n    { id: '3', name: '自我校准', cost: 1, desc: '首次命中后同空域目标后续惩罚减免。', prerequisites: [] },\n    { id: '4', name: '联合反击', cost: 6, desc: '进入自动反击状态，遭重型攻击即反制炮击。', prerequisites: [] },\n  ],\n  地面支援姬: [\n    { id: '1', name: '高度防御', cost: 1, desc: '防御评级增加1D10。', prerequisites: [] },\n    { id: '2', name: '密集编队', cost: 1, desc: '同阵线协同时命中与速度提升。', prerequisites: [] },\n    { id: '2.1', name: '支援', cost: 2, desc: '前线支援火力无损并强化命中。', prerequisites: ['2'] },\n    { id: '3', name: '先进瞄准', cost: 1, desc: '瞄准命中增加。', prerequisites: [] },\n  ],\n};\n\nconst opening_story = `【联合纪年177年8月28日】\n你们是新一批威曼普学院的新生。\n根据【第二协议】中的对等条款，曾经在各地上中学的你们，在即将升到高中时，作为各地与威曼普学院的某种交换成为了对抗异种的中坚力量预备军。\n而好巧不巧的是，在你们接到入学通知的时候，异种在领主【咒妄】的率领下，突破了联合北部防线，斯托尔，夏顿两座边塞城市的沦陷，直接导致重要军事要塞光明大圣堂被完全包围。\n如果光明大圣堂沦陷，整个北部防线有被以点带面凿穿的风险，威曼普城同样根据【第二协议】的条款，派出了【海洋】【魔法支点】【学士】三个结社前往支援。\n而除了这些明面上的力量，新生也不可避免的被卷入了这场漩涡，正面战场也许很难帮得上忙，但是，繁杂的侦查，辅助，探索，清理少量异种的任务，还是不可避免的向你们袭来。\n而幸运与不幸的是，你们这支新成立的学员小队，恰巧成为了最前端的侦察小队，即将承接可能带来最丰厚报偿，也可能是送命的侦查任务……`;\n\nconst create_form = reactive({\n  角色姓名: '',\n  职业: '指挥官' as Profession,\n  战姬类型: '轻型' as WarmaidType,\n  性别: '男性' as Gender,\n  年龄: 21,\n});\nconst selected_warmaid_skills = ref<string[]>([]);\nconst warmaid_custom_skills = ref('');\nconst background_input = ref('');\nconst background_summary_override = ref('');\nconst authority_build = reactive({\n  途径: '生命' as AuthorityPath,\n  名称: '',\n  技能描述: '',\n});\n\nconst human_attr = reactive<Record<HumanKey, number>>({\n  力量: 1,\n  敏捷: 1,\n  体质: 1,\n  感知: 1,\n  意志: 1,\n  魅力: 1,\n  学识: 1,\n});\n\nconst warmaid_attr = reactive<WarmaidStats>({\n  魔力评级: 0,\n  力量加成: 0,\n  体质加成: 0,\n  抗污染值: 0,\n  飞行速度: 0,\n  防御评级: 0,\n});\n\nconst warmaid_rolled = ref(false);\nconst selected_abilities = ref<string[]>([]);\n\nconst age_limit = computed(() => age_limit_map[create_form.职业]);\nconst human_points_left = computed(() => 5 - (_.sum(Object.values(human_attr)) - human_keys.length));\nconst current_base_abilities = computed(() => base_ability_map[create_form.职业]);\nconst current_ability_title = computed(() => `${create_form.职业}能力组`);\nconst current_ability_hint = computed(() => {\n  if (create_form.职业 === '指挥官') return '指挥官能力偏重链路、补给、阵型与协同。';\n  if (create_form.职业 === '战姬') return '战姬能力偏重灵装、机动、火力与抗污染。';\n  return '权柄使役者能力偏重仪式、圣器、契约与权柄稳定。';\n});\nconst current_warmaid_skills = computed(() => warmaid_skill_tree[create_form.战姬类型] ?? []);\nconst selected_warmaid_skill_cost = computed(() => {\n  const map = new Map(current_warmaid_skills.value.map(v => [v.id, v.cost]));\n  return selected_warmaid_skills.value.reduce((sum, id) => sum + (map.get(id) ?? 0), 0);\n});\nconst skill_points_left = computed(() => Math.max(0, skill_points_total - selected_warmaid_skill_cost.value));\n\nconst current_dice_rules = computed(() => {\n  const rule = warmaid_dice_rules[create_form.战姬类型];\n  return [\n    { key: '魔力评级', rule: rule.魔力评级 },\n    { key: '力量加成', rule: rule.力量加成 },\n    { key: '体质加成', rule: rule.体质加成 },\n    { key: '抗污染值', rule: rule.抗污染值 },\n    { key: '飞行速度', rule: rule.飞行速度 },\n    { key: '防御评级', rule: rule.防御评级 },\n  ];\n});\n\nconst warmaid_result_list = computed(() => [\n  { key: '魔力评级', value: warmaid_attr.魔力评级 },\n  { key: '力量加成', value: warmaid_attr.力量加成 },\n  { key: '体质加成', value: warmaid_attr.体质加成 },\n  { key: '抗污染值', value: warmaid_attr.抗污染值 },\n  { key: '飞行速度', value: warmaid_attr.飞行速度 },\n  { key: '防御评级', value: warmaid_attr.防御评级 },\n]);\n\nconst profession = computed<Profession>(() => {\n  const saved = data.value.界面.建卡?.职业;\n  if (saved === '指挥官' || saved === '战姬' || saved === '权柄使役者') return saved;\n  if (data.value.主角.档案.身份路径.includes('战姬')) return '战姬';\n  if (data.value.主角.档案.身份路径.includes('权柄')) return '权柄使役者';\n  return '指挥官';\n});\nconst display_gender = computed(() => {\n  const raw = String((data.value as any).主角?.档案?.性别 ?? '').trim();\n  if (raw) return raw;\n  return profession.value === '战姬' ? '女性' : '未设定';\n});\n\nconst is_warmaid = computed(() => profession.value === '战姬');\n\nconst human_attributes = computed(() => {\n  const base = data.value.主角.人类属性;\n  const train = data.value.主角.锻炼;\n  const add_str = is_warmaid.value && data.value.主角.灵装化.启用 ? data.value.主角.属性.力量加成 : 0;\n  const add_con = is_warmaid.value && data.value.主角.灵装化.启用 ? data.value.主角.属性.体质加成 : 0;\n  return [\n    { key: '力量', value: base.力量 + add_str, training: train.力量 },\n    { key: '敏捷', value: base.敏捷, training: train.敏捷 },\n    { key: '体质', value: base.体质 + add_con, training: train.体质 },\n    { key: '感知', value: base.感知, training: train.感知 },\n    { key: '意志', value: base.意志, training: train.意志 },\n    { key: '魅力', value: base.魅力, training: train.魅力 },\n    { key: '学识', value: base.学识, training: train.学识 },\n  ];\n});\n\nconst warmaid_attributes = computed(() => [\n  { key: '魔力评级', value: data.value.主角.属性.魔力评级 },\n  { key: '力量加成', value: data.value.主角.属性.力量加成 },\n  { key: '体质加成', value: data.value.主角.属性.体质加成 },\n  { key: '抗污染值', value: data.value.主角.属性.抗污染值 },\n  { key: '飞行速度', value: data.value.主角.属性.飞行速度 },\n  { key: '防御评级', value: data.value.主角.属性.防御评级 },\n]);\n\nconst level_label = computed(() => {\n  if (profession.value === '战姬') return '战姬老练等级';\n  if (profession.value === '权柄使役者') return '权柄使役者等级';\n  return '军衔等级';\n});\n\nconst warmaid_rank_names = ['新手', '入门', '标准', '熟练', '专业', '精锐', '传奇'] as const;\nconst authority_rank_names = ['信徒', '书写者', '编织者', '权柄之主'] as const;\n\nconst level_value = computed(() => {\n  if (profession.value === '战姬') {\n    const idx = _.clamp(data.value.主角.成长.战姬老练等级, 1, warmaid_rank_names.length) - 1;\n    return warmaid_rank_names[idx];\n  }\n  if (profession.value === '权柄使役者') {\n    const idx = _.clamp(data.value.主角.成长.权柄使役者等级, 1, authority_rank_names.length) - 1;\n    return authority_rank_names[idx];\n  }\n  return '-';\n});\n\nconst level_meta_lines = computed(() => {\n  if (profession.value === '战姬') {\n    const current = _.clamp(data.value.主角.成长.战姬老练等级, 1, warmaid_rank_names.length);\n    const next = current < warmaid_rank_names.length ? warmaid_rank_names[current] : '已达最高';\n    const need = data.value.主角.成长.下一级所需魔力碎片;\n    return [\n      `魔力碎片: ${data.value.主角.成长.魔力碎片}`,\n      current < warmaid_rank_names.length ? `下一阶: ${next}（需 ${need}）` : '老练等级已达顶阶',\n    ];\n  }\n  if (profession.value === '权柄使役者') {\n    const shard = data.value.主角.成长.权柄碎片;\n    const has_origin = data.value.主角.成长.权柄本源;\n    const lv = _.clamp(data.value.主角.成长.权柄使役者等级, 1, authority_rank_names.length);\n    if (lv <= 1) return [`权柄碎片: ${shard}`, '下一阶: 书写者（需 50 权柄碎片）'];\n    if (lv === 2) return [`权柄碎片: ${shard}`, '下一阶: 编织者（需 100 权柄碎片）'];\n    if (lv === 3) return [`权柄碎片: ${shard}`, has_origin ? '下一阶: 权柄之主（需 1000 权柄碎片）' : '下一阶: 权柄之主（需 1000 权柄碎片 + 权柄本源）'];\n    return [`权柄碎片: ${shard}`, `权柄本源: ${has_origin ? '已持有' : '未持有'}`];\n  }\n  return ['无等级成长信息'];\n});\n\nfunction extractFloorTextFromRaw(raw: string): string {\n  if (!raw) return '';\n\n  const content_match = raw.match(/<content>([\\s\\S]*?)<\\/content>/im);\n  const source = content_match?.[1] ?? raw;\n\n  return source\n    .replace(/<update(?:variable)?>[\\s\\S]*?<\\/update(?:variable)?>/gim, '')\n    .replace(/<update(?:variable)?>[\\s\\S]*$/gim, '')\n    .replace(/<StatusPlaceHolderImpl\\/>/gim, '')\n    .replace(/<OnStageCharacters>[\\s\\S]*?<\\/OnStageCharacters>/gim, '')\n    .replace(/<NpcRelationHints>[\\s\\S]*?<\\/NpcRelationHints>/gim, '')\n    .replace(/<(?:think|thinking|context|disclaimer|tucao|current_event|progress)[^>]*>[\\s\\S]*?<\\/(?:think|thinking|context|disclaimer|tucao|current_event|progress)>/gim, '')\n    .replace(/<(?:think|thinking|context|disclaimer|tucao|current_event|progress)[^>]*\\/>/gim, '')\n    .replace(/```[\\s\\S]*?```/gim, '')\n    .replace(/<\\/?[^>\\n]+>/g, '')\n    .replace(/\\r/g, '')\n    .replace(/\\n{3,}/g, '\\n\\n')\n    .trim();\n}\n\nfunction format_attr_text(attrs: Record<string, number>): string {\n  const entries = Object.entries(attrs ?? {});\n  if (entries.length === 0) return '基础属性：暂无';\n  return `基础属性：${entries.map(([k, v]) => `${k}:${v}`).join(' / ')}`;\n}\n\nfunction toggle_module(module_name: '在场角色' | '长期NPC'): void {\n  if (!data.value.界面.模块折叠) {\n    data.value.界面.模块折叠 = {\n      在场角色: false,\n      长期NPC: false,\n    };\n  }\n  const current = Boolean(data.value.界面.模块折叠[module_name]);\n  data.value.界面.模块折叠[module_name] = !current;\n  module_fold_state.value = {\n    ...module_fold_state.value,\n    [module_name]: !current,\n  };\n}\n\nwatch(\n  () => create_form.职业,\n  () => {\n    create_form.年龄 = _.clamp(Number(create_form.年龄) || age_limit.value.min, age_limit.value.min, age_limit.value.max);\n    if (create_form.职业 === '战姬') create_form.性别 = '女性';\n    const valid_ability_names = new Set(current_base_abilities.value.map(v => v.name));\n    selected_abilities.value = selected_abilities.value.filter(name => valid_ability_names.has(name));\n    selected_warmaid_skills.value = [];\n    warmaid_custom_skills.value = '';\n    authority_build.名称 = '';\n    authority_build.技能描述 = '';\n    authority_build.途径 = '生命';\n    if (create_form.职业 !== '战姬') {\n      warmaid_rolled.value = false;\n      Object.assign(warmaid_attr, { 魔力评级: 0, 力量加成: 0, 体质加成: 0, 抗污染值: 0, 飞行速度: 0, 防御评级: 0 });\n    }\n  },\n  { immediate: true },\n);\n\nwatch(\n  () => create_form.战姬类型,\n  () => {\n    warmaid_rolled.value = false;\n  },\n);\n\nwatch(\n  () => show_create.value,\n  show => {\n    if (!show) {\n      draft_initialized.value = false;\n      return;\n    }\n    if (draft_initialized.value) return;\n\n    const saved = data.value.界面.建卡;\n    if (!saved || saved.已开始) return;\n\n    create_form.角色姓名 = saved.角色姓名 || '';\n    create_form.职业 = saved.职业;\n    create_form.战姬类型 = saved.战姬类型;\n    create_form.性别 = (saved as any).性别 === '女性' ? '女性' : create_form.职业 === '战姬' ? '女性' : '男性';\n    create_form.年龄 = saved.年龄;\n    cheat_mode.value = Boolean(saved.作弊模式);\n    plot_mode.value = Boolean((saved as any).剧情模式);\n    draft_initialized.value = true;\n  },\n  { immediate: true },\n);\n\nwatchEffect(() => {\n  if (show_create.value) return;\n  const in_air_battle = data.value.主角.战术.战斗模式 === '空战' && data.value.主角.战术.是否战斗中;\n  if (in_air_battle) active_tab.value = 'battle';\n});\n\nfunction build_next_actions_from_reply(text: string): string[] {\n  const t = text.trim();\n  if (!t) return [...default_next_action_options];\n\n  const pool: string[] = [];\n  const pushUnique = (v: string) => {\n    const s = v.trim();\n    if (!s) return;\n    if (!pool.includes(s)) pool.push(s);\n  };\n\n  if (/报到|学院|新生|教官|训练/.test(t)) {\n    pushUnique('前往报到处补全入学手续');\n    pushUnique('向教官申请进行首次适配训练');\n  }\n  if (/战斗|空战|异种|敌人|警报|突袭/.test(t)) {\n    pushUnique('进入战备状态并确认当前阵线');\n    pushUnique('申请侦察并汇报敌情');\n    pushUnique('检查武装与资源后准备交战');\n  }\n  if (/图书馆|资料|线索|情报|调查/.test(t)) {\n    pushUnique('前往图书馆检索相关情报');\n    pushUnique('对当前线索进行整理并提出假设');\n  }\n  if (/任务|委托|小队|行动/.test(t)) {\n    pushUnique('确认小队分工并接受当前任务');\n    pushUnique('向队友同步行动计划');\n  }\n  if (/受伤|治疗|恢复|污染/.test(t)) {\n    pushUnique('优先处理伤势与污染状态');\n  }\n  if (/交易|黑市|物资|联合币/.test(t)) {\n    pushUnique('整理仓库并评估黑市交易方案');\n  }\n\n  // fallback\n  pushUnique('与在场角色进行交流');\n  pushUnique('查看近期事务并决定下一步');\n  pushUnique('进行一次谨慎侦察行动');\n  pushUnique('根据当前局势推进主线任务');\n\n  return ensure_four_actions(pool.slice(0, 4));\n}\n\nfunction ensure_four_actions(list: string[]): string[] {\n  const result: string[] = [];\n  for (const item of list) {\n    const t = String(item ?? '').trim();\n    if (!t) continue;\n    if (!result.includes(t)) result.push(t);\n    if (result.length >= 4) return result;\n  }\n  for (const item of default_next_action_options) {\n    if (!result.includes(item)) result.push(item);\n    if (result.length >= 4) break;\n  }\n  return result.slice(0, 4);\n}\n\nwatch(\n  () => display_floor_text.value,\n  (val) => {\n    const source = String(val ?? '').trim() || String(data.value.界面?.楼层文本?.原文 ?? '');\n    next_action_options.value = ensure_four_actions(build_next_actions_from_reply(source));\n  },\n  { immediate: true },\n);\nwatch(\n  () => Number((data.value as any).界面?.楼层文本?.更新时间 ?? 0),\n  () => {\n    const source = String(display_floor_text.value ?? '').trim() || String(data.value.界面?.楼层文本?.原文 ?? '');\n    next_action_options.value = ensure_four_actions(build_next_actions_from_reply(source));\n  },\n);\n\nfunction change_human(key: HumanKey, delta: number): void {\n  if (delta > 0) {\n    if (human_points_left.value <= 0) return;\n    if (human_attr[key] >= human_caps[key]) return;\n    human_attr[key] += 1;\n    return;\n  }\n\n  if (human_attr[key] <= 1) return;\n  human_attr[key] -= 1;\n}\n\nfunction go_human_step(): void {\n  create_error.value = '';\n\n  const name = create_form.角色姓名.trim();\n  if (!name) {\n    create_error.value = '请输入角色姓名';\n    return;\n  }\n\n  const limit = age_limit.value;\n  const age = Number(create_form.年龄);\n  if (!cheat_mode.value && (!Number.isFinite(age) || age < limit.min || age > limit.max)) {\n    create_error.value = `年龄不符合职业限制（${limit.min}-${limit.max}）`;\n    return;\n  }\n\n  create_stage.value = 'human';\n}\n\nfunction go_next_after_human(): void {\n  create_error.value = '';\n  if (!cheat_mode.value && human_points_left.value !== 0) {\n    create_error.value = '请先分配完全部 5 点人类属性';\n    return;\n  }\n\n  create_stage.value = 'abilities';\n}\n\nfunction toggle_ability(name: string): void {\n  create_error.value = '';\n  const current = selected_abilities.value;\n  if (current.includes(name)) {\n    selected_abilities.value = current.filter(v => v !== name);\n    return;\n  }\n  if (current.length >= ability_pick_limit) {\n    create_error.value = `当前版本最多选择 ${ability_pick_limit} 项基础能力`;\n    return;\n  }\n  selected_abilities.value = [...current, name];\n}\n\nfunction go_next_after_abilities(): void {\n  create_error.value = '';\n  if (!cheat_mode.value && selected_abilities.value.length === 0) {\n    create_error.value = '请至少选择 1 项基础能力';\n    return;\n  }\n  create_stage.value = 'profession';\n}\n\nfunction hasWarmaidSkillPrerequisites(skill_id: string): boolean {\n  const node = current_warmaid_skills.value.find(v => v.id === skill_id);\n  if (!node) return false;\n  return node.prerequisites.every(pre => selected_warmaid_skills.value.includes(pre));\n}\n\nfunction toggle_warmaid_skill(skill_id: string): void {\n  create_error.value = '';\n  const node = current_warmaid_skills.value.find(v => v.id === skill_id);\n  if (!node) return;\n\n  if (selected_warmaid_skills.value.includes(skill_id)) {\n    const used_as_pre = current_warmaid_skills.value.some(v =>\n      selected_warmaid_skills.value.includes(v.id) && v.prerequisites.includes(skill_id));\n    if (used_as_pre && !cheat_mode.value) {\n      create_error.value = '有后续技能依赖该节点，无法取消';\n      return;\n    }\n    selected_warmaid_skills.value = selected_warmaid_skills.value.filter(v => v !== skill_id);\n    return;\n  }\n\n  if (!cheat_mode.value && !hasWarmaidSkillPrerequisites(skill_id)) {\n    create_error.value = `技能 ${skill_id} 前置条件不足`;\n    return;\n  }\n  if (!cheat_mode.value && selected_warmaid_skill_cost.value + node.cost > skill_points_total) {\n    create_error.value = `技能点不足（初始仅 ${skill_points_total} 点）`;\n    return;\n  }\n\n  selected_warmaid_skills.value = [...selected_warmaid_skills.value, skill_id];\n}\n\nfunction sanitizeBackground(raw: string): string {\n  const compact = raw\n    .split(/\\r?\\n/)\n    .map(line => line.trim())\n    .filter(Boolean)\n    .filter(line => !background_filter_pattern.test(line))\n    .join(' ');\n  return compact.slice(0, 320);\n}\n\nfunction validateAuthorityBuild(): string {\n  if (create_form.职业 !== '权柄使役者') return '';\n  if (!authority_build.名称.trim()) return '请填写权柄名称';\n  if (!authority_build.技能描述.trim()) return '请填写赋予技能';\n  const merged = `${authority_build.名称}\\n${authority_build.技能描述}`;\n  if (!cheat_mode.value && authority_forbidden_pattern.test(merged)) {\n    return '权柄描述存在超限内容（无敌/成神/直接权柄之主等），请重写';\n  }\n  return '';\n}\n\nfunction go_next_after_profession(): void {\n  create_error.value = '';\n  if (create_form.职业 === '战姬' && !cheat_mode.value && selected_warmaid_skills.value.length === 0) {\n    create_error.value = '请至少选择1个战姬技能节点';\n    return;\n  }\n\n  const authority_err = validateAuthorityBuild();\n  if (authority_err) {\n    create_error.value = authority_err;\n    return;\n  }\n  create_stage.value = 'background';\n}\n\nfunction go_next_after_background(): void {\n  create_error.value = '';\n  if (!background_input.value.trim() && !cheat_mode.value) {\n    create_error.value = '请填写背景';\n    return;\n  }\n  if (create_form.职业 === '战姬') {\n    create_stage.value = 'warmaid';\n    return;\n  }\n  finish_create();\n}\n\nfunction rollD(sides: number): number {\n  return Math.floor(Math.random() * sides) + 1;\n}\n\nfunction ensure_air_defaults(): void {\n  if (!data.value.主角?.战术?.空战) return;\n  if (!data.value.主角.战术.词条区) data.value.主角.战术.词条区 = {};\n}\n\nfunction roll_air_weather(): void {\n  ensure_air_defaults();\n  const r = rollD(100);\n  const air = data.value.主角.战术.空战;\n  air.天气判定值 = r;\n  air.台风眼格 = [];\n  if (r <= 10) {\n    air.天气 = '万里无云';\n    air.天气命中修正 = 10;\n    air.天气探测修正 = 50;\n    air.天气移速倍率 = 1;\n  } else if (r <= 70) {\n    air.天气 = '天气晴朗';\n    air.天气命中修正 = 5;\n    air.天气探测修正 = 0;\n    air.天气移速倍率 = 1;\n  } else if (r <= 80) {\n    air.天气 = '阴雨连绵';\n    air.天气命中修正 = -10;\n    air.天气探测修正 = -50;\n    air.天气移速倍率 = 0.5;\n  } else if (r <= 90) {\n    air.天气 = '雷暴雨天';\n    air.天气命中修正 = -15;\n    air.天气探测修正 = -50;\n    air.天气移速倍率 = 0.5;\n  } else {\n    air.天气 = '台风天';\n    air.天气命中修正 = -20;\n    air.天气探测修正 = -30;\n    air.天气移速倍率 = 0.6;\n    air.台风眼格 = ['E3', 'H6'];\n  }\n  data.value.战场日志[`天气判定-${Date.now()}`] = `${air.天气}（d100=${r}，命中修正${air.天气命中修正}）`;\n}\n\nfunction score_air_side(side: { 侦察型: number; 轻型: number; 中型: number; 重型: number; 要塞型: number; 其他: number }): number {\n  return side.侦察型 * 3 + side.轻型 * 3 + side.中型 * 2 + side.重型 + side.其他;\n}\n\nfunction calc_air_superiority(): void {\n  ensure_air_defaults();\n  const air = data.value.主角.战术.空战;\n  const my_recon = air.我方单位.侦察型;\n  const enemy_recon = air.敌方单位.侦察型;\n  air.我方制空点 = score_air_side(air.我方单位);\n  air.敌方制空点 = score_air_side(air.敌方单位);\n\n  if (!air.触发突袭轮 && my_recon > 0 && enemy_recon === 0) {\n    data.value.主角.战术.制空权 = '我方';\n    air.制空修正 = 1;\n    air.重武器命中条件 = '我方可视为提前完成重武器架设';\n  } else if (!air.触发突袭轮 && enemy_recon > 0 && my_recon === 0) {\n    data.value.主角.战术.制空权 = '敌方';\n    air.制空修正 = -1;\n    air.重武器命中条件 = '重武器需侦察/轻型辅助，否则命中无效';\n  } else if (air.我方制空点 > air.敌方制空点) {\n    data.value.主角.战术.制空权 = '我方';\n    air.制空修正 = 1;\n    air.重武器命中条件 = '无';\n  } else if (air.我方制空点 < air.敌方制空点) {\n    data.value.主角.战术.制空权 = '敌方';\n    air.制空修正 = -1;\n    air.重武器命中条件 = '重武器需侦察/轻型辅助，否则命中无效';\n  } else {\n    data.value.主角.战术.制空权 = '争夺中';\n    air.制空修正 = 0;\n    air.重武器命中条件 = '无';\n  }\n\n  data.value.战场日志[`制空判定-${Date.now()}`] = `我方${air.我方制空点}/敌方${air.敌方制空点}，制空权：${data.value.主角.战术.制空权}`;\n}\n\nfunction run_air_recon(): void {\n  ensure_air_defaults();\n  const air = data.value.主角.战术.空战;\n  const base_roll = rollD(10);\n  let bonus = 0;\n  if (air.侦查单位类型 === '侦察型') bonus = rollD(10);\n  else if (air.侦查单位类型 === '轻型') bonus = rollD(5);\n  else if (air.侦查单位类型 === '中型') bonus = rollD(20);\n  else bonus = 10;\n\n  const hide_map: Record<string, number> = { 侦察型: 10, 轻型: 8, 中型: 5, 重型: 2, 要塞: 1 };\n  const target = air.侦查目标类型;\n  const origin_hide = hide_map[target];\n  const roll = base_roll + bonus + air.天气探测修正;\n  const tag_text = Object.entries(data.value.主角.战术.词条区)\n    .map(([k, v]) => `${k}:${v.join(',')}`)\n    .join(' | ');\n\n  const has_camo = /迷彩/.test(tag_text);\n  const has_huge = /巨型|领主|再诞战姬/.test(tag_text);\n  let remaining = has_huge ? 0 : origin_hide;\n  if (!has_huge) {\n    if (!has_camo) remaining = Math.max(0, origin_hide - roll);\n  }\n\n  air.侦查结果 = roll;\n  air.目标隐匿剩余 = remaining;\n  data.value.战场日志[`侦查-${Date.now()}`] = `${air.侦查单位类型}侦查${target}：结果${roll}，隐匿剩余${remaining}${has_camo ? '（迷彩阻止消减）' : ''}`;\n}\n\nfunction record_air_tag(side: '我方' | '敌方'): void {\n  ensure_air_defaults();\n  const unit = window.prompt(`${side}单位名称`)?.trim();\n  const tags = window.prompt('输入词条，逗号分隔（如：迷彩,拟态）')?.trim();\n  if (!unit || !tags) return;\n  const list = tags.split(',').map(v => v.trim()).filter(Boolean);\n  data.value.主角.战术.词条区[`${side}-${unit}`] = list;\n  data.value.战场日志[`词条登记-${Date.now()}`] = `${side}-${unit} => ${list.join(',')}`;\n}\n\nfunction finish_air_battle_and_feedback(): void {\n  ensure_air_defaults();\n  const air = data.value.主角.战术.空战;\n  const logs = Object.entries(data.value.战场日志).slice(-3).map(([k, v]) => `${k}:${v}`).join('；');\n  const tag_lines = Object.entries(data.value.主角.战术.词条区).map(([k, v]) => `${k}[${v.join(',')}]`).join('；') || '无';\n  const summary = `空战结算：天气=${air.天气}(命中修正${air.天气命中修正})，空域=${air.空域层}，制空权=${data.value.主角.战术.制空权}（修正${air.制空修正 >= 0 ? '+' : ''}${air.制空修正}），突袭轮=${air.触发突袭轮 ? `是/${air.突袭来源}` : '否'}，侦查结果=${air.侦查结果}/隐匿剩余=${air.目标隐匿剩余}，词条区=${tag_lines}，最近战场日志=${logs}。请严格按该结算继续叙事。`;\n  data.value.界面.空战反馈 = {\n    待反馈: true,\n    摘要: summary,\n    时间戳: Date.now(),\n  };\n  data.value.主角.战术.是否战斗中 = false;\n  data.value.主角.战术.战斗模式 = '非战斗';\n  data.value.主角.战术.空战.流程阶段 = '空战结算';\n  data.value.世界.近期事务.空战结算 = summary;\n  data.value.战场日志[`空战结算-${Date.now()}`] = summary;\n}\n\nfunction rollExpr(expr: string): number {\n  const m = expr.trim().toUpperCase().match(/^(\\d+)D(\\d+)$/);\n  if (!m) return 0;\n  const count = Number(m[1]);\n  const sides = Number(m[2]);\n  let total = 0;\n  for (let i = 0; i < count; i += 1) total += rollD(sides);\n  return total;\n}\n\nfunction roll_warmaid_stats(): void {\n  create_error.value = '';\n  const rule = warmaid_dice_rules[create_form.战姬类型];\n  warmaid_attr.魔力评级 = rollExpr(rule.魔力评级);\n  warmaid_attr.力量加成 = rollExpr(rule.力量加成);\n  warmaid_attr.体质加成 = rollExpr(rule.体质加成);\n  warmaid_attr.抗污染值 = rollExpr(rule.抗污染值);\n  warmaid_attr.飞行速度 = rollExpr(rule.飞行速度);\n  warmaid_attr.防御评级 = rollExpr(rule.防御评级);\n  warmaid_rolled.value = true;\n}\n\nfunction finish_create(): void {\n  create_error.value = '';\n  if (create_form.职业 === '战姬' && !warmaid_rolled.value && !cheat_mode.value) {\n    create_error.value = '请先完成战姬六维骰点';\n    return;\n  }\n\n  const name = create_form.角色姓名.trim();\n  if (!name) {\n    create_error.value = '请输入角色姓名';\n    return;\n  }\n  const authority_err = validateAuthorityBuild();\n  if (authority_err) {\n    create_error.value = authority_err;\n    return;\n  }\n  const bg_raw = background_input.value.trim();\n  const bg_summary = background_summary_override.value.trim() || sanitizeBackground(bg_raw);\n  const training_source = `${bg_raw}\\n${bg_summary}`;\n  const training_state = training_keyword_pattern.test(training_source) ? '已受训' : '未受训';\n\n  data.value.界面.建卡 = {\n    已开始: true,\n    角色姓名: name,\n    职业: create_form.职业,\n    战姬类型: create_form.战姬类型,\n    性别: create_form.职业 === '战姬' ? '女性' : create_form.性别,\n    年龄: Number(create_form.年龄),\n    作弊模式: cheat_mode.value,\n    剧情模式: plot_mode.value,\n  };\n\n  data.value.主角.档案.代号 = name;\n  _.set(data.value, '主角.档案.性别', create_form.职业 === '战姬' ? '女性' : create_form.性别);\n  data.value.主角.档案.身份路径 = create_form.职业 === '战姬' ? `战姬-${create_form.战姬类型}` : create_form.职业;\n\n  data.value.主角.人类属性 = { ...human_attr };\n  data.value.主角.锻炼 = {\n    力量: 0,\n    敏捷: 0,\n    体质: 0,\n    感知: 0,\n    意志: 0,\n    魅力: 0,\n    学识: 0,\n  };\n\n  if (create_form.职业 === '战姬') {\n    data.value.主角.属性 = { ...warmaid_attr };\n    const max_mp = Math.max(20, warmaid_attr.魔力评级 * 10);\n    data.value.主角.资源.最大魔力 = max_mp;\n    data.value.主角.资源.当前魔力 = max_mp;\n    data.value.主角.灵装化.每回合耗魔 = Math.max(1, Math.ceil(max_mp / 10));\n  } else {\n    data.value.主角.属性 = {\n      魔力评级: 0,\n      力量加成: 0,\n      体质加成: 0,\n      抗污染值: 0,\n      飞行速度: 0,\n      防御评级: 0,\n    };\n  }\n\n  data.value.主角.灵装化.启用 = false;\n  data.value.主角.灵装化.手动切换 = false;\n  data.value.主角.灵装化.上次结算轮次 = data.value.主角.战术.当前轮次;\n  data.value.主角.基础能力.已选 = [...selected_abilities.value];\n  data.value.主角.技能树 = {\n    可用技能点: skill_points_total - selected_warmaid_skill_cost.value,\n    已用技能点: selected_warmaid_skill_cost.value,\n    已解锁: Object.fromEntries(selected_warmaid_skills.value.map(id => [id, true])),\n    自定义: warmaid_custom_skills.value.trim(),\n  };\n  data.value.主角.权柄 = {\n    权柄名称: authority_build.名称.trim(),\n    权柄途径: authority_build.途径,\n    碎片数: create_form.职业 === '权柄使役者' ? 1 : 0,\n    赋予技能: authority_build.技能描述.trim(),\n    审核通过: create_form.职业 !== '权柄使役者' ? false : !authority_forbidden_pattern.test(`${authority_build.名称}\\n${authority_build.技能描述}`),\n    审核备注: create_form.职业 === '权柄使役者' ? '初始为【信徒】。禁止无敌、成神、直接权柄之主等超限设定。' : '',\n  };\n  data.value.主角.背景 = {\n    原文: bg_raw,\n    摘要: bg_summary,\n  };\n  data.value.主角.成长.战姬老练等级 = 1;\n  data.value.主角.成长.权柄使役者等级 = 1;\n  data.value.主角.成长.魔力碎片 = 0;\n  data.value.主角.成长.下一级所需魔力碎片 = 10;\n  data.value.主角.成长.权柄碎片 = 0;\n  data.value.主角.成长.权柄本源 = false;\n\n  data.value.世界.当前时间 = '联合纪年177年8月28日 08:00';\n  data.value.世界.当前地点 = '卡尔斯战姬学院 主校区 报到大厅';\n  data.value.世界.战区威胁等级 = '低';\n  data.value.世界.新手引导 = {\n    剧情模式: plot_mode.value,\n    训练判定: training_state,\n    阶段: plot_mode.value ? '入学手续' : '自由推进',\n    入学手续进度: 0,\n    课程周进度: 0,\n    已完成入学手续: false,\n    已完成课程周: false,\n    已接希尔顿任务: false,\n    最后推进说明: plot_mode.value\n      ? '剧情模式已开启：请先完成入学手续，再完成一周课程，最后前往最低难度希尔顿试验室。'\n      : '剧情模式未开启：可自由推进。',\n  };\n  data.value.世界.近期事务 = {\n    新生报道: '在威曼普学院完成身份登记与宿舍分配',\n    北线战况: '咒妄率异种突破北部防线，光明大圣堂遭围困',\n    小队任务: '新生侦察小队即将承接前沿侦查任务',\n    背景摘要: bg_summary || '暂无背景摘要',\n    训练判定: training_state === '已受训' ? '背景含训练/战术经历，按受训生处理。' : '背景未出现军人/训练/战术经历，按未受训新生处理。',\n    引导链: plot_mode.value\n      ? '阶段1/3 入学手续：身份核验→链路适配→纪律简报。'\n      : '剧情模式关闭：不强制入学引导链。',\n  };\n\n  data.value.战场日志 = {\n    开场简报: '联合纪年177年8月28日，新生小队在威曼普学院报到并被编入前沿侦察序列。',\n  };\n  data.value.界面.楼层文本 = {\n    正文: opening_story,\n    原文: opening_story,\n    更新时间: Date.now(),\n  };\n  data.value.界面.在场角色 = [];\n  data.value.界面.模块折叠 = {\n    在场角色: false,\n    长期NPC: false,\n  };\n  module_fold_state.value = {\n    在场角色: false,\n    长期NPC: false,\n  };\n\n  data.value.战利品.显示战利品 = false;\n  data.value.战利品.当前容器 = {};\n  data.value.战利品.最近获取 = {};\n  data.value.战利品.副本 = {\n    已激活: false,\n    副本名称: '',\n    实验室等级: '基础实验室',\n    地图规模: '小型',\n    房间总数: 0,\n    当前房间索引: 0,\n    已探索房间: 0,\n    最近房间: '',\n    最近结算: '',\n    房间列表: [],\n  };\n  data.value.战利品.仓库 = {\n    联合币: 0,\n    芯片: 0,\n    物品: {},\n    独特收藏品: [],\n  };\n  data.value.界面.游戏结束 = {\n    已结束: false,\n    原因: '',\n    时间戳: 0,\n  };\n  data.value.界面.空战反馈 = {\n    待反馈: false,\n    摘要: '',\n    时间戳: 0,\n  };\n  data.value.世界.长期NPC列表 = {};\n  data.value.世界.NPC关系追踪 = {};\n  data.value.主角.战术.词条区 = {};\n  data.value.主角.战术.空战 = {\n    菜单开启: false,\n    流程阶段: '遭遇',\n    天气: '天气晴朗',\n    天气判定值: 11,\n    天气命中修正: 5,\n    天气探测修正: 0,\n    天气移速倍率: 1,\n    空域层: '标准空域',\n    格距米: 500,\n    我方单位: { 侦察型: 0, 轻型: 0, 中型: 0, 重型: 0, 要塞型: 0, 其他: 0 },\n    敌方单位: { 侦察型: 0, 轻型: 0, 中型: 0, 重型: 0, 要塞型: 0, 其他: 0 },\n    我方制空点: 0,\n    敌方制空点: 0,\n    制空修正: 0,\n    重武器命中条件: '无',\n    触发突袭轮: false,\n    突袭来源: '无',\n    当前行动序列: [],\n    台风眼格: [],\n    侦查单位类型: '侦察型',\n    侦查目标类型: '轻型',\n    侦查结果: 0,\n    目标隐匿剩余: 0,\n    我方闪避值: 3,\n    敌方闪避值: 3,\n    我方近失叠加命中: 0,\n    敌方近失叠加命中: 0,\n    最近命中详情: '',\n    我方总耐久: 100,\n    敌方总耐久: 100,\n    已结算回合: 0,\n    最近结算摘要: '',\n  };\n}\n\nfunction toggle_transform(): void {\n  if (!is_warmaid.value) return;\n\n  const next = !data.value.主角.灵装化.启用;\n  data.value.主角.灵装化.手动切换 = next;\n  data.value.主角.灵装化.启用 = next;\n\n  if (next) {\n    data.value.主角.灵装化.上次结算轮次 = data.value.主角.战术.当前轮次;\n  }\n}\n\nasync function send_next_action(action: string): Promise<void> {\n  const ok = window.confirm(`确定吗？\\n将发送：${action}`);\n  if (!ok) return;\n\n  // 首选酒馆助手官方接口，避免跨域/DOM结构差异导致发送失败。\n  try {\n    if (typeof createChatMessages === 'function') {\n      await createChatMessages([{ role: 'user', message: action }]);\n      if (typeof triggerSlash === 'function') triggerSlash('/trigger');\n      return;\n    }\n  } catch (error) {\n    console.warn('[天启黎明] createChatMessages 发送失败，回退到兼容模式。', error);\n  }\n\n  // 远程前端在跨域 iframe 中时，不能直接操作父页面 DOM，优先通过 postMessage 交给主页面脚本代发。\n  try {\n    const payload = {\n      type: 'apocalypse-dawn:send_action',\n      source: 'apocalypse_dawn_mvu',\n      action,\n      ts: Date.now(),\n    };\n    if (window.parent) window.parent.postMessage(payload, '*');\n    if (window.top && window.top !== window.parent) window.top.postMessage(payload, '*');\n  } catch {}\n\n  const docs: Document[] = [];\n  docs.push(window.document);\n  try {\n    if (window.parent?.document && window.parent.document !== window.document) docs.push(window.parent.document);\n  } catch {}\n  try {\n    if (window.top?.document && window.top.document !== window.document) docs.push(window.top.document);\n  } catch {}\n\n  const textarea_selectors = ['#send_textarea', 'textarea#send_textarea', 'textarea[id*=\\\"send\\\"]', 'textarea'];\n  const send_btn_selectors = ['#send_but', 'button#send_but', '#send-button', 'button[type=\\\"submit\\\"]'];\n\n  for (const doc of docs) {\n    let input_el: HTMLTextAreaElement | null = null;\n    for (const sel of textarea_selectors) {\n      const el = doc.querySelector(sel);\n      if (el instanceof HTMLTextAreaElement) {\n        input_el = el;\n        break;\n      }\n    }\n    if (!input_el) continue;\n\n    input_el.value = action;\n    input_el.dispatchEvent(new Event('input', { bubbles: true }));\n    input_el.dispatchEvent(new Event('change', { bubbles: true }));\n\n    for (const sel of send_btn_selectors) {\n      const btn = doc.querySelector(sel);\n      if (btn instanceof HTMLElement) {\n        btn.click();\n        return;\n      }\n    }\n  }\n  // 这里不再弹错误：跨域模式下主页面会通过 message 监听代发，避免误报。\n  console.info('[天启黎明] 当前上下文未直接找到输入框，已尝试通过 postMessage 发送。');\n}\n</script>\n\n<style scoped>\n.card {\n  width: 100%;\n  max-width: 940px;\n  margin: 0 auto;\n  border: 2px solid var(--c-line);\n  border-radius: 14px;\n  background: var(--c-panel);\n  box-shadow: 0 18px 44px rgba(16, 25, 30, 0.16);\n  overflow: hidden;\n}\n.card.fullscreen {\n  position: fixed;\n  inset: 0;\n  z-index: 99999;\n  width: 100vw;\n  max-width: none;\n  margin: 0;\n  border-width: 0;\n  box-shadow: none;\n  border-radius: 0;\n  overflow-y: auto;\n}\n.create-flow {\n  padding: 16px;\n  background: radial-gradient(circle at 12% 10%, #fff6e9 0%, #fffdf8 42%, #f8ede3 100%);\n}\n.cover-panel {\n  min-height: 360px;\n  display: grid;\n  place-items: center;\n  align-content: center;\n  gap: 18px;\n  border: 1px solid #9d7f61;\n  border-radius: 14px;\n  background: linear-gradient(150deg, #fff9ee 0%, #f3ddca 55%, #ead2bf 100%);\n}\n.logo {\n  font-size: clamp(44px, 8vw, 92px);\n  line-height: 1;\n  letter-spacing: 8px;\n  color: #7c2610;\n  text-shadow: 0 2px 0 #ffdcb8, 0 6px 16px rgba(90, 22, 8, 0.28);\n}\n.author {\n  font-size: 18px;\n  color: #5f4332;\n}\n.cover-actions {\n  display: flex;\n  gap: 10px;\n  flex-wrap: wrap;\n  justify-content: center;\n}\n.create-panel {\n  display: grid;\n  gap: 12px;\n  padding: 16px;\n  border: 1px solid #9b8c80;\n  border-radius: 12px;\n  background: linear-gradient(165deg, #fffcf6 0%, #fff6ee 100%);\n}\n.create-panel h2 {\n  color: var(--c-accent);\n  font-size: 24px;\n  letter-spacing: 0.5px;\n}\n.field {\n  display: grid;\n  gap: 6px;\n}\n.field span {\n  font-size: 13px;\n}\n.field input,\n.field select {\n  border: 1px solid #3f525c;\n  border-radius: 8px;\n  padding: 9px 10px;\n  background: #fff;\n  font-family: var(--font-main);\n}\n.field textarea {\n  border: 1px solid #3f525c;\n  border-radius: 8px;\n  padding: 9px 10px;\n  background: #fff;\n  font-family: var(--font-main);\n  resize: vertical;\n}\n.tip {\n  font-size: 12px;\n  color: var(--c-sub);\n}\n.tip.strong {\n  font-weight: 700;\n  color: #7c2610;\n}\n.tip.profession-mark {\n  color: #2d4653;\n  font-weight: 700;\n}\n.age-tip {\n  font-size: 12px;\n  color: var(--c-sub);\n}\n.error {\n  color: #b00020;\n  font-size: 12px;\n}\n.actions {\n  display: flex;\n  justify-content: space-between;\n  gap: 8px;\n}\n.start-btn,\n.secondary-btn {\n  border-radius: 999px;\n  font-weight: 700;\n  padding: 9px 16px;\n  cursor: pointer;\n}\n.start-btn {\n  border: 2px solid #7a2f18;\n  background: linear-gradient(180deg, #d56a46 0%, #b65232 100%);\n  color: #fffaf6;\n}\n.start-btn.large {\n  font-size: 16px;\n  padding: 10px 28px;\n}\n.plot-btn {\n  border: 1px solid #395f78;\n  background: #eef7ff;\n  color: #1d4258;\n  border-radius: 999px;\n  padding: 9px 18px;\n  font-weight: 700;\n  cursor: pointer;\n}\n.plot-btn.active {\n  background: #1d4d68;\n  color: #fff;\n}\n.plot-btn.large {\n  font-size: 16px;\n  padding: 10px 20px;\n}\n.cheat-btn {\n  border: 1px solid #b03333;\n  background: #fff1f1;\n  color: #b00020;\n  border-radius: 999px;\n  padding: 8px 18px;\n  font-weight: 700;\n  cursor: pointer;\n}\n.cheat-btn.active {\n  background: #b00020;\n  color: #fff;\n}\n.secondary-btn {\n  border: 1px solid #55646d;\n  background: #fff;\n  color: #2f4048;\n}\n.allocate-list,\n.ability-list,\n.skill-list,\n.dice-rule-list,\n.dice-result-list {\n  list-style: none;\n  display: grid;\n  gap: 6px;\n}\n.allocate-list li,\n.ability-list li,\n.skill-list li,\n.dice-rule-list li,\n.dice-result-list li {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  gap: 8px;\n  border-bottom: 1px dashed #cdd6dc;\n  padding-bottom: 4px;\n}\n.ability-btn {\n  width: 100%;\n  text-align: left;\n  border: 1px solid #6d7d86;\n  border-radius: 10px;\n  padding: 10px;\n  background: #fff;\n  cursor: pointer;\n  display: grid;\n  gap: 4px;\n}\n.ability-btn.active {\n  border-color: #7a2f18;\n  background: #fff1e8;\n}\n.ability-btn span {\n  font-weight: 700;\n}\n.ability-btn small {\n  color: #5f7079;\n}\n.ability-source {\n  color: #7a4b33;\n  font-size: 11px;\n}\n.example-box {\n  margin: 0;\n  white-space: pre-wrap;\n  border: 1px dashed #b58e71;\n  border-radius: 8px;\n  padding: 8px;\n  background: #fff8f0;\n  font-size: 12px;\n  color: #5a473b;\n}\n.counter {\n  display: flex;\n  gap: 8px;\n  align-items: center;\n}\n.counter button {\n  width: 24px;\n  height: 24px;\n  border: 1px solid #55646d;\n  border-radius: 50%;\n  background: #fff;\n  cursor: pointer;\n}\n.mvu-textbox {\n  padding: 12px;\n  border-bottom: 1px dashed #7d8a90;\n  background: #fffef8;\n}\n.next-actions {\n  padding: 12px;\n  border-bottom: 1px dashed #7d8a90;\n  background: #f8fcff;\n}\n.next-actions h2 {\n  font-size: 14px;\n  margin-bottom: 8px;\n  color: var(--c-accent);\n}\n.next-actions-grid {\n  display: grid;\n  grid-template-columns: repeat(2, minmax(0, 1fr));\n  gap: 8px;\n}\n.next-action-btn {\n  border: 1px solid #53626a;\n  border-radius: 8px;\n  padding: 8px 10px;\n  background: #ffffff;\n  color: #2d3f49;\n  font-size: 12px;\n  text-align: left;\n}\n.next-action-btn:hover {\n  background: #edf4f9;\n}\n.onstage-box {\n  padding: 12px;\n  border-bottom: 1px dashed #7d8a90;\n  background: #f9fbff;\n}\n.onstage-box.in-panel {\n  border: 1px solid #6f7d85;\n  border-radius: 10px;\n  background: #f7fbff;\n}\n.onstage-box h2 {\n  font-size: 14px;\n  margin-bottom: 6px;\n  color: var(--c-accent);\n}\n.module-toggle {\n  width: 100%;\n  text-align: left;\n  border: 1px solid #53626a;\n  border-radius: 8px;\n  background: #ffffff;\n  color: #2d3f49;\n  font-weight: 700;\n  padding: 8px 10px;\n  cursor: pointer;\n  margin-bottom: 8px;\n}\n.module-toggle:hover {\n  background: #edf4f9;\n}\n.onstage-list {\n  list-style: none;\n  display: grid;\n  gap: 8px;\n}\n.onstage-list li {\n  border: 1px solid #5f6e77;\n  border-radius: 8px;\n  padding: 8px;\n  background: #fff;\n}\n.onstage-list li.empty-tip {\n  border-style: dashed;\n  color: #5e6f79;\n  text-align: center;\n  background: #fbfdff;\n}\n.onstage-head {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 10px;\n  align-items: center;\n}\n.onstage-attrs {\n  margin: 6px 0;\n  font-size: 12px;\n  color: #4e5d66;\n}\n.onstage-thought {\n  margin: 6px 0 0;\n  font-size: 12px;\n  line-height: 1.5;\n}\n.mvu-textbox h2 {\n  font-size: 14px;\n  margin-bottom: 6px;\n  color: var(--c-accent);\n}\n.mvu-body {\n  margin: 0;\n  white-space: pre-wrap;\n  word-break: break-word;\n  font-size: 13px;\n  line-height: 1.55;\n  max-height: 240px;\n  overflow: auto;\n  padding: 10px;\n  border: 1px solid #4f5d64;\n  border-radius: 8px;\n  background: #ffffff;\n}\n.gameover-banner {\n  padding: 12px;\n  border-bottom: 1px solid #8d1c1c;\n  background: linear-gradient(120deg, #ffe6e6 0%, #ffd2d2 100%);\n}\n.gameover-banner h2 {\n  margin: 0 0 4px;\n  font-size: 16px;\n  color: #7a1010;\n}\n.gameover-banner p {\n  margin: 0;\n  font-size: 13px;\n  color: #6a1a1a;\n}\n.hero {\n  display: flex;\n  justify-content: space-between;\n  gap: 10px;\n  align-items: center;\n  padding: 12px 14px;\n  background: linear-gradient(130deg, #fffaf3 0%, #f2dfd5 100%);\n  border-bottom: 1px solid #75838c;\n}\n.hero-controls {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n}\n.hero h1 {\n  font-size: 26px;\n}\n.hero p {\n  font-size: 13px;\n  color: var(--c-sub);\n}\n.threat {\n  border: 1px solid var(--c-accent);\n  border-radius: 999px;\n  padding: 4px 8px;\n  color: var(--c-accent);\n  font-weight: 700;\n  background: #fff6f2;\n}\n.fullscreen-btn,\n.toggle-btn,\n.tabs button {\n  border: 1px solid var(--c-line);\n  border-radius: 999px;\n  background: #fff;\n  color: var(--c-line);\n  padding: 5px 10px;\n  font-size: 12px;\n  cursor: pointer;\n  transition: all 0.18s ease;\n}\n.fullscreen-btn:hover,\n.toggle-btn:hover,\n.tabs button:hover {\n  background: var(--c-accent-soft);\n}\n.world {\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));\n  gap: 8px;\n  padding: 10px 12px;\n  border-bottom: 1px dashed var(--c-line);\n}\n.tabs {\n  display: flex;\n  gap: 8px;\n  padding: 10px 12px;\n  border-bottom: 1px dashed var(--c-line);\n}\n.tabs button.active {\n  background: var(--c-accent);\n  color: #fff;\n  border-color: var(--c-accent);\n}\n.panel {\n  padding: 10px 12px 14px;\n  display: grid;\n  gap: 10px;\n}\n.bars {\n  display: grid;\n  gap: 8px;\n}\n.bar {\n  display: grid;\n  grid-template-columns: 48px 1fr;\n  align-items: center;\n  gap: 8px;\n}\nprogress {\n  width: 100%;\n  height: 12px;\n}\n.grid {\n  display: grid;\n  gap: 10px;\n}\n.grid.two {\n  grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));\n}\narticle,\n.loot {\n  border: 1px solid #6f7d85;\n  border-radius: 10px;\n  padding: 10px;\n  background: #fffefa;\n}\narticle h3,\n.loot h3 {\n  font-size: 14px;\n  margin-bottom: 6px;\n  color: var(--c-accent);\n}\n.big {\n  font-size: 24px;\n  font-weight: 700;\n  margin-bottom: 4px;\n}\n.kv {\n  list-style: none;\n  display: grid;\n  gap: 4px;\n}\n.kv li {\n  display: flex;\n  justify-content: space-between;\n  gap: 12px;\n  border-bottom: 1px dashed #ccd5d9;\n  padding-bottom: 2px;\n}\n.kv li strong {\n  text-align: right;\n}\n.air-menu {\n  border: 1px solid #7f8d95;\n  border-radius: 10px;\n  padding: 10px;\n  background: linear-gradient(180deg, #f8fcff 0%, #eef6fb 100%);\n}\n.air-controls {\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));\n  gap: 8px;\n  margin: 8px 0;\n}\n.field.mini span {\n  font-size: 11px;\n}\n.field.mini select {\n  padding: 6px 8px;\n  font-size: 12px;\n}\n.air-actions {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 6px;\n  margin: 8px 0;\n}\n.toggle-btn.danger {\n  color: #7d0f0f;\n  border-color: #a23333;\n  background: #ffecec;\n}\n@media (max-width: 560px) {\n  .hero {\n    align-items: flex-start;\n    flex-direction: column;\n  }\n  .tabs {\n    flex-wrap: wrap;\n  }\n  .next-actions-grid {\n    grid-template-columns: 1fr;\n  }\n}\n</style>\n",":root {\n  --c-bg: #f6f3ea;\n  --c-panel: #fffdf8;\n  --c-line: #25333a;\n  --c-sub: #5d666e;\n  --c-accent: #b65232;\n  --c-accent-soft: #f1d9cf;\n  --font-main: 'LXGW WenKai', 'Noto Serif SC', 'Source Han Serif SC', 'Microsoft YaHei', serif;\n}\n\n* {\n  box-sizing: border-box;\n  margin: 0;\n  padding: 0;\n}\n\nbody {\n  width: 100%;\n  background: radial-gradient(circle at top right, #fff8f1 0%, var(--c-bg) 65%);\n  color: var(--c-line);\n  font-family: var(--font-main);\n  line-height: 1.55;\n}\n"],"names":[],"sourceRoot":""}