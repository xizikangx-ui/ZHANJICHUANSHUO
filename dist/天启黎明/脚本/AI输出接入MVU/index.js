$(()=>{errorCatched(async()=>{await waitGlobalInitialized('Mvu');const e=new Set,s=new Map;async function a(a){if(e.has(a))return;const t=getChatMessages(a,{include_swipes:!1})[0];if(!t||'assistant'!==t.role||t.is_hidden)return;const n=t.message?.trim()??'';if(n&&s.get(a)!==n){e.add(a);try{const e=Mvu.getMvuData({type:'message',message_id:a}),t=await Mvu.parseMessage(n,e);await Mvu.replaceMvuData(t,{type:'message',message_id:a}),s.set(a,n),console.info(`[天启黎明][MVU桥接] 已同步楼层 ${a}`)}catch(e){console.warn(`[天启黎明][MVU桥接] 同步楼层 ${a} 失败`,e)}finally{e.delete(a)}}}eventOn(tavern_events.MESSAGE_RECEIVED,e=>{a(e)}),eventOn(tavern_events.MESSAGE_UPDATED,e=>{a(e)}),eventOn(tavern_events.CHAT_CHANGED,()=>{e.clear(),s.clear()});const t=getChatMessages(-1,{include_swipes:!1})[0];t&&'assistant'===t.role&&a(t.message_id)})()});
//# sourceMappingURL=index.js.map