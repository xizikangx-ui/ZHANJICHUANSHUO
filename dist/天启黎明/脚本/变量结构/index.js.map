{"version":3,"file":"index.js","mappings":"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","sources":["src://tavern_helper_template/external var \"z\"","src://tavern_helper_template/src//schema.ts","src://tavern_helper_template/src////index.ts"],"sourcesContent":["const __WEBPACK_NAMESPACE_OBJECT__ = z;","export const Schema = z\n    .object({\n    : z\n        .object({\n        : z\n            .object({\n            : z.boolean().prefault(false),\n            : z.string().prefault(''),\n            : z.enum(['', '', '']).prefault(''),\n            : z\n                .enum(['', '', '', '', '', ''])\n                .prefault(''),\n            : z.coerce.number().transform(v => _.clamp(v, 12, 80)).prefault(21),\n            : z.enum(['', '']).prefault(''),\n            : z.boolean().prefault(false),\n            : z.boolean().prefault(false),\n        })\n            .prefault({}),\n        : z\n            .object({\n            : z.string().prefault(''),\n            : z.string().prefault(''),\n            : z.coerce.number().prefault(0),\n        })\n            .prefault({}),\n        : z\n            .array(z\n            .object({\n            : z.string().prefault(''),\n            : z.coerce.number().transform(v => _.clamp(v, -200, 1000)).prefault(0),\n            : z.string().prefault(''),\n            : z.string().prefault(''),\n            : z.string().prefault(''),\n            : z.record(z.string().describe(''), z.coerce.number().prefault(0)).prefault({}),\n            : z.coerce.number().prefault(0),\n        })\n            .prefault({}))\n            .prefault([]),\n        : z\n            .object({\n            : z.boolean().prefault(false),\n            NPC: z.boolean().prefault(false),\n        })\n            .prefault({}),\n        : z\n            .object({\n            : z.boolean().prefault(false),\n            : z.string().prefault(''),\n            : z.coerce.number().prefault(0),\n        })\n            .prefault({}),\n        : z\n            .object({\n            : z.boolean().prefault(false),\n            : z.string().prefault(''),\n            : z.coerce.number().prefault(0),\n        })\n            .prefault({}),\n    })\n        .prefault({}),\n    : z\n        .object({\n        : z.string().prefault('177828 08:00'),\n        : z.string().prefault(' '),\n        : z.string().prefault(''),\n        : z.enum(['', '', '', '']).prefault(''),\n        : z.record(z.string().describe(''), z.string().describe('')).prefault({}),\n        : z\n            .object({\n            : z.boolean().prefault(false),\n            : z.enum(['', '']).prefault(''),\n            : z.enum(['', '', '', '']).prefault(''),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 4)).prefault(0),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 7)).prefault(0),\n            : z.boolean().prefault(false),\n            : z.boolean().prefault(false),\n            : z.boolean().prefault(false),\n            : z.string().prefault(''),\n        })\n            .prefault({}),\n        NPC: z.record(z.string().describe('NPC'), z.object({\n            : z.string().prefault(''),\n            : z.coerce.number().transform(v => _.clamp(v, -200, 1000)).prefault(0),\n            : z.string().prefault(''),\n            : z.enum(['', '', '', '', '', '', '', '']).prefault(''),\n            : z.string().prefault(''),\n            : z.string().prefault(''),\n            : z.record(z.string().describe(''), z.coerce.number().prefault(0)).prefault({}),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 99999)).prefault(0),\n            : z.enum(['', '']).prefault(''),\n            : z.array(z.string()).prefault([]),\n            : z.coerce.number().prefault(0),\n            : z.coerce.number().prefault(0),\n        }).prefault({})).prefault({}),\n        NPC: z.record(z.string().describe('NPC'), z.object({\n            : z.coerce.number().transform(v => _.clamp(v, 0, 9999)).prefault(0),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999999)).prefault(0),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 9999)).prefault(0),\n            : z.coerce.number().prefault(0),\n            : z.boolean().prefault(false),\n        }).prefault({})).prefault({}),\n    })\n        .prefault({}),\n    : z\n        .object({\n        : z\n            .object({\n            : z.string().prefault(''),\n            : z.string().prefault(''),\n            : z.string().prefault(''),\n            : z.string().prefault(''),\n        })\n            .prefault({}),\n        : z\n            .object({\n            : z.coerce.number().transform(v => _.clamp(v, 0, 5)).prefault(1),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 5)).prefault(1),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 5)).prefault(1),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 5)).prefault(1),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 5)).prefault(1),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 5)).prefault(1),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 5)).prefault(1),\n        })\n            .prefault({}),\n        : z\n            .object({\n            : z.coerce.number().transform(v => _.clamp(v, 0, 100)).prefault(0),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 100)).prefault(0),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 100)).prefault(0),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 100)).prefault(0),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 100)).prefault(0),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 100)).prefault(0),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 100)).prefault(0),\n        })\n            .prefault({}),\n        : z\n            .object({\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(20),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(18),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(18),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(18),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(20),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(12),\n        })\n            .prefault({}),\n        : z\n            .object({\n            : z.coerce.number().transform(v => _.clamp(v, 1, 20)).prefault(1),\n            : z.coerce.number().transform(v => _.clamp(v, 1, 20)).prefault(1),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999999)).prefault(0),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999999)).prefault(10),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999999)).prefault(0),\n            : z.boolean().prefault(false),\n        })\n            .prefault({}),\n        : z\n            .object({\n            : z.boolean().prefault(false),\n            : z.boolean().prefault(false),\n            : z.enum(['', '', '']).prefault(''),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(8),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 9)).prefault(1),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 9999)).prefault(0),\n        })\n            .prefault({}),\n        : z\n            .object({\n            : z.coerce.number().transform(v => _.clamp(v, 0, 9999)).prefault(100),\n            : z.coerce.number().transform(v => _.clamp(v, 1, 9999)).prefault(100),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 9999)).prefault(100),\n            : z.coerce.number().transform(v => _.clamp(v, 1, 9999)).prefault(100),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 100)).prefault(0),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 9)).prefault(1),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 9)).prefault(1),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 99)).prefault(10),\n            : z.coerce.number().transform(v => _.clamp(v, 1, 99)).prefault(10),\n        })\n            .prefault({}),\n        : z\n            .object({\n            : z.array(z.string()).prefault([]),\n        })\n            .prefault({}),\n        : z\n            .object({\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(4),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(0),\n            : z.record(z.string().describe('ID'), z.boolean()).prefault({}),\n            : z.string().prefault(''),\n        })\n            .prefault({}),\n        : z\n            .object({\n            : z.string().prefault(''),\n            : z.enum(['', '', '', '', '', '', '', '', '']).prefault(''),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 99999)).prefault(0),\n            : z.string().prefault(''),\n            : z.boolean().prefault(false),\n            : z.string().prefault(''),\n        })\n            .prefault({}),\n        : z\n            .object({\n            : z.string().prefault(''),\n            : z.string().prefault(''),\n        })\n            .prefault({}),\n        : z\n            .object({\n            : z.enum(['', '', '']).prefault(''),\n            : z.boolean().prefault(false),\n            : z.enum(['', '', '', '']).prefault(''),\n            : z.enum(['', '', '']).prefault(''),\n            : z.coerce.number().transform(v => _.clamp(v, 1, 999)).prefault(1),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(0),\n            : z.string().prefault(''),\n            : z.record(z.string().describe(''), z.array(z.string()).prefault([])).prefault({}),\n            : z\n                .object({\n                : z.boolean().prefault(false),\n                : z\n                    .enum(['', '', '', '', '', '', ''])\n                    .prefault(''),\n                : z.enum(['', '', '', '', '']).prefault(''),\n                : z.coerce.number().transform(v => _.clamp(v, 1, 100)).prefault(11),\n                : z.coerce.number().transform(v => _.clamp(v, -50, 50)).prefault(5),\n                : z.coerce.number().transform(v => _.clamp(v, -100, 100)).prefault(0),\n                : z.coerce.number().transform(v => _.clamp(v, 0.1, 3)).prefault(1),\n                : z.enum(['', '', '', '', '', '']).prefault(''),\n                : z.coerce.number().transform(v => _.clamp(v, 100, 2000)).prefault(500),\n                : z\n                    .object({\n                    : z.coerce.number().transform(v => _.clamp(v, 0, 99)).prefault(0),\n                    : z.coerce.number().transform(v => _.clamp(v, 0, 99)).prefault(0),\n                    : z.coerce.number().transform(v => _.clamp(v, 0, 99)).prefault(0),\n                    : z.coerce.number().transform(v => _.clamp(v, 0, 99)).prefault(0),\n                    : z.coerce.number().transform(v => _.clamp(v, 0, 99)).prefault(0),\n                    : z.coerce.number().transform(v => _.clamp(v, 0, 99)).prefault(0),\n                })\n                    .prefault({}),\n                : z\n                    .object({\n                    : z.coerce.number().transform(v => _.clamp(v, 0, 99)).prefault(0),\n                    : z.coerce.number().transform(v => _.clamp(v, 0, 99)).prefault(0),\n                    : z.coerce.number().transform(v => _.clamp(v, 0, 99)).prefault(0),\n                    : z.coerce.number().transform(v => _.clamp(v, 0, 99)).prefault(0),\n                    : z.coerce.number().transform(v => _.clamp(v, 0, 99)).prefault(0),\n                    : z.coerce.number().transform(v => _.clamp(v, 0, 99)).prefault(0),\n                })\n                    .prefault({}),\n                : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(0),\n                : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(0),\n                : z.coerce.number().transform(v => _.clamp(v, -1, 1)).prefault(0),\n                : z.string().prefault(''),\n                : z.boolean().prefault(false),\n                : z.string().prefault(''),\n                : z.array(z.string()).prefault([]),\n                : z.array(z.string()).prefault([]),\n                : z.enum(['', '', '', '']).prefault(''),\n                : z.enum(['', '', '', '', '']).prefault(''),\n                : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(0),\n                : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(0),\n                : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(3),\n                : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(3),\n                : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(0),\n                : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(0),\n                : z.string().prefault(''),\n                : z.coerce.number().transform(v => _.clamp(v, 0, 99999)).prefault(100),\n                : z.coerce.number().transform(v => _.clamp(v, 0, 99999)).prefault(100),\n                : z.coerce.number().transform(v => _.clamp(v, 0, 9999)).prefault(0),\n                : z.string().prefault(''),\n            })\n                .prefault({}),\n        })\n            .prefault({}),\n        : z\n            .object({\n            : z.string().prefault(''),\n            : z.record(z.string().describe(''), z\n                .object({\n                : z.coerce.number().transform(v => _.clamp(v, 0, 8)).prefault(1),\n                : z.coerce.number().transform(v => _.clamp(v, 0, 8)).prefault(2),\n                : z.string().prefault(''),\n            })\n                .prefault({})).prefault({}),\n            : z.record(z.string().describe(''), z.string()).prefault({}),\n            : z.record(z.string().describe(''), z.string().describe('')).prefault({}),\n        })\n            .prefault({}),\n        : z.record(z.string().describe(''), z\n            .object({\n            : z.enum(['', '', '']).prefault(''),\n            : z.string().prefault(''),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 99)).prefault(1),\n        })\n            .prefault({})).prefault({}),\n        : z\n            .object({\n            : z.string().prefault(''),\n            : z.enum(['', '', '', '', '', '', '', '']).prefault(''),\n            : z.coerce.number().transform(v => _.clamp(v, 1, 10)).prefault(1),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(0),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(0),\n            : z.string().prefault(''),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(0),\n            : z.enum(['', '', '', '']).prefault(''),\n            : z.string().prefault(''),\n            : z.string().prefault(''),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(0),\n            : z.coerce.number().prefault(0),\n        })\n            .prefault({}),\n    })\n        .prefault({}),\n    : z\n        .object({\n        : z.boolean().prefault(false),\n        : z.record(z.string().describe(''), z\n            .object({\n            : z.enum(['', '']).prefault(''),\n            : z.boolean().prefault(false),\n        })\n            .prefault({})).prefault({}),\n        : z.record(z.string().describe(''), z\n            .object({\n            : z.enum(['', '', '', '', '', '']).prefault(''),\n            : z.coerce.number().transform(v => _.clamp(v, 1, 999)).prefault(1),\n            : z.coerce.number().transform(v => _.clamp(v, 1, 999999999)).prefault(1),\n        })\n            .prefault({})).prefault({}),\n        : z\n            .object({\n            : z.boolean().prefault(false),\n            : z.string().prefault(''),\n            : z\n                .enum(['', '', '', ''])\n                .prefault(''),\n            : z.enum(['', '', '']).prefault(''),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(0),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(0),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(0),\n            : z.string().prefault(''),\n            : z.string().prefault(''),\n            : z\n                .array(z\n                .object({\n                : z.coerce.number().transform(v => _.clamp(v, 1, 999)).prefault(1),\n                : z.string().prefault(''),\n                : z.enum(['', '', '', '']).prefault(''),\n                : z\n                    .object({\n                    : z.coerce.number().transform(v => _.clamp(v, 0, 9)).prefault(0),\n                    : z.coerce.number().transform(v => _.clamp(v, 0, 9)).prefault(0),\n                    : z.boolean().prefault(false),\n                    : z.boolean().prefault(false),\n                })\n                    .prefault({}),\n            })\n                .prefault({}))\n                .prefault([]),\n        })\n            .prefault({}),\n        : z\n            .object({\n            : z.coerce.number().transform(v => _.clamp(v, 0, 99999999)).prefault(0),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999999)).prefault(0),\n            : z.record(z.string().describe(''), z\n                .object({\n                : z.enum(['', '', '', '', '', '']).prefault(''),\n                : z.coerce.number().transform(v => _.clamp(v, 0, 999999)).prefault(0),\n                : z.coerce.number().transform(v => _.clamp(v, 1, 999999999)).prefault(1),\n                : z.string().prefault(''),\n                : z.string().prefault(''),\n                : z.array(z.string()).prefault([]),\n                : z.boolean().prefault(true),\n            })\n                .prefault({})).prefault({}),\n            : z.array(z.string()).prefault([]),\n        })\n            .prefault({}),\n    })\n        .prefault({}),\n    : z.record(z.string().describe(''), z.string().describe('')).prefault({}),\n})\n    .prefault({});\n","import { registerMvuSchema } from 'https://testingcf.jsdelivr.net/gh/StageDog/tavern_resource/dist/util/mvu_zod.js';\nimport { Schema } from '../../schema';\n\nfunction installHideOriginalReplyStyle(): void {\n  const host_document = window.parent?.document ?? document;\n  const style_id = 'apocalypse-dawn-hide-original-reply-style';\n  if (host_document.getElementById(style_id)) return;\n\n  const style = host_document.createElement('style');\n  style.id = style_id;\n  style.textContent = `\n    .mes:has(.TH-render) .mes_text > :not(.TH-render) {\n      display: none !important;\n    }\n  `;\n  host_document.head.appendChild(style);\n}\n\nfunction asNumber(value: unknown, fallback = 0): number {\n  const numeric = Number(value);\n  return Number.isFinite(numeric) ? numeric : fallback;\n}\n\nfunction rollD6(): number {\n  return Math.floor(Math.random() * 6) + 1;\n}\n\nconst warmaid_rank_steps = [\n  { name: '', need: 10 },\n  { name: '', need: 50 },\n  { name: '', need: 100 },\n  { name: '', need: 500 },\n  { name: '', need: 1000 },\n  { name: '', need: 2000 },\n  { name: '', need: 6000 },\n] as const;\n\nfunction reconcileGrowthLevel(stat_data: any): void {\n  if (!stat_data || typeof stat_data !== 'object') return;\n\n  const profession = String(_.get(stat_data, '..', ''));\n  const is_warmaid = profession === '' || String(_.get(stat_data, '..', '')).includes('');\n  const is_authority = profession === '' || String(_.get(stat_data, '..', '')).includes('');\n\n  if (is_warmaid) {\n    let level = _.clamp(asNumber(_.get(stat_data, '..', 1), 1), 1, warmaid_rank_steps.length);\n    let shards = Math.max(0, asNumber(_.get(stat_data, '..', 0), 0));\n\n    // /\n    while (level < warmaid_rank_steps.length) {\n      const need = warmaid_rank_steps[level - 1].need;\n      if (shards < need) break;\n      shards -= need;\n      level += 1;\n    }\n\n    _.set(stat_data, '..', level);\n    _.set(stat_data, '..', shards);\n    _.set(\n      stat_data,\n      '..',\n      level < warmaid_rank_steps.length ? warmaid_rank_steps[level - 1].need : 0,\n    );\n  }\n\n  if (is_authority) {\n    const shard = Math.max(0, asNumber(_.get(stat_data, '..', 0), 0));\n    const has_origin = Boolean(_.get(stat_data, '..', false));\n\n    let level = 1; // \n    if (shard >= 50) level = 2; // \n    if (shard >= 100) level = 3; // \n    if (shard >= 1000 && has_origin) level = 4; // \n\n    _.set(stat_data, '..', level);\n  }\n}\n\nfunction trimBattleLogs(stat_data: any, keep = 3): void {\n  if (!stat_data || typeof stat_data !== 'object') return;\n  const logs = _.get(stat_data, '', {});\n  if (!_.isObjectLike(logs)) {\n    _.set(stat_data, '', {});\n    return;\n  }\n  const entries = Object.entries(logs as Record<string, string>);\n  if (entries.length <= keep) return;\n  _.set(stat_data, '', Object.fromEntries(entries.slice(-keep)));\n}\n\nfunction ensureAirCombatData(stat_data: any): void {\n  if (!stat_data || typeof stat_data !== 'object') return;\n  if (!_.isObjectLike(_.get(stat_data, '.'))) {\n    _.set(stat_data, '.', { : false, : '', : 0 });\n  }\n  if (!_.isObjectLike(_.get(stat_data, '..'))) {\n    _.set(stat_data, '..', {});\n  }\n  if (!_.isObjectLike(_.get(stat_data, '..'))) {\n    _.set(stat_data, '..', {\n      : false,\n      : '',\n      : '',\n      : 11,\n      : 5,\n      : 0,\n      : 1,\n      : '',\n      : 500,\n      : { : 0, : 0, : 0, : 0, : 0, : 0 },\n      : { : 0, : 0, : 0, : 0, : 0, : 0 },\n      : 0,\n      : 0,\n      : 0,\n      : '',\n      : false,\n      : '',\n      : [],\n      : [],\n      : '',\n      : '',\n      : 0,\n      : 0,\n      : 3,\n      : 3,\n      : 0,\n      : 0,\n      : '',\n      : 100,\n      : 100,\n      : 0,\n      : '',\n    });\n  } else {\n    const air = _.get(stat_data, '..');\n    _.defaultsDeep(air, {\n      : false,\n      : '',\n      : '',\n      : 11,\n      : 5,\n      : 0,\n      : 1,\n      : '',\n      : 500,\n      : { : 0, : 0, : 0, : 0, : 0, : 0 },\n      : { : 0, : 0, : 0, : 0, : 0, : 0 },\n      : 0,\n      : 0,\n      : 0,\n      : '',\n      : false,\n      : '',\n      : [],\n      : [],\n      : '',\n      : '',\n      : 0,\n      : 0,\n      : 3,\n      : 3,\n      : 0,\n      : 0,\n      : '',\n      : 100,\n      : 100,\n      : 0,\n      : '',\n    });\n  }\n}\n\nconst battle_activate_pattern = /|||||||/i;\nconst battle_action_pattern = /||||||||||/i;\nconst battle_end_pattern = /|||||||/i;\nconst battle_hostile_pattern = /||||||||||/i;\nconst explicit_battle_open_pattern = /|||||||/i;\n\nfunction isBattleTriggerContent(content: string): boolean {\n  const text = String(content ?? '');\n  if (!text.trim()) return false;\n  if (explicit_battle_open_pattern.test(text)) return true;\n  if (battle_activate_pattern.test(text) && battle_hostile_pattern.test(text)) return true;\n  if (/(||||||)/i.test(text) && battle_hostile_pattern.test(text)) return true;\n  return false;\n}\n\nfunction getWeaponLevel(stat_data: any): number {\n  const weapons = _.get(stat_data, '..', {});\n  if (!_.isObjectLike(weapons)) return 1;\n  const first = Object.values(weapons as Record<string, any>)[0];\n  return Math.max(1, asNumber(_.get(first, '', 1), 1));\n}\n\nfunction buildAirBattleSummary(stat_data: any, end_reason: string): string {\n  const air = _.get(stat_data, '..', {});\n  const logs = Object.entries(_.get(stat_data, '', {})).slice(-3).map(([k, v]) => `${k}:${v}`).join('');\n  return `(${end_reason})${asNumber(air., 0)}=${air.}(${asNumber(air., 0)})=${_.get(stat_data, '..', '')}=${asNumber(air., 0)}=${asNumber(air., 0)}=${logs}`;\n}\n\nfunction startAirBattleIfTriggered(stat_data: any, content: string): boolean {\n  ensureAirCombatData(stat_data);\n  if (!isBattleTriggerContent(content)) return false;\n\n  const in_battle = Boolean(_.get(stat_data, '..', false));\n  if (in_battle) return true;\n\n  _.set(stat_data, '..', '');\n  _.set(stat_data, '..', true);\n  _.set(stat_data, '...', true);\n  _.set(stat_data, '...', '');\n  _.set(stat_data, '...', 0);\n\n  const threat = String(_.get(stat_data, '.', ''));\n  const enemy_hp = threat === '' ? 180 : threat === '' ? 140 : threat === '' ? 110 : 90;\n  _.set(stat_data, '...', asNumber(_.get(stat_data, '..', 100), 100));\n  _.set(stat_data, '...', Math.max(30, asNumber(_.get(stat_data, '...', enemy_hp), enemy_hp)));\n\n  const source =\n    //i.test(content) ? ''\n      : //i.test(content) ? ''\n        : //i.test(content) ? ''\n          : '';\n  const ambush = /|/i.test(content);\n  _.set(stat_data, '...', ambush);\n  _.set(stat_data, '...', ambush ? source : '');\n  if (ambush) {\n    _.set(stat_data, '..', asNumber(_.get(stat_data, '..', 1), 1) + 1);\n  }\n\n  _.set(stat_data, `.-${Date.now()}`, `${source}`);\n  trimBattleLogs(stat_data, 3);\n  return true;\n}\n\nfunction resolveAirCombatRound(stat_data: any, content: string): boolean {\n  ensureAirCombatData(stat_data);\n  if (_.get(stat_data, '..', '') !== '') return false;\n  if (!_.get(stat_data, '..', false)) return false;\n  if (!battle_action_pattern.test(content) && !battle_end_pattern.test(content)) return false;\n\n  const air = _.get(stat_data, '..');\n  let self_hp = asNumber(_.get(air, '', _.get(stat_data, '..', 100)), 100);\n  let enemy_hp = asNumber(_.get(air, '', 100), 100);\n  const weather_mod = _.clamp(Math.trunc(asNumber(_.get(air, '', 0), 0) / 10), -2, 2);\n  const sup_mod = _.clamp(asNumber(_.get(air, '', 0), 0), -1, 1);\n  const weapon_lv = getWeaponLevel(stat_data);\n  const heavy_condition = String(_.get(air, '', ''));\n  const need_assist = /|.*/.test(heavy_condition);\n  const has_assist = asNumber(_.get(air, '.', 0), 0) > 0 || asNumber(_.get(air, '.', 0), 0) > 0;\n\n  const self_near_miss_stack = asNumber(_.get(air, '', 0), 0);\n  const enemy_near_miss_stack = asNumber(_.get(air, '', 0), 0);\n  const enemy_dodge = asNumber(_.get(air, '', 3), 3);\n  const self_dodge = asNumber(_.get(air, '', 3), 3);\n  const full_auto = /||/.test(content);\n\n  const calcSingleShot = (hit_bonus: number, dodge_value: number, base_damage_mult = 1): { diff: number; damage: number; note: string; near_miss: boolean; invalid: boolean } => {\n    const hit_roll = rollD6() + hit_bonus;\n    const diff = hit_roll - dodge_value;\n    const base_damage = Math.max(1, (rollD6() + weapon_lv) * base_damage_mult);\n    if (diff > 6) return { diff, damage: base_damage + weapon_lv * rollD10(), note: '', near_miss: false, invalid: false };\n    if (diff > 4) return { diff, damage: base_damage, note: '', near_miss: false, invalid: false };\n    if (diff > 2) return { diff, damage: Math.max(1, Math.floor(base_damage / 2)), note: '', near_miss: false, invalid: false };\n    if (diff > 1) return { diff, damage: Math.max(1, weapon_lv * _.random(1, 2)), note: '', near_miss: false, invalid: false };\n    if (diff === 1 || diff === 0) return { diff, damage: 0, note: '', near_miss: true, invalid: false };\n    return { diff, damage: 0, note: '', near_miss: false, invalid: true };\n  };\n\n  let dealt = 0;\n  let diff = 0;\n  let self_hit_note = '';\n  if (need_assist && !has_assist) {\n    self_hit_note = '/';\n  } else {\n    const hit_bonus_base = weather_mod + sup_mod + self_near_miss_stack;\n    const first_shot = calcSingleShot(hit_bonus_base, enemy_dodge);\n    diff = first_shot.diff;\n    dealt += first_shot.damage;\n    self_hit_note = first_shot.note;\n    _.set(air, '', first_shot.near_miss ? self_near_miss_stack + 10 : 0);\n\n    if (full_auto) {\n      let shot_index = 1;\n      let expected_next_bonus = hit_bonus_base - 10;\n      while (shot_index < 6 && expected_next_bonus + 6 >= enemy_dodge) {\n        const shot = calcSingleShot(expected_next_bonus, enemy_dodge);\n        dealt += shot.damage;\n        self_hit_note += ` / ${shot_index + 1}:${shot.note}`;\n        if (shot.near_miss) _.set(air, '', asNumber(_.get(air, '', 0), 0) + 10);\n        if (!shot.invalid) diff = shot.diff;\n        shot_index += 1;\n        expected_next_bonus -= 10;\n      }\n    }\n  }\n  enemy_hp = Math.max(0, enemy_hp - dealt);\n\n  const enemy_hit = calcSingleShot(Math.max(0, -sup_mod) + enemy_near_miss_stack, self_dodge);\n  const enemy_diff = enemy_hit.diff;\n  const taken = enemy_hit.damage;\n  _.set(air, '', enemy_hit.near_miss ? enemy_near_miss_stack + 10 : 0);\n  self_hp = Math.max(0, self_hp - taken);\n\n  _.set(stat_data, '..', self_hp);\n  _.set(air, '', self_hp);\n  _.set(air, '', enemy_hp);\n  _.set(air, '', asNumber(_.get(air, '', 0), 0) + 1);\n  const round_summary = `${_.get(air, '', 0)}${self_hit_note}(${diff})${dealt}${enemy_hit.note}(${enemy_diff})${taken}`;\n  _.set(air, '', round_summary);\n  _.set(air, '', round_summary);\n  _.set(stat_data, `.-${Date.now()}`, round_summary);\n  trimBattleLogs(stat_data, 3);\n\n  const end_by_text = battle_end_pattern.test(content);\n  const end_by_hp = self_hp <= 0 || enemy_hp <= 0;\n  if (!(end_by_text || end_by_hp)) return true;\n\n  _.set(stat_data, '..', false);\n  _.set(stat_data, '..', '');\n  _.set(air, '', '');\n  const reason = self_hp <= 0 ? '' : enemy_hp <= 0 ? '' : '';\n  const summary = buildAirBattleSummary(stat_data, reason);\n  _.set(stat_data, '.', {\n    : true,\n    : summary,\n    : Date.now(),\n  });\n  _.set(stat_data, '..', summary);\n  _.set(stat_data, `.-${Date.now()}`, summary);\n  trimBattleLogs(stat_data, 3);\n  return true;\n}\n\nfunction extractDisplayText(content: string): string {\n  const without_update = content\n    .replace(/<update(?:variable)?>[\\s\\S]*?<\\/update(?:variable)?>/gim, '')\n    .replace(/<update(?:variable)?>[\\s\\S]*$/gim, '');\n\n  const without_placeholder = without_update\n    .replace(/<StatusPlaceHolderImpl\\/>/gim, '')\n    .replace(/<OnStageCharacters>[\\s\\S]*?<\\/OnStageCharacters>/gim, '')\n    .replace(/<NpcRelationHints>[\\s\\S]*?<\\/NpcRelationHints>/gim, '');\n\n  let text = without_placeholder.replace(/```[\\s\\S]*?\\$\\('body'\\)\\.load\\([\\s\\S]*?```/gim, '');\n\n  const content_match = text.match(/<content>([\\s\\S]*?)<\\/content>/im);\n  if (content_match?.[1]) {\n    text = content_match[1];\n  } else {\n    text = text\n      .replace(/<(?:think|thinking|context|disclaimer|tucao|current_event|progress)[^>]*>[\\s\\S]*?<\\/(?:think|thinking|context|disclaimer|tucao|current_event|progress)>/gim, '')\n      .replace(/<(?:think|thinking|context|disclaimer|tucao|current_event|progress)[^>]*\\/>/gim, '');\n  }\n\n  text = text\n    .replace(/```[\\s\\S]*?```/gim, '')\n    .replace(/<\\|im_end\\|>/gim, '')\n    .replace(/<\\/?[^>\\n]+>/g, '')\n    .replace(/\\r/g, '')\n    .replace(/\\n{3,}/g, '\\n\\n')\n    .trim();\n\n  return stripReasoningLeak(text);\n}\n\nfunction stripReasoningLeak(input: string): string {\n  let text = String(input ?? '');\n  if (!text) return '';\n\n  // /\n  text = text\n    .replace(/<(?:analysis|reasoning|chain[-_ ]?of[-_ ]?thought|cot)[^>]*>[\\s\\S]*?<\\/(?:analysis|reasoning|chain[-_ ]?of[-_ ]?thought|cot)>/gim, '')\n    .replace(/<(?:analysis|reasoning|chain[-_ ]?of[-_ ]?thought|cot)[^>]*\\/>/gim, '')\n    .replace(/(?:^|\\n)\\s*\\[(?:|||analysis|reasoning|cot)[^\\]]*\\][\\s\\S]*?(?=\\n\\s*\\[|$)/gim, '\\n')\n    .replace(/(?:^|\\n)\\s*<{2,3}\\s*(?:||analysis|reasoning|cot)\\s*>{2,3}[\\s\\S]*?(?=\\n\\s*<{2,3}|\\n{2,}|$)/gim, '\\n');\n\n  const leakageLinePattern =\n    /^\\s*(?:#{1,6}\\s*)?(?:||||analysis|reasoning|chain[-_ ]?of[-_ ]?thought|cot)\\s*[:]/i;\n  const pseudoToolLinePattern =\n    /^\\s*(?:\\[?\\]?|thinking\\.{0,3}|let me think|internal monologue)\\s*[:]/i;\n\n  const safeLines = text\n    .split('\\n')\n    .filter(line => !leakageLinePattern.test(line) && !pseudoToolLinePattern.test(line));\n\n  text = safeLines.join('\\n').replace(/\\n{3,}/g, '\\n\\n').trim();\n  return text;\n}\n\ntype OnStageCharacter = {\n  : string;\n  : number;\n  : string;\n  : string;\n  : string;\n  : Record<string, number>;\n  : number;\n};\n\ntype NpcRelationHint = {\n  : string;\n  : string[];\n};\n\nconst npc_name_stop_words = new Set([\n  '', '', '', '', '', '', '', '', '', '', '',\n  '', '', '', '', '', '', '', '', '', '', '',\n  '', '', '', '', '', '', '', '', '', '', '',\n]);\nconst npc_name_bad_prefix = /^(|||||||||||)/;\nconst npc_name_bad_contains = /(||||||||||||||||||||||||||)/;\n\nfunction normalizeNpcName(raw: string): string {\n  return String(raw ?? '')\n    .trim()\n    .replace(/^[\"[(]+|[\")\\]]+$/g, '')\n    .replace(/[,.?!;:]/g, '')\n    .trim();\n}\n\nfunction isLikelyNpcName(name: string, excluded: Set<string>): boolean {\n  if (!name) return false;\n  if (excluded.has(name)) return false;\n  if (npc_name_stop_words.has(name)) return false;\n  if (npc_name_bad_contains.test(name)) return false;\n  if (npc_name_bad_prefix.test(name)) return false;\n  if (/[0-9-]/.test(name)) return false;\n  if (/(||||||)$/.test(name)) return false;\n  if (!/^[\\u4e00-\\u9fa5]{2,6}$/.test(name)) return false;\n  if (/(||||||||)$/.test(name)) return false;\n  return true;\n}\n\nfunction sanitizeOnStageCharacters(list: OnStageCharacter[], excluded: Set<string>): OnStageCharacter[] {\n  return list.filter(v => isLikelyNpcName(String(v?. ?? ''), excluded));\n}\n\nfunction extractNameContext(text: string, name: string): string {\n  const lines = String(text ?? '').split(/[\\n]/).map(v => v.trim()).filter(Boolean);\n  const hit = lines.find(v => v.includes(name));\n  if (!hit) return '';\n  return hit.slice(0, 48);\n}\n\nfunction inferAttitudeByContext(context: string): string {\n  const t = String(context ?? '');\n  if (/|||/.test(t)) return '';\n  if (/||||/.test(t)) return '';\n  if (/||||/.test(t)) return '';\n  if (/|||/.test(t)) return '';\n  return '';\n}\n\nfunction refreshOnStageThoughtsByAiText(stat_data: any, ai_content: string): void {\n  const list = Array.isArray(_.get(stat_data, '.')) ? (_.get(stat_data, '.') as OnStageCharacter[]) : [];\n  if (list.length === 0) return;\n  const text = extractDisplayText(String(ai_content ?? ''));\n  if (!text) return;\n\n  const next = list.map(char => {\n    const name = String(char?. ?? '');\n    if (!name || !text.includes(name)) return char;\n    const context = extractNameContext(text, name);\n    return {\n      ...char,\n      : inferAttitudeByContext(context) || String(char. ?? ''),\n      : context ? `${context}` : `${name}`,\n      : Date.now(),\n    };\n  });\n  _.set(stat_data, '.', next);\n}\n\nfunction inferOnStageCharactersFromText(content: string, options?: { exclude_names?: string[]; old_onstage?: OnStageCharacter[] }): OnStageCharacter[] {\n  const text = extractDisplayText(String(content ?? ''));\n  if (!text) return [];\n\n  const excluded = new Set<string>(options?.exclude_names ?? []);\n  const old_onstage = options?.old_onstage ?? [];\n  const old_map = new Map(old_onstage.map(v => [v., v]));\n  const score = new Map<string, number>();\n\n  const pushScore = (raw_name: string, delta: number) => {\n    const name = normalizeNpcName(raw_name);\n    if (!isLikelyNpcName(name, excluded)) return;\n    score.set(name, (score.get(name) ?? 0) + delta);\n  };\n\n  // ///\n  for (const m of text.matchAll(/(?:||||)([\\u4e00-\\u9fa5]{2,6})/g)) {\n    pushScore(m[1], 3);\n  }\n  // X/////\n  for (const m of text.matchAll(/([\\u4e00-\\u9fa5]{2,6})(?:||||||||||||||||||||)/g)) {\n    pushScore(m[1], 2);\n  }\n  // /\n  for (const m of text.matchAll(/([\\u4e00-\\u9fa5]{2,6})[]\\s*(?:[\"]||||||||||||)/g)) {\n    pushScore(m[1], 1.6);\n  }\n  // \n  for (const m of text.matchAll(/([\\u4e00-\\u9fa5]{2,6})/g)) {\n    pushScore(m[1], 0.05);\n  }\n\n  // \n  for (const name of old_map.keys()) {\n    if (text.includes(name)) score.set(name, Math.max(score.get(name) ?? 0, 2));\n  }\n\n  const result: OnStageCharacter[] = [];\n  for (const [name, s] of score.entries()) {\n    if (s < 2.8) continue;\n    const old = old_map.get(name);\n    const context = extractNameContext(text, name);\n    result.push({\n      : name,\n      : clampAffection(old?. ?? 0, 0),\n      : String((old as any)?. ?? ''),\n      : old?. || inferAttitudeByContext(context),\n      : old?. || (context ? `${context}` : ''),\n      : _.isObjectLike(old?.) ? (_.cloneDeep(old?.) as Record<string, number>) : {},\n      : Date.now(),\n    });\n  }\n  return result;\n}\n\nfunction parseOnStageCharacters(content: string): OnStageCharacter[] | undefined {\n  const match = content.match(/<OnStageCharacters>([\\s\\S]*?)<\\/OnStageCharacters>/im);\n  if (!match?.[1]) return undefined;\n\n  try {\n    const parsed = JSON.parse(match[1]);\n    if (!Array.isArray(parsed)) return undefined;\n\n    return parsed\n      .filter(item => _.isObjectLike(item))\n      .map(item => {\n        const attrs = _.isObjectLike((item as any).) ? (item as any). as Record<string, unknown> : {};\n        const normalized_attrs = Object.fromEntries(\n          Object.entries(attrs).map(([k, v]) => [k, asNumber(v, 0)]),\n        ) as Record<string, number>;\n        return {\n          : String((item as any). ?? ''),\n          : _.clamp(asNumber((item as any)., 0), -200, 1000),\n          : String((item as any). ?? ''),\n          : String((item as any). ?? ''),\n          : String((item as any). ?? ''),\n          : normalized_attrs,\n          : Date.now(),\n        };\n      });\n  } catch {\n    return undefined;\n  }\n}\n\nfunction parseNpcRelationHints(content: string): NpcRelationHint[] | undefined {\n  const match = content.match(/<NpcRelationHints>([\\s\\S]*?)<\\/NpcRelationHints>/im);\n  if (!match?.[1]) return undefined;\n  try {\n    const parsed = JSON.parse(match[1]);\n    if (!Array.isArray(parsed)) return undefined;\n    return parsed\n      .filter(item => _.isObjectLike(item))\n      .map(item => ({\n        : String((item as any). ?? ''),\n        : Array.isArray((item as any).) ? (item as any)..map((v: unknown) => String(v)) : [],\n      }))\n      .filter(v => v.);\n  } catch {\n    return undefined;\n  }\n}\n\nfunction ensureNpcData(stat_data: any): void {\n  if (!_.isObjectLike(_.get(stat_data, ''))) _.set(stat_data, '', {});\n  if (!Array.isArray(_.get(stat_data, '.'))) _.set(stat_data, '.', []);\n  if (!_.isObjectLike(_.get(stat_data, '.'))) {\n    _.set(stat_data, '.', { : false, NPC: false });\n  } else {\n    _.defaults(_.get(stat_data, '.'), { : false, NPC: false });\n  }\n  if (!_.isObjectLike(_.get(stat_data, '.NPC'))) _.set(stat_data, '.NPC', {});\n  if (!_.isObjectLike(_.get(stat_data, '.NPC'))) _.set(stat_data, '.NPC', {});\n  if (!_.isObjectLike(_.get(stat_data, ''))) _.set(stat_data, '', {});\n  _.defaultsDeep(_.get(stat_data, ''), {\n    : false,\n    : {},\n    : {},\n    : {\n      : false,\n      : '',\n      : '',\n      : '',\n      : 0,\n      : 0,\n      : 0,\n      : '',\n      : '',\n      : [],\n    },\n    : {\n      : 0,\n      : 0,\n      : {},\n      : [],\n    },\n  });\n}\n\nfunction resetNpcStateBeforeCreate(stat_data: any): void {\n  if (!stat_data || typeof stat_data !== 'object') return;\n  if (_.get(stat_data, '..', false)) return;\n  _.set(stat_data, '.', []);\n  _.set(stat_data, '.NPC', {});\n  _.set(stat_data, '.NPC', {});\n}\n\nfunction clampAffection(value: unknown, fallback = 0): number {\n  return _.clamp(asNumber(value, fallback), -200, 1000);\n}\n\nfunction calcAffectionStage(score: number, is_partner = false): string {\n  if (is_partner) return '';\n  if (score <= -50) return '';\n  if (score <= -20) return '';\n  if (score <= 0) return '';\n  if (score <= 100) return '';\n  if (score <= 400) return '';\n  if (score <= 600) return '';\n  return '';\n}\n\nfunction mergeOnStageCharacters(old_list: OnStageCharacter[], incoming: OnStageCharacter[]): OnStageCharacter[] {\n  const merged_map = new Map<string, OnStageCharacter>();\n  for (const old of old_list) {\n    merged_map.set(old., {\n      : String(old. || ''),\n      : clampAffection(old., 0),\n      : String((old as any). || ''),\n      : String(old. || ''),\n      : String(old. || ''),\n      : _.isObjectLike(old.) ? _.cloneDeep(old.) : {},\n      : asNumber(old., 0),\n    });\n  }\n  for (const next of incoming) {\n    const name = String(next. || '');\n    const prev = merged_map.get(name);\n    if (!prev) {\n      merged_map.set(name, {\n        : name,\n        : clampAffection(next., 0),\n        : String((next as any). || ''),\n        : String(next. || ''),\n        : String(next. || ''),\n        : _.isObjectLike(next.) ? _.cloneDeep(next.) : {},\n        : Date.now(),\n      });\n      continue;\n    }\n    const requested = clampAffection(next., prev.);\n    const merged_affection = requested > prev. ? Math.min(prev. + 5, requested) : requested;\n    merged_map.set(name, {\n      : name,\n      : clampAffection(merged_affection, prev.),\n      : String((next as any). || (prev as any). || ''),\n      : String(next. || prev. || ''),\n      : String(next. || prev. || ''),\n      : {\n        ...(prev. ?? {}),\n        ...(_.isObjectLike(next.) ? next. : {}),\n      },\n      : Date.now(),\n    });\n  }\n  return [...merged_map.values()];\n}\n\nfunction detectMentionedNames(content: string, names: string[]): Set<string> {\n  const text = String(content ?? '');\n  const mentions = new Set<string>();\n  for (const name of names) {\n    if (!name) continue;\n    if (text.includes(name)) mentions.add(name);\n  }\n  return mentions;\n}\n\nfunction getTracker(stat_data: any, name: string): any {\n  const key = `.NPC.${name}`;\n  if (!_.isObjectLike(_.get(stat_data, key))) {\n    _.set(stat_data, key, {\n      : 0,\n      : 0,\n      : 0,\n      : 0,\n      : false,\n    });\n  }\n  return _.get(stat_data, key);\n}\n\nfunction upsertLongTermNpc(stat_data: any, name: string, payload?: Partial<OnStageCharacter>): any {\n  const key = `.NPC.${name}`;\n  const existing = _.get(stat_data, key);\n  const base = _.isObjectLike(existing) ? existing : {\n    : name,\n    : 0,\n    : '',\n    : '',\n    : '',\n    : '',\n    : {},\n    : 0,\n    : '',\n    : [],\n    : Date.now(),\n    : 0,\n  };\n  const next_affection = clampAffection(payload?., base.);\n  const current_affection = clampAffection(base., 0);\n  const merged_affection = next_affection > current_affection ? Math.min(current_affection + 5, next_affection) : next_affection;\n  const is_partner = Array.isArray(base.) && base..includes('');\n  const next = {\n    ...base,\n    : name,\n    : merged_affection,\n    : String((payload as any)?. || base. || ''),\n    : String(payload?. || base. || ''),\n    : String(payload?. || base. || ''),\n    : {\n      ...(base. ?? {}),\n      ...(payload?. ?? {}),\n    },\n    : Date.now(),\n  };\n  next. = calcAffectionStage(next., is_partner);\n  _.set(stat_data, key, next);\n  return next;\n}\n\nfunction promoteToLongTermByName(stat_data: any, name: string, reason: string): void {\n  const onstage_list = (_.get(stat_data, '.', []) as OnStageCharacter[]);\n  const onstage = onstage_list.find(v => v. === name);\n  const npc = upsertLongTermNpc(stat_data, name, onstage);\n  const tracker = getTracker(stat_data, name);\n  tracker. = true;\n  _.set(stat_data, `.NPC.${name}.`, _.uniq([...(npc. ?? []), reason]));\n}\n\nconst npc_follow_pattern = /|||||/;\nconst npc_partner_ai_pattern = /||/;\nconst npc_partner_user_confirm_pattern = /||||/;\nconst npc_sex_pattern = /||||/;\n\nfunction applyUserNpcRequest(stat_data: any, user_content: string): boolean {\n  if (!npc_follow_pattern.test(user_content)) return false;\n  const onstage_list = (_.get(stat_data, '.', []) as OnStageCharacter[]);\n  const names = onstage_list.map(v => v.);\n  const mentioned = [...detectMentionedNames(user_content, names)];\n  const targets = mentioned.length > 0 ? mentioned : (names.length === 1 ? [names[0]] : []);\n  if (targets.length === 0) return false;\n  for (const name of targets) {\n    const tracker = getTracker(stat_data, name);\n    tracker. = asNumber(tracker., 0) + 1;\n    tracker. = Date.now();\n    promoteToLongTermByName(stat_data, name, '');\n  }\n  return true;\n}\n\nfunction applyNpcLongTermRules(stat_data: any, ai_content: string, user_content: string, parsed_onstage?: OnStageCharacter[], hints?: NpcRelationHint[]): void {\n  ensureNpcData(stat_data);\n  const onstage_list = (_.get(stat_data, '.', []) as OnStageCharacter[]);\n  const long_map = _.get(stat_data, '.NPC', {}) as Record<string, any>;\n  const name_pool = _.uniq([\n    ...onstage_list.map(v => v.),\n    ...Object.keys(long_map),\n    ...(parsed_onstage?.map(v => v.) ?? []),\n  ]);\n  const structured_names = new Set((parsed_onstage ?? []).map(v => v.));\n  const text_mentions = detectMentionedNames(ai_content, name_pool);\n  const appeared = new Set<string>([...structured_names, ...text_mentions]);\n  const round = asNumber(_.get(stat_data, '..', 1), 1);\n\n  for (const name of name_pool) {\n    const tracker = getTracker(stat_data, name);\n    if (appeared.has(name)) {\n      tracker. = asNumber(tracker., 0) + 1;\n      tracker. = round;\n    } else {\n      tracker. = Math.max(0, asNumber(tracker., 0) - 1);\n    }\n    if (tracker. >= 5 && !tracker.) {\n      promoteToLongTermByName(stat_data, name, '');\n    }\n  }\n\n  for (const onstage of onstage_list) {\n    if (_.has(stat_data, `.NPC.${onstage.}`)) {\n      upsertLongTermNpc(stat_data, onstage., onstage);\n    }\n  }\n\n  for (const hint of hints ?? []) {\n    if (!_.has(long_map, hint.)) continue;\n    const curr = _.get(stat_data, `.NPC.${hint.}.`, []);\n    _.set(stat_data, `.NPC.${hint.}.`, _.uniq([...(curr ?? []), ...hint.]));\n  }\n\n  const ai_has_partner_signal = npc_partner_ai_pattern.test(ai_content);\n  const user_confirm = npc_partner_user_confirm_pattern.test(user_content);\n  if (ai_has_partner_signal && user_confirm) {\n    for (const name of detectMentionedNames(ai_content, Object.keys(_.get(stat_data, '.NPC', {})))) {\n      const score = clampAffection(_.get(stat_data, `.NPC.${name}.`, 0), 0);\n      if (score < 601) continue;\n      const current_tags = _.get(stat_data, `.NPC.${name}.`, []);\n      const tags = _.uniq([...(Array.isArray(current_tags) ? current_tags : []), '']);\n      _.set(stat_data, `.NPC.${name}.`, tags);\n      _.set(stat_data, `.NPC.${name}.`, '');\n      _.set(stat_data, `.NPC.${name}.`, Date.now());\n    }\n  }\n\n  if (npc_sex_pattern.test(ai_content)) {\n    for (const name of detectMentionedNames(ai_content, Object.keys(_.get(stat_data, '.NPC', {})))) {\n      const count = asNumber(_.get(stat_data, `.NPC.${name}.`, 0), 0) + 1;\n      _.set(stat_data, `.NPC.${name}.`, count);\n      _.set(stat_data, `.NPC.${name}.`, '');\n      _.set(stat_data, `.NPC.${name}.`, Date.now());\n    }\n  }\n}\n\nfunction applyVivianaArc(stat_data: any): void {\n  const current_place = String(_.get(stat_data, '.', ''));\n  const in_library = //.test(current_place);\n  const onstage = _.get(stat_data, '.', []) as OnStageCharacter[];\n  const long_map = _.get(stat_data, '.NPC', {}) as Record<string, any>;\n  const names = _.uniq([\n    ...onstage.map(v => String(v. || '')),\n    ...Object.keys(long_map),\n  ]).filter(v => //.test(v));\n  if (names.length === 0) return;\n\n  for (const name of names) {\n    if (!in_library) {\n      _.remove(onstage, v => String(v?. ?? '') === name);\n      continue;\n    }\n    const npc = _.get(stat_data, `.NPC.${name}`, {});\n    const score = clampAffection(_.get(npc, '', 0), 0);\n    const stage = String(_.get(npc, '', calcAffectionStage(score)));\n    const is_partner = stage === '' || (Array.isArray(_.get(npc, '')) && _.get(npc, '').includes(''));\n\n    let attitude = '';\n    let thought = '';\n    if (score >= 1) {\n      attitude = '';\n      thought = '';\n    }\n    if (score >= 101) {\n      attitude = '';\n      thought = '';\n    }\n    if (score >= 401) {\n      attitude = '';\n      thought = '';\n    }\n    if (score >= 601) {\n      attitude = '';\n      thought = '';\n    }\n    if (is_partner) {\n      attitude = '';\n      thought = '';\n      _.set(stat_data, `.NPC.${name}.`, '');\n    }\n\n    _.set(stat_data, `.NPC.${name}.`, attitude);\n    _.set(stat_data, `.NPC.${name}.`, thought);\n    _.set(stat_data, `.NPC.${name}.`, Date.now());\n\n    const idx = onstage.findIndex(v => String(v?. ?? '') === name);\n    if (idx >= 0) {\n      onstage[idx]. = attitude;\n      onstage[idx]. = `${thought}`;\n      onstage[idx]. = Date.now();\n    }\n  }\n}\n\nfunction sanitizeThoughtText(raw: string): string {\n  const thought = String(raw ?? '').trim();\n  if (!thought) return '';\n  if (/AI|||||JSON||mvu|statusplaceholder/i.test(thought)) {\n    return '';\n  }\n  return thought.slice(0, 120);\n}\n\nfunction buildPersonaInnerThought(name: string, score: number, is_partner: boolean, fallback: string): { attitude: string; thought: string } {\n  const clean_fallback = sanitizeThoughtText(fallback);\n\n  if (/|victorica/i.test(name)) {\n    if (is_partner) return { attitude: '', thought: '' };\n    if (score >= 601) return { attitude: '', thought: '' };\n    if (score >= 401) return { attitude: '', thought: '' };\n    if (score >= 101) return { attitude: '', thought: '' };\n    if (score >= 1) return { attitude: '', thought: '' };\n    return { attitude: '', thought: '' };\n  }\n\n  if (/|/i.test(name)) {\n    if (is_partner) return { attitude: '', thought: '' };\n    if (score >= 601) return { attitude: '', thought: '' };\n    if (score >= 401) return { attitude: '', thought: '' };\n    if (score >= 101) return { attitude: '', thought: '' };\n    if (score >= 1) return { attitude: '', thought: '' };\n    return { attitude: '', thought: '' };\n  }\n\n  if (clean_fallback) {\n    return { attitude: '', thought: clean_fallback };\n  }\n  return { attitude: '', thought: '' };\n}\n\nfunction applyNpcPersonaConsistency(stat_data: any): void {\n  const onstage = (_.get(stat_data, '.', []) as OnStageCharacter[]) ?? [];\n  const long_map = (_.get(stat_data, '.NPC', {}) as Record<string, any>) ?? {};\n  const all_names = _.uniq([\n    ...onstage.map(v => String(v?. ?? '')),\n    ...Object.keys(long_map),\n  ]).filter(Boolean);\n\n  for (const name of all_names) {\n    const long_key = `.NPC.${name}`;\n    const long_npc = _.get(stat_data, long_key, {});\n    const score = clampAffection(_.get(long_npc, '', 0), 0);\n    const tags = _.get(long_npc, '', []);\n    const is_partner = String(_.get(long_npc, '', '')) === '' || (Array.isArray(tags) && tags.includes(''));\n    const fallback = String(_.get(long_npc, '', '') || onstage.find(v => v. === name)?. || '');\n    const persona = buildPersonaInnerThought(name, score, is_partner, fallback);\n\n    if (_.has(stat_data, long_key)) {\n      _.set(stat_data, `${long_key}.`, persona.attitude);\n      _.set(stat_data, `${long_key}.`, persona.thought);\n      _.set(stat_data, `${long_key}.`, Date.now());\n      if (is_partner) _.set(stat_data, `${long_key}.`, '');\n    }\n\n    const idx = onstage.findIndex(v => String(v?. ?? '') === name);\n    if (idx >= 0) {\n      onstage[idx]. = persona.attitude;\n      onstage[idx]. = `${persona.thought}`;\n      onstage[idx]. = Date.now();\n    }\n  }\n}\n\nconst dungeon_enter_pattern = /|||||/i;\nconst dungeon_leave_pattern = /||||/i;\nconst dungeon_move_pattern = /||||||/i;\nconst dungeon_search_pattern = /||||||/i;\nconst dungeon_blow_pattern = /||||/i;\n\nconst lab_level_options = ['', '', '', ''] as const;\nconst lab_room_pool: Record<'' | '' | '' | '', string[]> = {\n  : ['', '', '', '', '', '', '', ''],\n  : ['', '', '', '', '', '', '', '', ''],\n  : ['', '', '', '', '', '', ''],\n  : ['', '', '', '', '', ''],\n};\n\ntype ItemTier = '' | '' | '' | '' | '' | '';\nconst tier_value_range: Record<ItemTier, [number, number]> = {\n  : [1, 1000],\n  : [1001, 5000],\n  : [5001, 20000],\n  : [20001, 50000],\n  : [50001, 200000],\n  : [200001, 20000000],\n};\nconst tier_affix_count: Record<ItemTier, number> = {\n  : 0,\n  : 1,\n  : 2,\n  : 3,\n  : 4,\n  : 5,\n};\nconst affix_pool = [\n  '', '', '', '', '', '', '', '', '', '',\n];\nconst trade_only_items = ['', '', '', '', ''];\nconst black_market_trade_pattern = /.*(||||)/i;\nconst black_market_buy_pattern = /.*(|||)/i;\n\nfunction parseLabLevel(content: string): (typeof lab_level_options)[number] {\n  if (//.test(content)) return '';\n  if (//.test(content)) return '';\n  if (//.test(content)) return '';\n  return '';\n}\n\nfunction parseMapScale(content: string, level: (typeof lab_level_options)[number]): '' | '' | '' {\n  if (//.test(content)) return '';\n  if (//.test(content)) return '';\n  if (//.test(content)) return '';\n  if (level === '' || level === '') return '';\n  if (level === '') return '';\n  return '';\n}\n\nfunction rollRoomTypeByLuck(luck: number): '' | '' | '' | '' {\n  // 1.012~34~7/8~910\n  // 20 +0.1/\n  const shift = Math.max(0, Math.floor(luck / 20));\n  const good_weight = 2 + shift;\n  const normal_weight = Math.max(1, 4 - shift);\n  const danger_weight = 1;\n  let risky_weight = 2;\n  if (shift >= 2) {\n    risky_weight = Math.max(1, risky_weight - Math.floor(shift / 2));\n  }\n  const hidden_weight = 1;\n  const total = hidden_weight + good_weight + normal_weight + risky_weight + danger_weight;\n  const r = Math.random() * total;\n  if (r < hidden_weight) return '';\n  if (r < hidden_weight + good_weight) return '';\n  if (r < hidden_weight + good_weight + normal_weight) return '';\n  // /\n  return '';\n}\n\nfunction buildRoomContainer(room_type: '' | '' | '' | ''): { : number; : number; : boolean; : boolean } {\n  if (room_type === '') return { : 0, : 4, : false, : false };\n  if (room_type === '') {\n    const locked = Math.random() < 0.35;\n    return locked\n      ? { : 0, : _.random(2, 5), : true, : false }\n      : { : 1, : 1, : false, : false };\n  }\n  if (room_type === '') return { : 2, : 0, : false, : false };\n  const has_loot = Math.random() < 0.7; // /1\n  return { : has_loot ? 1 : 0, : 0, : false, : false };\n}\n\nfunction generateDungeonMap(scale: '' | '' | '', luck: number): any[] {\n  const count = scale === '' ? 5 : scale === '' ? 12 : 20;\n  const rooms: any[] = [];\n  for (let i = 1; i <= count; i += 1) {\n    const room_type = rollRoomTypeByLuck(luck);\n    // /\n    const room_name = _.sample(lab_room_pool[room_type]) ?? (room_type === '' ? '' : '');\n    rooms.push({\n      : i,\n      : room_name,\n      : room_type,\n      : buildRoomContainer(room_type),\n    });\n  }\n  return rooms;\n}\n\nfunction pickLootQuality(level: (typeof lab_level_options)[number], is_advanced: boolean): ItemTier {\n  const roll = _.random(1, 100);\n  if (level === '') {\n    if (roll >= 96) return '';\n    if (roll >= 75) return '';\n    if (roll >= 45) return '';\n    if (roll >= 20) return '';\n    return is_advanced ? '' : '';\n  }\n  if (level === '') {\n    if (roll >= 97) return '';\n    if (roll >= 82) return '';\n    if (roll >= 55) return '';\n    if (roll >= 25) return '';\n    return is_advanced ? '' : '';\n  }\n  if (level === '') {\n    if (roll >= 95) return '';\n    if (roll >= 75) return '';\n    if (roll >= 45) return '';\n    if (roll >= 20) return '';\n    return '';\n  }\n  if (roll >= 98) return '';\n  if (roll >= 85) return '';\n  if (roll >= 60) return '';\n  if (roll >= 30) return '';\n  return '';\n}\n\nfunction addWarehouseItem(stat_data: any, item_name: string, quality: ItemTier, count: number, category: string, desc: string, value: number, tags: string[], tradeable = true): void {\n  if (item_name === '') {\n    _.set(stat_data, '..', asNumber(_.get(stat_data, '..', 0), 0) + count);\n    return;\n  }\n  if (item_name === '') {\n    _.set(stat_data, '..', asNumber(_.get(stat_data, '..', 0), 0) + count);\n    return;\n  }\n  const key = `...${item_name}`;\n  const old_count = asNumber(_.get(stat_data, `${key}.`, 0), 0);\n  const old_tags = _.get(stat_data, `${key}.`, []);\n  _.set(stat_data, key, {\n    : quality,\n    : old_count + count,\n    : value,\n    : category,\n    : desc,\n    : _.uniq([...(Array.isArray(old_tags) ? old_tags : []), ...tags]),\n    : tradeable,\n  });\n  if (/||/.test(quality)) {\n    const curr = _.get(stat_data, '..', []);\n    _.set(stat_data, '..', _.uniq([...(Array.isArray(curr) ? curr : []), item_name]));\n  }\n}\n\nfunction generateLootFromContainer(stat_data: any, level: (typeof lab_level_options)[number], container_type: '' | '', slot_override?: number): Record<string, any> {\n  const slots = slot_override ?? (container_type === '' ? 3 : 2);\n  const loot: Record<string, any> = {};\n  const pools = {\n    : ['', '', '', '', ''],\n    : ['', '', '', ''],\n    : ['', '', '', ''],\n    : ['', '', ''],\n  };\n  for (let i = 0; i < slots; i += 1) {\n    const quality = pickLootQuality(level, container_type === '');\n    const category = quality === '' || quality === ''\n      ? _.sample(['', '', '']) ?? ''\n      : _.sample(['', '', '']) ?? '';\n    const is_trade_only = category === '' && Math.random() < 0.45;\n    const item_name = (() => {\n      if (is_trade_only) return _.sample(trade_only_items) ?? '';\n      if (quality === '') return Math.random() < 0.25 ? '' : '';\n      if (quality === '') return '';\n      if (quality === '') return '';\n      return _.sample((pools as any)[category]) ?? '';\n    })();\n    const count = item_name === '' ? _.random(40, 280) : item_name === '' ? _.random(1, 4) : 1;\n    const [vmin, vmax] = tier_value_range[quality];\n    const value = _.random(vmin, vmax);\n    const tags = is_trade_only ? [] : _.sampleSize(affix_pool, tier_affix_count[quality]);\n    loot[item_name] = {\n      : quality,\n      : asNumber(_.get(loot, `${item_name}.`, 0), 0) + count,\n      : value,\n    };\n    addWarehouseItem(stat_data, item_name, quality, count, category, `${container_type}`, value, tags, true);\n  }\n  return loot;\n}\n\nfunction mergeLootRecord(target: Record<string, any>, incoming: Record<string, any>): void {\n  for (const [name, item] of Object.entries(incoming)) {\n    const old_count = asNumber(_.get(target, `${name}.`, 0), 0);\n    target[name] = {\n      : String((item as any)?. ?? _.get(target, `${name}.`, '')),\n      : old_count + asNumber((item as any)?., 0),\n      : asNumber((item as any)?., asNumber(_.get(target, `${name}.`, 1), 1)),\n    };\n  }\n}\n\nfunction applyDungeonLootSystem(stat_data: any, content: string): void {\n  ensureNpcData(stat_data);\n  const level = parseLabLevel(content);\n  const scale = parseMapScale(content, level);\n  const luck = asNumber(_.get(stat_data, '..', 1), 1) * 20;\n\n  if (dungeon_enter_pattern.test(content)) {\n    const map = generateDungeonMap(scale, luck);\n    _.set(stat_data, '.', {\n      : true,\n      : '',\n      : level,\n      : scale,\n      : map.length,\n      : 0,\n      : 1,\n      : map[0]?. ?? '',\n      : `${level}/${scale}/${map.length}`,\n      : map,\n    });\n    _.set(stat_data, '.', true);\n    _.set(stat_data, '..', `${level}${scale}`);\n    return;\n  }\n\n  if (!_.get(stat_data, '..', false)) return;\n  const rooms = _.get(stat_data, '..', []) as any[];\n  if (!Array.isArray(rooms) || rooms.length === 0) return;\n  let idx = _.clamp(asNumber(_.get(stat_data, '..', 0), 0), 0, rooms.length - 1);\n\n  if (dungeon_move_pattern.test(content)) {\n    idx = Math.min(rooms.length - 1, idx + 1);\n    _.set(stat_data, '..', idx);\n    _.set(stat_data, '..', Math.max(asNumber(_.get(stat_data, '..', 1), 1), idx + 1));\n    _.set(stat_data, '..', String(rooms[idx]?. ?? ''));\n  }\n\n  if (dungeon_search_pattern.test(content)) {\n    const room = rooms[idx];\n    if (room?.?.) {\n      _.set(stat_data, '.', {});\n      _.set(stat_data, '..', `${idx + 1}`);\n      _.set(stat_data, '.', true);\n    } else {\n      const merged_loot: Record<string, any> = {};\n      const is_blow = dungeon_blow_pattern.test(content) && Boolean(room?.?.);\n      const slot_override = is_blow ? 1 : undefined;\n      const normal_count = asNumber(room?.?., 0);\n      const advanced_count = asNumber(room?.?., 0);\n\n      for (let i = 0; i < normal_count; i += 1) {\n        const loot = generateLootFromContainer(stat_data, _.get(stat_data, '..', level), '', slot_override);\n        mergeLootRecord(merged_loot, loot);\n      }\n      for (let i = 0; i < advanced_count; i += 1) {\n        const loot = generateLootFromContainer(stat_data, _.get(stat_data, '..', level), '', slot_override);\n        mergeLootRecord(merged_loot, loot);\n      }\n\n      _.set(room, '.', true);\n      _.set(stat_data, '.', merged_loot);\n      _.set(stat_data, '.', true);\n      _.set(stat_data, '..', is_blow ? '1/' : `${idx + 1}`);\n      _.set(stat_data, `.-${Date.now()}`, `${idx + 1}:${room?. ?? ''} `);\n      trimBattleLogs(stat_data, 3);\n    }\n  }\n\n  if (dungeon_leave_pattern.test(content)) {\n    _.set(stat_data, '..', false);\n    _.set(stat_data, '..', '');\n  }\n}\n\nfunction applyBlackMarketTrade(stat_data: any, content: string): void {\n  if (!/|/.test(content)) return;\n  const market_place = '';\n  if (/|||/.test(content)) {\n    _.set(stat_data, '.', market_place);\n    _.set(stat_data, '..', '');\n  }\n\n  const items = _.get(stat_data, '..', {}) as Record<string, any>;\n  const names = Object.keys(items);\n  if (black_market_trade_pattern.test(content)) {\n    const targets = [...detectMentionedNames(content, names)];\n    for (const name of targets) {\n      const qty_match = content.match(new RegExp(`${_.escapeRegExp(name)}\\\\D*(\\\\d+)`, 'i'));\n      const sell_qty = Math.max(1, asNumber(qty_match?.[1], 1));\n      const own_qty = asNumber(_.get(stat_data, `...${name}.`, 0), 0);\n      if (own_qty <= 0) continue;\n      const use_qty = Math.min(own_qty, sell_qty);\n      const value = asNumber(_.get(stat_data, `...${name}.`, 1), 1);\n      const tradeable = Boolean(_.get(stat_data, `...${name}.`, true));\n      if (!tradeable) continue;\n      const income = Math.floor(value * use_qty * 0.1); // 90%\n      _.set(stat_data, '..', asNumber(_.get(stat_data, '..', 0), 0) + income);\n      const left = own_qty - use_qty;\n      if (left <= 0) _.unset(stat_data, `...${name}`);\n      else _.set(stat_data, `...${name}.`, left);\n      _.set(stat_data, '..', ` ${name} x${use_qty}${income}90%`);\n    }\n  }\n\n  if (black_market_buy_pattern.test(content)) {\n    const want_tier = (['', '', '', '', '', ''] as ItemTier[]).find(t => content.includes(t)) ?? '';\n    const [vmin, vmax] = tier_value_range[want_tier];\n    const price = _.random(vmin, vmax);\n    const money = asNumber(_.get(stat_data, '..', 0), 0);\n    if (money >= price) {\n      _.set(stat_data, '..', money - price);\n      const item_name = `${want_tier}-${Date.now().toString().slice(-4)}`;\n      const tags = _.sampleSize(affix_pool, tier_affix_count[want_tier]);\n      addWarehouseItem(stat_data, item_name, want_tier, 1, '', '', price, tags, true);\n      _.set(stat_data, '..', ` ${item_name}${want_tier} ${price}`);\n    } else {\n      _.set(stat_data, '..', `${price}${money}`);\n    }\n  }\n}\n\nfunction hasExplicitUpdateTag(content: string): boolean {\n  return /<update(?:variable)?>[\\s\\S]*?<\\/update(?:variable)?>|<update(?:variable)?>[\\s\\S]*$/im.test(content);\n}\n\nfunction lockCriticalStateWithoutTag(new_stat: any, old_stat: any): void {\n  if (!_.isObjectLike(new_stat)) return;\n  if (!_.isObjectLike(old_stat)) return;\n  const critical_paths = [\n    '.',\n    '.',\n    '.',\n    '.',\n    '.',\n    '.',\n    '.',\n    '.',\n    '.',\n    '.',\n    '.',\n  ];\n  for (const p of critical_paths) {\n    const old_val = _.get(old_stat, p);\n    if (old_val !== undefined) {\n      _.set(new_stat, p, _.cloneDeep(old_val));\n    }\n  }\n}\n\nfunction patchGameplayState(stat_data: any, content: string): void {\n  if (!stat_data || typeof stat_data !== 'object') return;\n\n  const profession = _.get(stat_data, '..', '');\n  const is_warmaid = profession === '' || String(_.get(stat_data, '..', '')).includes('');\n  if (!is_warmaid) {\n    _.set(stat_data, '..', false);\n    _.set(stat_data, '.', false);\n    return;\n  }\n\n  const current_round = asNumber(_.get(stat_data, '..', 0), 0);\n  const line = String(_.get(stat_data, '..', ''));\n  const threat = String(_.get(stat_data, '.', ''));\n  const manual_toggle = Boolean(_.get(stat_data, '..', false));\n\n  const battle_by_state = current_round > 1 || line === '' || line === '' || threat === '' || threat === '';\n  const battle_by_text = /||||||||||/i.test(content);\n  const in_battle = battle_by_state || battle_by_text;\n\n  const was_enabled = Boolean(_.get(stat_data, '..', false));\n  const should_enable = manual_toggle || in_battle;\n  _.set(stat_data, '..', should_enable);\n\n  let last_round = asNumber(_.get(stat_data, '..', 0), 0);\n  if (!was_enabled && should_enable) {\n    last_round = current_round;\n    _.set(stat_data, '..', current_round);\n  }\n\n  if (should_enable) {\n    const round_delta = Math.max(0, current_round - last_round);\n    if (round_delta > 0) {\n      const magic_cost = asNumber(_.get(stat_data, '..', 0), 0) * round_delta;\n      const slot_cost = asNumber(_.get(stat_data, '..', 0), 0) * round_delta;\n\n      const current_magic = asNumber(_.get(stat_data, '..', 0), 0);\n      const current_slot = asNumber(_.get(stat_data, '..', 0), 0);\n      const next_magic = Math.max(0, current_magic - magic_cost);\n      const next_slot = Math.max(0, current_slot - slot_cost);\n\n      _.set(stat_data, '..', next_magic);\n      _.set(stat_data, '..', next_slot);\n      _.set(stat_data, '..', current_round);\n\n      if (next_magic <= 0 || next_slot <= 0) {\n        _.set(stat_data, '..', false);\n        _.set(stat_data, '..', false);\n      }\n    }\n  } else if (last_round > current_round) {\n    _.set(stat_data, '..', current_round);\n  }\n\n  // /\n}\n\nfunction getWarmaidType(stat_data: any): string {\n  return String(\n    _.get(stat_data, '..', '').trim()\n      || _.get(stat_data, '..', '').replace('-', '').trim(),\n  );\n}\n\nfunction applyBattleSystemConstraints(stat_data: any, content: string): void {\n  if (!stat_data || typeof stat_data !== 'object') return;\n  ensureAirCombatData(stat_data);\n\n  const mode_by_text =\n    /|||||/i.test(content) ? ''\n      : /||||/i.test(content) ? ''\n        : '';\n  const current_round = asNumber(_.get(stat_data, '..', 1), 1);\n  const threat = String(_.get(stat_data, '.', ''));\n  const line = String(_.get(stat_data, '..', ''));\n  const in_battle_by_state = current_round > 1 || line === '' || line === '' || threat === '' || threat === '';\n  const in_battle_by_text = isBattleTriggerContent(content);\n  const in_battle = in_battle_by_state || in_battle_by_text;\n\n  const mode = in_battle ? (mode_by_text === '' ? '' : mode_by_text) : '';\n  _.set(stat_data, '..', mode);\n  _.set(stat_data, '..', in_battle);\n\n  if (!in_battle) {\n    _.set(stat_data, '..', 1);\n    _.set(stat_data, '..', 1);\n    _.set(stat_data, '..', '');\n    return;\n  }\n\n  const profession = _.get(stat_data, '..', '');\n  const warmaid_type = getWarmaidType(stat_data);\n  const is_commander = profession === '';\n  const is_authority = profession === '';\n\n  let ap = 1;\n  let mp = 1;\n  let penalty = '';\n\n  if (mode === '') {\n    const agi = asNumber(_.get(stat_data, '..', 1), 1);\n    ap = Math.max(1, Math.floor(agi / 3));\n    mp = warmaid_type === '' ? 0 : 1;\n  } else if (is_commander) {\n    ap = 1;\n    mp = 1;\n    if (line !== '') {\n      _.set(stat_data, '..', '');\n    }\n  } else if (is_authority) {\n    ap = 1;\n    mp = 1;\n  } else if (warmaid_type === '') {\n    ap = 1; mp = 2;\n  } else if (warmaid_type === '') {\n    ap = 2; mp = 1;\n  } else if (warmaid_type === '') {\n    ap = 1; mp = 1;\n  } else if (warmaid_type === '') {\n    ap = 1;\n    const move_counter = asNumber(_.get(stat_data, '..', 0), 0) + 1;\n    _.set(stat_data, '..', move_counter % 2);\n    mp = move_counter % 2 === 0 ? 1 : 0;\n    if (line === '') penalty = '-1/3';\n    if (line === '') penalty = '-1/2';\n  } else if (warmaid_type === '') {\n    ap = 1;\n    mp = 0;\n    if (line === '') penalty = '-1/2';\n    if (line === '' || line === '') penalty = '/';\n  } else if (warmaid_type === '') {\n    ap = 1; mp = 1;\n  }\n\n  _.set(stat_data, '..', ap);\n  _.set(stat_data, '..', mp);\n  if (mode === '') {\n    const weather_hit = asNumber(_.get(stat_data, '...', 0), 0);\n    const superiority = asNumber(_.get(stat_data, '...', 0), 0);\n    const heavy_condition = String(_.get(stat_data, '...', ''));\n    const transform_on = Boolean(_.get(stat_data, '..', false));\n    const airflow_penalty = `: ${weather_hit >= 0 ? '+' : ''}${weather_hit} / ${superiority >= 0 ? '+' : ''}${superiority} | :${heavy_condition}`;\n    penalty = penalty === '' ? airflow_penalty : `${penalty}${airflow_penalty}`;\n    if (!transform_on && !is_commander && !is_authority) {\n      penalty = `${penalty}: `;\n    }\n  }\n\n  _.set(stat_data, '..', penalty);\n}\n\nfunction applyHumanTraining(stat_data: any, content: string): void {\n  if (!stat_data || typeof stat_data !== 'object') return;\n  const attrs: Array<'' | '' | '' | '' | '' | '' | ''> = [\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n  ];\n\n  const keyword_map: Record<(typeof attrs)[number], RegExp> = {\n    : /|||||||/i,\n    : /||||||/i,\n    : /||||||/i,\n    : /|||||||/i,\n    : /||||||/i,\n    : /||||||/i,\n    : /|||||||/i,\n  };\n\n  attrs.forEach(attr => {\n    const matched = keyword_map[attr].test(content);\n    if (!matched) return;\n\n    const current_attr = asNumber(_.get(stat_data, `..${attr}`, 1), 1);\n    if (current_attr >= 5) {\n      _.set(stat_data, `..${attr}`, 100);\n      return;\n    }\n\n    const current_train = asNumber(_.get(stat_data, `..${attr}`, 0), 0);\n    const next_train = Math.min(100, current_train + 1);\n\n    if (next_train >= 100) {\n      _.set(stat_data, `..${attr}`, Math.min(5, current_attr + 1));\n      _.set(stat_data, `..${attr}`, 0);\n    } else {\n      _.set(stat_data, `..${attr}`, next_train);\n    }\n  });\n}\n\ntype SkillAttr = '' | '' | '' | '' | '' | '' | '' | '';\n\nfunction rollD10(): number {\n  return Math.floor(Math.random() * 10) + 1;\n}\n\nfunction inferSkillAttr(content: string): SkillAttr {\n  const map: Array<{ attr: SkillAttr; pattern: RegExp }> = [\n    { attr: '', pattern: /||||||||||||||||||||||/i },\n    { attr: '', pattern: /|||||||||||/i },\n    { attr: '', pattern: /|||||||||||/i },\n    { attr: '', pattern: /|||||||||||/i },\n    { attr: '', pattern: /||||||san||||/i },\n    { attr: '', pattern: /||||||||||/i },\n    { attr: '', pattern: /|||||||||||||||/i },\n  ];\n  const hit = map.find(item => item.pattern.test(content));\n  return hit?.attr ?? '';\n}\n\nfunction inferActionTag(content: string): string {\n  const rules: Array<{ tag: string; pattern: RegExp }> = [\n    { tag: '', pattern: /|||||||/i },\n    { tag: '', pattern: /|||/i },\n    { tag: '', pattern: /||||/i },\n    { tag: '', pattern: /||/i },\n    { tag: '', pattern: /||/i },\n    { tag: '', pattern: /||||/i },\n    { tag: '', pattern: /|||/i },\n    { tag: '', pattern: /|||/i },\n    { tag: '', pattern: /|||/i },\n  ];\n  return rules.find(r => r.pattern.test(content))?.tag ?? '';\n}\n\nfunction inferDifficulty(content: string, attr: SkillAttr): { penalty: number; label: string } {\n  let penalty = 0;\n  const hard = /|||||||||||||/i.test(content);\n  const extreme = /|||||||/i.test(content);\n\n  if (hard) penalty += 2;\n  if (extreme) penalty += 2;\n\n  if (attr === '' && /||||||/i.test(content) && hard) {\n    penalty += 1;\n  }\n\n  if (penalty <= 0) return { penalty: 0, label: '' };\n  if (penalty <= 2) return { penalty, label: '' };\n  if (penalty <= 4) return { penalty, label: '' };\n  return { penalty: Math.min(6, penalty), label: '' };\n}\n\nconst low_impact_no_check_pattern = /|||||||||||||/i;\nconst high_consequence_pattern = /||||||||||||||||||||||/i;\nconst contested_action_pattern = /||||||||||||||||||/i;\nconst explicit_check_pattern = /|||D10|/i;\nconst avoid_risk_intent_pattern = /|||||||||||||/i;\n\nfunction inferConsequenceLevel(content: string): 0 | 1 | 2 {\n  const text = String(content ?? '');\n  if (/||||||||||||/i.test(text)) return 2;\n  if (/|||||||||/i.test(text)) return 1;\n  return 0;\n}\n\nfunction shouldRequireSkillCheck(content: string, inferred_attr: SkillAttr): boolean {\n  const text = String(content ?? '').trim();\n  if (!text) return false;\n  if (explicit_check_pattern.test(text)) return true;\n  const avoid_intent = avoid_risk_intent_pattern.test(text);\n  if (low_impact_no_check_pattern.test(text) && !high_consequence_pattern.test(text)) return false;\n  if (isBattleTriggerContent(text)) return true;\n  if ((high_consequence_pattern.test(text) || contested_action_pattern.test(text)) && avoid_intent) return true;\n  if (inferred_attr === '' && /(|||||||||)/i.test(text) && avoid_intent) return true;\n  return false;\n}\n\nfunction hasRiskButNoAvoidIntent(content: string): boolean {\n  const text = String(content ?? '').trim();\n  if (!text) return false;\n  if (explicit_check_pattern.test(text)) return false;\n  if (isBattleTriggerContent(text)) return false; // \n  const risky = high_consequence_pattern.test(text) || contested_action_pattern.test(text);\n  if (!risky) return false;\n  return !avoid_risk_intent_pattern.test(text);\n}\n\ntype SkillOutcome = {\n  attr: SkillAttr;\n  action_tag: string;\n  current_round: number;\n  raw: number;\n  bonus: number;\n  difficulty_penalty: number;\n  difficulty_label: string;\n  total: number;\n  result: '' | '' | '' | '';\n  desc: string;\n  lock_to_round: number;\n  hp_loss: number;\n  mp_loss: number;\n};\n\ntype PendingSkillState = {\n  user_message_id: number;\n  source_content: string;\n  outcome: SkillOutcome;\n  feedback_prompt: string;\n  injected: boolean;\n  game_over: boolean;\n};\n\nfunction resolveSkillOutcome(stat_data: any, content: string, raw_override?: number): SkillOutcome | undefined {\n  const inferred_attr = inferSkillAttr(content);\n  const should_check = shouldRequireSkillCheck(content, inferred_attr) && inferred_attr !== '';\n  if (!should_check) return undefined;\n\n  const attr = inferred_attr;\n  const action_tag = inferActionTag(content);\n  const current_round = asNumber(_.get(stat_data, '..', 1), 1);\n  const lock_action = String(_.get(stat_data, '..', ''));\n  const lock_until = asNumber(_.get(stat_data, '..', 0), 0);\n\n  if (lock_action && lock_action === action_tag && current_round <= lock_until) {\n    return {\n      attr,\n      action_tag,\n      current_round,\n      raw: 1,\n      bonus: 0,\n      difficulty_penalty: 0,\n      difficulty_label: '',\n      total: 0,\n      result: '',\n      desc: `${action_tag}  ${lock_until} `,\n      lock_to_round: lock_until,\n      hp_loss: 0,\n      mp_loss: 0,\n    };\n  }\n\n  const bonus = asNumber(_.get(stat_data, `..${attr}`, 0), 0);\n  const difficulty = inferDifficulty(content, attr);\n  const raw = _.clamp(raw_override ?? rollD10(), 1, 10);\n  const total = Math.max(0, raw + bonus - difficulty.penalty);\n\n  let result: '' | '' | '' | '' = '';\n  let desc = '';\n  if (raw === 10) {\n    result = '';\n    desc = '=10';\n  } else if (raw === 1) {\n    result = '';\n    desc = '=1';\n  } else if (total > 5) {\n    result = '';\n    desc = ` ${total - 5}`;\n  } else {\n    result = '';\n    desc = ` ${5 - total}`;\n  }\n\n  let lock_to_round = 0;\n  let hp_loss = 0;\n  let mp_loss = 0;\n  if (result === '' || result === '') {\n    const consequence = inferConsequenceLevel(content);\n    const lock_rounds =\n      consequence === 2 ? (result === '' ? 4 : 2)\n        : consequence === 1 ? (result === '' ? 3 : 1)\n          : (result === '' ? 2 : 1);\n    lock_to_round = current_round + lock_rounds;\n    hp_loss =\n      consequence === 2 ? (result === '' ? 12 : 4)\n        : consequence === 1 ? (result === '' ? 8 : 2)\n          : (result === '' ? 4 : 0);\n    mp_loss =\n      consequence === 2 ? (result === '' ? 15 : 6)\n        : consequence === 1 ? (result === '' ? 10 : 3)\n          : (result === '' ? 5 : 1);\n    desc += ` -${hp_loss}-${mp_loss} ${lock_to_round} `;\n  }\n\n  return {\n    attr,\n    action_tag,\n    current_round,\n    raw,\n    bonus,\n    difficulty_penalty: difficulty.penalty,\n    difficulty_label: difficulty.label,\n    total,\n    result,\n    desc,\n    lock_to_round,\n    hp_loss,\n    mp_loss,\n  };\n}\n\nfunction applyResolvedSkillOutcome(stat_data: any, content: string, outcome: SkillOutcome): void {\n  if (outcome.result === '' || outcome.result === '') {\n    const lock_rounds = outcome.result === '' ? 4 : 2;\n    _.set(stat_data, '..', outcome.action_tag);\n    _.set(stat_data, '..', outcome.lock_to_round);\n    _.set(\n      stat_data,\n      `..${outcome.action_tag}`,\n      {\n        : outcome.result === '' ? '' : '',\n        : outcome.result === '' ? '' : '',\n        : lock_rounds,\n      },\n    );\n    _.set(stat_data, '..', Math.max(0, asNumber(_.get(stat_data, '..', 0), 0) - outcome.hp_loss));\n    _.set(stat_data, '..', Math.max(0, asNumber(_.get(stat_data, '..', 0), 0) - outcome.mp_loss));\n  } else {\n    _.set(stat_data, '..', '');\n    _.set(stat_data, '..', 0);\n  }\n\n  _.set(stat_data, '.', {\n    : content.slice(0, 80),\n    : outcome.attr,\n    : outcome.raw,\n    : outcome.bonus,\n    : outcome.difficulty_penalty,\n    : outcome.difficulty_label,\n    : outcome.total,\n    : outcome.result,\n    : outcome.desc,\n    : outcome.result === '' || outcome.result === '' ? outcome.action_tag : '',\n    : outcome.lock_to_round,\n    : Date.now(),\n  });\n\n  _.set(\n    stat_data,\n    `.-${Date.now()}`,\n    `${outcome.action_tag} | ${outcome.attr} | ${outcome.raw}+${outcome.bonus}-${outcome.difficulty_penalty}=${outcome.total} | ${outcome.difficulty_label} | ${outcome.result} | ${outcome.desc}`,\n  );\n  trimBattleLogs(stat_data, 3);\n  _.set(\n    stat_data,\n    '..',\n    `${outcome.action_tag}(${outcome.attr})=${outcome.result}${outcome.total}${outcome.raw}${outcome.difficulty_penalty}`,\n  );\n}\n\nfunction applySkillCheckSystem(stat_data: any, content: string): SkillOutcome | undefined {\n  if (hasRiskButNoAvoidIntent(content)) {\n    const tip = '/';\n    _.set(stat_data, '..', tip);\n    _.set(stat_data, `.-${Date.now()}`, tip);\n    trimBattleLogs(stat_data, 3);\n    return undefined;\n  }\n  const outcome = resolveSkillOutcome(stat_data, content);\n  if (!outcome) return undefined;\n  applyResolvedSkillOutcome(stat_data, content, outcome);\n  return outcome;\n}\n\nfunction ensureCoreResourceBaseline(stat_data: any): void {\n  if (!stat_data || typeof stat_data !== 'object') return;\n\n  const build_started = Boolean(_.get(stat_data, '..', false));\n\n  let max_hp = asNumber(_.get(stat_data, '..', 100), 100);\n  if (max_hp < 1) max_hp = 100;\n  let hp = asNumber(_.get(stat_data, '..', max_hp), max_hp);\n  if (!build_started && hp <= 0) hp = max_hp;\n  hp = _.clamp(hp, 0, max_hp);\n  _.set(stat_data, '..', max_hp);\n  _.set(stat_data, '..', hp);\n\n  let max_mp = asNumber(_.get(stat_data, '..', 100), 100);\n  if (max_mp < 1) max_mp = 100;\n  let mp = asNumber(_.get(stat_data, '..', max_mp), max_mp);\n  if (!build_started && mp <= 0) mp = max_mp;\n  mp = _.clamp(mp, 0, max_mp);\n  _.set(stat_data, '..', max_mp);\n  _.set(stat_data, '..', mp);\n\n  _.set(stat_data, '..', _.clamp(asNumber(_.get(stat_data, '..', 0), 0), 0, 100));\n  _.set(stat_data, '..', _.clamp(asNumber(_.get(stat_data, '..', 1), 1), 0, 9));\n  _.set(stat_data, '..', _.clamp(asNumber(_.get(stat_data, '..', 1), 1), 0, 9));\n\n  const slot_cap = Math.max(1, asNumber(_.get(stat_data, '..', 10), 10));\n  const slot_now = _.clamp(asNumber(_.get(stat_data, '..', slot_cap), slot_cap), 0, slot_cap);\n  _.set(stat_data, '..', slot_cap);\n  _.set(stat_data, '..', slot_now);\n\n  if (!build_started) {\n    _.set(stat_data, '..', false);\n    _.set(stat_data, '..', '');\n    _.set(stat_data, '..', 0);\n  }\n}\n\nfunction enforceGameOver(stat_data: any, reason: string): boolean {\n  const build_started = Boolean(_.get(stat_data, '..', false));\n  if (!build_started) return false;\n\n  const hp = asNumber(_.get(stat_data, '..', 0), 0);\n  if (hp > 0) return false;\n\n  _.set(stat_data, '..', 0);\n  _.set(stat_data, '..', false);\n  _.set(stat_data, '..', false);\n  _.set(stat_data, '..', false);\n  _.set(stat_data, '..', '');\n  _.set(stat_data, '..', true);\n  _.set(stat_data, '..', reason);\n  _.set(stat_data, '..', Date.now());\n  _.set(stat_data, `.-${Date.now()}`, reason);\n  trimBattleLogs(stat_data, 3);\n  _.set(stat_data, '..', '');\n  return true;\n}\n\nfunction normalizeGameOverState(stat_data: any): void {\n  if (!Boolean(_.get(stat_data, '..', false))) {\n    _.set(stat_data, '..', false);\n    _.set(stat_data, '..', '');\n    _.set(stat_data, '..', 0);\n    return;\n  }\n  const hp = asNumber(_.get(stat_data, '..', 0), 0);\n  if (hp <= 0) return;\n  if (!Boolean(_.get(stat_data, '..', false))) return;\n  _.set(stat_data, '..', false);\n  _.set(stat_data, '..', '');\n  _.set(stat_data, '..', 0);\n}\n\nconst battle_time_pattern = /||||||||||/i;\nconst dialogue_time_pattern = /|||||||||/i;\nconst jump_time_pattern = /(?:|||)\\s*([^\\n,;]+)/i;\n\nfunction formatUnionDateTime(date: Date): string {\n  const union_year = Math.max(1, date.getFullYear() - 2000);\n  const month = date.getMonth() + 1;\n  const day = date.getDate();\n  const hour = `${date.getHours()}`.padStart(2, '0');\n  const minute = `${date.getMinutes()}`.padStart(2, '0');\n  return `${union_year}${month}${day} ${hour}:${minute}`;\n}\n\nfunction parseWorldDateTime(value: unknown): Date {\n  const text = String(value ?? '').trim();\n  if (!text) return new Date(2177, 7, 28, 8, 0, 0, 0);\n\n  const union_match = text.match(/\\s*(\\d+)\\s*\\s*(\\d{1,2})\\s*\\s*(\\d{1,2})\\s*(?:\\s*(\\d{1,2})[:](\\d{1,2}))?/);\n  if (union_match) {\n    const year = 2000 + asNumber(union_match[1], 177);\n    const month = asNumber(union_match[2], 8);\n    const day = asNumber(union_match[3], 28);\n    const hour = asNumber(union_match[4], 8);\n    const minute = asNumber(union_match[5], 0);\n    return new Date(year, month - 1, day, hour, minute, 0, 0);\n  }\n\n  const iso_like = text.match(/(\\d{4})[-/](\\d{1,2})[-/](\\d{1,2})(?:\\s+(\\d{1,2})[:](\\d{1,2}))?/);\n  if (iso_like) {\n    const year = asNumber(iso_like[1], 2026);\n    const month = asNumber(iso_like[2], 1);\n    const day = asNumber(iso_like[3], 1);\n    const hour = asNumber(iso_like[4], 8);\n    const minute = asNumber(iso_like[5], 0);\n    return new Date(year, month - 1, day, hour, minute, 0, 0);\n  }\n\n  return new Date(2177, 7, 28, 8, 0, 0, 0);\n}\n\nfunction parseTimeJumpTarget(text: string, current: Date): Date | undefined {\n  const source = String(text ?? '').trim();\n  if (!source) return undefined;\n\n  const full_match = source.match(/(?:(?:)?\\s*(\\d+)\\s*)?\\s*(\\d{1,2})\\s*\\s*(\\d{1,2})\\s*(?:\\s*(\\d{1,2})[:](\\d{1,2})?)?/);\n  if (full_match) {\n    const year = full_match[1] ? 2000 + asNumber(full_match[1], current.getFullYear() - 2000) : current.getFullYear();\n    const month = asNumber(full_match[2], current.getMonth() + 1);\n    const day = asNumber(full_match[3], current.getDate());\n    const hour = full_match[4] ? asNumber(full_match[4], 8) : current.getHours();\n    const minute = full_match[5] ? asNumber(full_match[5], 0) : current.getMinutes();\n    return new Date(year, month - 1, day, hour, minute, 0, 0);\n  }\n\n  const day_only_match = source.match(/(\\d{1,2})\\s*\\s*(\\d{1,2})\\s*/);\n  if (day_only_match) {\n    const month = asNumber(day_only_match[1], current.getMonth() + 1);\n    const day = asNumber(day_only_match[2], current.getDate());\n    const hm = source.match(/(\\d{1,2})[:](\\d{1,2})/);\n    const hour = hm ? asNumber(hm[1], 8) : current.getHours();\n    const minute = hm ? asNumber(hm[2], 0) : current.getMinutes();\n    return new Date(current.getFullYear(), month - 1, day, hour, minute, 0, 0);\n  }\n\n  const hm_only = source.match(/(\\d{1,2})[:](\\d{1,2})/);\n  if (hm_only) {\n    const hour = asNumber(hm_only[1], current.getHours());\n    const minute = asNumber(hm_only[2], current.getMinutes());\n    return new Date(current.getFullYear(), current.getMonth(), current.getDate(), hour, minute, 0, 0);\n  }\n\n  return undefined;\n}\n\nfunction advanceWorldTimeByAction(stat_data: any, content: string): void {\n  if (!stat_data || typeof stat_data !== 'object') return;\n  const prev_text = String(_.get(stat_data, '.', '')).trim();\n  const prev_date = parseWorldDateTime(prev_text);\n\n  const jump_match = content.match(jump_time_pattern);\n  if (jump_match?.[1]) {\n    const jump_target = parseTimeJumpTarget(jump_match[1], prev_date);\n    if (jump_target) {\n      const next_text = formatUnionDateTime(jump_target);\n      _.set(stat_data, '.', next_text);\n      _.set(stat_data, '..', `${prev_text || formatUnionDateTime(prev_date)} -> ${next_text}`);\n      return;\n    }\n  }\n\n  const delta_minutes = battle_time_pattern.test(content)\n    ? _.random(240, 360)\n    : dialogue_time_pattern.test(content)\n      ? 5\n      : 20;\n\n  const next_date = new Date(prev_date.getTime() + delta_minutes * 60 * 1000);\n  const next_text = formatUnionDateTime(next_date);\n  const reason = battle_time_pattern.test(content)\n    ? `${delta_minutes}`\n    : dialogue_time_pattern.test(content)\n      ? '5'\n      : '20';\n  _.set(stat_data, '.', next_text);\n  _.set(stat_data, '..', `${prev_text || formatUnionDateTime(prev_date)} -> ${next_text}${reason}`);\n}\n\nconst player_background_trigger_pattern = /(||||||||)/;\nconst player_background_strip_pattern = /|||||||||/;\nconst training_keyword_pattern = /|||||||||/;\n\nfunction summarizePlayerBackground(raw: string): string {\n  const text = String(raw ?? '')\n    .replace(/\\r/g, '')\n    .replace(/[ \\t]+/g, ' ')\n    .trim();\n  if (!text) return '';\n\n  const lines = text\n    .split('\\n')\n    .map(v => v.trim())\n    .filter(Boolean)\n    .filter(v => !player_background_strip_pattern.test(v));\n\n  const merged = lines.join(' ');\n  if (!merged) return '';\n  return merged.length > 180 ? `${merged.slice(0, 180)}...` : merged;\n}\n\nfunction applyPlayerBackgroundInput(stat_data: any, content: string): boolean {\n  const source = String(content ?? '').trim();\n  if (!source) return false;\n  if (!player_background_trigger_pattern.test(source)) return false;\n  if (source.length < 24) return false;\n\n  const cleaned = source\n    .replace(/^.*?(||||||||)[:]?\\s*/i, '')\n    .trim();\n  const raw = cleaned || source;\n  const summary = summarizePlayerBackground(raw);\n  if (!summary) return false;\n\n  _.set(stat_data, '..', raw);\n  _.set(stat_data, '..', summary);\n  _.set(stat_data, '..', `${summary}`);\n  return true;\n}\n\nfunction detectTrainingStateFromBackground(stat_data: any): '' | '' {\n  const raw = String(_.get(stat_data, '..', ''));\n  const summary = String(_.get(stat_data, '..', ''));\n  return training_keyword_pattern.test(`${raw}\\n${summary}`) ? '' : '';\n}\n\nfunction ensureStoryGuideState(stat_data: any): void {\n  if (!_.isObjectLike(_.get(stat_data, ''))) _.set(stat_data, '', {});\n  if (!_.isObjectLike(_.get(stat_data, '.'))) _.set(stat_data, '.', {});\n  if (!_.isObjectLike(_.get(stat_data, '.'))) {\n    _.set(stat_data, '.', {\n      : false,\n      : '',\n      : '',\n      : 0,\n      : 0,\n      : false,\n      : false,\n      : false,\n      : '',\n    });\n  } else {\n    _.defaultsDeep(_.get(stat_data, '.'), {\n      : false,\n      : '',\n      : '',\n      : 0,\n      : 0,\n      : false,\n      : false,\n      : false,\n      : '',\n    });\n  }\n\n  const mode_by_card = Boolean(_.get(stat_data, '..', false));\n  _.set(stat_data, '..', mode_by_card || Boolean(_.get(stat_data, '..', false)));\n  _.set(stat_data, '..', detectTrainingStateFromBackground(stat_data));\n}\n\nconst admission_keyword_pattern = /|||||||/;\nconst course_keyword_pattern = /||||||||/;\nconst hilton_keyword_pattern = /||||||/;\n\nfunction progressStoryGuideByContent(stat_data: any, content: string): void {\n  ensureStoryGuideState(stat_data);\n  const guide = _.get(stat_data, '.');\n  if (!guide || !guide.) return;\n\n  const text = String(content ?? '');\n  if (!text.trim()) return;\n  const stage = String(guide. || '');\n\n  if (stage === '') {\n    if (!admission_keyword_pattern.test(text)) return;\n    guide. = _.clamp(asNumber(guide., 0) + 1, 0, 4);\n    guide. = ` ${guide.}/4`;\n    _.set(stat_data, '..', `1/3 ${guide.}/4`);\n    if (guide. >= 4) {\n      guide. = true;\n      guide. = '';\n      guide. = '';\n      _.set(stat_data, '..', '2/3 0/7');\n      _.set(stat_data, '..', '');\n    }\n    return;\n  }\n\n  if (stage === '') {\n    if (!course_keyword_pattern.test(text)) return;\n    guide. = _.clamp(asNumber(guide., 0) + 1, 0, 7);\n    guide. = ` ${guide.}/7`;\n    _.set(stat_data, '..', `2/3 ${guide.}/7`);\n    if (guide. >= 7) {\n      guide. = true;\n      guide. = '';\n      guide. = '';\n      _.set(stat_data, '..', '3/3 ');\n      _.set(stat_data, '..', '');\n    }\n    return;\n  }\n\n  if (stage === '') {\n    if (!hilton_keyword_pattern.test(text)) return;\n    guide. = true;\n    guide. = '';\n    guide. = '';\n    _.set(stat_data, '..', '');\n  }\n}\n\nfunction buildOutcomePrompt(outcome: SkillOutcome, game_over: boolean): string {\n  const lines = [\n    '[-]',\n    `: ${outcome.action_tag}`,\n    `: ${outcome.attr}`,\n    `: D10(${outcome.raw}) + (${outcome.bonus}) - (${outcome.difficulty_penalty}) = ${outcome.total}`,\n    `: ${outcome.difficulty_label}`,\n    `: ${outcome.result}`,\n    `: ${outcome.desc}`,\n    ': ',\n  ];\n  if (game_over) {\n    lines.push(': /');\n  }\n  return lines.join('\\n');\n}\n\nfunction toShortText(value: unknown, fallback = '-'): string {\n  const text = String(value ?? '').trim();\n  return text || fallback;\n}\n\nfunction toInt(value: unknown, fallback = 0): number {\n  return Math.trunc(asNumber(value, fallback));\n}\n\nfunction normalizeProfession(raw: unknown, path_raw: unknown): '' | '' | '' {\n  const profession = String(raw ?? '').trim();\n  if (profession === '' || profession === '' || profession === '') return profession;\n  const path = String(path_raw ?? '').trim();\n  if (path.includes('')) return '';\n  if (path.includes('')) return '';\n  return '';\n}\n\nfunction pickNonEmpty(...values: unknown[]): string {\n  for (const v of values) {\n    const s = String(v ?? '').trim();\n    if (s) return s;\n  }\n  return '';\n}\n\nfunction isPlaceholderName(value: unknown): boolean {\n  const text = String(value ?? '').trim();\n  return !text || ['', '', '', ''].includes(text);\n}\n\nfunction pickFirstValid(values: unknown[], invalid: (value: unknown) => boolean): string {\n  for (const value of values) {\n    const text = String(value ?? '').trim();\n    if (!text) continue;\n    if (invalid(value)) continue;\n    return text;\n  }\n  return '';\n}\n\nfunction enforcePlayerIdentity(stat_data: any, ...fallback_stats: any[]): void {\n  if (!_.isObjectLike(stat_data)) return;\n  if (!_.isObjectLike(_.get(stat_data, ''))) _.set(stat_data, '', {});\n  if (!_.isObjectLike(_.get(stat_data, '.'))) _.set(stat_data, '.', {});\n  if (!_.isObjectLike(_.get(stat_data, ''))) _.set(stat_data, '', {});\n  if (!_.isObjectLike(_.get(stat_data, '.'))) _.set(stat_data, '.', {});\n\n  const fallbacks = fallback_stats.filter(v => _.isObjectLike(v));\n  const build_started = Boolean(_.get(stat_data, '..', false))\n    || fallbacks.some(fb => Boolean(_.get(fb, '..', false)));\n  _.set(stat_data, '..', build_started);\n\n  if (!build_started) {\n    // AI\n    if (isPlaceholderName(_.get(stat_data, '..'))) _.set(stat_data, '..', '');\n    if (!String(_.get(stat_data, '..', '')).trim()) _.set(stat_data, '..', '');\n    if (!String(_.get(stat_data, '..', '')).trim()) _.set(stat_data, '..', '');\n    return;\n  }\n\n  const profession = normalizeProfession(\n    pickNonEmpty(\n      _.get(stat_data, '..'),\n      ...fallbacks.map(fb => _.get(fb, '..')),\n    ),\n    pickNonEmpty(\n      _.get(stat_data, '..'),\n      ...fallbacks.map(fb => _.get(fb, '..')),\n    ),\n  );\n\n  const warmaid_type = pickNonEmpty(\n    _.get(stat_data, '..'),\n    ...fallbacks.map(fb => _.get(fb, '..')),\n    String(_.get(stat_data, '..', '')).replace(/^-/, ''),\n    ...fallbacks.map(fb => String(_.get(fb, '..', '')).replace(/^-/, '')),\n    '',\n  );\n\n  const name = pickFirstValid([\n    _.get(stat_data, '..'),\n    _.get(stat_data, '..'),\n    ...fallbacks.map(fb => _.get(fb, '..')),\n    ...fallbacks.map(fb => _.get(fb, '..')),\n  ], isPlaceholderName) || '';\n\n  const gender = profession === ''\n    ? ''\n    : pickFirstValid([\n      _.get(stat_data, '..'),\n      _.get(stat_data, '..'),\n      ...fallbacks.map(fb => _.get(fb, '..')),\n      ...fallbacks.map(fb => _.get(fb, '..')),\n    ], v => !['', ''].includes(String(v ?? '').trim())) || '';\n\n  const age_raw = asNumber(\n    pickNonEmpty(\n      _.get(stat_data, '..'),\n      ...fallbacks.map(fb => _.get(fb, '..')),\n      21,\n    ),\n    21,\n  );\n  const age = _.clamp(age_raw, 12, 80);\n\n  _.set(stat_data, '..', profession);\n  _.set(stat_data, '..', warmaid_type);\n  _.set(stat_data, '..', name);\n  _.set(stat_data, '..', gender);\n  _.set(stat_data, '..', age);\n\n  _.set(stat_data, '..', name);\n  _.set(stat_data, '..', gender);\n  _.set(stat_data, '..', profession === '' ? `-${warmaid_type}` : profession);\n}\n\nfunction pickTailEntries(source: unknown, keep = 2): Array<[string, string]> {\n  if (!_.isObjectLike(source)) return [];\n  return Object.entries(source as Record<string, unknown>)\n    .slice(-keep)\n    .map(([k, v]) => [k, toShortText(v)]);\n}\n\nfunction buildMvuSummaryPrompt(chat_data: any): string {\n  const stat = _.isObjectLike(chat_data?.stat_data) ? chat_data.stat_data : {};\n  const build_started = Boolean(_.get(stat, '..', false));\n\n  const world_time = toShortText(_.get(stat, '.', _.get(stat, '.')));\n  const world_place = toShortText(_.get(stat, '.', _.get(stat, '.')));\n  const world_weather = toShortText(_.get(stat, '.'));\n  const world_threat = toShortText(_.get(stat, '.', ''));\n\n  const name = build_started\n    ? toShortText(_.get(stat, '..', _.get(stat, '..')))\n    : '';\n  const profession = build_started ? toShortText(_.get(stat, '..')) : '';\n  const path = build_started ? toShortText(_.get(stat, '..')) : '';\n  const gender = build_started\n    ? toShortText(_.get(stat, '..', _.get(stat, '..', '')))\n    : '';\n  const age = build_started ? toInt(_.get(stat, '..', 0), 0) : 0;\n\n  const hp = toInt(_.get(stat, '..', 0), 0);\n  const hp_max = toInt(_.get(stat, '..', _.get(stat, '..', hp)), hp);\n  const mp = toInt(_.get(stat, '..', 0), 0);\n  const mp_max = toInt(_.get(stat, '..', _.get(stat, '..', mp)), mp);\n  const action_point = toInt(_.get(stat, '..', 1), 1);\n  const move_point = toInt(_.get(stat, '..', 1), 1);\n  const slot_now = toInt(_.get(stat, '..', 0), 0);\n  const slot_max = toInt(_.get(stat, '..', slot_now), slot_now);\n  const corruption = toInt(_.get(stat, '..', 0), 0);\n\n  const in_battle = Boolean(_.get(stat, '..', false));\n  const mode = toShortText(_.get(stat, '..', ''));\n  const line = toShortText(_.get(stat, '..', ''));\n  const round = toInt(_.get(stat, '..', 1), 1);\n  const air_sup = toShortText(_.get(stat, '..', ''));\n  const fire_penalty = toShortText(_.get(stat, '..', ''));\n\n  const warmaid_lv = toInt(_.get(stat, '..', 0), 0);\n  const authority_lv = toInt(_.get(stat, '..', 0), 0);\n  const magic_shard = toInt(_.get(stat, '..', 0), 0);\n  const next_magic_shard = toInt(_.get(stat, '..', 0), 0);\n  const authority_shard = toInt(_.get(stat, '..', 0), 0);\n  const has_origin = Boolean(_.get(stat, '..', false));\n\n  const skill_desc = toShortText(_.get(stat, '..', ''));\n  const skill_updated = toInt(_.get(stat, '..', 0), 0) > 0;\n  const no_skill_yet = !skill_updated || /||/.test(skill_desc);\n  const skill_result = no_skill_yet ? '' : toShortText(_.get(stat, '..', ''));\n  const skill_attr = no_skill_yet ? '' : toShortText(_.get(stat, '..', ''));\n  const skill_total = no_skill_yet ? 0 : toInt(_.get(stat, '..', 0), 0);\n  const bg_summary = toShortText(_.get(stat, '..', ''), '');\n  const plot_mode = Boolean(_.get(stat, '..', _.get(stat, '..', false)));\n  const training_state = toShortText(_.get(stat, '..', ''));\n  const guide_stage = toShortText(_.get(stat, '..', ''));\n  const admission_progress = toInt(_.get(stat, '..', 0), 0);\n  const course_progress = toInt(_.get(stat, '..', 0), 0);\n  const guide_note = toShortText(_.get(stat, '..', ''), '');\n\n  const recent_affairs = pickTailEntries(_.get(stat, '.', {}), 2);\n  const recent_logs = pickTailEntries(_.get(stat, '', {}), 2);\n\n  const lines = [\n    '[MVU-]',\n    `: =${world_time} | =${world_place} | =${world_weather} | =${world_threat}`,\n    `: =${name} | =${gender} | =${age} | =${profession} | =${path}`,\n    `: HP=${hp}/${hp_max} | MP=${mp}/${mp_max} | AP=${action_point} | Move=${move_point} | =${slot_now}/${slot_max} | =${corruption}`,\n    `: =${in_battle ? '' : ''} | =${mode} | =${line} | =${round} | =${air_sup} | =${fire_penalty}`,\n    `: =${warmaid_lv} | =${authority_lv} | =${magic_shard}(${next_magic_shard}) | =${authority_shard} | =${has_origin ? '' : ''}`,\n    `: =${skill_result} | =${skill_attr} | =${skill_total}`,\n  ];\n  if (bg_summary) {\n    lines.push(`: ${bg_summary}`);\n  }\n  if (plot_mode) {\n    lines.push(`:  | =${training_state} | =${guide_stage}`);\n    lines.push(`: =${admission_progress}/4 | =${course_progress}/7`);\n    if (guide_note) lines.push(`: ${guide_note}`);\n    lines.push(': ');\n    if (guide_stage === '') {\n      lines.push('');\n    } else if (guide_stage === '') {\n      lines.push('//');\n    } else if (guide_stage === '') {\n      lines.push('');\n    }\n  } else {\n    lines.push(': ');\n  }\n\n  if (recent_affairs.length > 0) {\n    lines.push(`: ${recent_affairs.map(([k, v]) => `${k}:${v}`).join('')}`);\n  }\n  if (recent_logs.length > 0) {\n    lines.push(`: ${recent_logs.map(([k, v]) => `${k}:${v}`).join('')}`);\n  }\n\n  lines.push(': ');\n  if (build_started) {\n    lines.push(': //');\n  } else {\n    lines.push(': /');\n  }\n  lines.push(': //');\n  lines.push(': ');\n  lines.push(':  <OnStageCharacters>JSON');\n  lines.push(': /');\n  lines.push(': ');\n  lines.push(': =');\n  lines.push(': ');\n  lines.push(': //analysis/reasoning/cot ');\n  lines.push('JSON: (string), (-200~1000), (string), (string), (object<number>)');\n  lines.push(': <NpcRelationHints>JSON</NpcRelationHints>: (string), (string[])');\n  return lines.join('\\n');\n}\n\nfunction trySendActionToChatInput(action: string): boolean {\n  const text = String(action ?? '').trim();\n  if (!text) return false;\n\n  const textarea_selectors = [\n    '#send_textarea',\n    'textarea#send_textarea',\n    'textarea[id*=\"send\"]',\n    'textarea',\n  ];\n  const send_btn_selectors = [\n    '#send_but',\n    'button#send_but',\n    '#send-button',\n    'button[type=\"submit\"]',\n  ];\n\n  let input_el: HTMLTextAreaElement | null = null;\n  for (const sel of textarea_selectors) {\n    const el = document.querySelector(sel);\n    if (el instanceof HTMLTextAreaElement) {\n      input_el = el;\n      break;\n    }\n  }\n  if (!input_el) return false;\n\n  input_el.value = text;\n  input_el.dispatchEvent(new Event('input', { bubbles: true }));\n  input_el.dispatchEvent(new Event('change', { bubbles: true }));\n\n  for (const sel of send_btn_selectors) {\n    const btn = document.querySelector(sel);\n    if (btn instanceof HTMLElement) {\n      btn.click();\n      return true;\n    }\n  }\n  return false;\n}\n\n$(() => {\n  errorCatched(async () => {\n    const global_key = '__apocalypse_dawn_variable_bridge_installed__';\n    if ((window as any)[global_key]) return;\n    (window as any)[global_key] = true;\n\n    installHideOriginalReplyStyle();\n    registerMvuSchema(Schema);\n    await waitGlobalInitialized('Mvu');\n\n    const syncing_message_ids = new Set<number>();\n    const synced_message_content = new Map<number, string>();\n      const pending_skill_by_user_message = new Map<number, PendingSkillState>();\n    const processed_user_messages = new Set<number>();\n\n    //  iframe  postMessage \n    window.addEventListener('message', evt => {\n      const payload = evt.data;\n      if (!_.isObjectLike(payload)) return;\n      if ((payload as any).type !== 'apocalypse-dawn:send_action') return;\n      if ((payload as any).source !== 'apocalypse_dawn_mvu') return;\n      const action = String((payload as any).action ?? '').trim();\n      if (!action) return;\n      const sent = trySendActionToChatInput(action);\n      if (!sent) {\n        console.warn('[][] ');\n      }\n    });\n\n    async function processUserAction(message_id: number): Promise<void> {\n      if (processed_user_messages.has(message_id)) return;\n      const user_message = getChatMessages(message_id, { include_swipes: false })[0];\n      if (!user_message || user_message.role !== 'user' || user_message.is_hidden) return;\n\n      const source_content = String(user_message.message ?? '').trim();\n      if (!source_content) return;\n\n      const assistant_before = getChatMessages(`0-${Math.max(0, message_id - 1)}`, {\n        role: 'assistant',\n        include_swipes: false,\n      });\n      const anchor_assistant = assistant_before.length > 0 ? assistant_before[assistant_before.length - 1] : undefined;\n      const source_data = anchor_assistant\n        ? Mvu.getMvuData({ type: 'message', message_id: anchor_assistant.message_id })\n        : Mvu.getMvuData({ type: 'chat' });\n      const chat_fallback_data = Mvu.getMvuData({ type: 'chat' });\n      const next_data = _.cloneDeep(source_data ?? {});\n      next_data.stat_data = _.isObjectLike(next_data?.stat_data) ? _.cloneDeep(next_data.stat_data) : {};\n      ensureAirCombatData(next_data.stat_data);\n      ensureNpcData(next_data.stat_data);\n      ensureStoryGuideState(next_data.stat_data);\n      ensureCoreResourceBaseline(next_data.stat_data);\n      resetNpcStateBeforeCreate(next_data.stat_data);\n      enforcePlayerIdentity(next_data.stat_data, _.get(chat_fallback_data, 'stat_data'));\n      normalizeGameOverState(next_data.stat_data);\n      const build_started = Boolean(_.get(next_data.stat_data, '..', false));\n      if (!build_started) {\n        processed_user_messages.add(message_id);\n        return;\n      }\n      applyPlayerBackgroundInput(next_data.stat_data, source_content);\n      ensureStoryGuideState(next_data.stat_data);\n      enforcePlayerIdentity(next_data.stat_data, _.get(chat_fallback_data, 'stat_data'));\n      progressStoryGuideByContent(next_data.stat_data, source_content);\n      advanceWorldTimeByAction(next_data.stat_data, source_content);\n      const user_npc_request_hit = applyUserNpcRequest(next_data.stat_data, source_content);\n\n      applyBattleSystemConstraints(next_data.stat_data, source_content);\n      patchGameplayState(next_data.stat_data, source_content);\n      applyDungeonLootSystem(next_data.stat_data, source_content);\n      applyBlackMarketTrade(next_data.stat_data, source_content);\n      applyVivianaArc(next_data.stat_data);\n      applyNpcPersonaConsistency(next_data.stat_data);\n      applyHumanTraining(next_data.stat_data, source_content);\n      reconcileGrowthLevel(next_data.stat_data);\n      enforcePlayerIdentity(next_data.stat_data, _.get(chat_fallback_data, 'stat_data'));\n      normalizeGameOverState(next_data.stat_data);\n      const stat_changed = !_.isEqual(\n        _.get(next_data, 'stat_data'),\n        _.get(source_data, 'stat_data', {}),\n      );\n      const battle_started = startAirBattleIfTriggered(next_data.stat_data, source_content);\n      const battle_resolved = resolveAirCombatRound(next_data.stat_data, source_content);\n      const in_air_battle = Boolean(_.get(next_data.stat_data, '..', false))\n        && _.get(next_data.stat_data, '..', '') === '';\n\n      if (battle_started || battle_resolved || in_air_battle) {\n        processed_user_messages.add(message_id);\n        trimBattleLogs(next_data.stat_data, 3);\n        await Mvu.replaceMvuData(next_data, { type: 'chat' });\n        if (anchor_assistant) {\n          await Mvu.replaceMvuData(next_data, { type: 'message', message_id: anchor_assistant.message_id });\n        }\n        console.info(`[][]  ${message_id}`);\n        return;\n      }\n\n      const outcome = applySkillCheckSystem(next_data.stat_data, source_content);\n      if (!outcome) {\n        processed_user_messages.add(message_id);\n        if (user_npc_request_hit || stat_changed) {\n          trimBattleLogs(next_data.stat_data, 3);\n          await Mvu.replaceMvuData(next_data, { type: 'chat' });\n          if (anchor_assistant) {\n            await Mvu.replaceMvuData(next_data, { type: 'message', message_id: anchor_assistant.message_id });\n          }\n        }\n        return;\n      }\n      processed_user_messages.add(message_id);\n\n      const game_over = enforceGameOver(\n        next_data.stat_data,\n        `${outcome.action_tag} / ${outcome.result}`,\n      );\n      const feedback_prompt = buildOutcomePrompt(outcome, game_over);\n      injectPrompts(\n        [{\n          id: `apocalypse-dawn-skill-feedback-pre-${message_id}-${Date.now()}`,\n          position: 'in_chat',\n          depth: 0,\n          role: 'system',\n          content: feedback_prompt,\n          should_scan: true,\n        }],\n        { once: true },\n      );\n      pending_skill_by_user_message.set(message_id, {\n        user_message_id: message_id,\n        source_content,\n        outcome,\n        feedback_prompt,\n        injected: true,\n        game_over,\n      });\n      trimBattleLogs(next_data.stat_data, 3);\n\n      await Mvu.replaceMvuData(next_data, { type: 'chat' });\n      if (anchor_assistant) {\n        await Mvu.replaceMvuData(next_data, { type: 'message', message_id: anchor_assistant.message_id });\n      }\n      console.info(`[][]  ${message_id}`);\n    }\n\n    function injectMvuSummaryForUserMessage(user_message_id: number): void {\n      const chat_data = Mvu.getMvuData({ type: 'chat' });\n      const mvu_summary_prompt = buildMvuSummaryPrompt(chat_data);\n      injectPrompts(\n        [{\n          id: `apocalypse-dawn-mvu-summary-${user_message_id}-${Date.now()}`,\n          position: 'in_chat',\n          depth: 0,\n          role: 'system',\n          content: mvu_summary_prompt,\n          should_scan: true,\n        }],\n        { once: true },\n      );\n    }\n\n    let last_summary_injected_at = 0;\n    function injectMvuSummaryForLatestContext(reason: string): void {\n      const now = Date.now();\n      if (now - last_summary_injected_at < 350) return;\n      last_summary_injected_at = now;\n      const latest_user = getChatMessages(-1, { role: 'user', include_swipes: false })[0];\n      const marker = latest_user?.message_id ?? getLastMessageId();\n      const chat_data = Mvu.getMvuData({ type: 'chat' });\n      const mvu_summary_prompt = buildMvuSummaryPrompt(chat_data);\n      injectPrompts(\n        [{\n          id: `apocalypse-dawn-mvu-summary-${reason}-${marker}-${now}`,\n          position: 'in_chat',\n          depth: 0,\n          role: 'system',\n          content: mvu_summary_prompt,\n          should_scan: true,\n        }],\n        { once: true },\n      );\n    }\n\n    async function syncMessageToMvu(message_id: number): Promise<void> {\n      if (syncing_message_ids.has(message_id)) return;\n\n      const message = getChatMessages(message_id, { include_swipes: false })[0];\n      if (!message || message.role !== 'assistant' || message.is_hidden) return;\n\n      const content = message.message?.trim() ?? '';\n      if (!content) return;\n      if (synced_message_content.get(message_id) === content) return;\n\n      syncing_message_ids.add(message_id);\n      try {\n        const old_data = Mvu.getMvuData({ type: 'message', message_id });\n        const new_data = await Mvu.parseMessage(content, old_data);\n\n        if (!new_data.stat_data || typeof new_data.stat_data !== 'object') {\n          new_data.stat_data = {};\n        }\n        // \n        if (!hasExplicitUpdateTag(content)) {\n          lockCriticalStateWithoutTag(new_data.stat_data, old_data?.stat_data);\n        }\n        ensureAirCombatData(new_data.stat_data);\n        ensureNpcData(new_data.stat_data);\n        ensureStoryGuideState(new_data.stat_data);\n        ensureCoreResourceBaseline(new_data.stat_data);\n        resetNpcStateBeforeCreate(new_data.stat_data);\n        const chat_snapshot = Mvu.getMvuData({ type: 'chat' });\n        enforcePlayerIdentity(new_data.stat_data, _.get(chat_snapshot, 'stat_data'), _.get(old_data, 'stat_data'));\n        normalizeGameOverState(new_data.stat_data);\n        if (!new_data.stat_data. || typeof new_data.stat_data. !== 'object') {\n          new_data.stat_data. = {};\n        }\n        const parsed_onstage = parseOnStageCharacters(content);\n        const old_onstage = Array.isArray(_.get(new_data.stat_data, '.')) ? _.get(new_data.stat_data, '.') : [];\n        const inferred_onstage = inferOnStageCharactersFromText(content, {\n          exclude_names: [\n            String(_.get(new_data.stat_data, '..', '')),\n            String(_.get(new_data.stat_data, '..', '')),\n          ].filter(Boolean),\n          old_onstage,\n        });\n        const relation_hints = parseNpcRelationHints(content);\n        const incoming_onstage = [...(parsed_onstage ?? []), ...inferred_onstage];\n        const name_excluded = new Set<string>([\n          String(_.get(new_data.stat_data, '..', '')),\n          String(_.get(new_data.stat_data, '..', '')),\n        ].filter(Boolean));\n\n        if (incoming_onstage.length > 0) {\n          const merged = mergeOnStageCharacters(old_onstage, incoming_onstage);\n          new_data.stat_data.. = sanitizeOnStageCharacters(merged, name_excluded);\n          _.set(\n            new_data.stat_data,\n            '..',\n            `AI${_.uniq(incoming_onstage.map(v => v.)).join('')}`,\n          );\n        } else {\n          const current = Array.isArray(_.get(new_data.stat_data, '.')) ? _.get(new_data.stat_data, '.') : [];\n          new_data.stat_data.. = sanitizeOnStageCharacters(current, name_excluded);\n        }\n        refreshOnStageThoughtsByAiText(new_data.stat_data, content);\n\n        const previous_message = getChatMessages(message_id - 1, { include_swipes: false })[0];\n        const user_context = previous_message && previous_message.role === 'user' ? String(previous_message.message ?? '') : '';\n        const trigger_context = `${user_context}\\n${content}`;\n        const pending_skill = previous_message && previous_message.role === 'user'\n          ? pending_skill_by_user_message.get(previous_message.message_id)\n          : undefined;\n\n        applyBattleSystemConstraints(new_data.stat_data, trigger_context);\n        patchGameplayState(new_data.stat_data, trigger_context);\n        applyDungeonLootSystem(new_data.stat_data, content);\n        applyBlackMarketTrade(new_data.stat_data, user_context);\n        applyHumanTraining(new_data.stat_data, trigger_context);\n        reconcileGrowthLevel(new_data.stat_data);\n        startAirBattleIfTriggered(new_data.stat_data, trigger_context);\n        if (pending_skill) {\n          applyResolvedSkillOutcome(new_data.stat_data, pending_skill.source_content, pending_skill.outcome);\n          if (pending_skill.game_over) {\n            enforceGameOver(\n              new_data.stat_data,\n              `${pending_skill.outcome.action_tag} / ${pending_skill.outcome.result}`,\n            );\n          }\n          pending_skill_by_user_message.delete(previous_message.message_id);\n        }\n        enforceGameOver(new_data.stat_data, '');\n        normalizeGameOverState(new_data.stat_data);\n        applyNpcLongTermRules(new_data.stat_data, content, user_context, incoming_onstage, relation_hints);\n        applyVivianaArc(new_data.stat_data);\n        applyNpcPersonaConsistency(new_data.stat_data);\n\n        new_data.stat_data.. = {\n          : extractDisplayText(content),\n          : content,\n          : Date.now(),\n        };\n        enforcePlayerIdentity(new_data.stat_data, _.get(chat_snapshot, 'stat_data'), _.get(old_data, 'stat_data'));\n        normalizeGameOverState(new_data.stat_data);\n        trimBattleLogs(new_data.stat_data, 3);\n\n        await Mvu.replaceMvuData(new_data, { type: 'chat' });\n        await Mvu.replaceMvuData(new_data, { type: 'message', message_id });\n        synced_message_content.set(message_id, content);\n        console.info(`[][MVU]  ${message_id}`);\n      } catch (error) {\n        console.warn(`[][MVU]  ${message_id} `, error);\n      } finally {\n        syncing_message_ids.delete(message_id);\n      }\n    }\n\n    eventOn(tavern_events.MESSAGE_RECEIVED, message_id => {\n      void syncMessageToMvu(message_id);\n    });\n\n    eventOn(tavern_events.MESSAGE_UPDATED, message_id => {\n      void syncMessageToMvu(message_id);\n    });\n\n    eventOn(tavern_events.MESSAGE_SENT, message_id => {\n      void processUserAction(message_id);\n      // MVU/ after_commands \n      injectMvuSummaryForUserMessage(message_id);\n    });\n\n    eventOn(tavern_events.GENERATION_AFTER_COMMANDS, () => {\n      const latest_user = getChatMessages(-1, { role: 'user', include_swipes: false })[0];\n      if (!latest_user || latest_user.role !== 'user') return;\n      injectMvuSummaryForUserMessage(latest_user.message_id);\n\n      const chat_data = Mvu.getMvuData({ type: 'chat' });\n\n      const pending = pending_skill_by_user_message.get(latest_user.message_id);\n      if (pending && !pending.injected) {\n        injectPrompts(\n          [{\n            id: `apocalypse-dawn-skill-feedback-${latest_user.message_id}-${Date.now()}`,\n            position: 'in_chat',\n            depth: 0,\n            role: 'system',\n            content: pending.feedback_prompt,\n            should_scan: true,\n          }],\n          { once: true },\n        );\n        pending.injected = true;\n        return;\n      }\n\n      const air_pending = Boolean(_.get(chat_data, 'stat_data...', false));\n      const air_summary = String(_.get(chat_data, 'stat_data...', '')).trim();\n      if (air_pending && air_summary) {\n        injectPrompts(\n          [{\n            id: `apocalypse-dawn-airbattle-${Date.now()}`,\n            position: 'in_chat',\n            depth: 0,\n            role: 'system',\n            content: `[-]\\n${air_summary}\\n`,\n            should_scan: true,\n          }],\n          { once: true },\n        );\n        const next_chat_data = _.cloneDeep(chat_data ?? {});\n        if (!_.isObjectLike(next_chat_data.stat_data)) next_chat_data.stat_data = {};\n        if (!_.isObjectLike(next_chat_data.stat_data.)) next_chat_data.stat_data. = {};\n        next_chat_data.stat_data.. = {\n          : false,\n          : air_summary,\n          : Date.now(),\n        };\n        void Mvu.replaceMvuData(next_chat_data, { type: 'chat' });\n      }\n      const ended = Boolean(_.get(chat_data, 'stat_data...', false));\n      const hp_now = asNumber(_.get(chat_data, 'stat_data...', 1), 1);\n      const build_started = Boolean(_.get(chat_data, 'stat_data...', false));\n      if (build_started && ended && hp_now <= 0) {\n        injectPrompts(\n          [{\n            id: `apocalypse-dawn-gameover-${Date.now()}`,\n            position: 'in_chat',\n            depth: 0,\n            role: 'system',\n            content: '/',\n            should_scan: true,\n          }],\n          { once: true },\n        );\n      }\n    });\n\n    // /\n    eventOn(tavern_events.GENERATION_STARTED, () => {\n      injectMvuSummaryForLatestContext('generation-started');\n    });\n    eventOn(tavern_events.PRESET_CHANGED, () => {\n      injectMvuSummaryForLatestContext('preset-changed');\n    });\n    eventOn(tavern_events.OAI_PRESET_CHANGED_AFTER, () => {\n      injectMvuSummaryForLatestContext('oai-preset-after');\n    });\n    eventOn(tavern_events.CHATCOMPLETION_MODEL_CHANGED, () => {\n      injectMvuSummaryForLatestContext('model-changed');\n    });\n    eventOn(tavern_events.CHATCOMPLETION_SOURCE_CHANGED, () => {\n      injectMvuSummaryForLatestContext('source-changed');\n    });\n    eventOn(tavern_events.MAIN_API_CHANGED, () => {\n      injectMvuSummaryForLatestContext('main-api-changed');\n    });\n    eventOn(tavern_events.SETTINGS_UPDATED, () => {\n      injectMvuSummaryForLatestContext('settings-updated');\n    });\n\n    eventOn(tavern_events.CHAT_CHANGED, () => {\n      syncing_message_ids.clear();\n      synced_message_content.clear();\n      pending_skill_by_user_message.clear();\n      injectMvuSummaryForLatestContext('chat-changed');\n\n      const latest = getChatMessages(-1, { include_swipes: false })[0];\n      if (latest && latest.role === 'assistant') {\n        void syncMessageToMvu(latest.message_id);\n      }\n    });\n\n    const latest = getChatMessages(-1, { include_swipes: false })[0];\n    if (latest && latest.role === 'assistant') {\n      void syncMessageToMvu(latest.message_id);\n    }\n\n    // /assistant\n    const fallback_poll_timer = window.setInterval(() => {\n      const latest_message = getChatMessages(-1, { include_swipes: false })[0];\n      if (!latest_message || latest_message.role !== 'assistant' || latest_message.is_hidden) return;\n      void syncMessageToMvu(latest_message.message_id);\n    }, 1500);\n    //  MESSAGE_SENT //\n    const user_action_poll_timer = window.setInterval(() => {\n      const latest_user = getChatMessages(-1, { role: 'user', include_swipes: false })[0];\n      if (!latest_user || latest_user.role !== 'user' || latest_user.is_hidden) return;\n      if (processed_user_messages.has(latest_user.message_id)) return;\n      void processUserAction(latest_user.message_id);\n      injectMvuSummaryForUserMessage(latest_user.message_id);\n    }, 1200);\n    window.addEventListener(\n      'beforeunload',\n      () => {\n        window.clearInterval(fallback_poll_timer);\n        window.clearInterval(user_action_poll_timer);\n      },\n      { once: true },\n    );\n  })();\n});\n"],"names":["z","Schema","object","boolean","prefault","string","enum","coerce","number","transform","v","_","clamp","array","record","describe","asNumber","value","fallback","numeric","Number","isFinite","rollD6","Math","floor","random","warmaid_rank_steps","name","need","reconcileGrowthLevel","stat_data","profession","String","get","is_warmaid","includes","is_authority","level","length","shards","max","set","shard","has_origin","Boolean","trimBattleLogs","keep","logs","isObjectLike","entries","Object","fromEntries","slice","ensureAirCombatData","air","defaultsDeep","battle_activate_pattern","battle_action_pattern","battle_end_pattern","battle_hostile_pattern","explicit_battle_open_pattern","isBattleTriggerContent","content","text","trim","test","startAirBattleIfTriggered","threat","enemy_hp","source","ambush","Date","now","resolveAirCombatRound","self_hp","weather_mod","trunc","sup_mod","weapon_lv","weapons","first","values","getWeaponLevel","heavy_condition","need_assist","has_assist","self_near_miss_stack","enemy_near_miss_stack","enemy_dodge","self_dodge","full_auto","calcSingleShot","hit_bonus","dodge_value","base_damage_mult","diff","base_damage","damage","rollD10","note","near_miss","invalid","dealt","self_hit_note","hit_bonus_base","first_shot","shot_index","expected_next_bonus","shot","enemy_hit","enemy_diff","taken","round_summary","summary","end_reason","map","k","join","buildAirBattleSummary","extractDisplayText","replace","content_match","match","input","leakageLinePattern","pseudoToolLinePattern","safeLines","split","filter","line","stripReasoningLeak","npc_name_stop_words","Set","npc_name_bad_prefix","npc_name_bad_contains","isLikelyNpcName","excluded","has","sanitizeOnStageCharacters","list","extractNameContext","hit","find","inferAttitudeByContext","context","t","inferOnStageCharactersFromText","options","exclude_names","old_map","Map","old_onstage","score","pushScore","raw_name","delta","m","matchAll","keys","result","s","old","push","clampAffection","cloneDeep","ensureNpcData","Array","isArray","defaults","resetNpcStateBeforeCreate","calcAffectionStage","is_partner","detectMentionedNames","names","mentions","add","getTracker","key","upsertLongTermNpc","payload","existing","base","next_affection","current_affection","merged_affection","min","next","promoteToLongTermByName","reason","onstage","npc","uniq","npc_follow_pattern","npc_partner_ai_pattern","npc_partner_user_confirm_pattern","npc_sex_pattern","applyVivianaArc","current_place","in_library","long_map","remove","attitude","thought","idx","findIndex","buildPersonaInnerThought","clean_fallback","raw","sanitizeThoughtText","applyNpcPersonaConsistency","all_names","long_key","long_npc","tags","persona","dungeon_enter_pattern","dungeon_leave_pattern","dungeon_move_pattern","dungeon_search_pattern","dungeon_blow_pattern","lab_room_pool","tier_value_range","tier_affix_count","affix_pool","trade_only_items","black_market_trade_pattern","black_market_buy_pattern","rollRoomTypeByLuck","luck","shift","good_weight","normal_weight","risky_weight","total","r","buildRoomContainer","room_type","pickLootQuality","is_advanced","roll","addWarehouseItem","item_name","quality","count","category","desc","tradeable","old_count","old_tags","curr","generateLootFromContainer","container_type","slot_override","slots","loot","pools","i","sample","is_trade_only","vmin","vmax","sampleSize","mergeLootRecord","target","incoming","item","applyDungeonLootSystem","parseLabLevel","scale","parseMapScale","rooms","room_name","generateDungeonMap","room","merged_loot","is_blow","undefined","normal_count","advanced_count","applyBlackMarketTrade","items","targets","qty_match","RegExp","escapeRegExp","sell_qty","own_qty","use_qty","income","left","unset","want_tier","price","money","toString","patchGameplayState","current_round","manual_toggle","battle_by_state","battle_by_text","in_battle","was_enabled","should_enable","last_round","round_delta","magic_cost","slot_cost","current_magic","current_slot","next_magic","next_slot","applyBattleSystemConstraints","mode_by_text","in_battle_by_state","in_battle_by_text","mode","warmaid_type","getWarmaidType","is_commander","ap","mp","penalty","agi","move_counter","weather_hit","superiority","airflow_penalty","applyHumanTraining","keyword_map","forEach","attr","current_attr","current_train","next_train","low_impact_no_check_pattern","high_consequence_pattern","contested_action_pattern","explicit_check_pattern","avoid_risk_intent_pattern","resolveSkillOutcome","raw_override","inferred_attr","pattern","inferSkillAttr","should_check","avoid_intent","shouldRequireSkillCheck","action_tag","tag","inferActionTag","lock_action","lock_until","bonus","difficulty_penalty","difficulty_label","lock_to_round","hp_loss","mp_loss","difficulty","hard","label","inferDifficulty","consequence","inferConsequenceLevel","applyResolvedSkillOutcome","outcome","lock_rounds","applySkillCheckSystem","hasRiskButNoAvoidIntent","tip","ensureCoreResourceBaseline","build_started","max_hp","hp","max_mp","slot_cap","slot_now","enforceGameOver","normalizeGameOverState","battle_time_pattern","dialogue_time_pattern","jump_time_pattern","formatUnionDateTime","date","getFullYear","getMonth","getDate","getHours","padStart","getMinutes","advanceWorldTimeByAction","prev_text","prev_date","union_match","year","month","day","hour","minute","iso_like","parseWorldDateTime","jump_match","jump_target","current","full_match","day_only_match","hm","hm_only","parseTimeJumpTarget","next_text","delta_minutes","getTime","player_background_trigger_pattern","player_background_strip_pattern","training_keyword_pattern","applyPlayerBackgroundInput","merged","summarizePlayerBackground","ensureStoryGuideState","mode_by_card","detectTrainingStateFromBackground","admission_keyword_pattern","course_keyword_pattern","hilton_keyword_pattern","toShortText","toInt","pickNonEmpty","isPlaceholderName","pickFirstValid","enforcePlayerIdentity","fallback_stats","fallbacks","some","fb","path_raw","path","normalizeProfession","gender","age_raw","age","pickTailEntries","buildMvuSummaryPrompt","chat_data","stat","world_time","world_place","world_weather","world_threat","hp_max","mp_max","action_point","move_point","slot_max","corruption","round","air_sup","fire_penalty","warmaid_lv","authority_lv","magic_shard","next_magic_shard","authority_shard","skill_desc","no_skill_yet","skill_result","skill_attr","skill_total","bg_summary","plot_mode","training_state","guide_stage","admission_progress","course_progress","guide_note","recent_affairs","recent_logs","lines","$","errorCatched","async","global_key","window","host_document","parent","document","style_id","getElementById","style","createElement","id","textContent","head","appendChild","installHideOriginalReplyStyle","waitGlobalInitialized","syncing_message_ids","synced_message_content","pending_skill_by_user_message","processed_user_messages","processUserAction","message_id","user_message","getChatMessages","include_swipes","role","is_hidden","source_content","message","assistant_before","anchor_assistant","source_data","Mvu","getMvuData","type","chat_fallback_data","next_data","guide","stage","progressStoryGuideByContent","user_npc_request_hit","user_content","mentioned","tracker","applyUserNpcRequest","stat_changed","isEqual","battle_started","battle_resolved","in_air_battle","replaceMvuData","console","info","game_over","feedback_prompt","buildOutcomePrompt","injectPrompts","position","depth","should_scan","once","user_message_id","injected","injectMvuSummaryForUserMessage","mvu_summary_prompt","addEventListener","evt","data","action","sent","textarea_selectors","send_btn_selectors","input_el","sel","el","querySelector","HTMLTextAreaElement","dispatchEvent","Event","bubbles","btn","HTMLElement","click","trySendActionToChatInput","warn","last_summary_injected_at","injectMvuSummaryForLatestContext","latest_user","marker","getLastMessageId","syncMessageToMvu","old_data","new_data","parseMessage","hasExplicitUpdateTag","new_stat","old_stat","critical_paths","p","old_val","lockCriticalStateWithoutTag","chat_snapshot","parsed_onstage","parsed","JSON","parse","attrs","normalized_attrs","parseOnStageCharacters","inferred_onstage","relation_hints","parseNpcRelationHints","incoming_onstage","name_excluded","old_list","merged_map","prev","requested","mergeOnStageCharacters","ai_content","char","refreshOnStageThoughtsByAiText","previous_message","user_context","trigger_context","pending_skill","delete","hints","onstage_list","name_pool","structured_names","text_mentions","appeared","hint","ai_has_partner_signal","user_confirm","current_tags","applyNpcLongTermRules","error","eventOn","tavern_events","MESSAGE_RECEIVED","MESSAGE_UPDATED","MESSAGE_SENT","GENERATION_AFTER_COMMANDS","pending","air_pending","air_summary","next_chat_data","ended","hp_now","GENERATION_STARTED","PRESET_CHANGED","OAI_PRESET_CHANGED_AFTER","CHATCOMPLETION_MODEL_CHANGED","CHATCOMPLETION_SOURCE_CHANGED","MAIN_API_CHANGED","SETTINGS_UPDATED","CHAT_CHANGED","clear","latest","fallback_poll_timer","setInterval","latest_message","user_action_poll_timer","clearInterval"],"sourceRoot":""}