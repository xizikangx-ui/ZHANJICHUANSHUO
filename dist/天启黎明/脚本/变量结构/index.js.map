{"version":3,"file":"index.js","mappings":"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","sources":["src://tavern_helper_template/external var \"z\"","src://tavern_helper_template/src//schema.ts","src://tavern_helper_template/src////index.ts"],"sourcesContent":["const __WEBPACK_NAMESPACE_OBJECT__ = z;","export const Schema = z\n    .object({\n    : z\n        .object({\n        : z\n            .object({\n            : z.boolean().prefault(false),\n            : z.string().prefault(''),\n            : z.enum(['', '', '']).prefault(''),\n            : z\n                .enum(['', '', '', '', '', ''])\n                .prefault(''),\n            : z.coerce.number().transform(v => _.clamp(v, 12, 80)).prefault(21),\n            : z.enum(['', '']).prefault(''),\n            : z.boolean().prefault(false),\n            : z.boolean().prefault(false),\n        })\n            .prefault({}),\n        : z\n            .object({\n            : z.string().prefault(''),\n            : z.string().prefault(''),\n            : z.coerce.number().prefault(0),\n        })\n            .prefault({}),\n        : z\n            .array(z\n            .object({\n            : z.string().prefault(''),\n            : z.coerce.number().transform(v => _.clamp(v, -200, 1000)).prefault(0),\n            : z.string().prefault(''),\n            : z.string().prefault(''),\n            : z.string().prefault(''),\n            : z.record(z.string().describe(''), z.coerce.number().prefault(0)).prefault({}),\n            : z.coerce.number().prefault(0),\n        })\n            .prefault({}))\n            .prefault([]),\n        : z\n            .object({\n            : z.boolean().prefault(false),\n            NPC: z.boolean().prefault(false),\n        })\n            .prefault({}),\n        : z\n            .object({\n            : z.boolean().prefault(false),\n            : z.string().prefault(''),\n            : z.coerce.number().prefault(0),\n        })\n            .prefault({}),\n        : z\n            .object({\n            : z.boolean().prefault(false),\n            : z.string().prefault(''),\n            : z.coerce.number().prefault(0),\n        })\n            .prefault({}),\n    })\n        .prefault({}),\n    : z\n        .object({\n        : z.string().prefault('177828 08:00'),\n        : z.string().prefault(' '),\n        : z.string().prefault(''),\n        : z.enum(['', '', '', '']).prefault(''),\n        : z.record(z.string().describe(''), z.string().describe('')).prefault({}),\n        : z\n            .object({\n            : z.boolean().prefault(false),\n            : z.enum(['', '']).prefault(''),\n            : z.enum(['', '', '', '']).prefault(''),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 4)).prefault(0),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 7)).prefault(0),\n            : z.boolean().prefault(false),\n            : z.boolean().prefault(false),\n            : z.boolean().prefault(false),\n            : z.string().prefault(''),\n        })\n            .prefault({}),\n        NPC: z.record(z.string().describe('NPC'), z.object({\n            : z.string().prefault(''),\n            : z.coerce.number().transform(v => _.clamp(v, -200, 1000)).prefault(0),\n            : z.string().prefault(''),\n            : z.enum(['', '', '', '', '', '', '', '']).prefault(''),\n            : z.string().prefault(''),\n            : z.string().prefault(''),\n            : z.record(z.string().describe(''), z.coerce.number().prefault(0)).prefault({}),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 99999)).prefault(0),\n            : z.enum(['', '']).prefault(''),\n            : z.array(z.string()).prefault([]),\n            : z.coerce.number().prefault(0),\n            : z.coerce.number().prefault(0),\n        }).prefault({})).prefault({}),\n        NPC: z.record(z.string().describe('NPC'), z.object({\n            : z.coerce.number().transform(v => _.clamp(v, 0, 9999)).prefault(0),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999999)).prefault(0),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 9999)).prefault(0),\n            : z.coerce.number().prefault(0),\n            : z.boolean().prefault(false),\n        }).prefault({})).prefault({}),\n    })\n        .prefault({}),\n    : z\n        .object({\n        : z\n            .object({\n            : z.string().prefault(''),\n            : z.string().prefault(''),\n            : z.string().prefault(''),\n            : z.string().prefault(''),\n        })\n            .prefault({}),\n        : z\n            .object({\n            : z.coerce.number().transform(v => _.clamp(v, 0, 5)).prefault(1),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 5)).prefault(1),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 5)).prefault(1),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 5)).prefault(1),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 5)).prefault(1),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 5)).prefault(1),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 5)).prefault(1),\n        })\n            .prefault({}),\n        : z\n            .object({\n            : z.coerce.number().transform(v => _.clamp(v, 0, 100)).prefault(0),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 100)).prefault(0),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 100)).prefault(0),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 100)).prefault(0),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 100)).prefault(0),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 100)).prefault(0),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 100)).prefault(0),\n        })\n            .prefault({}),\n        : z\n            .object({\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(20),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(18),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(18),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(18),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(20),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(12),\n        })\n            .prefault({}),\n        : z\n            .object({\n            : z.coerce.number().transform(v => _.clamp(v, 1, 20)).prefault(1),\n            : z.coerce.number().transform(v => _.clamp(v, 1, 20)).prefault(1),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999999)).prefault(0),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999999)).prefault(10),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999999)).prefault(0),\n            : z.boolean().prefault(false),\n        })\n            .prefault({}),\n        : z\n            .object({\n            : z.boolean().prefault(false),\n            : z.boolean().prefault(false),\n            : z.enum(['', '', '']).prefault(''),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(8),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 9)).prefault(1),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 9999)).prefault(0),\n        })\n            .prefault({}),\n        : z\n            .object({\n            : z.coerce.number().transform(v => _.clamp(v, 0, 9999)).prefault(100),\n            : z.coerce.number().transform(v => _.clamp(v, 1, 9999)).prefault(100),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 9999)).prefault(100),\n            : z.coerce.number().transform(v => _.clamp(v, 1, 9999)).prefault(100),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 100)).prefault(0),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 9)).prefault(1),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 9)).prefault(1),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 99)).prefault(10),\n            : z.coerce.number().transform(v => _.clamp(v, 1, 99)).prefault(10),\n        })\n            .prefault({}),\n        : z\n            .object({\n            : z.array(z.string()).prefault([]),\n        })\n            .prefault({}),\n        : z\n            .object({\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(4),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(0),\n            : z.record(z.string().describe('ID'), z.boolean()).prefault({}),\n            : z.string().prefault(''),\n        })\n            .prefault({}),\n        : z\n            .object({\n            : z.string().prefault(''),\n            : z.enum(['', '', '', '', '', '', '', '', '']).prefault(''),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 99999)).prefault(0),\n            : z.string().prefault(''),\n            : z.boolean().prefault(false),\n            : z.string().prefault(''),\n        })\n            .prefault({}),\n        : z\n            .object({\n            : z.string().prefault(''),\n            : z.string().prefault(''),\n        })\n            .prefault({}),\n        : z\n            .object({\n            : z.enum(['', '', '']).prefault(''),\n            : z.boolean().prefault(false),\n            : z.enum(['', '', '', '']).prefault(''),\n            : z.enum(['', '', '']).prefault(''),\n            : z.coerce.number().transform(v => _.clamp(v, 1, 999)).prefault(1),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(0),\n            : z.string().prefault(''),\n            : z.record(z.string().describe(''), z.array(z.string()).prefault([])).prefault({}),\n            : z\n                .object({\n                : z.boolean().prefault(false),\n                : z\n                    .enum(['', '', '', '', '', '', ''])\n                    .prefault(''),\n                : z.enum(['', '', '', '', '']).prefault(''),\n                : z.coerce.number().transform(v => _.clamp(v, 1, 100)).prefault(11),\n                : z.coerce.number().transform(v => _.clamp(v, -50, 50)).prefault(5),\n                : z.coerce.number().transform(v => _.clamp(v, -100, 100)).prefault(0),\n                : z.coerce.number().transform(v => _.clamp(v, 0.1, 3)).prefault(1),\n                : z.enum(['', '', '', '', '', '']).prefault(''),\n                : z.coerce.number().transform(v => _.clamp(v, 100, 2000)).prefault(500),\n                : z\n                    .object({\n                    : z.coerce.number().transform(v => _.clamp(v, 0, 99)).prefault(0),\n                    : z.coerce.number().transform(v => _.clamp(v, 0, 99)).prefault(0),\n                    : z.coerce.number().transform(v => _.clamp(v, 0, 99)).prefault(0),\n                    : z.coerce.number().transform(v => _.clamp(v, 0, 99)).prefault(0),\n                    : z.coerce.number().transform(v => _.clamp(v, 0, 99)).prefault(0),\n                    : z.coerce.number().transform(v => _.clamp(v, 0, 99)).prefault(0),\n                })\n                    .prefault({}),\n                : z\n                    .object({\n                    : z.coerce.number().transform(v => _.clamp(v, 0, 99)).prefault(0),\n                    : z.coerce.number().transform(v => _.clamp(v, 0, 99)).prefault(0),\n                    : z.coerce.number().transform(v => _.clamp(v, 0, 99)).prefault(0),\n                    : z.coerce.number().transform(v => _.clamp(v, 0, 99)).prefault(0),\n                    : z.coerce.number().transform(v => _.clamp(v, 0, 99)).prefault(0),\n                    : z.coerce.number().transform(v => _.clamp(v, 0, 99)).prefault(0),\n                })\n                    .prefault({}),\n                : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(0),\n                : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(0),\n                : z.coerce.number().transform(v => _.clamp(v, -1, 1)).prefault(0),\n                : z.string().prefault(''),\n                : z.boolean().prefault(false),\n                : z.string().prefault(''),\n                : z.array(z.string()).prefault([]),\n                : z.array(z.string()).prefault([]),\n                : z.enum(['', '', '', '']).prefault(''),\n                : z.enum(['', '', '', '', '']).prefault(''),\n                : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(0),\n                : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(0),\n                : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(3),\n                : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(3),\n                : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(0),\n                : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(0),\n                : z.string().prefault(''),\n                : z.coerce.number().transform(v => _.clamp(v, 0, 99999)).prefault(100),\n                : z.coerce.number().transform(v => _.clamp(v, 0, 99999)).prefault(100),\n                : z.coerce.number().transform(v => _.clamp(v, 0, 9999)).prefault(0),\n                : z.string().prefault(''),\n            })\n                .prefault({}),\n        })\n            .prefault({}),\n        : z\n            .object({\n            : z.string().prefault(''),\n            : z.record(z.string().describe(''), z\n                .object({\n                : z.coerce.number().transform(v => _.clamp(v, 0, 8)).prefault(1),\n                : z.coerce.number().transform(v => _.clamp(v, 0, 8)).prefault(2),\n                : z.string().prefault(''),\n            })\n                .prefault({})).prefault({}),\n            : z.record(z.string().describe(''), z.string()).prefault({}),\n            : z.record(z.string().describe(''), z.string().describe('')).prefault({}),\n        })\n            .prefault({}),\n        : z.record(z.string().describe(''), z\n            .object({\n            : z.enum(['', '', '']).prefault(''),\n            : z.string().prefault(''),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 99)).prefault(1),\n        })\n            .prefault({})).prefault({}),\n        : z\n            .object({\n            : z.string().prefault(''),\n            : z.enum(['', '', '', '', '', '', '', '']).prefault(''),\n            : z.coerce.number().transform(v => _.clamp(v, 1, 10)).prefault(1),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(0),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(0),\n            : z.string().prefault(''),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(0),\n            : z.enum(['', '', '', '']).prefault(''),\n            : z.string().prefault(''),\n            : z.string().prefault(''),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(0),\n            : z.coerce.number().prefault(0),\n        })\n            .prefault({}),\n    })\n        .prefault({}),\n    : z\n        .object({\n        : z.boolean().prefault(false),\n        : z.record(z.string().describe(''), z\n            .object({\n            : z.enum(['', '']).prefault(''),\n            : z.boolean().prefault(false),\n        })\n            .prefault({})).prefault({}),\n        : z.record(z.string().describe(''), z\n            .object({\n            : z.enum(['', '', '', '', '', '']).prefault(''),\n            : z.coerce.number().transform(v => _.clamp(v, 1, 999)).prefault(1),\n            : z.coerce.number().transform(v => _.clamp(v, 1, 999999999)).prefault(1),\n        })\n            .prefault({})).prefault({}),\n        : z\n            .object({\n            : z.boolean().prefault(false),\n            : z.string().prefault(''),\n            : z\n                .enum(['', '', '', ''])\n                .prefault(''),\n            : z.enum(['', '', '']).prefault(''),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(0),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(0),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(0),\n            : z.string().prefault(''),\n            : z.string().prefault(''),\n            : z\n                .array(z\n                .object({\n                : z.coerce.number().transform(v => _.clamp(v, 1, 999)).prefault(1),\n                : z.string().prefault(''),\n                : z.enum(['', '', '', '']).prefault(''),\n                : z\n                    .object({\n                    : z.coerce.number().transform(v => _.clamp(v, 0, 9)).prefault(0),\n                    : z.coerce.number().transform(v => _.clamp(v, 0, 9)).prefault(0),\n                    : z.boolean().prefault(false),\n                    : z.boolean().prefault(false),\n                })\n                    .prefault({}),\n            })\n                .prefault({}))\n                .prefault([]),\n        })\n            .prefault({}),\n        : z\n            .object({\n            : z.coerce.number().transform(v => _.clamp(v, 0, 99999999)).prefault(0),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999999)).prefault(0),\n            : z.record(z.string().describe(''), z\n                .object({\n                : z.enum(['', '', '', '', '', '']).prefault(''),\n                : z.coerce.number().transform(v => _.clamp(v, 0, 999999)).prefault(0),\n                : z.coerce.number().transform(v => _.clamp(v, 1, 999999999)).prefault(1),\n                : z.string().prefault(''),\n                : z.string().prefault(''),\n                : z.array(z.string()).prefault([]),\n                : z.boolean().prefault(true),\n            })\n                .prefault({})).prefault({}),\n            : z.array(z.string()).prefault([]),\n        })\n            .prefault({}),\n    })\n        .prefault({}),\n    : z.record(z.string().describe(''), z.string().describe('')).prefault({}),\n})\n    .prefault({});\n","import { registerMvuSchema } from 'https://testingcf.jsdelivr.net/gh/StageDog/tavern_resource/dist/util/mvu_zod.js';\nimport { Schema } from '../../schema';\n\nfunction installHideOriginalReplyStyle(): void {\n  const host_document = window.parent?.document ?? document;\n  const style_id = 'apocalypse-dawn-hide-original-reply-style';\n  if (host_document.getElementById(style_id)) return;\n\n  const style = host_document.createElement('style');\n  style.id = style_id;\n  style.textContent = `\n    .mes:has(.TH-render) .mes_text > :not(.TH-render) {\n      display: none !important;\n    }\n  `;\n  host_document.head.appendChild(style);\n}\n\nfunction asNumber(value: unknown, fallback = 0): number {\n  const numeric = Number(value);\n  return Number.isFinite(numeric) ? numeric : fallback;\n}\n\nfunction rollD6(): number {\n  return Math.floor(Math.random() * 6) + 1;\n}\n\nconst warmaid_rank_steps = [\n  { name: '', need: 10 },\n  { name: '', need: 50 },\n  { name: '', need: 100 },\n  { name: '', need: 500 },\n  { name: '', need: 1000 },\n  { name: '', need: 2000 },\n  { name: '', need: 6000 },\n] as const;\n\nfunction reconcileGrowthLevel(stat_data: any): void {\n  if (!stat_data || typeof stat_data !== 'object') return;\n\n  const profession = String(_.get(stat_data, '..', ''));\n  const is_warmaid = profession === '' || String(_.get(stat_data, '..', '')).includes('');\n  const is_authority = profession === '' || String(_.get(stat_data, '..', '')).includes('');\n\n  if (is_warmaid) {\n    let level = _.clamp(asNumber(_.get(stat_data, '..', 1), 1), 1, warmaid_rank_steps.length);\n    let shards = Math.max(0, asNumber(_.get(stat_data, '..', 0), 0));\n\n    // /\n    while (level < warmaid_rank_steps.length) {\n      const need = warmaid_rank_steps[level - 1].need;\n      if (shards < need) break;\n      shards -= need;\n      level += 1;\n    }\n\n    _.set(stat_data, '..', level);\n    _.set(stat_data, '..', shards);\n    _.set(\n      stat_data,\n      '..',\n      level < warmaid_rank_steps.length ? warmaid_rank_steps[level - 1].need : 0,\n    );\n  }\n\n  if (is_authority) {\n    const shard = Math.max(0, asNumber(_.get(stat_data, '..', 0), 0));\n    const has_origin = Boolean(_.get(stat_data, '..', false));\n\n    let level = 1; // \n    if (shard >= 50) level = 2; // \n    if (shard >= 100) level = 3; // \n    if (shard >= 1000 && has_origin) level = 4; // \n\n    _.set(stat_data, '..', level);\n  }\n}\n\nfunction trimBattleLogs(stat_data: any, keep = 3): void {\n  if (!stat_data || typeof stat_data !== 'object') return;\n  const logs = _.get(stat_data, '', {});\n  if (!_.isObjectLike(logs)) {\n    _.set(stat_data, '', {});\n    return;\n  }\n  const entries = Object.entries(logs as Record<string, string>);\n  if (entries.length <= keep) return;\n  _.set(stat_data, '', Object.fromEntries(entries.slice(-keep)));\n}\n\nfunction ensureAirCombatData(stat_data: any): void {\n  if (!stat_data || typeof stat_data !== 'object') return;\n  if (!_.isObjectLike(_.get(stat_data, '.'))) {\n    _.set(stat_data, '.', { : false, : '', : 0 });\n  }\n  if (!_.isObjectLike(_.get(stat_data, '..'))) {\n    _.set(stat_data, '..', {});\n  }\n  if (!_.isObjectLike(_.get(stat_data, '..'))) {\n    _.set(stat_data, '..', {\n      : false,\n      : '',\n      : '',\n      : 11,\n      : 5,\n      : 0,\n      : 1,\n      : '',\n      : 500,\n      : { : 0, : 0, : 0, : 0, : 0, : 0 },\n      : { : 0, : 0, : 0, : 0, : 0, : 0 },\n      : 0,\n      : 0,\n      : 0,\n      : '',\n      : false,\n      : '',\n      : [],\n      : [],\n      : '',\n      : '',\n      : 0,\n      : 0,\n      : 3,\n      : 3,\n      : 0,\n      : 0,\n      : '',\n      : 100,\n      : 100,\n      : 0,\n      : '',\n    });\n  } else {\n    const air = _.get(stat_data, '..');\n    _.defaultsDeep(air, {\n      : false,\n      : '',\n      : '',\n      : 11,\n      : 5,\n      : 0,\n      : 1,\n      : '',\n      : 500,\n      : { : 0, : 0, : 0, : 0, : 0, : 0 },\n      : { : 0, : 0, : 0, : 0, : 0, : 0 },\n      : 0,\n      : 0,\n      : 0,\n      : '',\n      : false,\n      : '',\n      : [],\n      : [],\n      : '',\n      : '',\n      : 0,\n      : 0,\n      : 3,\n      : 3,\n      : 0,\n      : 0,\n      : '',\n      : 100,\n      : 100,\n      : 0,\n      : '',\n    });\n  }\n}\n\nconst battle_activate_pattern = /|||||||/i;\nconst battle_action_pattern = /||||||||||/i;\nconst battle_end_pattern = /|||||||/i;\nconst battle_hostile_pattern = /||||||||||/i;\nconst explicit_battle_open_pattern = /|||||||/i;\n\nfunction isBattleTriggerContent(content: string): boolean {\n  const text = String(content ?? '');\n  if (!text.trim()) return false;\n  if (explicit_battle_open_pattern.test(text)) return true;\n  if (battle_activate_pattern.test(text) && battle_hostile_pattern.test(text)) return true;\n  if (/(||||||)/i.test(text) && battle_hostile_pattern.test(text)) return true;\n  return false;\n}\n\nfunction getWeaponLevel(stat_data: any): number {\n  const weapons = _.get(stat_data, '..', {});\n  if (!_.isObjectLike(weapons)) return 1;\n  const first = Object.values(weapons as Record<string, any>)[0];\n  return Math.max(1, asNumber(_.get(first, '', 1), 1));\n}\n\nfunction buildAirBattleSummary(stat_data: any, end_reason: string): string {\n  const air = _.get(stat_data, '..', {});\n  const logs = Object.entries(_.get(stat_data, '', {})).slice(-3).map(([k, v]) => `${k}:${v}`).join('');\n  return `(${end_reason})${asNumber(air., 0)}=${air.}(${asNumber(air., 0)})=${_.get(stat_data, '..', '')}=${asNumber(air., 0)}=${asNumber(air., 0)}=${logs}`;\n}\n\nfunction startAirBattleIfTriggered(stat_data: any, content: string): boolean {\n  ensureAirCombatData(stat_data);\n  if (!isBattleTriggerContent(content)) return false;\n\n  const in_battle = Boolean(_.get(stat_data, '..', false));\n  if (in_battle) return true;\n\n  _.set(stat_data, '..', '');\n  _.set(stat_data, '..', true);\n  _.set(stat_data, '...', true);\n  _.set(stat_data, '...', '');\n  _.set(stat_data, '...', 0);\n\n  const threat = String(_.get(stat_data, '.', ''));\n  const enemy_hp = threat === '' ? 180 : threat === '' ? 140 : threat === '' ? 110 : 90;\n  _.set(stat_data, '...', asNumber(_.get(stat_data, '..', 100), 100));\n  _.set(stat_data, '...', Math.max(30, asNumber(_.get(stat_data, '...', enemy_hp), enemy_hp)));\n\n  const source =\n    //i.test(content) ? ''\n      : //i.test(content) ? ''\n        : //i.test(content) ? ''\n          : '';\n  const ambush = /|/i.test(content);\n  _.set(stat_data, '...', ambush);\n  _.set(stat_data, '...', ambush ? source : '');\n  if (ambush) {\n    _.set(stat_data, '..', asNumber(_.get(stat_data, '..', 1), 1) + 1);\n  }\n\n  _.set(stat_data, `.-${Date.now()}`, `${source}`);\n  trimBattleLogs(stat_data, 3);\n  return true;\n}\n\nfunction resolveAirCombatRound(stat_data: any, content: string): boolean {\n  ensureAirCombatData(stat_data);\n  if (_.get(stat_data, '..', '') !== '') return false;\n  if (!_.get(stat_data, '..', false)) return false;\n  if (!battle_action_pattern.test(content) && !battle_end_pattern.test(content)) return false;\n\n  const air = _.get(stat_data, '..');\n  let self_hp = asNumber(_.get(air, '', _.get(stat_data, '..', 100)), 100);\n  let enemy_hp = asNumber(_.get(air, '', 100), 100);\n  const weather_mod = _.clamp(Math.trunc(asNumber(_.get(air, '', 0), 0) / 10), -2, 2);\n  const sup_mod = _.clamp(asNumber(_.get(air, '', 0), 0), -1, 1);\n  const weapon_lv = getWeaponLevel(stat_data);\n  const heavy_condition = String(_.get(air, '', ''));\n  const need_assist = /|.*/.test(heavy_condition);\n  const has_assist = asNumber(_.get(air, '.', 0), 0) > 0 || asNumber(_.get(air, '.', 0), 0) > 0;\n\n  const self_near_miss_stack = asNumber(_.get(air, '', 0), 0);\n  const enemy_near_miss_stack = asNumber(_.get(air, '', 0), 0);\n  const enemy_dodge = asNumber(_.get(air, '', 3), 3);\n  const self_dodge = asNumber(_.get(air, '', 3), 3);\n  const full_auto = /||/.test(content);\n\n  const calcSingleShot = (hit_bonus: number, dodge_value: number, base_damage_mult = 1): { diff: number; damage: number; note: string; near_miss: boolean; invalid: boolean } => {\n    const hit_roll = rollD6() + hit_bonus;\n    const diff = hit_roll - dodge_value;\n    const base_damage = Math.max(1, (rollD6() + weapon_lv) * base_damage_mult);\n    if (diff > 6) return { diff, damage: base_damage + weapon_lv * rollD10(), note: '', near_miss: false, invalid: false };\n    if (diff > 4) return { diff, damage: base_damage, note: '', near_miss: false, invalid: false };\n    if (diff > 2) return { diff, damage: Math.max(1, Math.floor(base_damage / 2)), note: '', near_miss: false, invalid: false };\n    if (diff > 1) return { diff, damage: Math.max(1, weapon_lv * _.random(1, 2)), note: '', near_miss: false, invalid: false };\n    if (diff === 1 || diff === 0) return { diff, damage: 0, note: '', near_miss: true, invalid: false };\n    return { diff, damage: 0, note: '', near_miss: false, invalid: true };\n  };\n\n  let dealt = 0;\n  let diff = 0;\n  let self_hit_note = '';\n  if (need_assist && !has_assist) {\n    self_hit_note = '/';\n  } else {\n    const hit_bonus_base = weather_mod + sup_mod + self_near_miss_stack;\n    const first_shot = calcSingleShot(hit_bonus_base, enemy_dodge);\n    diff = first_shot.diff;\n    dealt += first_shot.damage;\n    self_hit_note = first_shot.note;\n    _.set(air, '', first_shot.near_miss ? self_near_miss_stack + 10 : 0);\n\n    if (full_auto) {\n      let shot_index = 1;\n      let expected_next_bonus = hit_bonus_base - 10;\n      while (shot_index < 6 && expected_next_bonus + 6 >= enemy_dodge) {\n        const shot = calcSingleShot(expected_next_bonus, enemy_dodge);\n        dealt += shot.damage;\n        self_hit_note += ` / ${shot_index + 1}:${shot.note}`;\n        if (shot.near_miss) _.set(air, '', asNumber(_.get(air, '', 0), 0) + 10);\n        if (!shot.invalid) diff = shot.diff;\n        shot_index += 1;\n        expected_next_bonus -= 10;\n      }\n    }\n  }\n  enemy_hp = Math.max(0, enemy_hp - dealt);\n\n  const enemy_hit = calcSingleShot(Math.max(0, -sup_mod) + enemy_near_miss_stack, self_dodge);\n  const enemy_diff = enemy_hit.diff;\n  const taken = enemy_hit.damage;\n  _.set(air, '', enemy_hit.near_miss ? enemy_near_miss_stack + 10 : 0);\n  self_hp = Math.max(0, self_hp - taken);\n\n  _.set(stat_data, '..', self_hp);\n  _.set(air, '', self_hp);\n  _.set(air, '', enemy_hp);\n  _.set(air, '', asNumber(_.get(air, '', 0), 0) + 1);\n  const round_summary = `${_.get(air, '', 0)}${self_hit_note}(${diff})${dealt}${enemy_hit.note}(${enemy_diff})${taken}`;\n  _.set(air, '', round_summary);\n  _.set(air, '', round_summary);\n  _.set(stat_data, `.-${Date.now()}`, round_summary);\n  trimBattleLogs(stat_data, 3);\n\n  const end_by_text = battle_end_pattern.test(content);\n  const end_by_hp = self_hp <= 0 || enemy_hp <= 0;\n  if (!(end_by_text || end_by_hp)) return true;\n\n  _.set(stat_data, '..', false);\n  _.set(stat_data, '..', '');\n  _.set(air, '', '');\n  const reason = self_hp <= 0 ? '' : enemy_hp <= 0 ? '' : '';\n  const summary = buildAirBattleSummary(stat_data, reason);\n  _.set(stat_data, '.', {\n    : true,\n    : summary,\n    : Date.now(),\n  });\n  _.set(stat_data, '..', summary);\n  _.set(stat_data, `.-${Date.now()}`, summary);\n  trimBattleLogs(stat_data, 3);\n  return true;\n}\n\nfunction extractDisplayText(content: string): string {\n  const without_update = content\n    .replace(/<update(?:variable)?>[\\s\\S]*?<\\/update(?:variable)?>/gim, '')\n    .replace(/<update(?:variable)?>[\\s\\S]*$/gim, '');\n\n  const without_placeholder = without_update\n    .replace(/<StatusPlaceHolderImpl\\/>/gim, '')\n    .replace(/<OnStageCharacters>[\\s\\S]*?<\\/OnStageCharacters>/gim, '')\n    .replace(/<NpcRelationHints>[\\s\\S]*?<\\/NpcRelationHints>/gim, '');\n\n  let text = without_placeholder.replace(/```[\\s\\S]*?\\$\\('body'\\)\\.load\\([\\s\\S]*?```/gim, '');\n\n  const content_match = text.match(/<content>([\\s\\S]*?)<\\/content>/im);\n  if (content_match?.[1]) {\n    text = content_match[1];\n  } else {\n    text = text\n      .replace(/<(?:think|thinking|context|disclaimer|tucao|current_event|progress)[^>]*>[\\s\\S]*?<\\/(?:think|thinking|context|disclaimer|tucao|current_event|progress)>/gim, '')\n      .replace(/<(?:think|thinking|context|disclaimer|tucao|current_event|progress)[^>]*\\/>/gim, '');\n  }\n\n  text = text\n    .replace(/```[\\s\\S]*?```/gim, '')\n    .replace(/<\\|im_end\\|>/gim, '')\n    .replace(/<\\/?[^>\\n]+>/g, '')\n    .replace(/\\r/g, '')\n    .replace(/\\n{3,}/g, '\\n\\n')\n    .trim();\n\n  return text;\n}\n\ntype OnStageCharacter = {\n  : string;\n  : number;\n  : string;\n  : string;\n  : string;\n  : Record<string, number>;\n  : number;\n};\n\ntype NpcRelationHint = {\n  : string;\n  : string[];\n};\n\nconst npc_name_stop_words = new Set([\n  '', '', '', '', '', '', '', '', '', '', '',\n  '', '', '', '', '', '', '', '', '', '', '',\n  '', '', '', '', '', '', '', '', '', '', '',\n]);\nconst npc_name_bad_prefix = /^(|||||||||||)/;\nconst npc_name_bad_contains = /(||||||||||||||||||||||||||)/;\n\nfunction normalizeNpcName(raw: string): string {\n  return String(raw ?? '')\n    .trim()\n    .replace(/^[\"[(]+|[\")\\]]+$/g, '')\n    .replace(/[,.?!;:]/g, '')\n    .trim();\n}\n\nfunction isLikelyNpcName(name: string, excluded: Set<string>): boolean {\n  if (!name) return false;\n  if (excluded.has(name)) return false;\n  if (npc_name_stop_words.has(name)) return false;\n  if (npc_name_bad_contains.test(name)) return false;\n  if (npc_name_bad_prefix.test(name)) return false;\n  if (/[0-9-]/.test(name)) return false;\n  if (/(||||||)$/.test(name)) return false;\n  if (!/^[\\u4e00-\\u9fa5]{2,6}$/.test(name)) return false;\n  if (/(||||||||)$/.test(name)) return false;\n  return true;\n}\n\nfunction sanitizeOnStageCharacters(list: OnStageCharacter[], excluded: Set<string>): OnStageCharacter[] {\n  return list.filter(v => isLikelyNpcName(String(v?. ?? ''), excluded));\n}\n\nfunction extractNameContext(text: string, name: string): string {\n  const lines = String(text ?? '').split(/[\\n]/).map(v => v.trim()).filter(Boolean);\n  const hit = lines.find(v => v.includes(name));\n  if (!hit) return '';\n  return hit.slice(0, 48);\n}\n\nfunction inferAttitudeByContext(context: string): string {\n  const t = String(context ?? '');\n  if (/|||/.test(t)) return '';\n  if (/||||/.test(t)) return '';\n  if (/||||/.test(t)) return '';\n  if (/|||/.test(t)) return '';\n  return '';\n}\n\nfunction refreshOnStageThoughtsByAiText(stat_data: any, ai_content: string): void {\n  const list = Array.isArray(_.get(stat_data, '.')) ? (_.get(stat_data, '.') as OnStageCharacter[]) : [];\n  if (list.length === 0) return;\n  const text = extractDisplayText(String(ai_content ?? ''));\n  if (!text) return;\n\n  const next = list.map(char => {\n    const name = String(char?. ?? '');\n    if (!name || !text.includes(name)) return char;\n    const context = extractNameContext(text, name);\n    return {\n      ...char,\n      : inferAttitudeByContext(context) || String(char. ?? ''),\n      : context ? `${context}` : `${name}`,\n      : Date.now(),\n    };\n  });\n  _.set(stat_data, '.', next);\n}\n\nfunction inferOnStageCharactersFromText(content: string, options?: { exclude_names?: string[]; old_onstage?: OnStageCharacter[] }): OnStageCharacter[] {\n  const text = extractDisplayText(String(content ?? ''));\n  if (!text) return [];\n\n  const excluded = new Set<string>(options?.exclude_names ?? []);\n  const old_onstage = options?.old_onstage ?? [];\n  const old_map = new Map(old_onstage.map(v => [v., v]));\n  const score = new Map<string, number>();\n\n  const pushScore = (raw_name: string, delta: number) => {\n    const name = normalizeNpcName(raw_name);\n    if (!isLikelyNpcName(name, excluded)) return;\n    score.set(name, (score.get(name) ?? 0) + delta);\n  };\n\n  // ///\n  for (const m of text.matchAll(/(?:||||)([\\u4e00-\\u9fa5]{2,6})/g)) {\n    pushScore(m[1], 3);\n  }\n  // X/////\n  for (const m of text.matchAll(/([\\u4e00-\\u9fa5]{2,6})(?:||||||||||||||||||||)/g)) {\n    pushScore(m[1], 2);\n  }\n  // /\n  for (const m of text.matchAll(/([\\u4e00-\\u9fa5]{2,6})[]\\s*(?:[\"]||||||||||||)/g)) {\n    pushScore(m[1], 1.6);\n  }\n  // \n  for (const m of text.matchAll(/([\\u4e00-\\u9fa5]{2,6})/g)) {\n    pushScore(m[1], 0.05);\n  }\n\n  // \n  for (const name of old_map.keys()) {\n    if (text.includes(name)) score.set(name, Math.max(score.get(name) ?? 0, 2));\n  }\n\n  const result: OnStageCharacter[] = [];\n  for (const [name, s] of score.entries()) {\n    if (s < 2.8) continue;\n    const old = old_map.get(name);\n    const context = extractNameContext(text, name);\n    result.push({\n      : name,\n      : clampAffection(old?. ?? 0, 0),\n      : String((old as any)?. ?? ''),\n      : old?. || inferAttitudeByContext(context),\n      : old?. || (context ? `${context}` : ''),\n      : _.isObjectLike(old?.) ? (_.cloneDeep(old?.) as Record<string, number>) : {},\n      : Date.now(),\n    });\n  }\n  return result;\n}\n\nfunction parseOnStageCharacters(content: string): OnStageCharacter[] | undefined {\n  const match = content.match(/<OnStageCharacters>([\\s\\S]*?)<\\/OnStageCharacters>/im);\n  if (!match?.[1]) return undefined;\n\n  try {\n    const parsed = JSON.parse(match[1]);\n    if (!Array.isArray(parsed)) return undefined;\n\n    return parsed\n      .filter(item => _.isObjectLike(item))\n      .map(item => {\n        const attrs = _.isObjectLike((item as any).) ? (item as any). as Record<string, unknown> : {};\n        const normalized_attrs = Object.fromEntries(\n          Object.entries(attrs).map(([k, v]) => [k, asNumber(v, 0)]),\n        ) as Record<string, number>;\n        return {\n          : String((item as any). ?? ''),\n          : _.clamp(asNumber((item as any)., 0), -200, 1000),\n          : String((item as any). ?? ''),\n          : String((item as any). ?? ''),\n          : String((item as any). ?? ''),\n          : normalized_attrs,\n          : Date.now(),\n        };\n      });\n  } catch {\n    return undefined;\n  }\n}\n\nfunction parseNpcRelationHints(content: string): NpcRelationHint[] | undefined {\n  const match = content.match(/<NpcRelationHints>([\\s\\S]*?)<\\/NpcRelationHints>/im);\n  if (!match?.[1]) return undefined;\n  try {\n    const parsed = JSON.parse(match[1]);\n    if (!Array.isArray(parsed)) return undefined;\n    return parsed\n      .filter(item => _.isObjectLike(item))\n      .map(item => ({\n        : String((item as any). ?? ''),\n        : Array.isArray((item as any).) ? (item as any)..map((v: unknown) => String(v)) : [],\n      }))\n      .filter(v => v.);\n  } catch {\n    return undefined;\n  }\n}\n\nfunction ensureNpcData(stat_data: any): void {\n  if (!_.isObjectLike(_.get(stat_data, ''))) _.set(stat_data, '', {});\n  if (!Array.isArray(_.get(stat_data, '.'))) _.set(stat_data, '.', []);\n  if (!_.isObjectLike(_.get(stat_data, '.'))) {\n    _.set(stat_data, '.', { : false, NPC: false });\n  } else {\n    _.defaults(_.get(stat_data, '.'), { : false, NPC: false });\n  }\n  if (!_.isObjectLike(_.get(stat_data, '.NPC'))) _.set(stat_data, '.NPC', {});\n  if (!_.isObjectLike(_.get(stat_data, '.NPC'))) _.set(stat_data, '.NPC', {});\n  if (!_.isObjectLike(_.get(stat_data, ''))) _.set(stat_data, '', {});\n  _.defaultsDeep(_.get(stat_data, ''), {\n    : false,\n    : {},\n    : {},\n    : {\n      : false,\n      : '',\n      : '',\n      : '',\n      : 0,\n      : 0,\n      : 0,\n      : '',\n      : '',\n      : [],\n    },\n    : {\n      : 0,\n      : 0,\n      : {},\n      : [],\n    },\n  });\n}\n\nfunction resetNpcStateBeforeCreate(stat_data: any): void {\n  if (!stat_data || typeof stat_data !== 'object') return;\n  if (_.get(stat_data, '..', false)) return;\n  _.set(stat_data, '.', []);\n  _.set(stat_data, '.NPC', {});\n  _.set(stat_data, '.NPC', {});\n}\n\nfunction clampAffection(value: unknown, fallback = 0): number {\n  return _.clamp(asNumber(value, fallback), -200, 1000);\n}\n\nfunction calcAffectionStage(score: number, is_partner = false): string {\n  if (is_partner) return '';\n  if (score <= -50) return '';\n  if (score <= -20) return '';\n  if (score <= 0) return '';\n  if (score <= 100) return '';\n  if (score <= 400) return '';\n  if (score <= 600) return '';\n  return '';\n}\n\nfunction mergeOnStageCharacters(old_list: OnStageCharacter[], incoming: OnStageCharacter[]): OnStageCharacter[] {\n  const merged_map = new Map<string, OnStageCharacter>();\n  for (const old of old_list) {\n    merged_map.set(old., {\n      : String(old. || ''),\n      : clampAffection(old., 0),\n      : String((old as any). || ''),\n      : String(old. || ''),\n      : String(old. || ''),\n      : _.isObjectLike(old.) ? _.cloneDeep(old.) : {},\n      : asNumber(old., 0),\n    });\n  }\n  for (const next of incoming) {\n    const name = String(next. || '');\n    const prev = merged_map.get(name);\n    if (!prev) {\n      merged_map.set(name, {\n        : name,\n        : clampAffection(next., 0),\n        : String((next as any). || ''),\n        : String(next. || ''),\n        : String(next. || ''),\n        : _.isObjectLike(next.) ? _.cloneDeep(next.) : {},\n        : Date.now(),\n      });\n      continue;\n    }\n    const requested = clampAffection(next., prev.);\n    const merged_affection = requested > prev. ? Math.min(prev. + 5, requested) : requested;\n    merged_map.set(name, {\n      : name,\n      : clampAffection(merged_affection, prev.),\n      : String((next as any). || (prev as any). || ''),\n      : String(next. || prev. || ''),\n      : String(next. || prev. || ''),\n      : {\n        ...(prev. ?? {}),\n        ...(_.isObjectLike(next.) ? next. : {}),\n      },\n      : Date.now(),\n    });\n  }\n  return [...merged_map.values()];\n}\n\nfunction detectMentionedNames(content: string, names: string[]): Set<string> {\n  const text = String(content ?? '');\n  const mentions = new Set<string>();\n  for (const name of names) {\n    if (!name) continue;\n    if (text.includes(name)) mentions.add(name);\n  }\n  return mentions;\n}\n\nfunction getTracker(stat_data: any, name: string): any {\n  const key = `.NPC.${name}`;\n  if (!_.isObjectLike(_.get(stat_data, key))) {\n    _.set(stat_data, key, {\n      : 0,\n      : 0,\n      : 0,\n      : 0,\n      : false,\n    });\n  }\n  return _.get(stat_data, key);\n}\n\nfunction upsertLongTermNpc(stat_data: any, name: string, payload?: Partial<OnStageCharacter>): any {\n  const key = `.NPC.${name}`;\n  const existing = _.get(stat_data, key);\n  const base = _.isObjectLike(existing) ? existing : {\n    : name,\n    : 0,\n    : '',\n    : '',\n    : '',\n    : '',\n    : {},\n    : 0,\n    : '',\n    : [],\n    : Date.now(),\n    : 0,\n  };\n  const next_affection = clampAffection(payload?., base.);\n  const current_affection = clampAffection(base., 0);\n  const merged_affection = next_affection > current_affection ? Math.min(current_affection + 5, next_affection) : next_affection;\n  const is_partner = Array.isArray(base.) && base..includes('');\n  const next = {\n    ...base,\n    : name,\n    : merged_affection,\n    : String((payload as any)?. || base. || ''),\n    : String(payload?. || base. || ''),\n    : String(payload?. || base. || ''),\n    : {\n      ...(base. ?? {}),\n      ...(payload?. ?? {}),\n    },\n    : Date.now(),\n  };\n  next. = calcAffectionStage(next., is_partner);\n  _.set(stat_data, key, next);\n  return next;\n}\n\nfunction promoteToLongTermByName(stat_data: any, name: string, reason: string): void {\n  const onstage_list = (_.get(stat_data, '.', []) as OnStageCharacter[]);\n  const onstage = onstage_list.find(v => v. === name);\n  const npc = upsertLongTermNpc(stat_data, name, onstage);\n  const tracker = getTracker(stat_data, name);\n  tracker. = true;\n  _.set(stat_data, `.NPC.${name}.`, _.uniq([...(npc. ?? []), reason]));\n}\n\nconst npc_follow_pattern = /|||||/;\nconst npc_partner_ai_pattern = /||/;\nconst npc_partner_user_confirm_pattern = /||||/;\nconst npc_sex_pattern = /||||/;\n\nfunction applyUserNpcRequest(stat_data: any, user_content: string): boolean {\n  if (!npc_follow_pattern.test(user_content)) return false;\n  const onstage_list = (_.get(stat_data, '.', []) as OnStageCharacter[]);\n  const names = onstage_list.map(v => v.);\n  const mentioned = [...detectMentionedNames(user_content, names)];\n  const targets = mentioned.length > 0 ? mentioned : (names.length === 1 ? [names[0]] : []);\n  if (targets.length === 0) return false;\n  for (const name of targets) {\n    const tracker = getTracker(stat_data, name);\n    tracker. = asNumber(tracker., 0) + 1;\n    tracker. = Date.now();\n    promoteToLongTermByName(stat_data, name, '');\n  }\n  return true;\n}\n\nfunction applyNpcLongTermRules(stat_data: any, ai_content: string, user_content: string, parsed_onstage?: OnStageCharacter[], hints?: NpcRelationHint[]): void {\n  ensureNpcData(stat_data);\n  const onstage_list = (_.get(stat_data, '.', []) as OnStageCharacter[]);\n  const long_map = _.get(stat_data, '.NPC', {}) as Record<string, any>;\n  const name_pool = _.uniq([\n    ...onstage_list.map(v => v.),\n    ...Object.keys(long_map),\n    ...(parsed_onstage?.map(v => v.) ?? []),\n  ]);\n  const structured_names = new Set((parsed_onstage ?? []).map(v => v.));\n  const text_mentions = detectMentionedNames(ai_content, name_pool);\n  const appeared = new Set<string>([...structured_names, ...text_mentions]);\n  const round = asNumber(_.get(stat_data, '..', 1), 1);\n\n  for (const name of name_pool) {\n    const tracker = getTracker(stat_data, name);\n    if (appeared.has(name)) {\n      tracker. = asNumber(tracker., 0) + 1;\n      tracker. = round;\n    } else {\n      tracker. = Math.max(0, asNumber(tracker., 0) - 1);\n    }\n    if (tracker. >= 5 && !tracker.) {\n      promoteToLongTermByName(stat_data, name, '');\n    }\n  }\n\n  for (const onstage of onstage_list) {\n    if (_.has(stat_data, `.NPC.${onstage.}`)) {\n      upsertLongTermNpc(stat_data, onstage., onstage);\n    }\n  }\n\n  for (const hint of hints ?? []) {\n    if (!_.has(long_map, hint.)) continue;\n    const curr = _.get(stat_data, `.NPC.${hint.}.`, []);\n    _.set(stat_data, `.NPC.${hint.}.`, _.uniq([...(curr ?? []), ...hint.]));\n  }\n\n  const ai_has_partner_signal = npc_partner_ai_pattern.test(ai_content);\n  const user_confirm = npc_partner_user_confirm_pattern.test(user_content);\n  if (ai_has_partner_signal && user_confirm) {\n    for (const name of detectMentionedNames(ai_content, Object.keys(_.get(stat_data, '.NPC', {})))) {\n      const score = clampAffection(_.get(stat_data, `.NPC.${name}.`, 0), 0);\n      if (score < 601) continue;\n      const current_tags = _.get(stat_data, `.NPC.${name}.`, []);\n      const tags = _.uniq([...(Array.isArray(current_tags) ? current_tags : []), '']);\n      _.set(stat_data, `.NPC.${name}.`, tags);\n      _.set(stat_data, `.NPC.${name}.`, '');\n      _.set(stat_data, `.NPC.${name}.`, Date.now());\n    }\n  }\n\n  if (npc_sex_pattern.test(ai_content)) {\n    for (const name of detectMentionedNames(ai_content, Object.keys(_.get(stat_data, '.NPC', {})))) {\n      const count = asNumber(_.get(stat_data, `.NPC.${name}.`, 0), 0) + 1;\n      _.set(stat_data, `.NPC.${name}.`, count);\n      _.set(stat_data, `.NPC.${name}.`, '');\n      _.set(stat_data, `.NPC.${name}.`, Date.now());\n    }\n  }\n}\n\nfunction applyVivianaArc(stat_data: any): void {\n  const current_place = String(_.get(stat_data, '.', ''));\n  const in_library = //.test(current_place);\n  const onstage = _.get(stat_data, '.', []) as OnStageCharacter[];\n  const long_map = _.get(stat_data, '.NPC', {}) as Record<string, any>;\n  const names = _.uniq([\n    ...onstage.map(v => String(v. || '')),\n    ...Object.keys(long_map),\n  ]).filter(v => //.test(v));\n  if (names.length === 0) return;\n\n  for (const name of names) {\n    if (!in_library) {\n      _.remove(onstage, v => String(v?. ?? '') === name);\n      continue;\n    }\n    const npc = _.get(stat_data, `.NPC.${name}`, {});\n    const score = clampAffection(_.get(npc, '', 0), 0);\n    const stage = String(_.get(npc, '', calcAffectionStage(score)));\n    const is_partner = stage === '' || (Array.isArray(_.get(npc, '')) && _.get(npc, '').includes(''));\n\n    let attitude = '';\n    let thought = '';\n    if (score >= 1) {\n      attitude = '';\n      thought = '';\n    }\n    if (score >= 101) {\n      attitude = '';\n      thought = '';\n    }\n    if (score >= 401) {\n      attitude = '';\n      thought = '';\n    }\n    if (score >= 601) {\n      attitude = '';\n      thought = '';\n    }\n    if (is_partner) {\n      attitude = '';\n      thought = '';\n      _.set(stat_data, `.NPC.${name}.`, '');\n    }\n\n    _.set(stat_data, `.NPC.${name}.`, attitude);\n    _.set(stat_data, `.NPC.${name}.`, thought);\n    _.set(stat_data, `.NPC.${name}.`, Date.now());\n\n    const idx = onstage.findIndex(v => String(v?. ?? '') === name);\n    if (idx >= 0) {\n      onstage[idx]. = attitude;\n      onstage[idx]. = `${thought}`;\n      onstage[idx]. = Date.now();\n    }\n  }\n}\n\nfunction sanitizeThoughtText(raw: string): string {\n  const thought = String(raw ?? '').trim();\n  if (!thought) return '';\n  if (/AI|||||JSON||mvu|statusplaceholder/i.test(thought)) {\n    return '';\n  }\n  return thought.slice(0, 120);\n}\n\nfunction buildPersonaInnerThought(name: string, score: number, is_partner: boolean, fallback: string): { attitude: string; thought: string } {\n  const clean_fallback = sanitizeThoughtText(fallback);\n\n  if (/|victorica/i.test(name)) {\n    if (is_partner) return { attitude: '', thought: '' };\n    if (score >= 601) return { attitude: '', thought: '' };\n    if (score >= 401) return { attitude: '', thought: '' };\n    if (score >= 101) return { attitude: '', thought: '' };\n    if (score >= 1) return { attitude: '', thought: '' };\n    return { attitude: '', thought: '' };\n  }\n\n  if (/|/i.test(name)) {\n    if (is_partner) return { attitude: '', thought: '' };\n    if (score >= 601) return { attitude: '', thought: '' };\n    if (score >= 401) return { attitude: '', thought: '' };\n    if (score >= 101) return { attitude: '', thought: '' };\n    if (score >= 1) return { attitude: '', thought: '' };\n    return { attitude: '', thought: '' };\n  }\n\n  if (clean_fallback) {\n    return { attitude: '', thought: clean_fallback };\n  }\n  return { attitude: '', thought: '' };\n}\n\nfunction applyNpcPersonaConsistency(stat_data: any): void {\n  const onstage = (_.get(stat_data, '.', []) as OnStageCharacter[]) ?? [];\n  const long_map = (_.get(stat_data, '.NPC', {}) as Record<string, any>) ?? {};\n  const all_names = _.uniq([\n    ...onstage.map(v => String(v?. ?? '')),\n    ...Object.keys(long_map),\n  ]).filter(Boolean);\n\n  for (const name of all_names) {\n    const long_key = `.NPC.${name}`;\n    const long_npc = _.get(stat_data, long_key, {});\n    const score = clampAffection(_.get(long_npc, '', 0), 0);\n    const tags = _.get(long_npc, '', []);\n    const is_partner = String(_.get(long_npc, '', '')) === '' || (Array.isArray(tags) && tags.includes(''));\n    const fallback = String(_.get(long_npc, '', '') || onstage.find(v => v. === name)?. || '');\n    const persona = buildPersonaInnerThought(name, score, is_partner, fallback);\n\n    if (_.has(stat_data, long_key)) {\n      _.set(stat_data, `${long_key}.`, persona.attitude);\n      _.set(stat_data, `${long_key}.`, persona.thought);\n      _.set(stat_data, `${long_key}.`, Date.now());\n      if (is_partner) _.set(stat_data, `${long_key}.`, '');\n    }\n\n    const idx = onstage.findIndex(v => String(v?. ?? '') === name);\n    if (idx >= 0) {\n      onstage[idx]. = persona.attitude;\n      onstage[idx]. = `${persona.thought}`;\n      onstage[idx]. = Date.now();\n    }\n  }\n}\n\nconst dungeon_enter_pattern = /|||||/i;\nconst dungeon_leave_pattern = /||||/i;\nconst dungeon_move_pattern = /||||||/i;\nconst dungeon_search_pattern = /||||||/i;\nconst dungeon_blow_pattern = /||||/i;\n\nconst lab_level_options = ['', '', '', ''] as const;\nconst lab_room_pool: Record<'' | '' | '' | '', string[]> = {\n  : ['', '', '', '', '', '', '', ''],\n  : ['', '', '', '', '', '', '', '', ''],\n  : ['', '', '', '', '', '', ''],\n  : ['', '', '', '', '', ''],\n};\n\ntype ItemTier = '' | '' | '' | '' | '' | '';\nconst tier_value_range: Record<ItemTier, [number, number]> = {\n  : [1, 1000],\n  : [1001, 5000],\n  : [5001, 20000],\n  : [20001, 50000],\n  : [50001, 200000],\n  : [200001, 20000000],\n};\nconst tier_affix_count: Record<ItemTier, number> = {\n  : 0,\n  : 1,\n  : 2,\n  : 3,\n  : 4,\n  : 5,\n};\nconst affix_pool = [\n  '', '', '', '', '', '', '', '', '', '',\n];\nconst trade_only_items = ['', '', '', '', ''];\nconst black_market_trade_pattern = /.*(||||)/i;\nconst black_market_buy_pattern = /.*(|||)/i;\n\nfunction parseLabLevel(content: string): (typeof lab_level_options)[number] {\n  if (//.test(content)) return '';\n  if (//.test(content)) return '';\n  if (//.test(content)) return '';\n  return '';\n}\n\nfunction parseMapScale(content: string, level: (typeof lab_level_options)[number]): '' | '' | '' {\n  if (//.test(content)) return '';\n  if (//.test(content)) return '';\n  if (//.test(content)) return '';\n  if (level === '' || level === '') return '';\n  if (level === '') return '';\n  return '';\n}\n\nfunction rollRoomTypeByLuck(luck: number): '' | '' | '' | '' {\n  // 1.012~34~7/8~910\n  // 20 +0.1/\n  const shift = Math.max(0, Math.floor(luck / 20));\n  const good_weight = 2 + shift;\n  const normal_weight = Math.max(1, 4 - shift);\n  const danger_weight = 1;\n  let risky_weight = 2;\n  if (shift >= 2) {\n    risky_weight = Math.max(1, risky_weight - Math.floor(shift / 2));\n  }\n  const hidden_weight = 1;\n  const total = hidden_weight + good_weight + normal_weight + risky_weight + danger_weight;\n  const r = Math.random() * total;\n  if (r < hidden_weight) return '';\n  if (r < hidden_weight + good_weight) return '';\n  if (r < hidden_weight + good_weight + normal_weight) return '';\n  // /\n  return '';\n}\n\nfunction buildRoomContainer(room_type: '' | '' | '' | ''): { : number; : number; : boolean; : boolean } {\n  if (room_type === '') return { : 0, : 4, : false, : false };\n  if (room_type === '') {\n    const locked = Math.random() < 0.35;\n    return locked\n      ? { : 0, : _.random(2, 5), : true, : false }\n      : { : 1, : 1, : false, : false };\n  }\n  if (room_type === '') return { : 2, : 0, : false, : false };\n  const has_loot = Math.random() < 0.7; // /1\n  return { : has_loot ? 1 : 0, : 0, : false, : false };\n}\n\nfunction generateDungeonMap(scale: '' | '' | '', luck: number): any[] {\n  const count = scale === '' ? 5 : scale === '' ? 12 : 20;\n  const rooms: any[] = [];\n  for (let i = 1; i <= count; i += 1) {\n    const room_type = rollRoomTypeByLuck(luck);\n    // /\n    const room_name = _.sample(lab_room_pool[room_type]) ?? (room_type === '' ? '' : '');\n    rooms.push({\n      : i,\n      : room_name,\n      : room_type,\n      : buildRoomContainer(room_type),\n    });\n  }\n  return rooms;\n}\n\nfunction pickLootQuality(level: (typeof lab_level_options)[number], is_advanced: boolean): ItemTier {\n  const roll = _.random(1, 100);\n  if (level === '') {\n    if (roll >= 96) return '';\n    if (roll >= 75) return '';\n    if (roll >= 45) return '';\n    if (roll >= 20) return '';\n    return is_advanced ? '' : '';\n  }\n  if (level === '') {\n    if (roll >= 97) return '';\n    if (roll >= 82) return '';\n    if (roll >= 55) return '';\n    if (roll >= 25) return '';\n    return is_advanced ? '' : '';\n  }\n  if (level === '') {\n    if (roll >= 95) return '';\n    if (roll >= 75) return '';\n    if (roll >= 45) return '';\n    if (roll >= 20) return '';\n    return '';\n  }\n  if (roll >= 98) return '';\n  if (roll >= 85) return '';\n  if (roll >= 60) return '';\n  if (roll >= 30) return '';\n  return '';\n}\n\nfunction addWarehouseItem(stat_data: any, item_name: string, quality: ItemTier, count: number, category: string, desc: string, value: number, tags: string[], tradeable = true): void {\n  if (item_name === '') {\n    _.set(stat_data, '..', asNumber(_.get(stat_data, '..', 0), 0) + count);\n    return;\n  }\n  if (item_name === '') {\n    _.set(stat_data, '..', asNumber(_.get(stat_data, '..', 0), 0) + count);\n    return;\n  }\n  const key = `...${item_name}`;\n  const old_count = asNumber(_.get(stat_data, `${key}.`, 0), 0);\n  const old_tags = _.get(stat_data, `${key}.`, []);\n  _.set(stat_data, key, {\n    : quality,\n    : old_count + count,\n    : value,\n    : category,\n    : desc,\n    : _.uniq([...(Array.isArray(old_tags) ? old_tags : []), ...tags]),\n    : tradeable,\n  });\n  if (/||/.test(quality)) {\n    const curr = _.get(stat_data, '..', []);\n    _.set(stat_data, '..', _.uniq([...(Array.isArray(curr) ? curr : []), item_name]));\n  }\n}\n\nfunction generateLootFromContainer(stat_data: any, level: (typeof lab_level_options)[number], container_type: '' | '', slot_override?: number): Record<string, any> {\n  const slots = slot_override ?? (container_type === '' ? 3 : 2);\n  const loot: Record<string, any> = {};\n  const pools = {\n    : ['', '', '', '', ''],\n    : ['', '', '', ''],\n    : ['', '', '', ''],\n    : ['', '', ''],\n  };\n  for (let i = 0; i < slots; i += 1) {\n    const quality = pickLootQuality(level, container_type === '');\n    const category = quality === '' || quality === ''\n      ? _.sample(['', '', '']) ?? ''\n      : _.sample(['', '', '']) ?? '';\n    const is_trade_only = category === '' && Math.random() < 0.45;\n    const item_name = (() => {\n      if (is_trade_only) return _.sample(trade_only_items) ?? '';\n      if (quality === '') return Math.random() < 0.25 ? '' : '';\n      if (quality === '') return '';\n      if (quality === '') return '';\n      return _.sample((pools as any)[category]) ?? '';\n    })();\n    const count = item_name === '' ? _.random(40, 280) : item_name === '' ? _.random(1, 4) : 1;\n    const [vmin, vmax] = tier_value_range[quality];\n    const value = _.random(vmin, vmax);\n    const tags = is_trade_only ? [] : _.sampleSize(affix_pool, tier_affix_count[quality]);\n    loot[item_name] = {\n      : quality,\n      : asNumber(_.get(loot, `${item_name}.`, 0), 0) + count,\n      : value,\n    };\n    addWarehouseItem(stat_data, item_name, quality, count, category, `${container_type}`, value, tags, true);\n  }\n  return loot;\n}\n\nfunction mergeLootRecord(target: Record<string, any>, incoming: Record<string, any>): void {\n  for (const [name, item] of Object.entries(incoming)) {\n    const old_count = asNumber(_.get(target, `${name}.`, 0), 0);\n    target[name] = {\n      : String((item as any)?. ?? _.get(target, `${name}.`, '')),\n      : old_count + asNumber((item as any)?., 0),\n      : asNumber((item as any)?., asNumber(_.get(target, `${name}.`, 1), 1)),\n    };\n  }\n}\n\nfunction applyDungeonLootSystem(stat_data: any, content: string): void {\n  ensureNpcData(stat_data);\n  const level = parseLabLevel(content);\n  const scale = parseMapScale(content, level);\n  const luck = asNumber(_.get(stat_data, '..', 1), 1) * 20;\n\n  if (dungeon_enter_pattern.test(content)) {\n    const map = generateDungeonMap(scale, luck);\n    _.set(stat_data, '.', {\n      : true,\n      : '',\n      : level,\n      : scale,\n      : map.length,\n      : 0,\n      : 1,\n      : map[0]?. ?? '',\n      : `${level}/${scale}/${map.length}`,\n      : map,\n    });\n    _.set(stat_data, '.', true);\n    _.set(stat_data, '..', `${level}${scale}`);\n    return;\n  }\n\n  if (!_.get(stat_data, '..', false)) return;\n  const rooms = _.get(stat_data, '..', []) as any[];\n  if (!Array.isArray(rooms) || rooms.length === 0) return;\n  let idx = _.clamp(asNumber(_.get(stat_data, '..', 0), 0), 0, rooms.length - 1);\n\n  if (dungeon_move_pattern.test(content)) {\n    idx = Math.min(rooms.length - 1, idx + 1);\n    _.set(stat_data, '..', idx);\n    _.set(stat_data, '..', Math.max(asNumber(_.get(stat_data, '..', 1), 1), idx + 1));\n    _.set(stat_data, '..', String(rooms[idx]?. ?? ''));\n  }\n\n  if (dungeon_search_pattern.test(content)) {\n    const room = rooms[idx];\n    if (room?.?.) {\n      _.set(stat_data, '.', {});\n      _.set(stat_data, '..', `${idx + 1}`);\n      _.set(stat_data, '.', true);\n    } else {\n      const merged_loot: Record<string, any> = {};\n      const is_blow = dungeon_blow_pattern.test(content) && Boolean(room?.?.);\n      const slot_override = is_blow ? 1 : undefined;\n      const normal_count = asNumber(room?.?., 0);\n      const advanced_count = asNumber(room?.?., 0);\n\n      for (let i = 0; i < normal_count; i += 1) {\n        const loot = generateLootFromContainer(stat_data, _.get(stat_data, '..', level), '', slot_override);\n        mergeLootRecord(merged_loot, loot);\n      }\n      for (let i = 0; i < advanced_count; i += 1) {\n        const loot = generateLootFromContainer(stat_data, _.get(stat_data, '..', level), '', slot_override);\n        mergeLootRecord(merged_loot, loot);\n      }\n\n      _.set(room, '.', true);\n      _.set(stat_data, '.', merged_loot);\n      _.set(stat_data, '.', true);\n      _.set(stat_data, '..', is_blow ? '1/' : `${idx + 1}`);\n      _.set(stat_data, `.-${Date.now()}`, `${idx + 1}:${room?. ?? ''} `);\n      trimBattleLogs(stat_data, 3);\n    }\n  }\n\n  if (dungeon_leave_pattern.test(content)) {\n    _.set(stat_data, '..', false);\n    _.set(stat_data, '..', '');\n  }\n}\n\nfunction applyBlackMarketTrade(stat_data: any, content: string): void {\n  if (!/|/.test(content)) return;\n  const market_place = '';\n  if (/|||/.test(content)) {\n    _.set(stat_data, '.', market_place);\n    _.set(stat_data, '..', '');\n  }\n\n  const items = _.get(stat_data, '..', {}) as Record<string, any>;\n  const names = Object.keys(items);\n  if (black_market_trade_pattern.test(content)) {\n    const targets = [...detectMentionedNames(content, names)];\n    for (const name of targets) {\n      const qty_match = content.match(new RegExp(`${_.escapeRegExp(name)}\\\\D*(\\\\d+)`, 'i'));\n      const sell_qty = Math.max(1, asNumber(qty_match?.[1], 1));\n      const own_qty = asNumber(_.get(stat_data, `...${name}.`, 0), 0);\n      if (own_qty <= 0) continue;\n      const use_qty = Math.min(own_qty, sell_qty);\n      const value = asNumber(_.get(stat_data, `...${name}.`, 1), 1);\n      const tradeable = Boolean(_.get(stat_data, `...${name}.`, true));\n      if (!tradeable) continue;\n      const income = Math.floor(value * use_qty * 0.1); // 90%\n      _.set(stat_data, '..', asNumber(_.get(stat_data, '..', 0), 0) + income);\n      const left = own_qty - use_qty;\n      if (left <= 0) _.unset(stat_data, `...${name}`);\n      else _.set(stat_data, `...${name}.`, left);\n      _.set(stat_data, '..', ` ${name} x${use_qty}${income}90%`);\n    }\n  }\n\n  if (black_market_buy_pattern.test(content)) {\n    const want_tier = (['', '', '', '', '', ''] as ItemTier[]).find(t => content.includes(t)) ?? '';\n    const [vmin, vmax] = tier_value_range[want_tier];\n    const price = _.random(vmin, vmax);\n    const money = asNumber(_.get(stat_data, '..', 0), 0);\n    if (money >= price) {\n      _.set(stat_data, '..', money - price);\n      const item_name = `${want_tier}-${Date.now().toString().slice(-4)}`;\n      const tags = _.sampleSize(affix_pool, tier_affix_count[want_tier]);\n      addWarehouseItem(stat_data, item_name, want_tier, 1, '', '', price, tags, true);\n      _.set(stat_data, '..', ` ${item_name}${want_tier} ${price}`);\n    } else {\n      _.set(stat_data, '..', `${price}${money}`);\n    }\n  }\n}\n\nfunction hasExplicitUpdateTag(content: string): boolean {\n  return /<update(?:variable)?>[\\s\\S]*?<\\/update(?:variable)?>|<update(?:variable)?>[\\s\\S]*$/im.test(content);\n}\n\nfunction lockCriticalStateWithoutTag(new_stat: any, old_stat: any): void {\n  if (!_.isObjectLike(new_stat)) return;\n  if (!_.isObjectLike(old_stat)) return;\n  const critical_paths = [\n    '.',\n    '.',\n    '.',\n    '.',\n    '.',\n    '.',\n    '.',\n    '.',\n    '.',\n    '.',\n    '.',\n  ];\n  for (const p of critical_paths) {\n    const old_val = _.get(old_stat, p);\n    if (old_val !== undefined) {\n      _.set(new_stat, p, _.cloneDeep(old_val));\n    }\n  }\n}\n\nfunction patchGameplayState(stat_data: any, content: string): void {\n  if (!stat_data || typeof stat_data !== 'object') return;\n\n  const profession = _.get(stat_data, '..', '');\n  const is_warmaid = profession === '' || String(_.get(stat_data, '..', '')).includes('');\n  if (!is_warmaid) {\n    _.set(stat_data, '..', false);\n    _.set(stat_data, '.', false);\n    return;\n  }\n\n  const current_round = asNumber(_.get(stat_data, '..', 0), 0);\n  const line = String(_.get(stat_data, '..', ''));\n  const threat = String(_.get(stat_data, '.', ''));\n  const manual_toggle = Boolean(_.get(stat_data, '..', false));\n\n  const battle_by_state = current_round > 1 || line === '' || line === '' || threat === '' || threat === '';\n  const battle_by_text = /||||||||||/i.test(content);\n  const in_battle = battle_by_state || battle_by_text;\n\n  const was_enabled = Boolean(_.get(stat_data, '..', false));\n  const should_enable = manual_toggle || in_battle;\n  _.set(stat_data, '..', should_enable);\n\n  let last_round = asNumber(_.get(stat_data, '..', 0), 0);\n  if (!was_enabled && should_enable) {\n    last_round = current_round;\n    _.set(stat_data, '..', current_round);\n  }\n\n  if (should_enable) {\n    const round_delta = Math.max(0, current_round - last_round);\n    if (round_delta > 0) {\n      const magic_cost = asNumber(_.get(stat_data, '..', 0), 0) * round_delta;\n      const slot_cost = asNumber(_.get(stat_data, '..', 0), 0) * round_delta;\n\n      const current_magic = asNumber(_.get(stat_data, '..', 0), 0);\n      const current_slot = asNumber(_.get(stat_data, '..', 0), 0);\n      const next_magic = Math.max(0, current_magic - magic_cost);\n      const next_slot = Math.max(0, current_slot - slot_cost);\n\n      _.set(stat_data, '..', next_magic);\n      _.set(stat_data, '..', next_slot);\n      _.set(stat_data, '..', current_round);\n\n      if (next_magic <= 0 || next_slot <= 0) {\n        _.set(stat_data, '..', false);\n        _.set(stat_data, '..', false);\n      }\n    }\n  } else if (last_round > current_round) {\n    _.set(stat_data, '..', current_round);\n  }\n\n  // /\n}\n\nfunction getWarmaidType(stat_data: any): string {\n  return String(\n    _.get(stat_data, '..', '').trim()\n      || _.get(stat_data, '..', '').replace('-', '').trim(),\n  );\n}\n\nfunction applyBattleSystemConstraints(stat_data: any, content: string): void {\n  if (!stat_data || typeof stat_data !== 'object') return;\n  ensureAirCombatData(stat_data);\n\n  const mode_by_text =\n    /|||||/i.test(content) ? ''\n      : /||||/i.test(content) ? ''\n        : '';\n  const current_round = asNumber(_.get(stat_data, '..', 1), 1);\n  const threat = String(_.get(stat_data, '.', ''));\n  const line = String(_.get(stat_data, '..', ''));\n  const in_battle_by_state = current_round > 1 || line === '' || line === '' || threat === '' || threat === '';\n  const in_battle_by_text = isBattleTriggerContent(content);\n  const in_battle = in_battle_by_state || in_battle_by_text;\n\n  const mode = in_battle ? (mode_by_text === '' ? '' : mode_by_text) : '';\n  _.set(stat_data, '..', mode);\n  _.set(stat_data, '..', in_battle);\n\n  if (!in_battle) {\n    _.set(stat_data, '..', 1);\n    _.set(stat_data, '..', 1);\n    _.set(stat_data, '..', '');\n    return;\n  }\n\n  const profession = _.get(stat_data, '..', '');\n  const warmaid_type = getWarmaidType(stat_data);\n  const is_commander = profession === '';\n  const is_authority = profession === '';\n\n  let ap = 1;\n  let mp = 1;\n  let penalty = '';\n\n  if (mode === '') {\n    const agi = asNumber(_.get(stat_data, '..', 1), 1);\n    ap = Math.max(1, Math.floor(agi / 3));\n    mp = warmaid_type === '' ? 0 : 1;\n  } else if (is_commander) {\n    ap = 1;\n    mp = 1;\n    if (line !== '') {\n      _.set(stat_data, '..', '');\n    }\n  } else if (is_authority) {\n    ap = 1;\n    mp = 1;\n  } else if (warmaid_type === '') {\n    ap = 1; mp = 2;\n  } else if (warmaid_type === '') {\n    ap = 2; mp = 1;\n  } else if (warmaid_type === '') {\n    ap = 1; mp = 1;\n  } else if (warmaid_type === '') {\n    ap = 1;\n    const move_counter = asNumber(_.get(stat_data, '..', 0), 0) + 1;\n    _.set(stat_data, '..', move_counter % 2);\n    mp = move_counter % 2 === 0 ? 1 : 0;\n    if (line === '') penalty = '-1/3';\n    if (line === '') penalty = '-1/2';\n  } else if (warmaid_type === '') {\n    ap = 1;\n    mp = 0;\n    if (line === '') penalty = '-1/2';\n    if (line === '' || line === '') penalty = '/';\n  } else if (warmaid_type === '') {\n    ap = 1; mp = 1;\n  }\n\n  _.set(stat_data, '..', ap);\n  _.set(stat_data, '..', mp);\n  if (mode === '') {\n    const weather_hit = asNumber(_.get(stat_data, '...', 0), 0);\n    const superiority = asNumber(_.get(stat_data, '...', 0), 0);\n    const heavy_condition = String(_.get(stat_data, '...', ''));\n    const transform_on = Boolean(_.get(stat_data, '..', false));\n    const airflow_penalty = `: ${weather_hit >= 0 ? '+' : ''}${weather_hit} / ${superiority >= 0 ? '+' : ''}${superiority} | :${heavy_condition}`;\n    penalty = penalty === '' ? airflow_penalty : `${penalty}${airflow_penalty}`;\n    if (!transform_on && !is_commander && !is_authority) {\n      penalty = `${penalty}: `;\n    }\n  }\n\n  _.set(stat_data, '..', penalty);\n}\n\nfunction applyHumanTraining(stat_data: any, content: string): void {\n  if (!stat_data || typeof stat_data !== 'object') return;\n  const attrs: Array<'' | '' | '' | '' | '' | '' | ''> = [\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n  ];\n\n  const keyword_map: Record<(typeof attrs)[number], RegExp> = {\n    : /|||||||/i,\n    : /||||||/i,\n    : /||||||/i,\n    : /|||||||/i,\n    : /||||||/i,\n    : /||||||/i,\n    : /|||||||/i,\n  };\n\n  attrs.forEach(attr => {\n    const matched = keyword_map[attr].test(content);\n    if (!matched) return;\n\n    const current_attr = asNumber(_.get(stat_data, `..${attr}`, 1), 1);\n    if (current_attr >= 5) {\n      _.set(stat_data, `..${attr}`, 100);\n      return;\n    }\n\n    const current_train = asNumber(_.get(stat_data, `..${attr}`, 0), 0);\n    const next_train = Math.min(100, current_train + 1);\n\n    if (next_train >= 100) {\n      _.set(stat_data, `..${attr}`, Math.min(5, current_attr + 1));\n      _.set(stat_data, `..${attr}`, 0);\n    } else {\n      _.set(stat_data, `..${attr}`, next_train);\n    }\n  });\n}\n\ntype SkillAttr = '' | '' | '' | '' | '' | '' | '' | '';\n\nfunction rollD10(): number {\n  return Math.floor(Math.random() * 10) + 1;\n}\n\nfunction inferSkillAttr(content: string): SkillAttr {\n  const map: Array<{ attr: SkillAttr; pattern: RegExp }> = [\n    { attr: '', pattern: /||||||||||||||||||||||/i },\n    { attr: '', pattern: /|||||||||||/i },\n    { attr: '', pattern: /|||||||||||/i },\n    { attr: '', pattern: /|||||||||||/i },\n    { attr: '', pattern: /||||||san||||/i },\n    { attr: '', pattern: /||||||||||/i },\n    { attr: '', pattern: /|||||||||||||||/i },\n  ];\n  const hit = map.find(item => item.pattern.test(content));\n  return hit?.attr ?? '';\n}\n\nfunction inferActionTag(content: string): string {\n  const rules: Array<{ tag: string; pattern: RegExp }> = [\n    { tag: '', pattern: /|||||||/i },\n    { tag: '', pattern: /|||/i },\n    { tag: '', pattern: /||||/i },\n    { tag: '', pattern: /||/i },\n    { tag: '', pattern: /||/i },\n    { tag: '', pattern: /||||/i },\n    { tag: '', pattern: /|||/i },\n    { tag: '', pattern: /|||/i },\n    { tag: '', pattern: /|||/i },\n  ];\n  return rules.find(r => r.pattern.test(content))?.tag ?? '';\n}\n\nfunction inferDifficulty(content: string, attr: SkillAttr): { penalty: number; label: string } {\n  let penalty = 0;\n  const hard = /|||||||||||||/i.test(content);\n  const extreme = /|||||||/i.test(content);\n\n  if (hard) penalty += 2;\n  if (extreme) penalty += 2;\n\n  if (attr === '' && /||||||/i.test(content) && hard) {\n    penalty += 1;\n  }\n\n  if (penalty <= 0) return { penalty: 0, label: '' };\n  if (penalty <= 2) return { penalty, label: '' };\n  if (penalty <= 4) return { penalty, label: '' };\n  return { penalty: Math.min(6, penalty), label: '' };\n}\n\nconst low_impact_no_check_pattern = /|||||||||||||/i;\nconst high_consequence_pattern = /||||||||||||||||||||||/i;\nconst contested_action_pattern = /||||||||||||||||||/i;\nconst explicit_check_pattern = /|||D10|/i;\nconst avoid_risk_intent_pattern = /|||||||||||||/i;\n\nfunction inferConsequenceLevel(content: string): 0 | 1 | 2 {\n  const text = String(content ?? '');\n  if (/||||||||||||/i.test(text)) return 2;\n  if (/|||||||||/i.test(text)) return 1;\n  return 0;\n}\n\nfunction shouldRequireSkillCheck(content: string, inferred_attr: SkillAttr): boolean {\n  const text = String(content ?? '').trim();\n  if (!text) return false;\n  if (explicit_check_pattern.test(text)) return true;\n  const avoid_intent = avoid_risk_intent_pattern.test(text);\n  if (low_impact_no_check_pattern.test(text) && !high_consequence_pattern.test(text)) return false;\n  if (isBattleTriggerContent(text)) return true;\n  if ((high_consequence_pattern.test(text) || contested_action_pattern.test(text)) && avoid_intent) return true;\n  if (inferred_attr === '' && /(|||||||||)/i.test(text) && avoid_intent) return true;\n  return false;\n}\n\nfunction hasRiskButNoAvoidIntent(content: string): boolean {\n  const text = String(content ?? '').trim();\n  if (!text) return false;\n  if (explicit_check_pattern.test(text)) return false;\n  if (isBattleTriggerContent(text)) return false; // \n  const risky = high_consequence_pattern.test(text) || contested_action_pattern.test(text);\n  if (!risky) return false;\n  return !avoid_risk_intent_pattern.test(text);\n}\n\ntype SkillOutcome = {\n  attr: SkillAttr;\n  action_tag: string;\n  current_round: number;\n  raw: number;\n  bonus: number;\n  difficulty_penalty: number;\n  difficulty_label: string;\n  total: number;\n  result: '' | '' | '' | '';\n  desc: string;\n  lock_to_round: number;\n  hp_loss: number;\n  mp_loss: number;\n};\n\ntype PendingSkillState = {\n  user_message_id: number;\n  source_content: string;\n  outcome: SkillOutcome;\n  feedback_prompt: string;\n  injected: boolean;\n  game_over: boolean;\n};\n\nfunction resolveSkillOutcome(stat_data: any, content: string, raw_override?: number): SkillOutcome | undefined {\n  const inferred_attr = inferSkillAttr(content);\n  const should_check = shouldRequireSkillCheck(content, inferred_attr) && inferred_attr !== '';\n  if (!should_check) return undefined;\n\n  const attr = inferred_attr;\n  const action_tag = inferActionTag(content);\n  const current_round = asNumber(_.get(stat_data, '..', 1), 1);\n  const lock_action = String(_.get(stat_data, '..', ''));\n  const lock_until = asNumber(_.get(stat_data, '..', 0), 0);\n\n  if (lock_action && lock_action === action_tag && current_round <= lock_until) {\n    return {\n      attr,\n      action_tag,\n      current_round,\n      raw: 1,\n      bonus: 0,\n      difficulty_penalty: 0,\n      difficulty_label: '',\n      total: 0,\n      result: '',\n      desc: `${action_tag}  ${lock_until} `,\n      lock_to_round: lock_until,\n      hp_loss: 0,\n      mp_loss: 0,\n    };\n  }\n\n  const bonus = asNumber(_.get(stat_data, `..${attr}`, 0), 0);\n  const difficulty = inferDifficulty(content, attr);\n  const raw = _.clamp(raw_override ?? rollD10(), 1, 10);\n  const total = Math.max(0, raw + bonus - difficulty.penalty);\n\n  let result: '' | '' | '' | '' = '';\n  let desc = '';\n  if (raw === 10) {\n    result = '';\n    desc = '=10';\n  } else if (raw === 1) {\n    result = '';\n    desc = '=1';\n  } else if (total > 5) {\n    result = '';\n    desc = ` ${total - 5}`;\n  } else {\n    result = '';\n    desc = ` ${5 - total}`;\n  }\n\n  let lock_to_round = 0;\n  let hp_loss = 0;\n  let mp_loss = 0;\n  if (result === '' || result === '') {\n    const consequence = inferConsequenceLevel(content);\n    const lock_rounds =\n      consequence === 2 ? (result === '' ? 4 : 2)\n        : consequence === 1 ? (result === '' ? 3 : 1)\n          : (result === '' ? 2 : 1);\n    lock_to_round = current_round + lock_rounds;\n    hp_loss =\n      consequence === 2 ? (result === '' ? 12 : 4)\n        : consequence === 1 ? (result === '' ? 8 : 2)\n          : (result === '' ? 4 : 0);\n    mp_loss =\n      consequence === 2 ? (result === '' ? 15 : 6)\n        : consequence === 1 ? (result === '' ? 10 : 3)\n          : (result === '' ? 5 : 1);\n    desc += ` -${hp_loss}-${mp_loss} ${lock_to_round} `;\n  }\n\n  return {\n    attr,\n    action_tag,\n    current_round,\n    raw,\n    bonus,\n    difficulty_penalty: difficulty.penalty,\n    difficulty_label: difficulty.label,\n    total,\n    result,\n    desc,\n    lock_to_round,\n    hp_loss,\n    mp_loss,\n  };\n}\n\nfunction applyResolvedSkillOutcome(stat_data: any, content: string, outcome: SkillOutcome): void {\n  if (outcome.result === '' || outcome.result === '') {\n    const lock_rounds = outcome.result === '' ? 4 : 2;\n    _.set(stat_data, '..', outcome.action_tag);\n    _.set(stat_data, '..', outcome.lock_to_round);\n    _.set(\n      stat_data,\n      `..${outcome.action_tag}`,\n      {\n        : outcome.result === '' ? '' : '',\n        : outcome.result === '' ? '' : '',\n        : lock_rounds,\n      },\n    );\n    _.set(stat_data, '..', Math.max(0, asNumber(_.get(stat_data, '..', 0), 0) - outcome.hp_loss));\n    _.set(stat_data, '..', Math.max(0, asNumber(_.get(stat_data, '..', 0), 0) - outcome.mp_loss));\n  } else {\n    _.set(stat_data, '..', '');\n    _.set(stat_data, '..', 0);\n  }\n\n  _.set(stat_data, '.', {\n    : content.slice(0, 80),\n    : outcome.attr,\n    : outcome.raw,\n    : outcome.bonus,\n    : outcome.difficulty_penalty,\n    : outcome.difficulty_label,\n    : outcome.total,\n    : outcome.result,\n    : outcome.desc,\n    : outcome.result === '' || outcome.result === '' ? outcome.action_tag : '',\n    : outcome.lock_to_round,\n    : Date.now(),\n  });\n\n  _.set(\n    stat_data,\n    `.-${Date.now()}`,\n    `${outcome.action_tag} | ${outcome.attr} | ${outcome.raw}+${outcome.bonus}-${outcome.difficulty_penalty}=${outcome.total} | ${outcome.difficulty_label} | ${outcome.result} | ${outcome.desc}`,\n  );\n  trimBattleLogs(stat_data, 3);\n  _.set(\n    stat_data,\n    '..',\n    `${outcome.action_tag}(${outcome.attr})=${outcome.result}${outcome.total}${outcome.raw}${outcome.difficulty_penalty}`,\n  );\n}\n\nfunction applySkillCheckSystem(stat_data: any, content: string): SkillOutcome | undefined {\n  if (hasRiskButNoAvoidIntent(content)) {\n    const tip = '/';\n    _.set(stat_data, '..', tip);\n    _.set(stat_data, `.-${Date.now()}`, tip);\n    trimBattleLogs(stat_data, 3);\n    return undefined;\n  }\n  const outcome = resolveSkillOutcome(stat_data, content);\n  if (!outcome) return undefined;\n  applyResolvedSkillOutcome(stat_data, content, outcome);\n  return outcome;\n}\n\nfunction enforceGameOver(stat_data: any, reason: string): boolean {\n  const hp = asNumber(_.get(stat_data, '..', 0), 0);\n  if (hp > 0) return false;\n\n  _.set(stat_data, '..', 0);\n  _.set(stat_data, '..', false);\n  _.set(stat_data, '..', false);\n  _.set(stat_data, '..', false);\n  _.set(stat_data, '..', '');\n  _.set(stat_data, '..', true);\n  _.set(stat_data, '..', reason);\n  _.set(stat_data, '..', Date.now());\n  _.set(stat_data, `.-${Date.now()}`, reason);\n  trimBattleLogs(stat_data, 3);\n  _.set(stat_data, '..', '');\n  return true;\n}\n\nfunction normalizeGameOverState(stat_data: any): void {\n  const hp = asNumber(_.get(stat_data, '..', 0), 0);\n  if (hp <= 0) return;\n  if (!Boolean(_.get(stat_data, '..', false))) return;\n  _.set(stat_data, '..', false);\n  _.set(stat_data, '..', '');\n  _.set(stat_data, '..', 0);\n}\n\nconst battle_time_pattern = /||||||||||/i;\nconst dialogue_time_pattern = /|||||||||/i;\nconst jump_time_pattern = /(?:|||)\\s*([^\\n,;]+)/i;\n\nfunction formatUnionDateTime(date: Date): string {\n  const union_year = Math.max(1, date.getFullYear() - 2000);\n  const month = date.getMonth() + 1;\n  const day = date.getDate();\n  const hour = `${date.getHours()}`.padStart(2, '0');\n  const minute = `${date.getMinutes()}`.padStart(2, '0');\n  return `${union_year}${month}${day} ${hour}:${minute}`;\n}\n\nfunction parseWorldDateTime(value: unknown): Date {\n  const text = String(value ?? '').trim();\n  if (!text) return new Date(2177, 7, 28, 8, 0, 0, 0);\n\n  const union_match = text.match(/\\s*(\\d+)\\s*\\s*(\\d{1,2})\\s*\\s*(\\d{1,2})\\s*(?:\\s*(\\d{1,2})[:](\\d{1,2}))?/);\n  if (union_match) {\n    const year = 2000 + asNumber(union_match[1], 177);\n    const month = asNumber(union_match[2], 8);\n    const day = asNumber(union_match[3], 28);\n    const hour = asNumber(union_match[4], 8);\n    const minute = asNumber(union_match[5], 0);\n    return new Date(year, month - 1, day, hour, minute, 0, 0);\n  }\n\n  const iso_like = text.match(/(\\d{4})[-/](\\d{1,2})[-/](\\d{1,2})(?:\\s+(\\d{1,2})[:](\\d{1,2}))?/);\n  if (iso_like) {\n    const year = asNumber(iso_like[1], 2026);\n    const month = asNumber(iso_like[2], 1);\n    const day = asNumber(iso_like[3], 1);\n    const hour = asNumber(iso_like[4], 8);\n    const minute = asNumber(iso_like[5], 0);\n    return new Date(year, month - 1, day, hour, minute, 0, 0);\n  }\n\n  return new Date(2177, 7, 28, 8, 0, 0, 0);\n}\n\nfunction parseTimeJumpTarget(text: string, current: Date): Date | undefined {\n  const source = String(text ?? '').trim();\n  if (!source) return undefined;\n\n  const full_match = source.match(/(?:(?:)?\\s*(\\d+)\\s*)?\\s*(\\d{1,2})\\s*\\s*(\\d{1,2})\\s*(?:\\s*(\\d{1,2})[:](\\d{1,2})?)?/);\n  if (full_match) {\n    const year = full_match[1] ? 2000 + asNumber(full_match[1], current.getFullYear() - 2000) : current.getFullYear();\n    const month = asNumber(full_match[2], current.getMonth() + 1);\n    const day = asNumber(full_match[3], current.getDate());\n    const hour = full_match[4] ? asNumber(full_match[4], 8) : current.getHours();\n    const minute = full_match[5] ? asNumber(full_match[5], 0) : current.getMinutes();\n    return new Date(year, month - 1, day, hour, minute, 0, 0);\n  }\n\n  const day_only_match = source.match(/(\\d{1,2})\\s*\\s*(\\d{1,2})\\s*/);\n  if (day_only_match) {\n    const month = asNumber(day_only_match[1], current.getMonth() + 1);\n    const day = asNumber(day_only_match[2], current.getDate());\n    const hm = source.match(/(\\d{1,2})[:](\\d{1,2})/);\n    const hour = hm ? asNumber(hm[1], 8) : current.getHours();\n    const minute = hm ? asNumber(hm[2], 0) : current.getMinutes();\n    return new Date(current.getFullYear(), month - 1, day, hour, minute, 0, 0);\n  }\n\n  const hm_only = source.match(/(\\d{1,2})[:](\\d{1,2})/);\n  if (hm_only) {\n    const hour = asNumber(hm_only[1], current.getHours());\n    const minute = asNumber(hm_only[2], current.getMinutes());\n    return new Date(current.getFullYear(), current.getMonth(), current.getDate(), hour, minute, 0, 0);\n  }\n\n  return undefined;\n}\n\nfunction advanceWorldTimeByAction(stat_data: any, content: string): void {\n  if (!stat_data || typeof stat_data !== 'object') return;\n  const prev_text = String(_.get(stat_data, '.', '')).trim();\n  const prev_date = parseWorldDateTime(prev_text);\n\n  const jump_match = content.match(jump_time_pattern);\n  if (jump_match?.[1]) {\n    const jump_target = parseTimeJumpTarget(jump_match[1], prev_date);\n    if (jump_target) {\n      const next_text = formatUnionDateTime(jump_target);\n      _.set(stat_data, '.', next_text);\n      _.set(stat_data, '..', `${prev_text || formatUnionDateTime(prev_date)} -> ${next_text}`);\n      return;\n    }\n  }\n\n  const delta_minutes = battle_time_pattern.test(content)\n    ? _.random(240, 360)\n    : dialogue_time_pattern.test(content)\n      ? 5\n      : 20;\n\n  const next_date = new Date(prev_date.getTime() + delta_minutes * 60 * 1000);\n  const next_text = formatUnionDateTime(next_date);\n  const reason = battle_time_pattern.test(content)\n    ? `${delta_minutes}`\n    : dialogue_time_pattern.test(content)\n      ? '5'\n      : '20';\n  _.set(stat_data, '.', next_text);\n  _.set(stat_data, '..', `${prev_text || formatUnionDateTime(prev_date)} -> ${next_text}${reason}`);\n}\n\nconst player_background_trigger_pattern = /(||||||||)/;\nconst player_background_strip_pattern = /|||||||||/;\nconst training_keyword_pattern = /|||||||||/;\n\nfunction summarizePlayerBackground(raw: string): string {\n  const text = String(raw ?? '')\n    .replace(/\\r/g, '')\n    .replace(/[ \\t]+/g, ' ')\n    .trim();\n  if (!text) return '';\n\n  const lines = text\n    .split('\\n')\n    .map(v => v.trim())\n    .filter(Boolean)\n    .filter(v => !player_background_strip_pattern.test(v));\n\n  const merged = lines.join(' ');\n  if (!merged) return '';\n  return merged.length > 180 ? `${merged.slice(0, 180)}...` : merged;\n}\n\nfunction applyPlayerBackgroundInput(stat_data: any, content: string): boolean {\n  const source = String(content ?? '').trim();\n  if (!source) return false;\n  if (!player_background_trigger_pattern.test(source)) return false;\n  if (source.length < 24) return false;\n\n  const cleaned = source\n    .replace(/^.*?(||||||||)[:]?\\s*/i, '')\n    .trim();\n  const raw = cleaned || source;\n  const summary = summarizePlayerBackground(raw);\n  if (!summary) return false;\n\n  _.set(stat_data, '..', raw);\n  _.set(stat_data, '..', summary);\n  _.set(stat_data, '..', `${summary}`);\n  return true;\n}\n\nfunction detectTrainingStateFromBackground(stat_data: any): '' | '' {\n  const raw = String(_.get(stat_data, '..', ''));\n  const summary = String(_.get(stat_data, '..', ''));\n  return training_keyword_pattern.test(`${raw}\\n${summary}`) ? '' : '';\n}\n\nfunction ensureStoryGuideState(stat_data: any): void {\n  if (!_.isObjectLike(_.get(stat_data, ''))) _.set(stat_data, '', {});\n  if (!_.isObjectLike(_.get(stat_data, '.'))) _.set(stat_data, '.', {});\n  if (!_.isObjectLike(_.get(stat_data, '.'))) {\n    _.set(stat_data, '.', {\n      : false,\n      : '',\n      : '',\n      : 0,\n      : 0,\n      : false,\n      : false,\n      : false,\n      : '',\n    });\n  } else {\n    _.defaultsDeep(_.get(stat_data, '.'), {\n      : false,\n      : '',\n      : '',\n      : 0,\n      : 0,\n      : false,\n      : false,\n      : false,\n      : '',\n    });\n  }\n\n  const mode_by_card = Boolean(_.get(stat_data, '..', false));\n  _.set(stat_data, '..', mode_by_card || Boolean(_.get(stat_data, '..', false)));\n  _.set(stat_data, '..', detectTrainingStateFromBackground(stat_data));\n}\n\nconst admission_keyword_pattern = /|||||||/;\nconst course_keyword_pattern = /||||||||/;\nconst hilton_keyword_pattern = /||||||/;\n\nfunction progressStoryGuideByContent(stat_data: any, content: string): void {\n  ensureStoryGuideState(stat_data);\n  const guide = _.get(stat_data, '.');\n  if (!guide || !guide.) return;\n\n  const text = String(content ?? '');\n  if (!text.trim()) return;\n  const stage = String(guide. || '');\n\n  if (stage === '') {\n    if (!admission_keyword_pattern.test(text)) return;\n    guide. = _.clamp(asNumber(guide., 0) + 1, 0, 4);\n    guide. = ` ${guide.}/4`;\n    _.set(stat_data, '..', `1/3 ${guide.}/4`);\n    if (guide. >= 4) {\n      guide. = true;\n      guide. = '';\n      guide. = '';\n      _.set(stat_data, '..', '2/3 0/7');\n      _.set(stat_data, '..', '');\n    }\n    return;\n  }\n\n  if (stage === '') {\n    if (!course_keyword_pattern.test(text)) return;\n    guide. = _.clamp(asNumber(guide., 0) + 1, 0, 7);\n    guide. = ` ${guide.}/7`;\n    _.set(stat_data, '..', `2/3 ${guide.}/7`);\n    if (guide. >= 7) {\n      guide. = true;\n      guide. = '';\n      guide. = '';\n      _.set(stat_data, '..', '3/3 ');\n      _.set(stat_data, '..', '');\n    }\n    return;\n  }\n\n  if (stage === '') {\n    if (!hilton_keyword_pattern.test(text)) return;\n    guide. = true;\n    guide. = '';\n    guide. = '';\n    _.set(stat_data, '..', '');\n  }\n}\n\nfunction buildOutcomePrompt(outcome: SkillOutcome, game_over: boolean): string {\n  const lines = [\n    '[-]',\n    `: ${outcome.action_tag}`,\n    `: ${outcome.attr}`,\n    `: D10(${outcome.raw}) + (${outcome.bonus}) - (${outcome.difficulty_penalty}) = ${outcome.total}`,\n    `: ${outcome.difficulty_label}`,\n    `: ${outcome.result}`,\n    `: ${outcome.desc}`,\n    ': ',\n  ];\n  if (game_over) {\n    lines.push(': /');\n  }\n  return lines.join('\\n');\n}\n\nfunction toShortText(value: unknown, fallback = '-'): string {\n  const text = String(value ?? '').trim();\n  return text || fallback;\n}\n\nfunction toInt(value: unknown, fallback = 0): number {\n  return Math.trunc(asNumber(value, fallback));\n}\n\nfunction normalizeProfession(raw: unknown, path_raw: unknown): '' | '' | '' {\n  const profession = String(raw ?? '').trim();\n  if (profession === '' || profession === '' || profession === '') return profession;\n  const path = String(path_raw ?? '').trim();\n  if (path.includes('')) return '';\n  if (path.includes('')) return '';\n  return '';\n}\n\nfunction pickNonEmpty(...values: unknown[]): string {\n  for (const v of values) {\n    const s = String(v ?? '').trim();\n    if (s) return s;\n  }\n  return '';\n}\n\nfunction isPlaceholderName(value: unknown): boolean {\n  const text = String(value ?? '').trim();\n  return !text || ['', '', '', ''].includes(text);\n}\n\nfunction pickFirstValid(values: unknown[], invalid: (value: unknown) => boolean): string {\n  for (const value of values) {\n    const text = String(value ?? '').trim();\n    if (!text) continue;\n    if (invalid(value)) continue;\n    return text;\n  }\n  return '';\n}\n\nfunction enforcePlayerIdentity(stat_data: any, ...fallback_stats: any[]): void {\n  if (!_.isObjectLike(stat_data)) return;\n  if (!_.isObjectLike(_.get(stat_data, ''))) _.set(stat_data, '', {});\n  if (!_.isObjectLike(_.get(stat_data, '.'))) _.set(stat_data, '.', {});\n  if (!_.isObjectLike(_.get(stat_data, ''))) _.set(stat_data, '', {});\n  if (!_.isObjectLike(_.get(stat_data, '.'))) _.set(stat_data, '.', {});\n\n  const fallbacks = fallback_stats.filter(v => _.isObjectLike(v));\n  const build_started = Boolean(_.get(stat_data, '..', false))\n    || fallbacks.some(fb => Boolean(_.get(fb, '..', false)));\n  _.set(stat_data, '..', build_started);\n\n  if (!build_started) {\n    // AI\n    if (isPlaceholderName(_.get(stat_data, '..'))) _.set(stat_data, '..', '');\n    if (!String(_.get(stat_data, '..', '')).trim()) _.set(stat_data, '..', '');\n    if (!String(_.get(stat_data, '..', '')).trim()) _.set(stat_data, '..', '');\n    return;\n  }\n\n  const profession = normalizeProfession(\n    pickNonEmpty(\n      _.get(stat_data, '..'),\n      ...fallbacks.map(fb => _.get(fb, '..')),\n    ),\n    pickNonEmpty(\n      _.get(stat_data, '..'),\n      ...fallbacks.map(fb => _.get(fb, '..')),\n    ),\n  );\n\n  const warmaid_type = pickNonEmpty(\n    _.get(stat_data, '..'),\n    ...fallbacks.map(fb => _.get(fb, '..')),\n    String(_.get(stat_data, '..', '')).replace(/^-/, ''),\n    ...fallbacks.map(fb => String(_.get(fb, '..', '')).replace(/^-/, '')),\n    '',\n  );\n\n  const name = pickFirstValid([\n    _.get(stat_data, '..'),\n    _.get(stat_data, '..'),\n    ...fallbacks.map(fb => _.get(fb, '..')),\n    ...fallbacks.map(fb => _.get(fb, '..')),\n  ], isPlaceholderName) || '';\n\n  const gender = profession === ''\n    ? ''\n    : pickFirstValid([\n      _.get(stat_data, '..'),\n      _.get(stat_data, '..'),\n      ...fallbacks.map(fb => _.get(fb, '..')),\n      ...fallbacks.map(fb => _.get(fb, '..')),\n    ], v => !['', ''].includes(String(v ?? '').trim())) || '';\n\n  const age_raw = asNumber(\n    pickNonEmpty(\n      _.get(stat_data, '..'),\n      ...fallbacks.map(fb => _.get(fb, '..')),\n      21,\n    ),\n    21,\n  );\n  const age = _.clamp(age_raw, 12, 80);\n\n  _.set(stat_data, '..', profession);\n  _.set(stat_data, '..', warmaid_type);\n  _.set(stat_data, '..', name);\n  _.set(stat_data, '..', gender);\n  _.set(stat_data, '..', age);\n\n  _.set(stat_data, '..', name);\n  _.set(stat_data, '..', gender);\n  _.set(stat_data, '..', profession === '' ? `-${warmaid_type}` : profession);\n}\n\nfunction pickTailEntries(source: unknown, keep = 2): Array<[string, string]> {\n  if (!_.isObjectLike(source)) return [];\n  return Object.entries(source as Record<string, unknown>)\n    .slice(-keep)\n    .map(([k, v]) => [k, toShortText(v)]);\n}\n\nfunction buildMvuSummaryPrompt(chat_data: any): string {\n  const stat = _.isObjectLike(chat_data?.stat_data) ? chat_data.stat_data : {};\n  const build_started = Boolean(_.get(stat, '..', false));\n\n  const world_time = toShortText(_.get(stat, '.', _.get(stat, '.')));\n  const world_place = toShortText(_.get(stat, '.', _.get(stat, '.')));\n  const world_weather = toShortText(_.get(stat, '.'));\n  const world_threat = toShortText(_.get(stat, '.', ''));\n\n  const name = build_started\n    ? toShortText(_.get(stat, '..', _.get(stat, '..')))\n    : '';\n  const profession = build_started ? toShortText(_.get(stat, '..')) : '';\n  const path = build_started ? toShortText(_.get(stat, '..')) : '';\n  const gender = build_started\n    ? toShortText(_.get(stat, '..', _.get(stat, '..', '')))\n    : '';\n  const age = build_started ? toInt(_.get(stat, '..', 0), 0) : 0;\n\n  const hp = toInt(_.get(stat, '..', 0), 0);\n  const hp_max = toInt(_.get(stat, '..', _.get(stat, '..', hp)), hp);\n  const mp = toInt(_.get(stat, '..', 0), 0);\n  const mp_max = toInt(_.get(stat, '..', _.get(stat, '..', mp)), mp);\n  const action_point = toInt(_.get(stat, '..', 1), 1);\n  const move_point = toInt(_.get(stat, '..', 1), 1);\n  const slot_now = toInt(_.get(stat, '..', 0), 0);\n  const slot_max = toInt(_.get(stat, '..', slot_now), slot_now);\n  const corruption = toInt(_.get(stat, '..', 0), 0);\n\n  const in_battle = Boolean(_.get(stat, '..', false));\n  const mode = toShortText(_.get(stat, '..', ''));\n  const line = toShortText(_.get(stat, '..', ''));\n  const round = toInt(_.get(stat, '..', 1), 1);\n  const air_sup = toShortText(_.get(stat, '..', ''));\n  const fire_penalty = toShortText(_.get(stat, '..', ''));\n\n  const warmaid_lv = toInt(_.get(stat, '..', 0), 0);\n  const authority_lv = toInt(_.get(stat, '..', 0), 0);\n  const magic_shard = toInt(_.get(stat, '..', 0), 0);\n  const next_magic_shard = toInt(_.get(stat, '..', 0), 0);\n  const authority_shard = toInt(_.get(stat, '..', 0), 0);\n  const has_origin = Boolean(_.get(stat, '..', false));\n\n  const skill_desc = toShortText(_.get(stat, '..', ''));\n  const skill_updated = toInt(_.get(stat, '..', 0), 0) > 0;\n  const no_skill_yet = !skill_updated || /||/.test(skill_desc);\n  const skill_result = no_skill_yet ? '' : toShortText(_.get(stat, '..', ''));\n  const skill_attr = no_skill_yet ? '' : toShortText(_.get(stat, '..', ''));\n  const skill_total = no_skill_yet ? 0 : toInt(_.get(stat, '..', 0), 0);\n  const bg_summary = toShortText(_.get(stat, '..', ''), '');\n  const plot_mode = Boolean(_.get(stat, '..', _.get(stat, '..', false)));\n  const training_state = toShortText(_.get(stat, '..', ''));\n  const guide_stage = toShortText(_.get(stat, '..', ''));\n  const admission_progress = toInt(_.get(stat, '..', 0), 0);\n  const course_progress = toInt(_.get(stat, '..', 0), 0);\n  const guide_note = toShortText(_.get(stat, '..', ''), '');\n\n  const recent_affairs = pickTailEntries(_.get(stat, '.', {}), 2);\n  const recent_logs = pickTailEntries(_.get(stat, '', {}), 2);\n\n  const lines = [\n    '[MVU-]',\n    `: =${world_time} | =${world_place} | =${world_weather} | =${world_threat}`,\n    `: =${name} | =${gender} | =${age} | =${profession} | =${path}`,\n    `: HP=${hp}/${hp_max} | MP=${mp}/${mp_max} | AP=${action_point} | Move=${move_point} | =${slot_now}/${slot_max} | =${corruption}`,\n    `: =${in_battle ? '' : ''} | =${mode} | =${line} | =${round} | =${air_sup} | =${fire_penalty}`,\n    `: =${warmaid_lv} | =${authority_lv} | =${magic_shard}(${next_magic_shard}) | =${authority_shard} | =${has_origin ? '' : ''}`,\n    `: =${skill_result} | =${skill_attr} | =${skill_total}`,\n  ];\n  if (bg_summary) {\n    lines.push(`: ${bg_summary}`);\n  }\n  if (plot_mode) {\n    lines.push(`:  | =${training_state} | =${guide_stage}`);\n    lines.push(`: =${admission_progress}/4 | =${course_progress}/7`);\n    if (guide_note) lines.push(`: ${guide_note}`);\n    lines.push(': ');\n    if (guide_stage === '') {\n      lines.push('');\n    } else if (guide_stage === '') {\n      lines.push('//');\n    } else if (guide_stage === '') {\n      lines.push('');\n    }\n  } else {\n    lines.push(': ');\n  }\n\n  if (recent_affairs.length > 0) {\n    lines.push(`: ${recent_affairs.map(([k, v]) => `${k}:${v}`).join('')}`);\n  }\n  if (recent_logs.length > 0) {\n    lines.push(`: ${recent_logs.map(([k, v]) => `${k}:${v}`).join('')}`);\n  }\n\n  lines.push(': ');\n  if (build_started) {\n    lines.push(': //');\n  } else {\n    lines.push(': /');\n  }\n  lines.push(': //');\n  lines.push(': ');\n  lines.push(':  <OnStageCharacters>JSON');\n  lines.push(': /');\n  lines.push(': ');\n  lines.push(': =');\n  lines.push(': ');\n  lines.push('JSON: (string), (-200~1000), (string), (string), (object<number>)');\n  lines.push(': <NpcRelationHints>JSON</NpcRelationHints>: (string), (string[])');\n  return lines.join('\\n');\n}\n\nfunction trySendActionToChatInput(action: string): boolean {\n  const text = String(action ?? '').trim();\n  if (!text) return false;\n\n  const textarea_selectors = [\n    '#send_textarea',\n    'textarea#send_textarea',\n    'textarea[id*=\"send\"]',\n    'textarea',\n  ];\n  const send_btn_selectors = [\n    '#send_but',\n    'button#send_but',\n    '#send-button',\n    'button[type=\"submit\"]',\n  ];\n\n  let input_el: HTMLTextAreaElement | null = null;\n  for (const sel of textarea_selectors) {\n    const el = document.querySelector(sel);\n    if (el instanceof HTMLTextAreaElement) {\n      input_el = el;\n      break;\n    }\n  }\n  if (!input_el) return false;\n\n  input_el.value = text;\n  input_el.dispatchEvent(new Event('input', { bubbles: true }));\n  input_el.dispatchEvent(new Event('change', { bubbles: true }));\n\n  for (const sel of send_btn_selectors) {\n    const btn = document.querySelector(sel);\n    if (btn instanceof HTMLElement) {\n      btn.click();\n      return true;\n    }\n  }\n  return false;\n}\n\n$(() => {\n  errorCatched(async () => {\n    const global_key = '__apocalypse_dawn_variable_bridge_installed__';\n    if ((window as any)[global_key]) return;\n    (window as any)[global_key] = true;\n\n    installHideOriginalReplyStyle();\n    registerMvuSchema(Schema);\n    await waitGlobalInitialized('Mvu');\n\n    const syncing_message_ids = new Set<number>();\n    const synced_message_content = new Map<number, string>();\n      const pending_skill_by_user_message = new Map<number, PendingSkillState>();\n    const processed_user_messages = new Set<number>();\n\n    //  iframe  postMessage \n    window.addEventListener('message', evt => {\n      const payload = evt.data;\n      if (!_.isObjectLike(payload)) return;\n      if ((payload as any).type !== 'apocalypse-dawn:send_action') return;\n      if ((payload as any).source !== 'apocalypse_dawn_mvu') return;\n      const action = String((payload as any).action ?? '').trim();\n      if (!action) return;\n      const sent = trySendActionToChatInput(action);\n      if (!sent) {\n        console.warn('[][] ');\n      }\n    });\n\n    async function processUserAction(message_id: number): Promise<void> {\n      if (processed_user_messages.has(message_id)) return;\n      const user_message = getChatMessages(message_id, { include_swipes: false })[0];\n      if (!user_message || user_message.role !== 'user' || user_message.is_hidden) return;\n\n      const source_content = String(user_message.message ?? '').trim();\n      if (!source_content) return;\n\n      const assistant_before = getChatMessages(`0-${Math.max(0, message_id - 1)}`, {\n        role: 'assistant',\n        include_swipes: false,\n      });\n      const anchor_assistant = assistant_before.length > 0 ? assistant_before[assistant_before.length - 1] : undefined;\n      const source_data = anchor_assistant\n        ? Mvu.getMvuData({ type: 'message', message_id: anchor_assistant.message_id })\n        : Mvu.getMvuData({ type: 'chat' });\n      const chat_fallback_data = Mvu.getMvuData({ type: 'chat' });\n      const next_data = _.cloneDeep(source_data ?? {});\n      next_data.stat_data = _.isObjectLike(next_data?.stat_data) ? _.cloneDeep(next_data.stat_data) : {};\n      ensureAirCombatData(next_data.stat_data);\n      ensureNpcData(next_data.stat_data);\n      ensureStoryGuideState(next_data.stat_data);\n      resetNpcStateBeforeCreate(next_data.stat_data);\n      enforcePlayerIdentity(next_data.stat_data, _.get(chat_fallback_data, 'stat_data'));\n      normalizeGameOverState(next_data.stat_data);\n      const build_started = Boolean(_.get(next_data.stat_data, '..', false));\n      if (!build_started) {\n        processed_user_messages.add(message_id);\n        return;\n      }\n      applyPlayerBackgroundInput(next_data.stat_data, source_content);\n      ensureStoryGuideState(next_data.stat_data);\n      enforcePlayerIdentity(next_data.stat_data, _.get(chat_fallback_data, 'stat_data'));\n      progressStoryGuideByContent(next_data.stat_data, source_content);\n      advanceWorldTimeByAction(next_data.stat_data, source_content);\n      const user_npc_request_hit = applyUserNpcRequest(next_data.stat_data, source_content);\n\n      applyBattleSystemConstraints(next_data.stat_data, source_content);\n      patchGameplayState(next_data.stat_data, source_content);\n      applyDungeonLootSystem(next_data.stat_data, source_content);\n      applyBlackMarketTrade(next_data.stat_data, source_content);\n      applyVivianaArc(next_data.stat_data);\n      applyNpcPersonaConsistency(next_data.stat_data);\n      applyHumanTraining(next_data.stat_data, source_content);\n      reconcileGrowthLevel(next_data.stat_data);\n      enforcePlayerIdentity(next_data.stat_data, _.get(chat_fallback_data, 'stat_data'));\n      normalizeGameOverState(next_data.stat_data);\n      const stat_changed = !_.isEqual(\n        _.get(next_data, 'stat_data'),\n        _.get(source_data, 'stat_data', {}),\n      );\n      const battle_started = startAirBattleIfTriggered(next_data.stat_data, source_content);\n      const battle_resolved = resolveAirCombatRound(next_data.stat_data, source_content);\n      const in_air_battle = Boolean(_.get(next_data.stat_data, '..', false))\n        && _.get(next_data.stat_data, '..', '') === '';\n\n      if (battle_started || battle_resolved || in_air_battle) {\n        processed_user_messages.add(message_id);\n        trimBattleLogs(next_data.stat_data, 3);\n        await Mvu.replaceMvuData(next_data, { type: 'chat' });\n        if (anchor_assistant) {\n          await Mvu.replaceMvuData(next_data, { type: 'message', message_id: anchor_assistant.message_id });\n        }\n        console.info(`[][]  ${message_id}`);\n        return;\n      }\n\n      const outcome = applySkillCheckSystem(next_data.stat_data, source_content);\n      if (!outcome) {\n        processed_user_messages.add(message_id);\n        if (user_npc_request_hit || stat_changed) {\n          trimBattleLogs(next_data.stat_data, 3);\n          await Mvu.replaceMvuData(next_data, { type: 'chat' });\n          if (anchor_assistant) {\n            await Mvu.replaceMvuData(next_data, { type: 'message', message_id: anchor_assistant.message_id });\n          }\n        }\n        return;\n      }\n      processed_user_messages.add(message_id);\n\n      const game_over = enforceGameOver(\n        next_data.stat_data,\n        `${outcome.action_tag} / ${outcome.result}`,\n      );\n      const feedback_prompt = buildOutcomePrompt(outcome, game_over);\n      injectPrompts(\n        [{\n          id: `apocalypse-dawn-skill-feedback-pre-${message_id}-${Date.now()}`,\n          position: 'in_chat',\n          depth: 0,\n          role: 'system',\n          content: feedback_prompt,\n          should_scan: true,\n        }],\n        { once: true },\n      );\n      pending_skill_by_user_message.set(message_id, {\n        user_message_id: message_id,\n        source_content,\n        outcome,\n        feedback_prompt,\n        injected: true,\n        game_over,\n      });\n      trimBattleLogs(next_data.stat_data, 3);\n\n      await Mvu.replaceMvuData(next_data, { type: 'chat' });\n      if (anchor_assistant) {\n        await Mvu.replaceMvuData(next_data, { type: 'message', message_id: anchor_assistant.message_id });\n      }\n      console.info(`[][]  ${message_id}`);\n    }\n\n    function injectMvuSummaryForUserMessage(user_message_id: number): void {\n      const chat_data = Mvu.getMvuData({ type: 'chat' });\n      const mvu_summary_prompt = buildMvuSummaryPrompt(chat_data);\n      injectPrompts(\n        [{\n          id: `apocalypse-dawn-mvu-summary-${user_message_id}-${Date.now()}`,\n          position: 'in_chat',\n          depth: 0,\n          role: 'system',\n          content: mvu_summary_prompt,\n          should_scan: true,\n        }],\n        { once: true },\n      );\n    }\n\n    async function syncMessageToMvu(message_id: number): Promise<void> {\n      if (syncing_message_ids.has(message_id)) return;\n\n      const message = getChatMessages(message_id, { include_swipes: false })[0];\n      if (!message || message.role !== 'assistant' || message.is_hidden) return;\n\n      const content = message.message?.trim() ?? '';\n      if (!content) return;\n      if (synced_message_content.get(message_id) === content) return;\n\n      syncing_message_ids.add(message_id);\n      try {\n        const old_data = Mvu.getMvuData({ type: 'message', message_id });\n        const new_data = await Mvu.parseMessage(content, old_data);\n\n        if (!new_data.stat_data || typeof new_data.stat_data !== 'object') {\n          new_data.stat_data = {};\n        }\n        // \n        if (!hasExplicitUpdateTag(content)) {\n          lockCriticalStateWithoutTag(new_data.stat_data, old_data?.stat_data);\n        }\n        ensureAirCombatData(new_data.stat_data);\n        ensureNpcData(new_data.stat_data);\n        ensureStoryGuideState(new_data.stat_data);\n        resetNpcStateBeforeCreate(new_data.stat_data);\n        const chat_snapshot = Mvu.getMvuData({ type: 'chat' });\n        enforcePlayerIdentity(new_data.stat_data, _.get(chat_snapshot, 'stat_data'), _.get(old_data, 'stat_data'));\n        normalizeGameOverState(new_data.stat_data);\n        if (!new_data.stat_data. || typeof new_data.stat_data. !== 'object') {\n          new_data.stat_data. = {};\n        }\n        const parsed_onstage = parseOnStageCharacters(content);\n        const old_onstage = Array.isArray(_.get(new_data.stat_data, '.')) ? _.get(new_data.stat_data, '.') : [];\n        const inferred_onstage = inferOnStageCharactersFromText(content, {\n          exclude_names: [\n            String(_.get(new_data.stat_data, '..', '')),\n            String(_.get(new_data.stat_data, '..', '')),\n          ].filter(Boolean),\n          old_onstage,\n        });\n        const relation_hints = parseNpcRelationHints(content);\n        const incoming_onstage = [...(parsed_onstage ?? []), ...inferred_onstage];\n        const name_excluded = new Set<string>([\n          String(_.get(new_data.stat_data, '..', '')),\n          String(_.get(new_data.stat_data, '..', '')),\n        ].filter(Boolean));\n\n        if (incoming_onstage.length > 0) {\n          const merged = mergeOnStageCharacters(old_onstage, incoming_onstage);\n          new_data.stat_data.. = sanitizeOnStageCharacters(merged, name_excluded);\n          _.set(\n            new_data.stat_data,\n            '..',\n            `AI${_.uniq(incoming_onstage.map(v => v.)).join('')}`,\n          );\n        } else {\n          const current = Array.isArray(_.get(new_data.stat_data, '.')) ? _.get(new_data.stat_data, '.') : [];\n          new_data.stat_data.. = sanitizeOnStageCharacters(current, name_excluded);\n        }\n        refreshOnStageThoughtsByAiText(new_data.stat_data, content);\n\n        const previous_message = getChatMessages(message_id - 1, { include_swipes: false })[0];\n        const user_context = previous_message && previous_message.role === 'user' ? String(previous_message.message ?? '') : '';\n        const trigger_context = `${user_context}\\n${content}`;\n        const pending_skill = previous_message && previous_message.role === 'user'\n          ? pending_skill_by_user_message.get(previous_message.message_id)\n          : undefined;\n\n        applyBattleSystemConstraints(new_data.stat_data, trigger_context);\n        patchGameplayState(new_data.stat_data, trigger_context);\n        applyDungeonLootSystem(new_data.stat_data, content);\n        applyBlackMarketTrade(new_data.stat_data, user_context);\n        applyHumanTraining(new_data.stat_data, trigger_context);\n        reconcileGrowthLevel(new_data.stat_data);\n        startAirBattleIfTriggered(new_data.stat_data, trigger_context);\n        if (pending_skill) {\n          applyResolvedSkillOutcome(new_data.stat_data, pending_skill.source_content, pending_skill.outcome);\n          if (pending_skill.game_over) {\n            enforceGameOver(\n              new_data.stat_data,\n              `${pending_skill.outcome.action_tag} / ${pending_skill.outcome.result}`,\n            );\n          }\n          pending_skill_by_user_message.delete(previous_message.message_id);\n        }\n        enforceGameOver(new_data.stat_data, '');\n        normalizeGameOverState(new_data.stat_data);\n        applyNpcLongTermRules(new_data.stat_data, content, user_context, incoming_onstage, relation_hints);\n        applyVivianaArc(new_data.stat_data);\n        applyNpcPersonaConsistency(new_data.stat_data);\n\n        new_data.stat_data.. = {\n          : extractDisplayText(content),\n          : content,\n          : Date.now(),\n        };\n        enforcePlayerIdentity(new_data.stat_data, _.get(chat_snapshot, 'stat_data'), _.get(old_data, 'stat_data'));\n        normalizeGameOverState(new_data.stat_data);\n        trimBattleLogs(new_data.stat_data, 3);\n\n        await Mvu.replaceMvuData(new_data, { type: 'chat' });\n        await Mvu.replaceMvuData(new_data, { type: 'message', message_id });\n        synced_message_content.set(message_id, content);\n        console.info(`[][MVU]  ${message_id}`);\n      } catch (error) {\n        console.warn(`[][MVU]  ${message_id} `, error);\n      } finally {\n        syncing_message_ids.delete(message_id);\n      }\n    }\n\n    eventOn(tavern_events.MESSAGE_RECEIVED, message_id => {\n      void syncMessageToMvu(message_id);\n    });\n\n    eventOn(tavern_events.MESSAGE_UPDATED, message_id => {\n      void syncMessageToMvu(message_id);\n    });\n\n    eventOn(tavern_events.MESSAGE_SENT, message_id => {\n      void processUserAction(message_id);\n      // MVU/ after_commands \n      injectMvuSummaryForUserMessage(message_id);\n    });\n\n    eventOn(tavern_events.GENERATION_AFTER_COMMANDS, () => {\n      const latest_user = getChatMessages(-1, { role: 'user', include_swipes: false })[0];\n      if (!latest_user || latest_user.role !== 'user') return;\n      injectMvuSummaryForUserMessage(latest_user.message_id);\n\n      const chat_data = Mvu.getMvuData({ type: 'chat' });\n\n      const pending = pending_skill_by_user_message.get(latest_user.message_id);\n      if (pending && !pending.injected) {\n        injectPrompts(\n          [{\n            id: `apocalypse-dawn-skill-feedback-${latest_user.message_id}-${Date.now()}`,\n            position: 'in_chat',\n            depth: 0,\n            role: 'system',\n            content: pending.feedback_prompt,\n            should_scan: true,\n          }],\n          { once: true },\n        );\n        pending.injected = true;\n        return;\n      }\n\n      const air_pending = Boolean(_.get(chat_data, 'stat_data...', false));\n      const air_summary = String(_.get(chat_data, 'stat_data...', '')).trim();\n      if (air_pending && air_summary) {\n        injectPrompts(\n          [{\n            id: `apocalypse-dawn-airbattle-${Date.now()}`,\n            position: 'in_chat',\n            depth: 0,\n            role: 'system',\n            content: `[-]\\n${air_summary}\\n`,\n            should_scan: true,\n          }],\n          { once: true },\n        );\n        const next_chat_data = _.cloneDeep(chat_data ?? {});\n        if (!_.isObjectLike(next_chat_data.stat_data)) next_chat_data.stat_data = {};\n        if (!_.isObjectLike(next_chat_data.stat_data.)) next_chat_data.stat_data. = {};\n        next_chat_data.stat_data.. = {\n          : false,\n          : air_summary,\n          : Date.now(),\n        };\n        void Mvu.replaceMvuData(next_chat_data, { type: 'chat' });\n      }\n      const ended = Boolean(_.get(chat_data, 'stat_data...', false));\n      const hp_now = asNumber(_.get(chat_data, 'stat_data...', 1), 1);\n      if (ended && hp_now <= 0) {\n        injectPrompts(\n          [{\n            id: `apocalypse-dawn-gameover-${Date.now()}`,\n            position: 'in_chat',\n            depth: 0,\n            role: 'system',\n            content: '/',\n            should_scan: true,\n          }],\n          { once: true },\n        );\n      }\n    });\n\n    eventOn(tavern_events.CHAT_CHANGED, () => {\n      syncing_message_ids.clear();\n      synced_message_content.clear();\n      pending_skill_by_user_message.clear();\n\n      const latest = getChatMessages(-1, { include_swipes: false })[0];\n      if (latest && latest.role === 'assistant') {\n        void syncMessageToMvu(latest.message_id);\n      }\n    });\n\n    const latest = getChatMessages(-1, { include_swipes: false })[0];\n    if (latest && latest.role === 'assistant') {\n      void syncMessageToMvu(latest.message_id);\n    }\n\n    // /assistant\n    const fallback_poll_timer = window.setInterval(() => {\n      const latest_message = getChatMessages(-1, { include_swipes: false })[0];\n      if (!latest_message || latest_message.role !== 'assistant' || latest_message.is_hidden) return;\n      void syncMessageToMvu(latest_message.message_id);\n    }, 1500);\n    //  MESSAGE_SENT //\n    const user_action_poll_timer = window.setInterval(() => {\n      const latest_user = getChatMessages(-1, { role: 'user', include_swipes: false })[0];\n      if (!latest_user || latest_user.role !== 'user' || latest_user.is_hidden) return;\n      if (processed_user_messages.has(latest_user.message_id)) return;\n      void processUserAction(latest_user.message_id);\n      injectMvuSummaryForUserMessage(latest_user.message_id);\n    }, 1200);\n    window.addEventListener(\n      'beforeunload',\n      () => {\n        window.clearInterval(fallback_poll_timer);\n        window.clearInterval(user_action_poll_timer);\n      },\n      { once: true },\n    );\n  })();\n});\n"],"names":["z","Schema","object","boolean","prefault","string","enum","coerce","number","transform","v","_","clamp","array","record","describe","asNumber","value","fallback","numeric","Number","isFinite","rollD6","Math","floor","random","warmaid_rank_steps","name","need","reconcileGrowthLevel","stat_data","profession","String","get","is_warmaid","includes","is_authority","level","length","shards","max","set","shard","has_origin","Boolean","trimBattleLogs","keep","logs","isObjectLike","entries","Object","fromEntries","slice","ensureAirCombatData","air","defaultsDeep","battle_activate_pattern","battle_action_pattern","battle_end_pattern","battle_hostile_pattern","explicit_battle_open_pattern","isBattleTriggerContent","content","text","trim","test","startAirBattleIfTriggered","threat","enemy_hp","source","ambush","Date","now","resolveAirCombatRound","self_hp","weather_mod","trunc","sup_mod","weapon_lv","weapons","first","values","getWeaponLevel","heavy_condition","need_assist","has_assist","self_near_miss_stack","enemy_near_miss_stack","enemy_dodge","self_dodge","full_auto","calcSingleShot","hit_bonus","dodge_value","base_damage_mult","diff","base_damage","damage","rollD10","note","near_miss","invalid","dealt","self_hit_note","hit_bonus_base","first_shot","shot_index","expected_next_bonus","shot","enemy_hit","enemy_diff","taken","round_summary","summary","end_reason","map","k","join","buildAirBattleSummary","extractDisplayText","replace","content_match","match","npc_name_stop_words","Set","npc_name_bad_prefix","npc_name_bad_contains","isLikelyNpcName","excluded","has","sanitizeOnStageCharacters","list","filter","extractNameContext","hit","split","find","inferAttitudeByContext","context","t","inferOnStageCharactersFromText","options","exclude_names","old_map","Map","old_onstage","score","pushScore","raw_name","delta","m","matchAll","keys","result","s","old","push","clampAffection","cloneDeep","ensureNpcData","Array","isArray","defaults","resetNpcStateBeforeCreate","calcAffectionStage","is_partner","detectMentionedNames","names","mentions","add","getTracker","key","upsertLongTermNpc","payload","existing","base","next_affection","current_affection","merged_affection","min","next","promoteToLongTermByName","reason","onstage","npc","uniq","npc_follow_pattern","npc_partner_ai_pattern","npc_partner_user_confirm_pattern","npc_sex_pattern","applyVivianaArc","current_place","in_library","long_map","remove","attitude","thought","idx","findIndex","buildPersonaInnerThought","clean_fallback","raw","sanitizeThoughtText","applyNpcPersonaConsistency","all_names","long_key","long_npc","tags","persona","dungeon_enter_pattern","dungeon_leave_pattern","dungeon_move_pattern","dungeon_search_pattern","dungeon_blow_pattern","lab_room_pool","tier_value_range","tier_affix_count","affix_pool","trade_only_items","black_market_trade_pattern","black_market_buy_pattern","rollRoomTypeByLuck","luck","shift","good_weight","normal_weight","risky_weight","total","r","buildRoomContainer","room_type","pickLootQuality","is_advanced","roll","addWarehouseItem","item_name","quality","count","category","desc","tradeable","old_count","old_tags","curr","generateLootFromContainer","container_type","slot_override","slots","loot","pools","i","sample","is_trade_only","vmin","vmax","sampleSize","mergeLootRecord","target","incoming","item","applyDungeonLootSystem","parseLabLevel","scale","parseMapScale","rooms","room_name","generateDungeonMap","room","merged_loot","is_blow","undefined","normal_count","advanced_count","applyBlackMarketTrade","items","targets","qty_match","RegExp","escapeRegExp","sell_qty","own_qty","use_qty","income","left","unset","want_tier","price","money","toString","patchGameplayState","current_round","line","manual_toggle","battle_by_state","battle_by_text","in_battle","was_enabled","should_enable","last_round","round_delta","magic_cost","slot_cost","current_magic","current_slot","next_magic","next_slot","applyBattleSystemConstraints","mode_by_text","in_battle_by_state","in_battle_by_text","mode","warmaid_type","getWarmaidType","is_commander","ap","mp","penalty","agi","move_counter","weather_hit","superiority","airflow_penalty","applyHumanTraining","keyword_map","forEach","attr","current_attr","current_train","next_train","low_impact_no_check_pattern","high_consequence_pattern","contested_action_pattern","explicit_check_pattern","avoid_risk_intent_pattern","resolveSkillOutcome","raw_override","inferred_attr","pattern","inferSkillAttr","should_check","avoid_intent","shouldRequireSkillCheck","action_tag","tag","inferActionTag","lock_action","lock_until","bonus","difficulty_penalty","difficulty_label","lock_to_round","hp_loss","mp_loss","difficulty","hard","label","inferDifficulty","consequence","inferConsequenceLevel","applyResolvedSkillOutcome","outcome","lock_rounds","applySkillCheckSystem","hasRiskButNoAvoidIntent","tip","enforceGameOver","normalizeGameOverState","battle_time_pattern","dialogue_time_pattern","jump_time_pattern","formatUnionDateTime","date","getFullYear","getMonth","getDate","getHours","padStart","getMinutes","advanceWorldTimeByAction","prev_text","prev_date","union_match","year","month","day","hour","minute","iso_like","parseWorldDateTime","jump_match","jump_target","current","full_match","day_only_match","hm","hm_only","parseTimeJumpTarget","next_text","delta_minutes","getTime","player_background_trigger_pattern","player_background_strip_pattern","training_keyword_pattern","applyPlayerBackgroundInput","merged","summarizePlayerBackground","ensureStoryGuideState","mode_by_card","detectTrainingStateFromBackground","admission_keyword_pattern","course_keyword_pattern","hilton_keyword_pattern","toShortText","toInt","pickNonEmpty","isPlaceholderName","pickFirstValid","enforcePlayerIdentity","fallback_stats","fallbacks","build_started","some","fb","path_raw","path","normalizeProfession","gender","age_raw","age","pickTailEntries","$","errorCatched","async","global_key","window","host_document","parent","document","style_id","getElementById","style","createElement","id","textContent","head","appendChild","installHideOriginalReplyStyle","waitGlobalInitialized","syncing_message_ids","synced_message_content","pending_skill_by_user_message","processed_user_messages","processUserAction","message_id","user_message","getChatMessages","include_swipes","role","is_hidden","source_content","message","assistant_before","anchor_assistant","source_data","Mvu","getMvuData","type","chat_fallback_data","next_data","guide","stage","progressStoryGuideByContent","user_npc_request_hit","user_content","mentioned","tracker","applyUserNpcRequest","stat_changed","isEqual","battle_started","battle_resolved","in_air_battle","replaceMvuData","console","info","game_over","feedback_prompt","lines","buildOutcomePrompt","injectPrompts","position","depth","should_scan","once","user_message_id","injected","injectMvuSummaryForUserMessage","mvu_summary_prompt","chat_data","stat","world_time","world_place","world_weather","world_threat","hp","hp_max","mp_max","action_point","move_point","slot_now","slot_max","corruption","round","air_sup","fire_penalty","warmaid_lv","authority_lv","magic_shard","next_magic_shard","authority_shard","skill_desc","no_skill_yet","skill_result","skill_attr","skill_total","bg_summary","plot_mode","training_state","guide_stage","admission_progress","course_progress","guide_note","recent_affairs","recent_logs","buildMvuSummaryPrompt","syncMessageToMvu","old_data","new_data","parseMessage","hasExplicitUpdateTag","new_stat","old_stat","critical_paths","p","old_val","lockCriticalStateWithoutTag","chat_snapshot","parsed_onstage","parsed","JSON","parse","attrs","normalized_attrs","parseOnStageCharacters","inferred_onstage","relation_hints","parseNpcRelationHints","incoming_onstage","name_excluded","old_list","merged_map","prev","requested","mergeOnStageCharacters","ai_content","char","refreshOnStageThoughtsByAiText","previous_message","user_context","trigger_context","pending_skill","delete","hints","onstage_list","name_pool","structured_names","text_mentions","appeared","hint","ai_has_partner_signal","user_confirm","current_tags","applyNpcLongTermRules","error","warn","addEventListener","evt","data","action","sent","textarea_selectors","send_btn_selectors","input_el","sel","el","querySelector","HTMLTextAreaElement","dispatchEvent","Event","bubbles","btn","HTMLElement","click","trySendActionToChatInput","eventOn","tavern_events","MESSAGE_RECEIVED","MESSAGE_UPDATED","MESSAGE_SENT","GENERATION_AFTER_COMMANDS","latest_user","pending","air_pending","air_summary","next_chat_data","ended","hp_now","CHAT_CHANGED","clear","latest","fallback_poll_timer","setInterval","latest_message","user_action_poll_timer","clearInterval"],"sourceRoot":""}