{"version":3,"file":"index.js","mappings":"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","sources":["src://tavern_helper_template/external var \"z\"","src://tavern_helper_template/src//schema.ts","src://tavern_helper_template/src////index.ts"],"sourcesContent":["const __WEBPACK_NAMESPACE_OBJECT__ = z;","export const Schema = z\n    .object({\n    : z\n        .object({\n        : z\n            .object({\n            : z.boolean().prefault(false),\n            : z.string().prefault(''),\n            : z.enum(['', '', '']).prefault(''),\n            : z\n                .enum(['', '', '', '', '', ''])\n                .prefault(''),\n            : z.coerce.number().transform(v => _.clamp(v, 12, 80)).prefault(21),\n            : z.boolean().prefault(false),\n        })\n            .prefault({}),\n        : z\n            .object({\n            : z.string().prefault(''),\n            : z.string().prefault(''),\n            : z.coerce.number().prefault(0),\n        })\n            .prefault({}),\n        : z\n            .array(z\n            .object({\n            : z.string().prefault(''),\n            : z.coerce.number().transform(v => _.clamp(v, -200, 1000)).prefault(0),\n            : z.string().prefault(''),\n            : z.string().prefault(''),\n            : z.record(z.string().describe(''), z.coerce.number().prefault(0)).prefault({}),\n            : z.coerce.number().prefault(0),\n        })\n            .prefault({}))\n            .prefault([]),\n        : z\n            .object({\n            : z.boolean().prefault(false),\n            NPC: z.boolean().prefault(false),\n        })\n            .prefault({}),\n        : z\n            .object({\n            : z.boolean().prefault(false),\n            : z.string().prefault(''),\n            : z.coerce.number().prefault(0),\n        })\n            .prefault({}),\n        : z\n            .object({\n            : z.boolean().prefault(false),\n            : z.string().prefault(''),\n            : z.coerce.number().prefault(0),\n        })\n            .prefault({}),\n    })\n        .prefault({}),\n    : z\n        .object({\n        : z.string().prefault('177828 08:00'),\n        : z.string().prefault(' '),\n        : z.string().prefault(''),\n        : z.enum(['', '', '', '']).prefault(''),\n        : z.record(z.string().describe(''), z.string().describe('')).prefault({}),\n        NPC: z.record(z.string().describe('NPC'), z.object({\n            : z.string().prefault(''),\n            : z.coerce.number().transform(v => _.clamp(v, -200, 1000)).prefault(0),\n            : z.enum(['', '', '', '', '', '', '', '']).prefault(''),\n            : z.string().prefault(''),\n            : z.string().prefault(''),\n            : z.record(z.string().describe(''), z.coerce.number().prefault(0)).prefault({}),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 99999)).prefault(0),\n            : z.enum(['', '']).prefault(''),\n            : z.array(z.string()).prefault([]),\n            : z.coerce.number().prefault(0),\n            : z.coerce.number().prefault(0),\n        }).prefault({})).prefault({}),\n        NPC: z.record(z.string().describe('NPC'), z.object({\n            : z.coerce.number().transform(v => _.clamp(v, 0, 9999)).prefault(0),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999999)).prefault(0),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 9999)).prefault(0),\n            : z.coerce.number().prefault(0),\n            : z.boolean().prefault(false),\n        }).prefault({})).prefault({}),\n    })\n        .prefault({}),\n    : z\n        .object({\n        : z\n            .object({\n            : z.string().prefault(''),\n            : z.string().prefault(''),\n            : z.string().prefault(''),\n            : z.string().prefault(''),\n        })\n            .prefault({}),\n        : z\n            .object({\n            : z.coerce.number().transform(v => _.clamp(v, 0, 5)).prefault(1),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 5)).prefault(1),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 5)).prefault(1),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 5)).prefault(1),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 5)).prefault(1),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 5)).prefault(1),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 5)).prefault(1),\n        })\n            .prefault({}),\n        : z\n            .object({\n            : z.coerce.number().transform(v => _.clamp(v, 0, 100)).prefault(0),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 100)).prefault(0),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 100)).prefault(0),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 100)).prefault(0),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 100)).prefault(0),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 100)).prefault(0),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 100)).prefault(0),\n        })\n            .prefault({}),\n        : z\n            .object({\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(20),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(18),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(18),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(18),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(20),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(12),\n        })\n            .prefault({}),\n        : z\n            .object({\n            : z.coerce.number().transform(v => _.clamp(v, 1, 20)).prefault(1),\n            : z.coerce.number().transform(v => _.clamp(v, 1, 20)).prefault(1),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999999)).prefault(0),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999999)).prefault(10),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999999)).prefault(0),\n            : z.boolean().prefault(false),\n        })\n            .prefault({}),\n        : z\n            .object({\n            : z.boolean().prefault(false),\n            : z.boolean().prefault(false),\n            : z.enum(['', '', '']).prefault(''),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(8),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 9)).prefault(1),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 9999)).prefault(0),\n        })\n            .prefault({}),\n        : z\n            .object({\n            : z.coerce.number().transform(v => _.clamp(v, 0, 9999)).prefault(100),\n            : z.coerce.number().transform(v => _.clamp(v, 1, 9999)).prefault(100),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 9999)).prefault(100),\n            : z.coerce.number().transform(v => _.clamp(v, 1, 9999)).prefault(100),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 100)).prefault(0),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 9)).prefault(1),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 9)).prefault(1),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 99)).prefault(10),\n            : z.coerce.number().transform(v => _.clamp(v, 1, 99)).prefault(10),\n        })\n            .prefault({}),\n        : z\n            .object({\n            : z.array(z.string()).prefault([]),\n        })\n            .prefault({}),\n        : z\n            .object({\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(4),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(0),\n            : z.record(z.string().describe('ID'), z.boolean()).prefault({}),\n            : z.string().prefault(''),\n        })\n            .prefault({}),\n        : z\n            .object({\n            : z.string().prefault(''),\n            : z.enum(['', '', '', '', '', '', '', '', '']).prefault(''),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 99999)).prefault(0),\n            : z.string().prefault(''),\n            : z.boolean().prefault(false),\n            : z.string().prefault(''),\n        })\n            .prefault({}),\n        : z\n            .object({\n            : z.string().prefault(''),\n            : z.string().prefault(''),\n        })\n            .prefault({}),\n        : z\n            .object({\n            : z.enum(['', '', '']).prefault(''),\n            : z.boolean().prefault(false),\n            : z.enum(['', '', '', '']).prefault(''),\n            : z.enum(['', '', '']).prefault(''),\n            : z.coerce.number().transform(v => _.clamp(v, 1, 999)).prefault(1),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(0),\n            : z.string().prefault(''),\n            : z.record(z.string().describe(''), z.array(z.string()).prefault([])).prefault({}),\n            : z\n                .object({\n                : z.boolean().prefault(false),\n                : z\n                    .enum(['', '', '', '', '', '', ''])\n                    .prefault(''),\n                : z.enum(['', '', '', '', '']).prefault(''),\n                : z.coerce.number().transform(v => _.clamp(v, 1, 100)).prefault(11),\n                : z.coerce.number().transform(v => _.clamp(v, -50, 50)).prefault(5),\n                : z.coerce.number().transform(v => _.clamp(v, -100, 100)).prefault(0),\n                : z.coerce.number().transform(v => _.clamp(v, 0.1, 3)).prefault(1),\n                : z.enum(['', '', '', '', '', '']).prefault(''),\n                : z.coerce.number().transform(v => _.clamp(v, 100, 2000)).prefault(500),\n                : z\n                    .object({\n                    : z.coerce.number().transform(v => _.clamp(v, 0, 99)).prefault(0),\n                    : z.coerce.number().transform(v => _.clamp(v, 0, 99)).prefault(0),\n                    : z.coerce.number().transform(v => _.clamp(v, 0, 99)).prefault(0),\n                    : z.coerce.number().transform(v => _.clamp(v, 0, 99)).prefault(0),\n                    : z.coerce.number().transform(v => _.clamp(v, 0, 99)).prefault(0),\n                    : z.coerce.number().transform(v => _.clamp(v, 0, 99)).prefault(0),\n                })\n                    .prefault({}),\n                : z\n                    .object({\n                    : z.coerce.number().transform(v => _.clamp(v, 0, 99)).prefault(0),\n                    : z.coerce.number().transform(v => _.clamp(v, 0, 99)).prefault(0),\n                    : z.coerce.number().transform(v => _.clamp(v, 0, 99)).prefault(0),\n                    : z.coerce.number().transform(v => _.clamp(v, 0, 99)).prefault(0),\n                    : z.coerce.number().transform(v => _.clamp(v, 0, 99)).prefault(0),\n                    : z.coerce.number().transform(v => _.clamp(v, 0, 99)).prefault(0),\n                })\n                    .prefault({}),\n                : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(0),\n                : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(0),\n                : z.coerce.number().transform(v => _.clamp(v, -1, 1)).prefault(0),\n                : z.string().prefault(''),\n                : z.boolean().prefault(false),\n                : z.string().prefault(''),\n                : z.array(z.string()).prefault([]),\n                : z.array(z.string()).prefault([]),\n                : z.enum(['', '', '', '']).prefault(''),\n                : z.enum(['', '', '', '', '']).prefault(''),\n                : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(0),\n                : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(0),\n                : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(3),\n                : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(3),\n                : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(0),\n                : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(0),\n                : z.string().prefault(''),\n                : z.coerce.number().transform(v => _.clamp(v, 0, 99999)).prefault(100),\n                : z.coerce.number().transform(v => _.clamp(v, 0, 99999)).prefault(100),\n                : z.coerce.number().transform(v => _.clamp(v, 0, 9999)).prefault(0),\n                : z.string().prefault(''),\n            })\n                .prefault({}),\n        })\n            .prefault({}),\n        : z\n            .object({\n            : z.string().prefault(''),\n            : z.record(z.string().describe(''), z\n                .object({\n                : z.coerce.number().transform(v => _.clamp(v, 0, 8)).prefault(1),\n                : z.coerce.number().transform(v => _.clamp(v, 0, 8)).prefault(2),\n                : z.string().prefault(''),\n            })\n                .prefault({})).prefault({}),\n            : z.record(z.string().describe(''), z.string()).prefault({}),\n            : z.record(z.string().describe(''), z.string().describe('')).prefault({}),\n        })\n            .prefault({}),\n        : z.record(z.string().describe(''), z\n            .object({\n            : z.enum(['', '', '']).prefault(''),\n            : z.string().prefault(''),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 99)).prefault(1),\n        })\n            .prefault({})).prefault({}),\n        : z\n            .object({\n            : z.string().prefault(''),\n            : z.enum(['', '', '', '', '', '', '', '']).prefault(''),\n            : z.coerce.number().transform(v => _.clamp(v, 1, 10)).prefault(1),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(0),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(0),\n            : z.string().prefault(''),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(0),\n            : z.enum(['', '', '', '']).prefault(''),\n            : z.string().prefault(''),\n            : z.string().prefault(''),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(0),\n            : z.coerce.number().prefault(0),\n        })\n            .prefault({}),\n    })\n        .prefault({}),\n    : z\n        .object({\n        : z.boolean().prefault(false),\n        : z.record(z.string().describe(''), z\n            .object({\n            : z.enum(['', '']).prefault(''),\n            : z.boolean().prefault(false),\n        })\n            .prefault({})).prefault({}),\n        : z.record(z.string().describe(''), z\n            .object({\n            : z.enum(['', '', '', '', '', '']).prefault(''),\n            : z.coerce.number().transform(v => _.clamp(v, 1, 999)).prefault(1),\n            : z.coerce.number().transform(v => _.clamp(v, 1, 999999999)).prefault(1),\n        })\n            .prefault({})).prefault({}),\n        : z\n            .object({\n            : z.boolean().prefault(false),\n            : z.string().prefault(''),\n            : z\n                .enum(['', '', '', ''])\n                .prefault(''),\n            : z.enum(['', '', '']).prefault(''),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(0),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(0),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(0),\n            : z.string().prefault(''),\n            : z.string().prefault(''),\n            : z\n                .array(z\n                .object({\n                : z.coerce.number().transform(v => _.clamp(v, 1, 999)).prefault(1),\n                : z.string().prefault(''),\n                : z.enum(['', '', '', '']).prefault(''),\n                : z\n                    .object({\n                    : z.coerce.number().transform(v => _.clamp(v, 0, 9)).prefault(0),\n                    : z.coerce.number().transform(v => _.clamp(v, 0, 9)).prefault(0),\n                    : z.boolean().prefault(false),\n                    : z.boolean().prefault(false),\n                })\n                    .prefault({}),\n            })\n                .prefault({}))\n                .prefault([]),\n        })\n            .prefault({}),\n        : z\n            .object({\n            : z.coerce.number().transform(v => _.clamp(v, 0, 99999999)).prefault(0),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999999)).prefault(0),\n            : z.record(z.string().describe(''), z\n                .object({\n                : z.enum(['', '', '', '', '', '']).prefault(''),\n                : z.coerce.number().transform(v => _.clamp(v, 0, 999999)).prefault(0),\n                : z.coerce.number().transform(v => _.clamp(v, 1, 999999999)).prefault(1),\n                : z.string().prefault(''),\n                : z.string().prefault(''),\n                : z.array(z.string()).prefault([]),\n                : z.boolean().prefault(true),\n            })\n                .prefault({})).prefault({}),\n            : z.array(z.string()).prefault([]),\n        })\n            .prefault({}),\n    })\n        .prefault({}),\n    : z.record(z.string().describe(''), z.string().describe('')).prefault({}),\n})\n    .prefault({});\n","import { registerMvuSchema } from 'https://testingcf.jsdelivr.net/gh/StageDog/tavern_resource/dist/util/mvu_zod.js';\nimport { Schema } from '../../schema';\n\nfunction installHideOriginalReplyStyle(): void {\n  const host_document = window.parent?.document ?? document;\n  const style_id = 'apocalypse-dawn-hide-original-reply-style';\n  if (host_document.getElementById(style_id)) return;\n\n  const style = host_document.createElement('style');\n  style.id = style_id;\n  style.textContent = `\n    .mes:has(.TH-render) .mes_text > :not(.TH-render) {\n      display: none !important;\n    }\n  `;\n  host_document.head.appendChild(style);\n}\n\nfunction asNumber(value: unknown, fallback = 0): number {\n  const numeric = Number(value);\n  return Number.isFinite(numeric) ? numeric : fallback;\n}\n\nfunction rollD6(): number {\n  return Math.floor(Math.random() * 6) + 1;\n}\n\nconst warmaid_rank_steps = [\n  { name: '', need: 10 },\n  { name: '', need: 50 },\n  { name: '', need: 100 },\n  { name: '', need: 500 },\n  { name: '', need: 1000 },\n  { name: '', need: 2000 },\n  { name: '', need: 6000 },\n] as const;\n\nfunction reconcileGrowthLevel(stat_data: any): void {\n  if (!stat_data || typeof stat_data !== 'object') return;\n\n  const profession = String(_.get(stat_data, '..', ''));\n  const is_warmaid = profession === '' || String(_.get(stat_data, '..', '')).includes('');\n  const is_authority = profession === '' || String(_.get(stat_data, '..', '')).includes('');\n\n  if (is_warmaid) {\n    let level = _.clamp(asNumber(_.get(stat_data, '..', 1), 1), 1, warmaid_rank_steps.length);\n    let shards = Math.max(0, asNumber(_.get(stat_data, '..', 0), 0));\n\n    // /\n    while (level < warmaid_rank_steps.length) {\n      const need = warmaid_rank_steps[level - 1].need;\n      if (shards < need) break;\n      shards -= need;\n      level += 1;\n    }\n\n    _.set(stat_data, '..', level);\n    _.set(stat_data, '..', shards);\n    _.set(\n      stat_data,\n      '..',\n      level < warmaid_rank_steps.length ? warmaid_rank_steps[level - 1].need : 0,\n    );\n  }\n\n  if (is_authority) {\n    const shard = Math.max(0, asNumber(_.get(stat_data, '..', 0), 0));\n    const has_origin = Boolean(_.get(stat_data, '..', false));\n\n    let level = 1; // \n    if (shard >= 50) level = 2; // \n    if (shard >= 100) level = 3; // \n    if (shard >= 1000 && has_origin) level = 4; // \n\n    _.set(stat_data, '..', level);\n  }\n}\n\nfunction trimBattleLogs(stat_data: any, keep = 3): void {\n  if (!stat_data || typeof stat_data !== 'object') return;\n  const logs = _.get(stat_data, '', {});\n  if (!_.isObjectLike(logs)) {\n    _.set(stat_data, '', {});\n    return;\n  }\n  const entries = Object.entries(logs as Record<string, string>);\n  if (entries.length <= keep) return;\n  _.set(stat_data, '', Object.fromEntries(entries.slice(-keep)));\n}\n\nfunction ensureAirCombatData(stat_data: any): void {\n  if (!stat_data || typeof stat_data !== 'object') return;\n  if (!_.isObjectLike(_.get(stat_data, '.'))) {\n    _.set(stat_data, '.', { : false, : '', : 0 });\n  }\n  if (!_.isObjectLike(_.get(stat_data, '..'))) {\n    _.set(stat_data, '..', {});\n  }\n  if (!_.isObjectLike(_.get(stat_data, '..'))) {\n    _.set(stat_data, '..', {\n      : false,\n      : '',\n      : '',\n      : 11,\n      : 5,\n      : 0,\n      : 1,\n      : '',\n      : 500,\n      : { : 0, : 0, : 0, : 0, : 0, : 0 },\n      : { : 0, : 0, : 0, : 0, : 0, : 0 },\n      : 0,\n      : 0,\n      : 0,\n      : '',\n      : false,\n      : '',\n      : [],\n      : [],\n      : '',\n      : '',\n      : 0,\n      : 0,\n      : 3,\n      : 3,\n      : 0,\n      : 0,\n      : '',\n      : 100,\n      : 100,\n      : 0,\n      : '',\n    });\n  } else {\n    const air = _.get(stat_data, '..');\n    _.defaultsDeep(air, {\n      : false,\n      : '',\n      : '',\n      : 11,\n      : 5,\n      : 0,\n      : 1,\n      : '',\n      : 500,\n      : { : 0, : 0, : 0, : 0, : 0, : 0 },\n      : { : 0, : 0, : 0, : 0, : 0, : 0 },\n      : 0,\n      : 0,\n      : 0,\n      : '',\n      : false,\n      : '',\n      : [],\n      : [],\n      : '',\n      : '',\n      : 0,\n      : 0,\n      : 3,\n      : 3,\n      : 0,\n      : 0,\n      : '',\n      : 100,\n      : 100,\n      : 0,\n      : '',\n    });\n  }\n}\n\nconst battle_activate_pattern = /|||||/i;\nconst battle_action_pattern = /||||||||||/i;\nconst battle_end_pattern = /|||||||/i;\n\nfunction getWeaponLevel(stat_data: any): number {\n  const weapons = _.get(stat_data, '..', {});\n  if (!_.isObjectLike(weapons)) return 1;\n  const first = Object.values(weapons as Record<string, any>)[0];\n  return Math.max(1, asNumber(_.get(first, '', 1), 1));\n}\n\nfunction buildAirBattleSummary(stat_data: any, end_reason: string): string {\n  const air = _.get(stat_data, '..', {});\n  const logs = Object.entries(_.get(stat_data, '', {})).slice(-3).map(([k, v]) => `${k}:${v}`).join('');\n  return `(${end_reason})${asNumber(air., 0)}=${air.}(${asNumber(air., 0)})=${_.get(stat_data, '..', '')}=${asNumber(air., 0)}=${asNumber(air., 0)}=${logs}`;\n}\n\nfunction startAirBattleIfTriggered(stat_data: any, content: string): boolean {\n  ensureAirCombatData(stat_data);\n  if (!battle_activate_pattern.test(content)) return false;\n\n  const in_battle = Boolean(_.get(stat_data, '..', false));\n  if (in_battle) return true;\n\n  _.set(stat_data, '..', '');\n  _.set(stat_data, '..', true);\n  _.set(stat_data, '...', true);\n  _.set(stat_data, '...', '');\n  _.set(stat_data, '...', 0);\n\n  const threat = String(_.get(stat_data, '.', ''));\n  const enemy_hp = threat === '' ? 180 : threat === '' ? 140 : threat === '' ? 110 : 90;\n  _.set(stat_data, '...', asNumber(_.get(stat_data, '..', 100), 100));\n  _.set(stat_data, '...', Math.max(30, asNumber(_.get(stat_data, '...', enemy_hp), enemy_hp)));\n\n  const source =\n    //i.test(content) ? ''\n      : //i.test(content) ? ''\n        : //i.test(content) ? ''\n          : '';\n  const ambush = /|/i.test(content);\n  _.set(stat_data, '...', ambush);\n  _.set(stat_data, '...', ambush ? source : '');\n  if (ambush) {\n    _.set(stat_data, '..', asNumber(_.get(stat_data, '..', 1), 1) + 1);\n  }\n\n  _.set(stat_data, `.-${Date.now()}`, `${source}`);\n  trimBattleLogs(stat_data, 3);\n  return true;\n}\n\nfunction resolveAirCombatRound(stat_data: any, content: string): boolean {\n  ensureAirCombatData(stat_data);\n  if (_.get(stat_data, '..', '') !== '') return false;\n  if (!Boolean(_.get(stat_data, '..', false))) return false;\n  if (!battle_action_pattern.test(content) && !battle_end_pattern.test(content)) return false;\n\n  const air = _.get(stat_data, '..');\n  let self_hp = asNumber(_.get(air, '', _.get(stat_data, '..', 100)), 100);\n  let enemy_hp = asNumber(_.get(air, '', 100), 100);\n  const weather_mod = _.clamp(Math.trunc(asNumber(_.get(air, '', 0), 0) / 10), -2, 2);\n  const sup_mod = _.clamp(asNumber(_.get(air, '', 0), 0), -1, 1);\n  const weapon_lv = getWeaponLevel(stat_data);\n  const heavy_condition = String(_.get(air, '', ''));\n  const need_assist = /|.*/.test(heavy_condition);\n  const has_assist = asNumber(_.get(air, '.', 0), 0) > 0 || asNumber(_.get(air, '.', 0), 0) > 0;\n\n  const self_near_miss_stack = asNumber(_.get(air, '', 0), 0);\n  const enemy_near_miss_stack = asNumber(_.get(air, '', 0), 0);\n  const enemy_dodge = asNumber(_.get(air, '', 3), 3);\n  const self_dodge = asNumber(_.get(air, '', 3), 3);\n  const full_auto = /||/.test(content);\n\n  const calcSingleShot = (hit_bonus: number, dodge_value: number, base_damage_mult = 1): { diff: number; damage: number; note: string; near_miss: boolean; invalid: boolean } => {\n    const hit_roll = rollD6() + hit_bonus;\n    const diff = hit_roll - dodge_value;\n    const base_damage = Math.max(1, (rollD6() + weapon_lv) * base_damage_mult);\n    if (diff > 6) return { diff, damage: base_damage + weapon_lv * rollD10(), note: '', near_miss: false, invalid: false };\n    if (diff > 4) return { diff, damage: base_damage, note: '', near_miss: false, invalid: false };\n    if (diff > 2) return { diff, damage: Math.max(1, Math.floor(base_damage / 2)), note: '', near_miss: false, invalid: false };\n    if (diff > 1) return { diff, damage: Math.max(1, weapon_lv * _.random(1, 2)), note: '', near_miss: false, invalid: false };\n    if (diff === 1 || diff === 0) return { diff, damage: 0, note: '', near_miss: true, invalid: false };\n    return { diff, damage: 0, note: '', near_miss: false, invalid: true };\n  };\n\n  let dealt = 0;\n  let diff = 0;\n  let self_hit_note = '';\n  if (need_assist && !has_assist) {\n    self_hit_note = '/';\n  } else {\n    const hit_bonus_base = weather_mod + sup_mod + self_near_miss_stack;\n    const first_shot = calcSingleShot(hit_bonus_base, enemy_dodge);\n    diff = first_shot.diff;\n    dealt += first_shot.damage;\n    self_hit_note = first_shot.note;\n    _.set(air, '', first_shot.near_miss ? self_near_miss_stack + 10 : 0);\n\n    if (full_auto) {\n      let shot_index = 1;\n      let expected_next_bonus = hit_bonus_base - 10;\n      while (shot_index < 6 && expected_next_bonus + 6 >= enemy_dodge) {\n        const shot = calcSingleShot(expected_next_bonus, enemy_dodge);\n        dealt += shot.damage;\n        self_hit_note += ` / ${shot_index + 1}:${shot.note}`;\n        if (shot.near_miss) _.set(air, '', asNumber(_.get(air, '', 0), 0) + 10);\n        if (!shot.invalid) diff = shot.diff;\n        shot_index += 1;\n        expected_next_bonus -= 10;\n      }\n    }\n  }\n  enemy_hp = Math.max(0, enemy_hp - dealt);\n\n  const enemy_hit = calcSingleShot(Math.max(0, -sup_mod) + enemy_near_miss_stack, self_dodge);\n  const enemy_diff = enemy_hit.diff;\n  const taken = enemy_hit.damage;\n  _.set(air, '', enemy_hit.near_miss ? enemy_near_miss_stack + 10 : 0);\n  self_hp = Math.max(0, self_hp - taken);\n\n  _.set(stat_data, '..', self_hp);\n  _.set(air, '', self_hp);\n  _.set(air, '', enemy_hp);\n  _.set(air, '', asNumber(_.get(air, '', 0), 0) + 1);\n  const round_summary = `${_.get(air, '', 0)}${self_hit_note}(${diff})${dealt}${enemy_hit.note}(${enemy_diff})${taken}`;\n  _.set(air, '', round_summary);\n  _.set(air, '', round_summary);\n  _.set(stat_data, `.-${Date.now()}`, round_summary);\n  trimBattleLogs(stat_data, 3);\n\n  const end_by_text = battle_end_pattern.test(content);\n  const end_by_hp = self_hp <= 0 || enemy_hp <= 0;\n  if (!(end_by_text || end_by_hp)) return true;\n\n  _.set(stat_data, '..', false);\n  _.set(stat_data, '..', '');\n  _.set(air, '', '');\n  const reason = self_hp <= 0 ? '' : enemy_hp <= 0 ? '' : '';\n  const summary = buildAirBattleSummary(stat_data, reason);\n  _.set(stat_data, '.', {\n    : true,\n    : summary,\n    : Date.now(),\n  });\n  _.set(stat_data, '..', summary);\n  _.set(stat_data, `.-${Date.now()}`, summary);\n  trimBattleLogs(stat_data, 3);\n  return true;\n}\n\nfunction extractDisplayText(content: string): string {\n  const without_update = content\n    .replace(/<update(?:variable)?>[\\s\\S]*?<\\/update(?:variable)?>/gim, '')\n    .replace(/<update(?:variable)?>[\\s\\S]*$/gim, '');\n\n  const without_placeholder = without_update\n    .replace(/<StatusPlaceHolderImpl\\/>/gim, '')\n    .replace(/<OnStageCharacters>[\\s\\S]*?<\\/OnStageCharacters>/gim, '')\n    .replace(/<NpcRelationHints>[\\s\\S]*?<\\/NpcRelationHints>/gim, '');\n\n  let text = without_placeholder.replace(/```[\\s\\S]*?\\$\\('body'\\)\\.load\\([\\s\\S]*?```/gim, '');\n\n  const content_match = text.match(/<content>([\\s\\S]*?)<\\/content>/im);\n  if (content_match?.[1]) {\n    text = content_match[1];\n  } else {\n    text = text\n      .replace(/<(?:think|thinking|context|disclaimer|tucao|current_event|progress)[^>]*>[\\s\\S]*?<\\/(?:think|thinking|context|disclaimer|tucao|current_event|progress)>/gim, '')\n      .replace(/<(?:think|thinking|context|disclaimer|tucao|current_event|progress)[^>]*\\/>/gim, '');\n  }\n\n  text = text\n    .replace(/```[\\s\\S]*?```/gim, '')\n    .replace(/<\\|im_end\\|>/gim, '')\n    .replace(/<\\/?[^>\\n]+>/g, '')\n    .replace(/\\r/g, '')\n    .replace(/\\n{3,}/g, '\\n\\n')\n    .trim();\n\n  return text;\n}\n\ntype OnStageCharacter = {\n  : string;\n  : number;\n  : string;\n  : string;\n  : Record<string, number>;\n  : number;\n};\n\ntype NpcRelationHint = {\n  : string;\n  : string[];\n};\n\nconst npc_name_stop_words = new Set([\n  '', '', '', '', '', '', '', '', '', '', '',\n  '', '', '', '', '', '', '', '', '', '', '',\n  '', '', '', '', '', '', '', '', '', '', '',\n]);\nconst npc_name_bad_prefix = /^(|||||||||||)/;\nconst npc_name_bad_contains = /(||||||||||||||||||||||||||)/;\n\nfunction normalizeNpcName(raw: string): string {\n  return String(raw ?? '')\n    .trim()\n    .replace(/^[\"\\[\\(]+|[\"\\]\\)]+$/g, '')\n    .replace(/[,\\.\\?!;:]/g, '')\n    .trim();\n}\n\nfunction isLikelyNpcName(name: string, excluded: Set<string>): boolean {\n  if (!name) return false;\n  if (excluded.has(name)) return false;\n  if (npc_name_stop_words.has(name)) return false;\n  if (npc_name_bad_contains.test(name)) return false;\n  if (npc_name_bad_prefix.test(name)) return false;\n  if (/[0-9-]/.test(name)) return false;\n  if (/(||||||)$/.test(name)) return false;\n  if (!/^[\\u4e00-\\u9fa5]{2,6}$/.test(name)) return false;\n  if (/(||||||||)$/.test(name)) return false;\n  return true;\n}\n\nfunction sanitizeOnStageCharacters(list: OnStageCharacter[], excluded: Set<string>): OnStageCharacter[] {\n  return list.filter(v => isLikelyNpcName(String(v?. ?? ''), excluded));\n}\n\nfunction extractNameContext(text: string, name: string): string {\n  const lines = String(text ?? '').split(/[\\n]/).map(v => v.trim()).filter(Boolean);\n  const hit = lines.find(v => v.includes(name));\n  if (!hit) return '';\n  return hit.slice(0, 48);\n}\n\nfunction inferAttitudeByContext(context: string): string {\n  const t = String(context ?? '');\n  if (/|||/.test(t)) return '';\n  if (/||||/.test(t)) return '';\n  if (/||||/.test(t)) return '';\n  if (/|||/.test(t)) return '';\n  return '';\n}\n\nfunction refreshOnStageThoughtsByAiText(stat_data: any, ai_content: string): void {\n  const list = Array.isArray(_.get(stat_data, '.')) ? (_.get(stat_data, '.') as OnStageCharacter[]) : [];\n  if (list.length === 0) return;\n  const text = extractDisplayText(String(ai_content ?? ''));\n  if (!text) return;\n\n  const next = list.map(char => {\n    const name = String(char?. ?? '');\n    if (!name || !text.includes(name)) return char;\n    const context = extractNameContext(text, name);\n    return {\n      ...char,\n      : inferAttitudeByContext(context) || String(char. ?? ''),\n      : context ? `${context}` : `${name}`,\n      : Date.now(),\n    };\n  });\n  _.set(stat_data, '.', next);\n}\n\nfunction inferOnStageCharactersFromText(content: string, options?: { exclude_names?: string[]; old_onstage?: OnStageCharacter[] }): OnStageCharacter[] {\n  const text = extractDisplayText(String(content ?? ''));\n  if (!text) return [];\n\n  const excluded = new Set<string>(options?.exclude_names ?? []);\n  const old_onstage = options?.old_onstage ?? [];\n  const old_map = new Map(old_onstage.map(v => [v., v]));\n  const score = new Map<string, number>();\n\n  const pushScore = (raw_name: string, delta: number) => {\n    const name = normalizeNpcName(raw_name);\n    if (!isLikelyNpcName(name, excluded)) return;\n    score.set(name, (score.get(name) ?? 0) + delta);\n  };\n\n  // ///\n  for (const m of text.matchAll(/(?:||||)([\\u4e00-\\u9fa5]{2,6})/g)) {\n    pushScore(m[1], 3);\n  }\n  // X/////\n  for (const m of text.matchAll(/([\\u4e00-\\u9fa5]{2,6})(?:||||||||||||||||||||)/g)) {\n    pushScore(m[1], 2);\n  }\n  // /\n  for (const m of text.matchAll(/([\\u4e00-\\u9fa5]{2,6})[]\\s*(?:[\"]||||||||||||)/g)) {\n    pushScore(m[1], 1.6);\n  }\n  // \n  for (const m of text.matchAll(/([\\u4e00-\\u9fa5]{2,6})/g)) {\n    pushScore(m[1], 0.05);\n  }\n\n  // \n  for (const name of old_map.keys()) {\n    if (text.includes(name)) score.set(name, Math.max(score.get(name) ?? 0, 2));\n  }\n\n  const result: OnStageCharacter[] = [];\n  for (const [name, s] of score.entries()) {\n    if (s < 2.8) continue;\n    const old = old_map.get(name);\n    const context = extractNameContext(text, name);\n    result.push({\n      : name,\n      : clampAffection(old?. ?? 0, 0),\n      : old?. || inferAttitudeByContext(context),\n      : old?. || (context ? `${context}` : ''),\n      : _.isObjectLike(old?.) ? _.cloneDeep(old?.) : {},\n      : Date.now(),\n    });\n  }\n  return result;\n}\n\nfunction parseOnStageCharacters(content: string): OnStageCharacter[] | undefined {\n  const match = content.match(/<OnStageCharacters>([\\s\\S]*?)<\\/OnStageCharacters>/im);\n  if (!match?.[1]) return undefined;\n\n  try {\n    const parsed = JSON.parse(match[1]);\n    if (!Array.isArray(parsed)) return undefined;\n\n    return parsed\n      .filter(item => _.isObjectLike(item))\n      .map(item => {\n        const attrs = _.isObjectLike((item as any).) ? (item as any). as Record<string, unknown> : {};\n        const normalized_attrs = Object.fromEntries(\n          Object.entries(attrs).map(([k, v]) => [k, asNumber(v, 0)]),\n        ) as Record<string, number>;\n        return {\n          : String((item as any). ?? ''),\n          : _.clamp(asNumber((item as any)., 0), -200, 1000),\n          : String((item as any). ?? ''),\n          : String((item as any). ?? ''),\n          : normalized_attrs,\n          : Date.now(),\n        };\n      });\n  } catch {\n    return undefined;\n  }\n}\n\nfunction parseNpcRelationHints(content: string): NpcRelationHint[] | undefined {\n  const match = content.match(/<NpcRelationHints>([\\s\\S]*?)<\\/NpcRelationHints>/im);\n  if (!match?.[1]) return undefined;\n  try {\n    const parsed = JSON.parse(match[1]);\n    if (!Array.isArray(parsed)) return undefined;\n    return parsed\n      .filter(item => _.isObjectLike(item))\n      .map(item => ({\n        : String((item as any). ?? ''),\n        : Array.isArray((item as any).) ? (item as any)..map((v: unknown) => String(v)) : [],\n      }))\n      .filter(v => v.);\n  } catch {\n    return undefined;\n  }\n}\n\nfunction ensureNpcData(stat_data: any): void {\n  if (!_.isObjectLike(_.get(stat_data, ''))) _.set(stat_data, '', {});\n  if (!Array.isArray(_.get(stat_data, '.'))) _.set(stat_data, '.', []);\n  if (!_.isObjectLike(_.get(stat_data, '.'))) {\n    _.set(stat_data, '.', { : false, NPC: false });\n  } else {\n    _.defaults(_.get(stat_data, '.'), { : false, NPC: false });\n  }\n  if (!_.isObjectLike(_.get(stat_data, '.NPC'))) _.set(stat_data, '.NPC', {});\n  if (!_.isObjectLike(_.get(stat_data, '.NPC'))) _.set(stat_data, '.NPC', {});\n  if (!_.isObjectLike(_.get(stat_data, ''))) _.set(stat_data, '', {});\n  _.defaultsDeep(_.get(stat_data, ''), {\n    : false,\n    : {},\n    : {},\n    : {\n      : false,\n      : '',\n      : '',\n      : '',\n      : 0,\n      : 0,\n      : 0,\n      : '',\n      : '',\n      : [],\n    },\n    : {\n      : 0,\n      : 0,\n      : {},\n      : [],\n    },\n  });\n}\n\nfunction resetNpcStateBeforeCreate(stat_data: any): void {\n  if (!stat_data || typeof stat_data !== 'object') return;\n  if (Boolean(_.get(stat_data, '..', false))) return;\n  _.set(stat_data, '.', []);\n  _.set(stat_data, '.NPC', {});\n  _.set(stat_data, '.NPC', {});\n}\n\nfunction clampAffection(value: unknown, fallback = 0): number {\n  return _.clamp(asNumber(value, fallback), -200, 1000);\n}\n\nfunction calcAffectionStage(score: number, is_partner = false): string {\n  if (is_partner) return '';\n  if (score <= -50) return '';\n  if (score <= -20) return '';\n  if (score <= 0) return '';\n  if (score <= 100) return '';\n  if (score <= 400) return '';\n  if (score <= 600) return '';\n  return '';\n}\n\nfunction mergeOnStageCharacters(old_list: OnStageCharacter[], incoming: OnStageCharacter[]): OnStageCharacter[] {\n  const merged_map = new Map<string, OnStageCharacter>();\n  for (const old of old_list) {\n    merged_map.set(old., {\n      : String(old. || ''),\n      : clampAffection(old., 0),\n      : String(old. || ''),\n      : String(old. || ''),\n      : _.isObjectLike(old.) ? _.cloneDeep(old.) : {},\n      : asNumber(old., 0),\n    });\n  }\n  for (const next of incoming) {\n    const name = String(next. || '');\n    const prev = merged_map.get(name);\n    if (!prev) {\n      merged_map.set(name, {\n        : name,\n        : clampAffection(next., 0),\n        : String(next. || ''),\n        : String(next. || ''),\n        : _.isObjectLike(next.) ? _.cloneDeep(next.) : {},\n        : Date.now(),\n      });\n      continue;\n    }\n    const requested = clampAffection(next., prev.);\n    const merged_affection = requested > prev. ? Math.min(prev. + 5, requested) : requested;\n    merged_map.set(name, {\n      : name,\n      : clampAffection(merged_affection, prev.),\n      : String(next. || prev. || ''),\n      : String(next. || prev. || ''),\n      : {\n        ...(prev. ?? {}),\n        ...(_.isObjectLike(next.) ? next. : {}),\n      },\n      : Date.now(),\n    });\n  }\n  return [...merged_map.values()];\n}\n\nfunction detectMentionedNames(content: string, names: string[]): Set<string> {\n  const text = String(content ?? '');\n  const mentions = new Set<string>();\n  for (const name of names) {\n    if (!name) continue;\n    if (text.includes(name)) mentions.add(name);\n  }\n  return mentions;\n}\n\nfunction getTracker(stat_data: any, name: string): any {\n  const key = `.NPC.${name}`;\n  if (!_.isObjectLike(_.get(stat_data, key))) {\n    _.set(stat_data, key, {\n      : 0,\n      : 0,\n      : 0,\n      : 0,\n      : false,\n    });\n  }\n  return _.get(stat_data, key);\n}\n\nfunction upsertLongTermNpc(stat_data: any, name: string, payload?: Partial<OnStageCharacter>): any {\n  const key = `.NPC.${name}`;\n  const existing = _.get(stat_data, key);\n  const base = _.isObjectLike(existing) ? existing : {\n    : name,\n    : 0,\n    : '',\n    : '',\n    : '',\n    : {},\n    : 0,\n    : '',\n    : [],\n    : Date.now(),\n    : 0,\n  };\n  const next_affection = clampAffection(payload?., base.);\n  const current_affection = clampAffection(base., 0);\n  const merged_affection = next_affection > current_affection ? Math.min(current_affection + 5, next_affection) : next_affection;\n  const is_partner = Array.isArray(base.) && base..includes('');\n  const next = {\n    ...base,\n    : name,\n    : merged_affection,\n    : String(payload?. || base. || ''),\n    : String(payload?. || base. || ''),\n    : {\n      ...(base. ?? {}),\n      ...(payload?. ?? {}),\n    },\n    : Date.now(),\n  };\n  next. = calcAffectionStage(next., is_partner);\n  _.set(stat_data, key, next);\n  return next;\n}\n\nfunction promoteToLongTermByName(stat_data: any, name: string, reason: string): void {\n  const onstage_list = (_.get(stat_data, '.', []) as OnStageCharacter[]);\n  const onstage = onstage_list.find(v => v. === name);\n  const npc = upsertLongTermNpc(stat_data, name, onstage);\n  const tracker = getTracker(stat_data, name);\n  tracker. = true;\n  _.set(stat_data, `.NPC.${name}.`, _.uniq([...(npc. ?? []), reason]));\n}\n\nconst npc_follow_pattern = /|||||/;\nconst npc_partner_ai_pattern = /||/;\nconst npc_partner_user_confirm_pattern = /||||/;\nconst npc_sex_pattern = /||||/;\n\nfunction applyUserNpcRequest(stat_data: any, user_content: string): boolean {\n  if (!npc_follow_pattern.test(user_content)) return false;\n  const onstage_list = (_.get(stat_data, '.', []) as OnStageCharacter[]);\n  const names = onstage_list.map(v => v.);\n  const mentioned = [...detectMentionedNames(user_content, names)];\n  const targets = mentioned.length > 0 ? mentioned : (names.length === 1 ? [names[0]] : []);\n  if (targets.length === 0) return false;\n  for (const name of targets) {\n    const tracker = getTracker(stat_data, name);\n    tracker. = asNumber(tracker., 0) + 1;\n    tracker. = Date.now();\n    promoteToLongTermByName(stat_data, name, '');\n  }\n  return true;\n}\n\nfunction applyNpcLongTermRules(stat_data: any, ai_content: string, user_content: string, parsed_onstage?: OnStageCharacter[], hints?: NpcRelationHint[]): void {\n  ensureNpcData(stat_data);\n  const onstage_list = (_.get(stat_data, '.', []) as OnStageCharacter[]);\n  const long_map = _.get(stat_data, '.NPC', {}) as Record<string, any>;\n  const name_pool = _.uniq([\n    ...onstage_list.map(v => v.),\n    ...Object.keys(long_map),\n    ...(parsed_onstage?.map(v => v.) ?? []),\n  ]);\n  const structured_names = new Set((parsed_onstage ?? []).map(v => v.));\n  const text_mentions = detectMentionedNames(ai_content, name_pool);\n  const appeared = new Set<string>([...structured_names, ...text_mentions]);\n  const round = asNumber(_.get(stat_data, '..', 1), 1);\n\n  for (const name of name_pool) {\n    const tracker = getTracker(stat_data, name);\n    if (appeared.has(name)) {\n      tracker. = asNumber(tracker., 0) + 1;\n      tracker. = round;\n    } else {\n      tracker. = Math.max(0, asNumber(tracker., 0) - 1);\n    }\n    if (tracker. >= 5 && !tracker.) {\n      promoteToLongTermByName(stat_data, name, '');\n    }\n  }\n\n  for (const onstage of onstage_list) {\n    if (_.has(stat_data, `.NPC.${onstage.}`)) {\n      upsertLongTermNpc(stat_data, onstage., onstage);\n    }\n  }\n\n  for (const hint of hints ?? []) {\n    if (!_.has(long_map, hint.)) continue;\n    const curr = _.get(stat_data, `.NPC.${hint.}.`, []);\n    _.set(stat_data, `.NPC.${hint.}.`, _.uniq([...(curr ?? []), ...hint.]));\n  }\n\n  const ai_has_partner_signal = npc_partner_ai_pattern.test(ai_content);\n  const user_confirm = npc_partner_user_confirm_pattern.test(user_content);\n  if (ai_has_partner_signal && user_confirm) {\n    for (const name of detectMentionedNames(ai_content, Object.keys(_.get(stat_data, '.NPC', {})))) {\n      const score = clampAffection(_.get(stat_data, `.NPC.${name}.`, 0), 0);\n      if (score < 601) continue;\n      const current_tags = _.get(stat_data, `.NPC.${name}.`, []);\n      const tags = _.uniq([...(Array.isArray(current_tags) ? current_tags : []), '']);\n      _.set(stat_data, `.NPC.${name}.`, tags);\n      _.set(stat_data, `.NPC.${name}.`, '');\n      _.set(stat_data, `.NPC.${name}.`, Date.now());\n    }\n  }\n\n  if (npc_sex_pattern.test(ai_content)) {\n    for (const name of detectMentionedNames(ai_content, Object.keys(_.get(stat_data, '.NPC', {})))) {\n      const count = asNumber(_.get(stat_data, `.NPC.${name}.`, 0), 0) + 1;\n      _.set(stat_data, `.NPC.${name}.`, count);\n      _.set(stat_data, `.NPC.${name}.`, '');\n      _.set(stat_data, `.NPC.${name}.`, Date.now());\n    }\n  }\n}\n\nfunction applyVivianaArc(stat_data: any): void {\n  const current_place = String(_.get(stat_data, '.', ''));\n  const in_library = //.test(current_place);\n  const onstage = _.get(stat_data, '.', []) as OnStageCharacter[];\n  const long_map = _.get(stat_data, '.NPC', {}) as Record<string, any>;\n  const names = _.uniq([\n    ...onstage.map(v => String(v. || '')),\n    ...Object.keys(long_map),\n  ]).filter(v => //.test(v));\n  if (names.length === 0) return;\n\n  for (const name of names) {\n    if (!in_library) {\n      _.remove(onstage, v => String(v?. ?? '') === name);\n      continue;\n    }\n    const npc = _.get(stat_data, `.NPC.${name}`, {});\n    const score = clampAffection(_.get(npc, '', 0), 0);\n    const stage = String(_.get(npc, '', calcAffectionStage(score)));\n    const is_partner = stage === '' || (Array.isArray(_.get(npc, '')) && _.get(npc, '').includes(''));\n\n    let attitude = '';\n    let thought = '';\n    if (score >= 1) {\n      attitude = '';\n      thought = '';\n    }\n    if (score >= 101) {\n      attitude = '';\n      thought = '';\n    }\n    if (score >= 401) {\n      attitude = '';\n      thought = '';\n    }\n    if (score >= 601) {\n      attitude = '';\n      thought = '';\n    }\n    if (is_partner) {\n      attitude = '';\n      thought = '';\n      _.set(stat_data, `.NPC.${name}.`, '');\n    }\n\n    _.set(stat_data, `.NPC.${name}.`, attitude);\n    _.set(stat_data, `.NPC.${name}.`, thought);\n    _.set(stat_data, `.NPC.${name}.`, Date.now());\n\n    const idx = onstage.findIndex(v => String(v?. ?? '') === name);\n    if (idx >= 0) {\n      onstage[idx]. = attitude;\n      onstage[idx]. = `${thought}`;\n      onstage[idx]. = Date.now();\n    }\n  }\n}\n\nconst dungeon_enter_pattern = /|||||/i;\nconst dungeon_leave_pattern = /||||/i;\nconst dungeon_move_pattern = /||||||/i;\nconst dungeon_search_pattern = /||||||/i;\nconst dungeon_blow_pattern = /||||/i;\n\nconst lab_level_options = ['', '', '', ''] as const;\nconst lab_room_pool: Record<'' | '' | '' | '', string[]> = {\n  : ['', '', '', '', '', '', '', ''],\n  : ['', '', '', '', '', '', '', '', ''],\n  : ['', '', '', '', '', '', ''],\n  : ['', '', '', '', '', ''],\n};\n\ntype ItemTier = '' | '' | '' | '' | '' | '';\nconst tier_value_range: Record<ItemTier, [number, number]> = {\n  : [1, 1000],\n  : [1001, 5000],\n  : [5001, 20000],\n  : [20001, 50000],\n  : [50001, 200000],\n  : [200001, 20000000],\n};\nconst tier_affix_count: Record<ItemTier, number> = {\n  : 0,\n  : 1,\n  : 2,\n  : 3,\n  : 4,\n  : 5,\n};\nconst affix_pool = [\n  '', '', '', '', '', '', '', '', '', '',\n];\nconst trade_only_items = ['', '', '', '', ''];\nconst black_market_trade_pattern = /.*(||||)/i;\nconst black_market_buy_pattern = /.*(|||)/i;\n\nfunction parseLabLevel(content: string): (typeof lab_level_options)[number] {\n  if (//.test(content)) return '';\n  if (//.test(content)) return '';\n  if (//.test(content)) return '';\n  return '';\n}\n\nfunction parseMapScale(content: string, level: (typeof lab_level_options)[number]): '' | '' | '' {\n  if (//.test(content)) return '';\n  if (//.test(content)) return '';\n  if (//.test(content)) return '';\n  if (level === '' || level === '') return '';\n  if (level === '') return '';\n  return '';\n}\n\nfunction rollRoomTypeByLuck(luck: number): '' | '' | '' | '' {\n  // 1.012~34~7/8~910\n  // 20 +0.1/\n  const shift = Math.max(0, Math.floor(luck / 20));\n  let good_weight = 2 + shift;\n  let normal_weight = Math.max(1, 4 - shift);\n  let danger_weight = 1;\n  let risky_weight = 2;\n  if (shift >= 2) {\n    risky_weight = Math.max(1, risky_weight - Math.floor(shift / 2));\n  }\n  const hidden_weight = 1;\n  const total = hidden_weight + good_weight + normal_weight + risky_weight + danger_weight;\n  const r = Math.random() * total;\n  if (r < hidden_weight) return '';\n  if (r < hidden_weight + good_weight) return '';\n  if (r < hidden_weight + good_weight + normal_weight) return '';\n  // /\n  return '';\n}\n\nfunction buildRoomContainer(room_type: '' | '' | '' | ''): { : number; : number; : boolean; : boolean } {\n  if (room_type === '') return { : 0, : 4, : false, : false };\n  if (room_type === '') {\n    const locked = Math.random() < 0.35;\n    return locked\n      ? { : 0, : _.random(2, 5), : true, : false }\n      : { : 1, : 1, : false, : false };\n  }\n  if (room_type === '') return { : 2, : 0, : false, : false };\n  const trap_or_danger = Math.random() < 0.7; // /1\n  return { : trap_or_danger ? 1 : 0, : 0, : false, : false };\n}\n\nfunction generateDungeonMap(level: (typeof lab_level_options)[number], scale: '' | '' | '', luck: number): any[] {\n  const count = scale === '' ? 5 : scale === '' ? 12 : 20;\n  const rooms: any[] = [];\n  for (let i = 1; i <= count; i += 1) {\n    const room_type = rollRoomTypeByLuck(luck);\n    // /\n    const room_name = _.sample(lab_room_pool[room_type]) ?? (room_type === '' ? '' : '');\n    rooms.push({\n      : i,\n      : room_name,\n      : room_type,\n      : buildRoomContainer(room_type),\n    });\n  }\n  return rooms;\n}\n\nfunction pickLootQuality(level: (typeof lab_level_options)[number], is_advanced: boolean): ItemTier {\n  const roll = _.random(1, 100);\n  if (level === '') {\n    if (roll >= 96) return '';\n    if (roll >= 75) return '';\n    if (roll >= 45) return '';\n    if (roll >= 20) return '';\n    return is_advanced ? '' : '';\n  }\n  if (level === '') {\n    if (roll >= 97) return '';\n    if (roll >= 82) return '';\n    if (roll >= 55) return '';\n    if (roll >= 25) return '';\n    return is_advanced ? '' : '';\n  }\n  if (level === '') {\n    if (roll >= 95) return '';\n    if (roll >= 75) return '';\n    if (roll >= 45) return '';\n    if (roll >= 20) return '';\n    return '';\n  }\n  if (roll >= 98) return '';\n  if (roll >= 85) return '';\n  if (roll >= 60) return '';\n  if (roll >= 30) return '';\n  return '';\n}\n\nfunction addWarehouseItem(stat_data: any, item_name: string, quality: ItemTier, count: number, category: string, desc: string, value: number, tags: string[], tradeable = true): void {\n  if (item_name === '') {\n    _.set(stat_data, '..', asNumber(_.get(stat_data, '..', 0), 0) + count);\n    return;\n  }\n  if (item_name === '') {\n    _.set(stat_data, '..', asNumber(_.get(stat_data, '..', 0), 0) + count);\n    return;\n  }\n  const key = `...${item_name}`;\n  const old_count = asNumber(_.get(stat_data, `${key}.`, 0), 0);\n  const old_tags = _.get(stat_data, `${key}.`, []);\n  _.set(stat_data, key, {\n    : quality,\n    : old_count + count,\n    : value,\n    : category,\n    : desc,\n    : _.uniq([...(Array.isArray(old_tags) ? old_tags : []), ...tags]),\n    : tradeable,\n  });\n  if (/||/.test(quality)) {\n    const curr = _.get(stat_data, '..', []);\n    _.set(stat_data, '..', _.uniq([...(Array.isArray(curr) ? curr : []), item_name]));\n  }\n}\n\nfunction generateLootFromContainer(stat_data: any, level: (typeof lab_level_options)[number], container_type: '' | '', slot_override?: number): Record<string, any> {\n  const slots = slot_override ?? (container_type === '' ? 3 : 2);\n  const loot: Record<string, any> = {};\n  const pools = {\n    : ['', '', '', '', ''],\n    : ['', '', '', ''],\n    : ['', '', '', ''],\n    : ['', '', ''],\n  };\n  for (let i = 0; i < slots; i += 1) {\n    const quality = pickLootQuality(level, container_type === '');\n    const category = quality === '' || quality === ''\n      ? _.sample(['', '', '']) ?? ''\n      : _.sample(['', '', '']) ?? '';\n    const is_trade_only = category === '' && Math.random() < 0.45;\n    const item_name = (() => {\n      if (is_trade_only) return _.sample(trade_only_items) ?? '';\n      if (quality === '') return Math.random() < 0.25 ? '' : '';\n      if (quality === '') return '';\n      if (quality === '') return '';\n      return _.sample((pools as any)[category]) ?? '';\n    })();\n    const count = item_name === '' ? _.random(40, 280) : item_name === '' ? _.random(1, 4) : 1;\n    const [vmin, vmax] = tier_value_range[quality];\n    const value = _.random(vmin, vmax);\n    const tags = is_trade_only ? [] : _.sampleSize(affix_pool, tier_affix_count[quality]);\n    loot[item_name] = {\n      : quality,\n      : asNumber(_.get(loot, `${item_name}.`, 0), 0) + count,\n      : value,\n    };\n    addWarehouseItem(stat_data, item_name, quality, count, category, `${container_type}`, value, tags, true);\n  }\n  return loot;\n}\n\nfunction mergeLootRecord(target: Record<string, any>, incoming: Record<string, any>): void {\n  for (const [name, item] of Object.entries(incoming)) {\n    const old_count = asNumber(_.get(target, `${name}.`, 0), 0);\n    target[name] = {\n      : String((item as any)?. ?? _.get(target, `${name}.`, '')),\n      : old_count + asNumber((item as any)?., 0),\n      : asNumber((item as any)?., asNumber(_.get(target, `${name}.`, 1), 1)),\n    };\n  }\n}\n\nfunction applyDungeonLootSystem(stat_data: any, content: string): void {\n  ensureNpcData(stat_data);\n  const level = parseLabLevel(content);\n  const scale = parseMapScale(content, level);\n  const luck = asNumber(_.get(stat_data, '..', 1), 1) * 20;\n\n  if (dungeon_enter_pattern.test(content)) {\n    const map = generateDungeonMap(level, scale, luck);\n    _.set(stat_data, '.', {\n      : true,\n      : '',\n      : level,\n      : scale,\n      : map.length,\n      : 0,\n      : 1,\n      : map[0]?. ?? '',\n      : `${level}/${scale}/${map.length}`,\n      : map,\n    });\n    _.set(stat_data, '.', true);\n    _.set(stat_data, '..', `${level}${scale}`);\n    return;\n  }\n\n  if (!Boolean(_.get(stat_data, '..', false))) return;\n  const rooms = _.get(stat_data, '..', []) as any[];\n  if (!Array.isArray(rooms) || rooms.length === 0) return;\n  let idx = _.clamp(asNumber(_.get(stat_data, '..', 0), 0), 0, rooms.length - 1);\n\n  if (dungeon_move_pattern.test(content)) {\n    idx = Math.min(rooms.length - 1, idx + 1);\n    _.set(stat_data, '..', idx);\n    _.set(stat_data, '..', Math.max(asNumber(_.get(stat_data, '..', 1), 1), idx + 1));\n    _.set(stat_data, '..', String(rooms[idx]?. ?? ''));\n  }\n\n  if (dungeon_search_pattern.test(content)) {\n    const room = rooms[idx];\n    if (room?.?.) {\n      _.set(stat_data, '.', {});\n      _.set(stat_data, '..', `${idx + 1}`);\n      _.set(stat_data, '.', true);\n    } else {\n      const merged_loot: Record<string, any> = {};\n      const is_blow = dungeon_blow_pattern.test(content) && Boolean(room?.?.);\n      const slot_override = is_blow ? 1 : undefined;\n      const normal_count = asNumber(room?.?., 0);\n      const advanced_count = asNumber(room?.?., 0);\n\n      for (let i = 0; i < normal_count; i += 1) {\n        const loot = generateLootFromContainer(stat_data, _.get(stat_data, '..', level), '', slot_override);\n        mergeLootRecord(merged_loot, loot);\n      }\n      for (let i = 0; i < advanced_count; i += 1) {\n        const loot = generateLootFromContainer(stat_data, _.get(stat_data, '..', level), '', slot_override);\n        mergeLootRecord(merged_loot, loot);\n      }\n\n      _.set(room, '.', true);\n      _.set(stat_data, '.', merged_loot);\n      _.set(stat_data, '.', true);\n      _.set(stat_data, '..', is_blow ? '1/' : `${idx + 1}`);\n      _.set(stat_data, `.-${Date.now()}`, `${idx + 1}:${room?. ?? ''} `);\n      trimBattleLogs(stat_data, 3);\n    }\n  }\n\n  if (dungeon_leave_pattern.test(content)) {\n    _.set(stat_data, '..', false);\n    _.set(stat_data, '..', '');\n  }\n}\n\nfunction applyBlackMarketTrade(stat_data: any, content: string): void {\n  if (!/|/.test(content)) return;\n  const market_place = '';\n  if (/|||/.test(content)) {\n    _.set(stat_data, '.', market_place);\n    _.set(stat_data, '..', '');\n  }\n\n  const items = _.get(stat_data, '..', {}) as Record<string, any>;\n  const names = Object.keys(items);\n  if (black_market_trade_pattern.test(content)) {\n    const targets = [...detectMentionedNames(content, names)];\n    for (const name of targets) {\n      const qty_match = content.match(new RegExp(`${_.escapeRegExp(name)}\\\\D*(\\\\d+)`, 'i'));\n      const sell_qty = Math.max(1, asNumber(qty_match?.[1], 1));\n      const own_qty = asNumber(_.get(stat_data, `...${name}.`, 0), 0);\n      if (own_qty <= 0) continue;\n      const use_qty = Math.min(own_qty, sell_qty);\n      const value = asNumber(_.get(stat_data, `...${name}.`, 1), 1);\n      const tradeable = Boolean(_.get(stat_data, `...${name}.`, true));\n      if (!tradeable) continue;\n      const income = Math.floor(value * use_qty * 0.1); // 90%\n      _.set(stat_data, '..', asNumber(_.get(stat_data, '..', 0), 0) + income);\n      const left = own_qty - use_qty;\n      if (left <= 0) _.unset(stat_data, `...${name}`);\n      else _.set(stat_data, `...${name}.`, left);\n      _.set(stat_data, '..', ` ${name} x${use_qty}${income}90%`);\n    }\n  }\n\n  if (black_market_buy_pattern.test(content)) {\n    const want_tier = (['', '', '', '', '', ''] as ItemTier[]).find(t => content.includes(t)) ?? '';\n    const [vmin, vmax] = tier_value_range[want_tier];\n    const price = _.random(vmin, vmax);\n    const money = asNumber(_.get(stat_data, '..', 0), 0);\n    if (money >= price) {\n      _.set(stat_data, '..', money - price);\n      const item_name = `${want_tier}-${Date.now().toString().slice(-4)}`;\n      const tags = _.sampleSize(affix_pool, tier_affix_count[want_tier]);\n      addWarehouseItem(stat_data, item_name, want_tier, 1, '', '', price, tags, true);\n      _.set(stat_data, '..', ` ${item_name}${want_tier} ${price}`);\n    } else {\n      _.set(stat_data, '..', `${price}${money}`);\n    }\n  }\n}\n\nfunction hasExplicitUpdateTag(content: string): boolean {\n  return /<update(?:variable)?>[\\s\\S]*?<\\/update(?:variable)?>|<update(?:variable)?>[\\s\\S]*$/im.test(content);\n}\n\nfunction patchGameplayState(stat_data: any, content: string): void {\n  if (!stat_data || typeof stat_data !== 'object') return;\n\n  const profession = _.get(stat_data, '..', '');\n  const is_warmaid = profession === '' || String(_.get(stat_data, '..', '')).includes('');\n  if (!is_warmaid) {\n    _.set(stat_data, '..', false);\n    _.set(stat_data, '.', false);\n    return;\n  }\n\n  const current_round = asNumber(_.get(stat_data, '..', 0), 0);\n  const line = String(_.get(stat_data, '..', ''));\n  const threat = String(_.get(stat_data, '.', ''));\n  const manual_toggle = Boolean(_.get(stat_data, '..', false));\n\n  const battle_by_state = current_round > 1 || line === '' || line === '' || threat === '' || threat === '';\n  const battle_by_text = /||||||||||/i.test(content);\n  const in_battle = battle_by_state || battle_by_text;\n\n  const was_enabled = Boolean(_.get(stat_data, '..', false));\n  const should_enable = manual_toggle || in_battle;\n  _.set(stat_data, '..', should_enable);\n\n  let last_round = asNumber(_.get(stat_data, '..', 0), 0);\n  if (!was_enabled && should_enable) {\n    last_round = current_round;\n    _.set(stat_data, '..', current_round);\n  }\n\n  if (should_enable) {\n    const round_delta = Math.max(0, current_round - last_round);\n    if (round_delta > 0) {\n      const magic_cost = asNumber(_.get(stat_data, '..', 0), 0) * round_delta;\n      const slot_cost = asNumber(_.get(stat_data, '..', 0), 0) * round_delta;\n\n      const current_magic = asNumber(_.get(stat_data, '..', 0), 0);\n      const current_slot = asNumber(_.get(stat_data, '..', 0), 0);\n      const next_magic = Math.max(0, current_magic - magic_cost);\n      const next_slot = Math.max(0, current_slot - slot_cost);\n\n      _.set(stat_data, '..', next_magic);\n      _.set(stat_data, '..', next_slot);\n      _.set(stat_data, '..', current_round);\n\n      if (next_magic <= 0 || next_slot <= 0) {\n        _.set(stat_data, '..', false);\n        _.set(stat_data, '..', false);\n      }\n    }\n  } else if (last_round > current_round) {\n    _.set(stat_data, '..', current_round);\n  }\n\n  // /\n}\n\nfunction getWarmaidType(stat_data: any): string {\n  return String(\n    _.get(stat_data, '..', '').trim()\n      || _.get(stat_data, '..', '').replace('-', '').trim(),\n  );\n}\n\nfunction applyBattleSystemConstraints(stat_data: any, content: string): void {\n  if (!stat_data || typeof stat_data !== 'object') return;\n  ensureAirCombatData(stat_data);\n\n  const mode_by_text =\n    /|||||/i.test(content) ? ''\n      : /||||/i.test(content) ? ''\n        : '';\n  const current_round = asNumber(_.get(stat_data, '..', 1), 1);\n  const threat = String(_.get(stat_data, '.', ''));\n  const line = String(_.get(stat_data, '..', ''));\n  const in_battle_by_state = current_round > 1 || line === '' || line === '' || threat === '' || threat === '';\n  const in_battle_by_text = /||||||||||/i.test(content);\n  const in_battle = in_battle_by_state || in_battle_by_text;\n\n  const mode = in_battle ? (mode_by_text === '' ? '' : mode_by_text) : '';\n  _.set(stat_data, '..', mode);\n  _.set(stat_data, '..', in_battle);\n\n  if (!in_battle) {\n    _.set(stat_data, '..', 1);\n    _.set(stat_data, '..', 1);\n    _.set(stat_data, '..', '');\n    return;\n  }\n\n  const profession = _.get(stat_data, '..', '');\n  const warmaid_type = getWarmaidType(stat_data);\n  const is_commander = profession === '';\n  const is_authority = profession === '';\n\n  let ap = 1;\n  let mp = 1;\n  let penalty = '';\n\n  if (mode === '') {\n    const agi = asNumber(_.get(stat_data, '..', 1), 1);\n    ap = Math.max(1, Math.floor(agi / 3));\n    mp = warmaid_type === '' ? 0 : 1;\n  } else if (is_commander) {\n    ap = 1;\n    mp = 1;\n    if (line !== '') {\n      _.set(stat_data, '..', '');\n    }\n  } else if (is_authority) {\n    ap = 1;\n    mp = 1;\n  } else {\n    if (warmaid_type === '') {\n      ap = 1; mp = 2;\n    } else if (warmaid_type === '') {\n      ap = 2; mp = 1;\n    } else if (warmaid_type === '') {\n      ap = 1; mp = 1;\n    } else if (warmaid_type === '') {\n      ap = 1;\n      const move_counter = asNumber(_.get(stat_data, '..', 0), 0) + 1;\n      _.set(stat_data, '..', move_counter % 2);\n      mp = move_counter % 2 === 0 ? 1 : 0;\n      if (line === '') penalty = '-1/3';\n      if (line === '') penalty = '-1/2';\n    } else if (warmaid_type === '') {\n      ap = 1;\n      mp = 0;\n      if (line === '') penalty = '-1/2';\n      if (line === '' || line === '') penalty = '/';\n    } else if (warmaid_type === '') {\n      ap = 1; mp = 1;\n    }\n  }\n\n  _.set(stat_data, '..', ap);\n  _.set(stat_data, '..', mp);\n  if (mode === '') {\n    const weather_hit = asNumber(_.get(stat_data, '...', 0), 0);\n    const superiority = asNumber(_.get(stat_data, '...', 0), 0);\n    const heavy_condition = String(_.get(stat_data, '...', ''));\n    const transform_on = Boolean(_.get(stat_data, '..', false));\n    const airflow_penalty = `: ${weather_hit >= 0 ? '+' : ''}${weather_hit} / ${superiority >= 0 ? '+' : ''}${superiority} | :${heavy_condition}`;\n    penalty = penalty === '' ? airflow_penalty : `${penalty}${airflow_penalty}`;\n    if (!transform_on && !is_commander && !is_authority) {\n      penalty = `${penalty}: `;\n    }\n  }\n\n  _.set(stat_data, '..', penalty);\n}\n\nfunction applyHumanTraining(stat_data: any, content: string): void {\n  if (!stat_data || typeof stat_data !== 'object') return;\n  const attrs: Array<'' | '' | '' | '' | '' | '' | ''> = [\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n  ];\n\n  const keyword_map: Record<(typeof attrs)[number], RegExp> = {\n    : /|||||||/i,\n    : /||||||/i,\n    : /||||||/i,\n    : /|||||||/i,\n    : /||||||/i,\n    : /||||||/i,\n    : /|||||||/i,\n  };\n\n  attrs.forEach(attr => {\n    const matched = keyword_map[attr].test(content);\n    if (!matched) return;\n\n    const current_attr = asNumber(_.get(stat_data, `..${attr}`, 1), 1);\n    if (current_attr >= 5) {\n      _.set(stat_data, `..${attr}`, 100);\n      return;\n    }\n\n    const current_train = asNumber(_.get(stat_data, `..${attr}`, 0), 0);\n    const next_train = Math.min(100, current_train + 1);\n\n    if (next_train >= 100) {\n      _.set(stat_data, `..${attr}`, Math.min(5, current_attr + 1));\n      _.set(stat_data, `..${attr}`, 0);\n    } else {\n      _.set(stat_data, `..${attr}`, next_train);\n    }\n  });\n}\n\ntype SkillAttr = '' | '' | '' | '' | '' | '' | '' | '';\n\nfunction rollD10(): number {\n  return Math.floor(Math.random() * 10) + 1;\n}\n\nfunction inferSkillAttr(content: string): SkillAttr {\n  const map: Array<{ attr: SkillAttr; pattern: RegExp }> = [\n    { attr: '', pattern: /||||||||||||||||||||||/i },\n    { attr: '', pattern: /|||||||||||/i },\n    { attr: '', pattern: /|||||||||||/i },\n    { attr: '', pattern: /|||||||||||/i },\n    { attr: '', pattern: /||||||san||||/i },\n    { attr: '', pattern: /||||||||||/i },\n    { attr: '', pattern: /|||||||||||||||/i },\n  ];\n  const hit = map.find(item => item.pattern.test(content));\n  return hit?.attr ?? '';\n}\n\nfunction inferActionTag(content: string): string {\n  const rules: Array<{ tag: string; pattern: RegExp }> = [\n    { tag: '', pattern: /|||||||/i },\n    { tag: '', pattern: /|||/i },\n    { tag: '', pattern: /||||/i },\n    { tag: '', pattern: /||/i },\n    { tag: '', pattern: /||/i },\n    { tag: '', pattern: /||||/i },\n    { tag: '', pattern: /|||/i },\n    { tag: '', pattern: /|||/i },\n    { tag: '', pattern: /|||/i },\n  ];\n  return rules.find(r => r.pattern.test(content))?.tag ?? '';\n}\n\nfunction inferDifficulty(content: string, attr: SkillAttr): { penalty: number; label: string } {\n  let penalty = 0;\n  const hard = /|||||||||||||/i.test(content);\n  const extreme = /|||||||/i.test(content);\n\n  if (hard) penalty += 2;\n  if (extreme) penalty += 2;\n\n  if (attr === '' && /||||||/i.test(content) && hard) {\n    penalty += 1;\n  }\n\n  if (penalty <= 0) return { penalty: 0, label: '' };\n  if (penalty <= 2) return { penalty, label: '' };\n  if (penalty <= 4) return { penalty, label: '' };\n  return { penalty: Math.min(6, penalty), label: '' };\n}\n\ntype SkillOutcome = {\n  attr: SkillAttr;\n  action_tag: string;\n  current_round: number;\n  raw: number;\n  bonus: number;\n  difficulty_penalty: number;\n  difficulty_label: string;\n  total: number;\n  result: '' | '' | '' | '';\n  desc: string;\n  lock_to_round: number;\n  hp_loss: number;\n  mp_loss: number;\n};\n\ntype PendingSkillState = {\n  user_message_id: number;\n  source_content: string;\n  outcome: SkillOutcome;\n  feedback_prompt: string;\n  injected: boolean;\n  game_over: boolean;\n};\n\nfunction resolveSkillOutcome(stat_data: any, content: string, raw_override?: number): SkillOutcome | undefined {\n  const has_explicit_check = /||/i.test(content);\n  const has_action_verb = /||||||||||||||||||||||||||||||san||||||||/i.test(content);\n  const inferred_attr = inferSkillAttr(content);\n  const should_check = has_explicit_check || (has_action_verb && inferred_attr !== '');\n  if (!should_check) return undefined;\n\n  const attr = inferred_attr;\n  const action_tag = inferActionTag(content);\n  const current_round = asNumber(_.get(stat_data, '..', 1), 1);\n  const lock_action = String(_.get(stat_data, '..', ''));\n  const lock_until = asNumber(_.get(stat_data, '..', 0), 0);\n\n  if (lock_action && lock_action === action_tag && current_round <= lock_until) {\n    return {\n      attr,\n      action_tag,\n      current_round,\n      raw: 1,\n      bonus: 0,\n      difficulty_penalty: 0,\n      difficulty_label: '',\n      total: 0,\n      result: '',\n      desc: `${action_tag}  ${lock_until} `,\n      lock_to_round: lock_until,\n      hp_loss: 0,\n      mp_loss: 0,\n    };\n  }\n\n  const bonus = attr === '' ? 0 : asNumber(_.get(stat_data, `..${attr}`, 0), 0);\n  const difficulty = inferDifficulty(content, attr);\n  const raw = _.clamp(raw_override ?? rollD10(), 1, 10);\n  const total = Math.max(0, raw + bonus - difficulty.penalty);\n\n  let result: '' | '' | '' | '' = '';\n  let desc = '';\n  if (raw === 10) {\n    result = '';\n    desc = '=10';\n  } else if (raw === 1) {\n    result = '';\n    desc = '=1';\n  } else if (total > 5) {\n    result = '';\n    desc = ` ${total - 5}`;\n  } else {\n    result = '';\n    desc = ` ${5 - total}`;\n  }\n\n  let lock_to_round = 0;\n  let hp_loss = 0;\n  let mp_loss = 0;\n  if (result === '' || result === '') {\n    const lock_rounds = result === '' ? 4 : 2;\n    lock_to_round = current_round + lock_rounds;\n    hp_loss = result === '' ? 12 : 4;\n    mp_loss = result === '' ? 15 : 5;\n    desc += ` -${hp_loss}-${mp_loss} ${lock_to_round} `;\n  }\n\n  return {\n    attr,\n    action_tag,\n    current_round,\n    raw,\n    bonus,\n    difficulty_penalty: difficulty.penalty,\n    difficulty_label: difficulty.label,\n    total,\n    result,\n    desc,\n    lock_to_round,\n    hp_loss,\n    mp_loss,\n  };\n}\n\nfunction applyResolvedSkillOutcome(stat_data: any, content: string, outcome: SkillOutcome): void {\n  if (outcome.result === '' || outcome.result === '') {\n    const lock_rounds = outcome.result === '' ? 4 : 2;\n    _.set(stat_data, '..', outcome.action_tag);\n    _.set(stat_data, '..', outcome.lock_to_round);\n    _.set(\n      stat_data,\n      `..${outcome.action_tag}`,\n      {\n        : outcome.result === '' ? '' : '',\n        : outcome.result === '' ? '' : '',\n        : lock_rounds,\n      },\n    );\n    _.set(stat_data, '..', Math.max(0, asNumber(_.get(stat_data, '..', 0), 0) - outcome.hp_loss));\n    _.set(stat_data, '..', Math.max(0, asNumber(_.get(stat_data, '..', 0), 0) - outcome.mp_loss));\n  } else {\n    _.set(stat_data, '..', '');\n    _.set(stat_data, '..', 0);\n  }\n\n  _.set(stat_data, '.', {\n    : content.slice(0, 80),\n    : outcome.attr,\n    : outcome.raw,\n    : outcome.bonus,\n    : outcome.difficulty_penalty,\n    : outcome.difficulty_label,\n    : outcome.total,\n    : outcome.result,\n    : outcome.desc,\n    : outcome.result === '' || outcome.result === '' ? outcome.action_tag : '',\n    : outcome.lock_to_round,\n    : Date.now(),\n  });\n\n  _.set(\n    stat_data,\n    `.-${Date.now()}`,\n    `${outcome.action_tag} | ${outcome.attr} | ${outcome.raw}+${outcome.bonus}-${outcome.difficulty_penalty}=${outcome.total} | ${outcome.difficulty_label} | ${outcome.result} | ${outcome.desc}`,\n  );\n  trimBattleLogs(stat_data, 3);\n  _.set(\n    stat_data,\n    '..',\n    `${outcome.action_tag}(${outcome.attr})=${outcome.result}${outcome.total}${outcome.raw}${outcome.difficulty_penalty}`,\n  );\n}\n\nfunction applySkillCheckSystem(stat_data: any, content: string): SkillOutcome | undefined {\n  const outcome = resolveSkillOutcome(stat_data, content);\n  if (!outcome) return undefined;\n  applyResolvedSkillOutcome(stat_data, content, outcome);\n  return outcome;\n}\n\nfunction enforceGameOver(stat_data: any, reason: string): boolean {\n  const hp = asNumber(_.get(stat_data, '..', 0), 0);\n  if (hp > 0) return false;\n\n  _.set(stat_data, '..', 0);\n  _.set(stat_data, '..', false);\n  _.set(stat_data, '..', false);\n  _.set(stat_data, '..', false);\n  _.set(stat_data, '..', '');\n  _.set(stat_data, '..', true);\n  _.set(stat_data, '..', reason);\n  _.set(stat_data, '..', Date.now());\n  _.set(stat_data, `.-${Date.now()}`, reason);\n  trimBattleLogs(stat_data, 3);\n  _.set(stat_data, '..', '');\n  return true;\n}\n\nconst battle_time_pattern = /||||||||||/i;\nconst dialogue_time_pattern = /|||||||||/i;\nconst jump_time_pattern = /(?:|||)\\s*([^\\n,;]+)/i;\n\nfunction formatUnionDateTime(date: Date): string {\n  const union_year = Math.max(1, date.getFullYear() - 2000);\n  const month = date.getMonth() + 1;\n  const day = date.getDate();\n  const hour = `${date.getHours()}`.padStart(2, '0');\n  const minute = `${date.getMinutes()}`.padStart(2, '0');\n  return `${union_year}${month}${day} ${hour}:${minute}`;\n}\n\nfunction parseWorldDateTime(value: unknown): Date {\n  const text = String(value ?? '').trim();\n  if (!text) return new Date(2177, 7, 28, 8, 0, 0, 0);\n\n  const union_match = text.match(/\\s*(\\d+)\\s*\\s*(\\d{1,2})\\s*\\s*(\\d{1,2})\\s*(?:\\s*(\\d{1,2})[:](\\d{1,2}))?/);\n  if (union_match) {\n    const year = 2000 + asNumber(union_match[1], 177);\n    const month = asNumber(union_match[2], 8);\n    const day = asNumber(union_match[3], 28);\n    const hour = asNumber(union_match[4], 8);\n    const minute = asNumber(union_match[5], 0);\n    return new Date(year, month - 1, day, hour, minute, 0, 0);\n  }\n\n  const iso_like = text.match(/(\\d{4})[-/](\\d{1,2})[-/](\\d{1,2})(?:\\s+(\\d{1,2})[:](\\d{1,2}))?/);\n  if (iso_like) {\n    const year = asNumber(iso_like[1], 2026);\n    const month = asNumber(iso_like[2], 1);\n    const day = asNumber(iso_like[3], 1);\n    const hour = asNumber(iso_like[4], 8);\n    const minute = asNumber(iso_like[5], 0);\n    return new Date(year, month - 1, day, hour, minute, 0, 0);\n  }\n\n  return new Date(2177, 7, 28, 8, 0, 0, 0);\n}\n\nfunction parseTimeJumpTarget(text: string, current: Date): Date | undefined {\n  const source = String(text ?? '').trim();\n  if (!source) return undefined;\n\n  const full_match = source.match(/(?:(?:)?\\s*(\\d+)\\s*)?\\s*(\\d{1,2})\\s*\\s*(\\d{1,2})\\s*(?:\\s*(\\d{1,2})[:](\\d{1,2})?)?/);\n  if (full_match) {\n    const year = full_match[1] ? 2000 + asNumber(full_match[1], current.getFullYear() - 2000) : current.getFullYear();\n    const month = asNumber(full_match[2], current.getMonth() + 1);\n    const day = asNumber(full_match[3], current.getDate());\n    const hour = full_match[4] ? asNumber(full_match[4], 8) : current.getHours();\n    const minute = full_match[5] ? asNumber(full_match[5], 0) : current.getMinutes();\n    return new Date(year, month - 1, day, hour, minute, 0, 0);\n  }\n\n  const day_only_match = source.match(/(\\d{1,2})\\s*\\s*(\\d{1,2})\\s*/);\n  if (day_only_match) {\n    const month = asNumber(day_only_match[1], current.getMonth() + 1);\n    const day = asNumber(day_only_match[2], current.getDate());\n    const hm = source.match(/(\\d{1,2})[:](\\d{1,2})/);\n    const hour = hm ? asNumber(hm[1], 8) : current.getHours();\n    const minute = hm ? asNumber(hm[2], 0) : current.getMinutes();\n    return new Date(current.getFullYear(), month - 1, day, hour, minute, 0, 0);\n  }\n\n  const hm_only = source.match(/(\\d{1,2})[:](\\d{1,2})/);\n  if (hm_only) {\n    const hour = asNumber(hm_only[1], current.getHours());\n    const minute = asNumber(hm_only[2], current.getMinutes());\n    return new Date(current.getFullYear(), current.getMonth(), current.getDate(), hour, minute, 0, 0);\n  }\n\n  return undefined;\n}\n\nfunction advanceWorldTimeByAction(stat_data: any, content: string): void {\n  if (!stat_data || typeof stat_data !== 'object') return;\n  const prev_text = String(_.get(stat_data, '.', '')).trim();\n  const prev_date = parseWorldDateTime(prev_text);\n\n  const jump_match = content.match(jump_time_pattern);\n  if (jump_match?.[1]) {\n    const jump_target = parseTimeJumpTarget(jump_match[1], prev_date);\n    if (jump_target) {\n      const next_text = formatUnionDateTime(jump_target);\n      _.set(stat_data, '.', next_text);\n      _.set(stat_data, '..', `${prev_text || formatUnionDateTime(prev_date)} -> ${next_text}`);\n      return;\n    }\n  }\n\n  const delta_minutes = battle_time_pattern.test(content)\n    ? _.random(240, 360)\n    : dialogue_time_pattern.test(content)\n      ? 5\n      : 20;\n\n  const next_date = new Date(prev_date.getTime() + delta_minutes * 60 * 1000);\n  const next_text = formatUnionDateTime(next_date);\n  const reason = battle_time_pattern.test(content)\n    ? `${delta_minutes}`\n    : dialogue_time_pattern.test(content)\n      ? '5'\n      : '20';\n  _.set(stat_data, '.', next_text);\n  _.set(stat_data, '..', `${prev_text || formatUnionDateTime(prev_date)} -> ${next_text}${reason}`);\n}\n\nconst player_background_trigger_pattern = /(||||||||)/;\nconst player_background_strip_pattern = /|||||||||/;\n\nfunction summarizePlayerBackground(raw: string): string {\n  const text = String(raw ?? '')\n    .replace(/\\r/g, '')\n    .replace(/[ \\t]+/g, ' ')\n    .trim();\n  if (!text) return '';\n\n  const lines = text\n    .split('\\n')\n    .map(v => v.trim())\n    .filter(Boolean)\n    .filter(v => !player_background_strip_pattern.test(v));\n\n  const merged = lines.join(' ');\n  if (!merged) return '';\n  return merged.length > 180 ? `${merged.slice(0, 180)}...` : merged;\n}\n\nfunction applyPlayerBackgroundInput(stat_data: any, content: string): boolean {\n  const source = String(content ?? '').trim();\n  if (!source) return false;\n  if (!player_background_trigger_pattern.test(source)) return false;\n  if (source.length < 24) return false;\n\n  const cleaned = source\n    .replace(/^.*?(||||||||)[:]?\\s*/i, '')\n    .trim();\n  const raw = cleaned || source;\n  const summary = summarizePlayerBackground(raw);\n  if (!summary) return false;\n\n  _.set(stat_data, '..', raw);\n  _.set(stat_data, '..', summary);\n  _.set(stat_data, '..', `${summary}`);\n  return true;\n}\n\nfunction buildOutcomePrompt(outcome: SkillOutcome, game_over: boolean): string {\n  const lines = [\n    '[-]',\n    `: ${outcome.action_tag}`,\n    `: ${outcome.attr}`,\n    `: D10(${outcome.raw}) + (${outcome.bonus}) - (${outcome.difficulty_penalty}) = ${outcome.total}`,\n    `: ${outcome.difficulty_label}`,\n    `: ${outcome.result}`,\n    `: ${outcome.desc}`,\n    ': ',\n  ];\n  if (game_over) {\n    lines.push(': /');\n  }\n  return lines.join('\\n');\n}\n\nfunction toShortText(value: unknown, fallback = '-'): string {\n  const text = String(value ?? '').trim();\n  return text || fallback;\n}\n\nfunction toInt(value: unknown, fallback = 0): number {\n  return Math.trunc(asNumber(value, fallback));\n}\n\nfunction pickTailEntries(source: unknown, keep = 2): Array<[string, string]> {\n  if (!_.isObjectLike(source)) return [];\n  return Object.entries(source as Record<string, unknown>)\n    .slice(-keep)\n    .map(([k, v]) => [k, toShortText(v)]);\n}\n\nfunction buildMvuSummaryPrompt(chat_data: any): string {\n  const stat = _.isObjectLike(chat_data?.stat_data) ? chat_data.stat_data : {};\n\n  const world_time = toShortText(_.get(stat, '.', _.get(stat, '.')));\n  const world_place = toShortText(_.get(stat, '.', _.get(stat, '.')));\n  const world_weather = toShortText(_.get(stat, '.'));\n  const world_threat = toShortText(_.get(stat, '.', ''));\n\n  const name = toShortText(_.get(stat, '..', _.get(stat, '..')));\n  const profession = toShortText(_.get(stat, '..'));\n  const path = toShortText(_.get(stat, '..'));\n\n  const hp = toInt(_.get(stat, '..', 0), 0);\n  const hp_max = toInt(_.get(stat, '..', hp), hp);\n  const mp = toInt(_.get(stat, '..', 0), 0);\n  const mp_max = toInt(_.get(stat, '..', mp), mp);\n  const action_point = toInt(_.get(stat, '..', 1), 1);\n  const move_point = toInt(_.get(stat, '..', 1), 1);\n  const slot_now = toInt(_.get(stat, '..', 0), 0);\n  const slot_max = toInt(_.get(stat, '..', slot_now), slot_now);\n  const corruption = toInt(_.get(stat, '..', 0), 0);\n\n  const in_battle = Boolean(_.get(stat, '..', false));\n  const mode = toShortText(_.get(stat, '..', ''));\n  const line = toShortText(_.get(stat, '..', ''));\n  const round = toInt(_.get(stat, '..', 1), 1);\n  const air_sup = toShortText(_.get(stat, '..', ''));\n  const fire_penalty = toShortText(_.get(stat, '..', ''));\n\n  const warmaid_lv = toInt(_.get(stat, '..', 0), 0);\n  const authority_lv = toInt(_.get(stat, '..', 0), 0);\n  const magic_shard = toInt(_.get(stat, '..', 0), 0);\n  const next_magic_shard = toInt(_.get(stat, '..', 0), 0);\n  const authority_shard = toInt(_.get(stat, '..', 0), 0);\n  const has_origin = Boolean(_.get(stat, '..', false));\n\n  const skill_result = toShortText(_.get(stat, '..', ''));\n  const skill_attr = toShortText(_.get(stat, '..', ''));\n  const skill_total = toInt(_.get(stat, '..', 0), 0);\n  const bg_summary = toShortText(_.get(stat, '..', ''), '');\n\n  const recent_affairs = pickTailEntries(_.get(stat, '.', {}), 2);\n  const recent_logs = pickTailEntries(_.get(stat, '', {}), 2);\n\n  const lines = [\n    '[MVU-]',\n    `: =${world_time} | =${world_place} | =${world_weather} | =${world_threat}`,\n    `: =${name} | =${profession} | =${path}`,\n    `: HP=${hp}/${hp_max} | MP=${mp}/${mp_max} | AP=${action_point} | Move=${move_point} | =${slot_now}/${slot_max} | =${corruption}`,\n    `: =${in_battle ? '' : ''} | =${mode} | =${line} | =${round} | =${air_sup} | =${fire_penalty}`,\n    `: =${warmaid_lv} | =${authority_lv} | =${magic_shard}(${next_magic_shard}) | =${authority_shard} | =${has_origin ? '' : ''}`,\n    `: =${skill_result} | =${skill_attr} | =${skill_total}`,\n  ];\n  if (bg_summary) {\n    lines.push(`: ${bg_summary}`);\n  }\n\n  if (recent_affairs.length > 0) {\n    lines.push(`: ${recent_affairs.map(([k, v]) => `${k}:${v}`).join('')}`);\n  }\n  if (recent_logs.length > 0) {\n    lines.push(`: ${recent_logs.map(([k, v]) => `${k}:${v}`).join('')}`);\n  }\n\n  lines.push(': ');\n  lines.push(':  <OnStageCharacters>JSON');\n  lines.push(': /');\n  lines.push(': ');\n  lines.push(': =');\n  lines.push('JSON: (string), (-200~1000), (string), (string), (object<number>)');\n  lines.push(': <NpcRelationHints>JSON</NpcRelationHints>: (string), (string[])');\n  return lines.join('\\n');\n}\n\n$(() => {\n  errorCatched(async () => {\n    const global_key = '__apocalypse_dawn_variable_bridge_installed__';\n    if ((window as any)[global_key]) return;\n    (window as any)[global_key] = true;\n\n    installHideOriginalReplyStyle();\n    registerMvuSchema(Schema);\n    await waitGlobalInitialized('Mvu');\n\n    const syncing_message_ids = new Set<number>();\n    const synced_message_content = new Map<number, string>();\n      const pending_skill_by_user_message = new Map<number, PendingSkillState>();\n    const processed_user_messages = new Set<number>();\n\n    async function processUserAction(message_id: number): Promise<void> {\n      if (processed_user_messages.has(message_id)) return;\n      const user_message = getChatMessages(message_id, { include_swipes: false })[0];\n      if (!user_message || user_message.role !== 'user' || user_message.is_hidden) return;\n\n      const source_content = String(user_message.message ?? '').trim();\n      if (!source_content) return;\n\n      const assistant_before = getChatMessages(`0-${Math.max(0, message_id - 1)}`, {\n        role: 'assistant',\n        include_swipes: false,\n      });\n      const anchor_assistant = assistant_before.length > 0 ? assistant_before[assistant_before.length - 1] : undefined;\n      const source_data = anchor_assistant\n        ? Mvu.getMvuData({ type: 'message', message_id: anchor_assistant.message_id })\n        : Mvu.getMvuData({ type: 'chat' });\n      const next_data = _.cloneDeep(source_data ?? {});\n      next_data.stat_data = _.isObjectLike(next_data?.stat_data) ? _.cloneDeep(next_data.stat_data) : {};\n      ensureAirCombatData(next_data.stat_data);\n      ensureNpcData(next_data.stat_data);\n      resetNpcStateBeforeCreate(next_data.stat_data);\n      applyPlayerBackgroundInput(next_data.stat_data, source_content);\n      advanceWorldTimeByAction(next_data.stat_data, source_content);\n      const user_npc_request_hit = applyUserNpcRequest(next_data.stat_data, source_content);\n\n      applyBattleSystemConstraints(next_data.stat_data, source_content);\n      patchGameplayState(next_data.stat_data, source_content);\n      applyDungeonLootSystem(next_data.stat_data, source_content);\n      applyBlackMarketTrade(next_data.stat_data, source_content);\n      applyVivianaArc(next_data.stat_data);\n      applyHumanTraining(next_data.stat_data, source_content);\n      reconcileGrowthLevel(next_data.stat_data);\n      const battle_started = startAirBattleIfTriggered(next_data.stat_data, source_content);\n      const battle_resolved = resolveAirCombatRound(next_data.stat_data, source_content);\n      const in_air_battle = Boolean(_.get(next_data.stat_data, '..', false))\n        && _.get(next_data.stat_data, '..', '') === '';\n\n      if (battle_started || battle_resolved || in_air_battle) {\n        processed_user_messages.add(message_id);\n        trimBattleLogs(next_data.stat_data, 3);\n        await Mvu.replaceMvuData(next_data, { type: 'chat' });\n        if (anchor_assistant) {\n          await Mvu.replaceMvuData(next_data, { type: 'message', message_id: anchor_assistant.message_id });\n        }\n        console.info(`[][]  ${message_id}`);\n        return;\n      }\n\n      const outcome = applySkillCheckSystem(next_data.stat_data, source_content);\n      if (!outcome) {\n        if (user_npc_request_hit) {\n          trimBattleLogs(next_data.stat_data, 3);\n          await Mvu.replaceMvuData(next_data, { type: 'chat' });\n          if (anchor_assistant) {\n            await Mvu.replaceMvuData(next_data, { type: 'message', message_id: anchor_assistant.message_id });\n          }\n        }\n        return;\n      }\n      processed_user_messages.add(message_id);\n\n      const game_over = enforceGameOver(\n        next_data.stat_data,\n        `${outcome.action_tag} / ${outcome.result}`,\n      );\n      const feedback_prompt = buildOutcomePrompt(outcome, game_over);\n      injectPrompts(\n        [{\n          id: `apocalypse-dawn-skill-feedback-pre-${message_id}-${Date.now()}`,\n          position: 'in_chat',\n          depth: 0,\n          role: 'system',\n          content: feedback_prompt,\n          should_scan: true,\n        }],\n        { once: true },\n      );\n      pending_skill_by_user_message.set(message_id, {\n        user_message_id: message_id,\n        source_content,\n        outcome,\n        feedback_prompt,\n        injected: true,\n        game_over,\n      });\n      trimBattleLogs(next_data.stat_data, 3);\n\n      await Mvu.replaceMvuData(next_data, { type: 'chat' });\n      if (anchor_assistant) {\n        await Mvu.replaceMvuData(next_data, { type: 'message', message_id: anchor_assistant.message_id });\n      }\n      console.info(`[][]  ${message_id}`);\n    }\n\n    async function syncMessageToMvu(message_id: number): Promise<void> {\n      if (syncing_message_ids.has(message_id)) return;\n\n      const message = getChatMessages(message_id, { include_swipes: false })[0];\n      if (!message || message.role !== 'assistant' || message.is_hidden) return;\n\n      const content = message.message?.trim() ?? '';\n      if (!content) return;\n      if (synced_message_content.get(message_id) === content) return;\n\n      syncing_message_ids.add(message_id);\n      try {\n        const old_data = Mvu.getMvuData({ type: 'message', message_id });\n        const new_data = await Mvu.parseMessage(content, old_data);\n\n        //  MVU \n        if (!hasExplicitUpdateTag(content)) {\n          new_data.stat_data = _.isObjectLike(old_data?.stat_data) ? _.cloneDeep(old_data.stat_data) : {};\n        }\n\n        if (!new_data.stat_data || typeof new_data.stat_data !== 'object') {\n          new_data.stat_data = {};\n        }\n        ensureAirCombatData(new_data.stat_data);\n        ensureNpcData(new_data.stat_data);\n        resetNpcStateBeforeCreate(new_data.stat_data);\n        if (!new_data.stat_data. || typeof new_data.stat_data. !== 'object') {\n          new_data.stat_data. = {};\n        }\n        const parsed_onstage = parseOnStageCharacters(content);\n        const old_onstage = Array.isArray(_.get(new_data.stat_data, '.')) ? _.get(new_data.stat_data, '.') : [];\n        const inferred_onstage = inferOnStageCharactersFromText(content, {\n          exclude_names: [\n            String(_.get(new_data.stat_data, '..', '')),\n            String(_.get(new_data.stat_data, '..', '')),\n          ].filter(Boolean),\n          old_onstage,\n        });\n        const relation_hints = parseNpcRelationHints(content);\n        const incoming_onstage = [...(parsed_onstage ?? []), ...inferred_onstage];\n        const name_excluded = new Set<string>([\n          String(_.get(new_data.stat_data, '..', '')),\n          String(_.get(new_data.stat_data, '..', '')),\n        ].filter(Boolean));\n\n        if (incoming_onstage.length > 0) {\n          const merged = mergeOnStageCharacters(old_onstage, incoming_onstage);\n          new_data.stat_data.. = sanitizeOnStageCharacters(merged, name_excluded);\n          _.set(\n            new_data.stat_data,\n            '..',\n            `AI${_.uniq(incoming_onstage.map(v => v.)).join('')}`,\n          );\n        } else {\n          const current = Array.isArray(_.get(new_data.stat_data, '.')) ? _.get(new_data.stat_data, '.') : [];\n          new_data.stat_data.. = sanitizeOnStageCharacters(current, name_excluded);\n        }\n        refreshOnStageThoughtsByAiText(new_data.stat_data, content);\n\n        const previous_message = getChatMessages(message_id - 1, { include_swipes: false })[0];\n        const user_context = previous_message && previous_message.role === 'user' ? String(previous_message.message ?? '') : '';\n        const trigger_context = `${user_context}\\n${content}`;\n        const skill_context = user_context.trim() || content;\n        const pending_skill = previous_message && previous_message.role === 'user'\n          ? pending_skill_by_user_message.get(previous_message.message_id)\n          : undefined;\n\n        applyBattleSystemConstraints(new_data.stat_data, trigger_context);\n        patchGameplayState(new_data.stat_data, trigger_context);\n        applyDungeonLootSystem(new_data.stat_data, content);\n        applyBlackMarketTrade(new_data.stat_data, user_context);\n        applyHumanTraining(new_data.stat_data, trigger_context);\n        reconcileGrowthLevel(new_data.stat_data);\n        startAirBattleIfTriggered(new_data.stat_data, trigger_context);\n        if (pending_skill) {\n          applyResolvedSkillOutcome(new_data.stat_data, pending_skill.source_content, pending_skill.outcome);\n          if (pending_skill.game_over) {\n            enforceGameOver(\n              new_data.stat_data,\n              `${pending_skill.outcome.action_tag} / ${pending_skill.outcome.result}`,\n            );\n          }\n          pending_skill_by_user_message.delete(previous_message.message_id);\n        } else {\n          const in_air_battle = Boolean(_.get(new_data.stat_data, '..', false))\n            && _.get(new_data.stat_data, '..', '') === '';\n          if (!in_air_battle) applySkillCheckSystem(new_data.stat_data, skill_context);\n        }\n        enforceGameOver(new_data.stat_data, '');\n        applyNpcLongTermRules(new_data.stat_data, content, user_context, incoming_onstage, relation_hints);\n        applyVivianaArc(new_data.stat_data);\n\n        new_data.stat_data.. = {\n          : extractDisplayText(content),\n          : content,\n          : Date.now(),\n        };\n        trimBattleLogs(new_data.stat_data, 3);\n\n        await Mvu.replaceMvuData(new_data, { type: 'message', message_id });\n        synced_message_content.set(message_id, content);\n        console.info(`[][MVU]  ${message_id}`);\n      } catch (error) {\n        console.warn(`[][MVU]  ${message_id} `, error);\n      } finally {\n        syncing_message_ids.delete(message_id);\n      }\n    }\n\n    eventOn(tavern_events.MESSAGE_RECEIVED, message_id => {\n      void syncMessageToMvu(message_id);\n    });\n\n    eventOn(tavern_events.MESSAGE_UPDATED, message_id => {\n      void syncMessageToMvu(message_id);\n    });\n\n    eventOn(tavern_events.MESSAGE_SENT, message_id => {\n      void processUserAction(message_id);\n    });\n\n    eventOn(tavern_events.GENERATION_AFTER_COMMANDS, () => {\n      const latest_user = getChatMessages(-1, { role: 'user', include_swipes: false })[0];\n      if (!latest_user || latest_user.role !== 'user') return;\n\n      const chat_data = Mvu.getMvuData({ type: 'chat' });\n      const mvu_summary_prompt = buildMvuSummaryPrompt(chat_data);\n      injectPrompts(\n        [{\n          id: `apocalypse-dawn-mvu-summary-${latest_user.message_id}-${Date.now()}`,\n          position: 'in_chat',\n          depth: 0,\n          role: 'system',\n          content: mvu_summary_prompt,\n          should_scan: true,\n        }],\n        { once: true },\n      );\n\n      const pending = pending_skill_by_user_message.get(latest_user.message_id);\n      if (pending && !pending.injected) {\n        injectPrompts(\n          [{\n            id: `apocalypse-dawn-skill-feedback-${latest_user.message_id}-${Date.now()}`,\n            position: 'in_chat',\n            depth: 0,\n            role: 'system',\n            content: pending.feedback_prompt,\n            should_scan: true,\n          }],\n          { once: true },\n        );\n        pending.injected = true;\n        return;\n      }\n\n      const air_pending = Boolean(_.get(chat_data, 'stat_data...', false));\n      const air_summary = String(_.get(chat_data, 'stat_data...', '')).trim();\n      if (air_pending && air_summary) {\n        injectPrompts(\n          [{\n            id: `apocalypse-dawn-airbattle-${Date.now()}`,\n            position: 'in_chat',\n            depth: 0,\n            role: 'system',\n            content: `[-]\\n${air_summary}\\n`,\n            should_scan: true,\n          }],\n          { once: true },\n        );\n        const next_chat_data = _.cloneDeep(chat_data ?? {});\n        if (!_.isObjectLike(next_chat_data.stat_data)) next_chat_data.stat_data = {};\n        if (!_.isObjectLike(next_chat_data.stat_data.)) next_chat_data.stat_data. = {};\n        next_chat_data.stat_data.. = {\n          : false,\n          : air_summary,\n          : Date.now(),\n        };\n        void Mvu.replaceMvuData(next_chat_data, { type: 'chat' });\n      }\n      const ended = Boolean(_.get(chat_data, 'stat_data...', false));\n      if (ended) {\n        injectPrompts(\n          [{\n            id: `apocalypse-dawn-gameover-${Date.now()}`,\n            position: 'in_chat',\n            depth: 0,\n            role: 'system',\n            content: '/',\n            should_scan: true,\n          }],\n          { once: true },\n        );\n      }\n    });\n\n    eventOn(tavern_events.CHAT_CHANGED, () => {\n      syncing_message_ids.clear();\n      synced_message_content.clear();\n      pending_skill_by_user_message.clear();\n\n      const latest = getChatMessages(-1, { include_swipes: false })[0];\n      if (latest && latest.role === 'assistant') {\n        void syncMessageToMvu(latest.message_id);\n      }\n    });\n\n    const latest = getChatMessages(-1, { include_swipes: false })[0];\n    if (latest && latest.role === 'assistant') {\n      void syncMessageToMvu(latest.message_id);\n    }\n  })();\n});\n"],"names":["z","Schema","object","boolean","prefault","string","enum","coerce","number","transform","v","_","clamp","array","record","describe","asNumber","value","fallback","numeric","Number","isFinite","rollD6","Math","floor","random","warmaid_rank_steps","name","need","reconcileGrowthLevel","stat_data","profession","String","get","is_warmaid","includes","is_authority","level","length","shards","max","set","shard","has_origin","Boolean","trimBattleLogs","keep","logs","isObjectLike","entries","Object","fromEntries","slice","ensureAirCombatData","air","defaultsDeep","battle_activate_pattern","battle_action_pattern","battle_end_pattern","startAirBattleIfTriggered","content","test","threat","enemy_hp","source","ambush","Date","now","resolveAirCombatRound","self_hp","weather_mod","trunc","sup_mod","weapon_lv","weapons","first","values","getWeaponLevel","heavy_condition","need_assist","has_assist","self_near_miss_stack","enemy_near_miss_stack","enemy_dodge","self_dodge","full_auto","calcSingleShot","hit_bonus","dodge_value","base_damage_mult","diff","base_damage","damage","rollD10","note","near_miss","invalid","dealt","self_hit_note","hit_bonus_base","first_shot","shot_index","expected_next_bonus","shot","enemy_hit","enemy_diff","taken","round_summary","summary","end_reason","map","k","join","buildAirBattleSummary","extractDisplayText","text","replace","content_match","match","trim","npc_name_stop_words","Set","npc_name_bad_prefix","npc_name_bad_contains","isLikelyNpcName","excluded","has","sanitizeOnStageCharacters","list","filter","extractNameContext","hit","split","find","inferAttitudeByContext","context","t","inferOnStageCharactersFromText","options","exclude_names","old_map","Map","old_onstage","score","pushScore","raw_name","delta","m","matchAll","keys","result","s","old","push","clampAffection","cloneDeep","ensureNpcData","Array","isArray","defaults","resetNpcStateBeforeCreate","calcAffectionStage","is_partner","detectMentionedNames","names","mentions","add","getTracker","key","upsertLongTermNpc","payload","existing","base","next_affection","current_affection","merged_affection","min","next","promoteToLongTermByName","reason","onstage","npc","uniq","npc_follow_pattern","npc_partner_ai_pattern","npc_partner_user_confirm_pattern","npc_sex_pattern","applyVivianaArc","current_place","in_library","long_map","remove","attitude","thought","idx","findIndex","dungeon_enter_pattern","dungeon_leave_pattern","dungeon_move_pattern","dungeon_search_pattern","dungeon_blow_pattern","lab_room_pool","tier_value_range","tier_affix_count","affix_pool","trade_only_items","black_market_trade_pattern","black_market_buy_pattern","rollRoomTypeByLuck","luck","shift","good_weight","normal_weight","risky_weight","total","r","buildRoomContainer","room_type","pickLootQuality","is_advanced","roll","addWarehouseItem","item_name","quality","count","category","desc","tags","tradeable","old_count","old_tags","curr","generateLootFromContainer","container_type","slot_override","slots","loot","pools","i","sample","is_trade_only","vmin","vmax","sampleSize","mergeLootRecord","target","incoming","item","applyDungeonLootSystem","parseLabLevel","scale","parseMapScale","rooms","room_name","generateDungeonMap","room","merged_loot","is_blow","undefined","normal_count","advanced_count","applyBlackMarketTrade","items","targets","qty_match","RegExp","escapeRegExp","sell_qty","own_qty","use_qty","income","left","unset","want_tier","price","money","toString","patchGameplayState","current_round","line","manual_toggle","battle_by_state","battle_by_text","in_battle","was_enabled","should_enable","last_round","round_delta","magic_cost","slot_cost","current_magic","current_slot","next_magic","next_slot","applyBattleSystemConstraints","mode_by_text","in_battle_by_state","in_battle_by_text","mode","warmaid_type","getWarmaidType","is_commander","ap","mp","penalty","agi","move_counter","weather_hit","superiority","airflow_penalty","applyHumanTraining","keyword_map","forEach","attr","current_attr","current_train","next_train","resolveSkillOutcome","raw_override","has_explicit_check","has_action_verb","inferred_attr","pattern","inferSkillAttr","action_tag","tag","inferActionTag","lock_action","lock_until","raw","bonus","difficulty_penalty","difficulty_label","lock_to_round","hp_loss","mp_loss","difficulty","hard","label","inferDifficulty","applyResolvedSkillOutcome","outcome","lock_rounds","applySkillCheckSystem","enforceGameOver","battle_time_pattern","dialogue_time_pattern","jump_time_pattern","formatUnionDateTime","date","getFullYear","getMonth","getDate","getHours","padStart","getMinutes","advanceWorldTimeByAction","prev_text","prev_date","union_match","year","month","day","hour","minute","iso_like","parseWorldDateTime","jump_match","jump_target","current","full_match","day_only_match","hm","hm_only","parseTimeJumpTarget","next_text","delta_minutes","getTime","player_background_trigger_pattern","player_background_strip_pattern","applyPlayerBackgroundInput","merged","summarizePlayerBackground","toShortText","toInt","pickTailEntries","$","errorCatched","async","global_key","window","host_document","parent","document","style_id","getElementById","style","createElement","id","textContent","head","appendChild","installHideOriginalReplyStyle","waitGlobalInitialized","syncing_message_ids","synced_message_content","pending_skill_by_user_message","processed_user_messages","processUserAction","message_id","user_message","getChatMessages","include_swipes","role","is_hidden","source_content","message","assistant_before","anchor_assistant","source_data","Mvu","getMvuData","type","next_data","user_npc_request_hit","user_content","mentioned","tracker","applyUserNpcRequest","battle_started","battle_resolved","in_air_battle","replaceMvuData","console","info","game_over","feedback_prompt","lines","buildOutcomePrompt","injectPrompts","position","depth","should_scan","once","user_message_id","injected","syncMessageToMvu","old_data","new_data","parseMessage","hasExplicitUpdateTag","parsed_onstage","parsed","JSON","parse","attrs","normalized_attrs","parseOnStageCharacters","inferred_onstage","relation_hints","parseNpcRelationHints","incoming_onstage","name_excluded","old_list","merged_map","prev","requested","mergeOnStageCharacters","ai_content","char","refreshOnStageThoughtsByAiText","previous_message","user_context","trigger_context","skill_context","pending_skill","delete","hints","onstage_list","name_pool","structured_names","text_mentions","appeared","round","hint","ai_has_partner_signal","user_confirm","current_tags","applyNpcLongTermRules","error","warn","eventOn","tavern_events","MESSAGE_RECEIVED","MESSAGE_UPDATED","MESSAGE_SENT","GENERATION_AFTER_COMMANDS","latest_user","chat_data","mvu_summary_prompt","stat","world_time","world_place","world_weather","world_threat","path","hp","hp_max","mp_max","action_point","move_point","slot_now","slot_max","corruption","air_sup","fire_penalty","warmaid_lv","authority_lv","magic_shard","next_magic_shard","authority_shard","skill_result","skill_attr","skill_total","bg_summary","recent_affairs","recent_logs","buildMvuSummaryPrompt","pending","air_pending","air_summary","next_chat_data","CHAT_CHANGED","clear","latest"],"sourceRoot":""}