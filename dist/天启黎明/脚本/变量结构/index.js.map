{"version":3,"file":"index.js","mappings":"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","sources":["src://tavern_helper_template/external var \"z\"","src://tavern_helper_template/src//schema.ts","src://tavern_helper_template/src////index.ts"],"sourcesContent":["const __WEBPACK_NAMESPACE_OBJECT__ = z;","export const Schema = z\n    .object({\n    : z\n        .object({\n        : z\n            .object({\n            : z.boolean().prefault(false),\n            : z.string().prefault(''),\n            : z.enum(['', '', '']).prefault(''),\n            : z\n                .enum(['', '', '', '', '', ''])\n                .prefault(''),\n            : z.coerce.number().transform(v => _.clamp(v, 12, 80)).prefault(21),\n            : z.enum(['', '']).prefault(''),\n            : z.boolean().prefault(false),\n            : z.boolean().prefault(false),\n        })\n            .prefault({}),\n        : z\n            .object({\n            : z.string().prefault(''),\n            : z.string().prefault(''),\n            : z.coerce.number().prefault(0),\n        })\n            .prefault({}),\n        : z\n            .array(z\n            .object({\n            : z.string().prefault(''),\n            : z.coerce.number().transform(v => _.clamp(v, -200, 1000)).prefault(0),\n            : z.string().prefault(''),\n            : z.string().prefault(''),\n            : z.record(z.string().describe(''), z.coerce.number().prefault(0)).prefault({}),\n            : z.coerce.number().prefault(0),\n        })\n            .prefault({}))\n            .prefault([]),\n        : z\n            .object({\n            : z.boolean().prefault(false),\n            NPC: z.boolean().prefault(false),\n        })\n            .prefault({}),\n        : z\n            .object({\n            : z.boolean().prefault(false),\n            : z.string().prefault(''),\n            : z.coerce.number().prefault(0),\n        })\n            .prefault({}),\n        : z\n            .object({\n            : z.boolean().prefault(false),\n            : z.string().prefault(''),\n            : z.coerce.number().prefault(0),\n        })\n            .prefault({}),\n    })\n        .prefault({}),\n    : z\n        .object({\n        : z.string().prefault('177828 08:00'),\n        : z.string().prefault(' '),\n        : z.string().prefault(''),\n        : z.enum(['', '', '', '']).prefault(''),\n        : z.record(z.string().describe(''), z.string().describe('')).prefault({}),\n        : z\n            .object({\n            : z.boolean().prefault(false),\n            : z.enum(['', '']).prefault(''),\n            : z.enum(['', '', '', '']).prefault(''),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 4)).prefault(0),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 7)).prefault(0),\n            : z.boolean().prefault(false),\n            : z.boolean().prefault(false),\n            : z.boolean().prefault(false),\n            : z.string().prefault(''),\n        })\n            .prefault({}),\n        NPC: z.record(z.string().describe('NPC'), z.object({\n            : z.string().prefault(''),\n            : z.coerce.number().transform(v => _.clamp(v, -200, 1000)).prefault(0),\n            : z.enum(['', '', '', '', '', '', '', '']).prefault(''),\n            : z.string().prefault(''),\n            : z.string().prefault(''),\n            : z.record(z.string().describe(''), z.coerce.number().prefault(0)).prefault({}),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 99999)).prefault(0),\n            : z.enum(['', '']).prefault(''),\n            : z.array(z.string()).prefault([]),\n            : z.coerce.number().prefault(0),\n            : z.coerce.number().prefault(0),\n        }).prefault({})).prefault({}),\n        NPC: z.record(z.string().describe('NPC'), z.object({\n            : z.coerce.number().transform(v => _.clamp(v, 0, 9999)).prefault(0),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999999)).prefault(0),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 9999)).prefault(0),\n            : z.coerce.number().prefault(0),\n            : z.boolean().prefault(false),\n        }).prefault({})).prefault({}),\n    })\n        .prefault({}),\n    : z\n        .object({\n        : z\n            .object({\n            : z.string().prefault(''),\n            : z.string().prefault(''),\n            : z.string().prefault(''),\n            : z.string().prefault(''),\n        })\n            .prefault({}),\n        : z\n            .object({\n            : z.coerce.number().transform(v => _.clamp(v, 0, 5)).prefault(1),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 5)).prefault(1),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 5)).prefault(1),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 5)).prefault(1),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 5)).prefault(1),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 5)).prefault(1),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 5)).prefault(1),\n        })\n            .prefault({}),\n        : z\n            .object({\n            : z.coerce.number().transform(v => _.clamp(v, 0, 100)).prefault(0),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 100)).prefault(0),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 100)).prefault(0),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 100)).prefault(0),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 100)).prefault(0),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 100)).prefault(0),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 100)).prefault(0),\n        })\n            .prefault({}),\n        : z\n            .object({\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(20),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(18),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(18),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(18),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(20),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(12),\n        })\n            .prefault({}),\n        : z\n            .object({\n            : z.coerce.number().transform(v => _.clamp(v, 1, 20)).prefault(1),\n            : z.coerce.number().transform(v => _.clamp(v, 1, 20)).prefault(1),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999999)).prefault(0),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999999)).prefault(10),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999999)).prefault(0),\n            : z.boolean().prefault(false),\n        })\n            .prefault({}),\n        : z\n            .object({\n            : z.boolean().prefault(false),\n            : z.boolean().prefault(false),\n            : z.enum(['', '', '']).prefault(''),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(8),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 9)).prefault(1),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 9999)).prefault(0),\n        })\n            .prefault({}),\n        : z\n            .object({\n            : z.coerce.number().transform(v => _.clamp(v, 0, 9999)).prefault(100),\n            : z.coerce.number().transform(v => _.clamp(v, 1, 9999)).prefault(100),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 9999)).prefault(100),\n            : z.coerce.number().transform(v => _.clamp(v, 1, 9999)).prefault(100),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 100)).prefault(0),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 9)).prefault(1),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 9)).prefault(1),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 99)).prefault(10),\n            : z.coerce.number().transform(v => _.clamp(v, 1, 99)).prefault(10),\n        })\n            .prefault({}),\n        : z\n            .object({\n            : z.array(z.string()).prefault([]),\n        })\n            .prefault({}),\n        : z\n            .object({\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(4),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(0),\n            : z.record(z.string().describe('ID'), z.boolean()).prefault({}),\n            : z.string().prefault(''),\n        })\n            .prefault({}),\n        : z\n            .object({\n            : z.string().prefault(''),\n            : z.enum(['', '', '', '', '', '', '', '', '']).prefault(''),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 99999)).prefault(0),\n            : z.string().prefault(''),\n            : z.boolean().prefault(false),\n            : z.string().prefault(''),\n        })\n            .prefault({}),\n        : z\n            .object({\n            : z.string().prefault(''),\n            : z.string().prefault(''),\n        })\n            .prefault({}),\n        : z\n            .object({\n            : z.enum(['', '', '']).prefault(''),\n            : z.boolean().prefault(false),\n            : z.enum(['', '', '', '']).prefault(''),\n            : z.enum(['', '', '']).prefault(''),\n            : z.coerce.number().transform(v => _.clamp(v, 1, 999)).prefault(1),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(0),\n            : z.string().prefault(''),\n            : z.record(z.string().describe(''), z.array(z.string()).prefault([])).prefault({}),\n            : z\n                .object({\n                : z.boolean().prefault(false),\n                : z\n                    .enum(['', '', '', '', '', '', ''])\n                    .prefault(''),\n                : z.enum(['', '', '', '', '']).prefault(''),\n                : z.coerce.number().transform(v => _.clamp(v, 1, 100)).prefault(11),\n                : z.coerce.number().transform(v => _.clamp(v, -50, 50)).prefault(5),\n                : z.coerce.number().transform(v => _.clamp(v, -100, 100)).prefault(0),\n                : z.coerce.number().transform(v => _.clamp(v, 0.1, 3)).prefault(1),\n                : z.enum(['', '', '', '', '', '']).prefault(''),\n                : z.coerce.number().transform(v => _.clamp(v, 100, 2000)).prefault(500),\n                : z\n                    .object({\n                    : z.coerce.number().transform(v => _.clamp(v, 0, 99)).prefault(0),\n                    : z.coerce.number().transform(v => _.clamp(v, 0, 99)).prefault(0),\n                    : z.coerce.number().transform(v => _.clamp(v, 0, 99)).prefault(0),\n                    : z.coerce.number().transform(v => _.clamp(v, 0, 99)).prefault(0),\n                    : z.coerce.number().transform(v => _.clamp(v, 0, 99)).prefault(0),\n                    : z.coerce.number().transform(v => _.clamp(v, 0, 99)).prefault(0),\n                })\n                    .prefault({}),\n                : z\n                    .object({\n                    : z.coerce.number().transform(v => _.clamp(v, 0, 99)).prefault(0),\n                    : z.coerce.number().transform(v => _.clamp(v, 0, 99)).prefault(0),\n                    : z.coerce.number().transform(v => _.clamp(v, 0, 99)).prefault(0),\n                    : z.coerce.number().transform(v => _.clamp(v, 0, 99)).prefault(0),\n                    : z.coerce.number().transform(v => _.clamp(v, 0, 99)).prefault(0),\n                    : z.coerce.number().transform(v => _.clamp(v, 0, 99)).prefault(0),\n                })\n                    .prefault({}),\n                : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(0),\n                : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(0),\n                : z.coerce.number().transform(v => _.clamp(v, -1, 1)).prefault(0),\n                : z.string().prefault(''),\n                : z.boolean().prefault(false),\n                : z.string().prefault(''),\n                : z.array(z.string()).prefault([]),\n                : z.array(z.string()).prefault([]),\n                : z.enum(['', '', '', '']).prefault(''),\n                : z.enum(['', '', '', '', '']).prefault(''),\n                : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(0),\n                : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(0),\n                : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(3),\n                : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(3),\n                : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(0),\n                : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(0),\n                : z.string().prefault(''),\n                : z.coerce.number().transform(v => _.clamp(v, 0, 99999)).prefault(100),\n                : z.coerce.number().transform(v => _.clamp(v, 0, 99999)).prefault(100),\n                : z.coerce.number().transform(v => _.clamp(v, 0, 9999)).prefault(0),\n                : z.string().prefault(''),\n            })\n                .prefault({}),\n        })\n            .prefault({}),\n        : z\n            .object({\n            : z.string().prefault(''),\n            : z.record(z.string().describe(''), z\n                .object({\n                : z.coerce.number().transform(v => _.clamp(v, 0, 8)).prefault(1),\n                : z.coerce.number().transform(v => _.clamp(v, 0, 8)).prefault(2),\n                : z.string().prefault(''),\n            })\n                .prefault({})).prefault({}),\n            : z.record(z.string().describe(''), z.string()).prefault({}),\n            : z.record(z.string().describe(''), z.string().describe('')).prefault({}),\n        })\n            .prefault({}),\n        : z.record(z.string().describe(''), z\n            .object({\n            : z.enum(['', '', '']).prefault(''),\n            : z.string().prefault(''),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 99)).prefault(1),\n        })\n            .prefault({})).prefault({}),\n        : z\n            .object({\n            : z.string().prefault(''),\n            : z.enum(['', '', '', '', '', '', '', '']).prefault(''),\n            : z.coerce.number().transform(v => _.clamp(v, 1, 10)).prefault(1),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(0),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(0),\n            : z.string().prefault(''),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(0),\n            : z.enum(['', '', '', '']).prefault(''),\n            : z.string().prefault(''),\n            : z.string().prefault(''),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(0),\n            : z.coerce.number().prefault(0),\n        })\n            .prefault({}),\n    })\n        .prefault({}),\n    : z\n        .object({\n        : z.boolean().prefault(false),\n        : z.record(z.string().describe(''), z\n            .object({\n            : z.enum(['', '']).prefault(''),\n            : z.boolean().prefault(false),\n        })\n            .prefault({})).prefault({}),\n        : z.record(z.string().describe(''), z\n            .object({\n            : z.enum(['', '', '', '', '', '']).prefault(''),\n            : z.coerce.number().transform(v => _.clamp(v, 1, 999)).prefault(1),\n            : z.coerce.number().transform(v => _.clamp(v, 1, 999999999)).prefault(1),\n        })\n            .prefault({})).prefault({}),\n        : z\n            .object({\n            : z.boolean().prefault(false),\n            : z.string().prefault(''),\n            : z\n                .enum(['', '', '', ''])\n                .prefault(''),\n            : z.enum(['', '', '']).prefault(''),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(0),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(0),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999)).prefault(0),\n            : z.string().prefault(''),\n            : z.string().prefault(''),\n            : z\n                .array(z\n                .object({\n                : z.coerce.number().transform(v => _.clamp(v, 1, 999)).prefault(1),\n                : z.string().prefault(''),\n                : z.enum(['', '', '', '']).prefault(''),\n                : z\n                    .object({\n                    : z.coerce.number().transform(v => _.clamp(v, 0, 9)).prefault(0),\n                    : z.coerce.number().transform(v => _.clamp(v, 0, 9)).prefault(0),\n                    : z.boolean().prefault(false),\n                    : z.boolean().prefault(false),\n                })\n                    .prefault({}),\n            })\n                .prefault({}))\n                .prefault([]),\n        })\n            .prefault({}),\n        : z\n            .object({\n            : z.coerce.number().transform(v => _.clamp(v, 0, 99999999)).prefault(0),\n            : z.coerce.number().transform(v => _.clamp(v, 0, 999999)).prefault(0),\n            : z.record(z.string().describe(''), z\n                .object({\n                : z.enum(['', '', '', '', '', '']).prefault(''),\n                : z.coerce.number().transform(v => _.clamp(v, 0, 999999)).prefault(0),\n                : z.coerce.number().transform(v => _.clamp(v, 1, 999999999)).prefault(1),\n                : z.string().prefault(''),\n                : z.string().prefault(''),\n                : z.array(z.string()).prefault([]),\n                : z.boolean().prefault(true),\n            })\n                .prefault({})).prefault({}),\n            : z.array(z.string()).prefault([]),\n        })\n            .prefault({}),\n    })\n        .prefault({}),\n    : z.record(z.string().describe(''), z.string().describe('')).prefault({}),\n})\n    .prefault({});\n","import { registerMvuSchema } from 'https://testingcf.jsdelivr.net/gh/StageDog/tavern_resource/dist/util/mvu_zod.js';\nimport { Schema } from '../../schema';\n\nfunction installHideOriginalReplyStyle(): void {\n  const host_document = window.parent?.document ?? document;\n  const style_id = 'apocalypse-dawn-hide-original-reply-style';\n  if (host_document.getElementById(style_id)) return;\n\n  const style = host_document.createElement('style');\n  style.id = style_id;\n  style.textContent = `\n    .mes:has(.TH-render) .mes_text > :not(.TH-render) {\n      display: none !important;\n    }\n  `;\n  host_document.head.appendChild(style);\n}\n\nfunction asNumber(value: unknown, fallback = 0): number {\n  const numeric = Number(value);\n  return Number.isFinite(numeric) ? numeric : fallback;\n}\n\nfunction rollD6(): number {\n  return Math.floor(Math.random() * 6) + 1;\n}\n\nconst warmaid_rank_steps = [\n  { name: '', need: 10 },\n  { name: '', need: 50 },\n  { name: '', need: 100 },\n  { name: '', need: 500 },\n  { name: '', need: 1000 },\n  { name: '', need: 2000 },\n  { name: '', need: 6000 },\n] as const;\n\nfunction reconcileGrowthLevel(stat_data: any): void {\n  if (!stat_data || typeof stat_data !== 'object') return;\n\n  const profession = String(_.get(stat_data, '..', ''));\n  const is_warmaid = profession === '' || String(_.get(stat_data, '..', '')).includes('');\n  const is_authority = profession === '' || String(_.get(stat_data, '..', '')).includes('');\n\n  if (is_warmaid) {\n    let level = _.clamp(asNumber(_.get(stat_data, '..', 1), 1), 1, warmaid_rank_steps.length);\n    let shards = Math.max(0, asNumber(_.get(stat_data, '..', 0), 0));\n\n    // /\n    while (level < warmaid_rank_steps.length) {\n      const need = warmaid_rank_steps[level - 1].need;\n      if (shards < need) break;\n      shards -= need;\n      level += 1;\n    }\n\n    _.set(stat_data, '..', level);\n    _.set(stat_data, '..', shards);\n    _.set(\n      stat_data,\n      '..',\n      level < warmaid_rank_steps.length ? warmaid_rank_steps[level - 1].need : 0,\n    );\n  }\n\n  if (is_authority) {\n    const shard = Math.max(0, asNumber(_.get(stat_data, '..', 0), 0));\n    const has_origin = Boolean(_.get(stat_data, '..', false));\n\n    let level = 1; // \n    if (shard >= 50) level = 2; // \n    if (shard >= 100) level = 3; // \n    if (shard >= 1000 && has_origin) level = 4; // \n\n    _.set(stat_data, '..', level);\n  }\n}\n\nfunction trimBattleLogs(stat_data: any, keep = 3): void {\n  if (!stat_data || typeof stat_data !== 'object') return;\n  const logs = _.get(stat_data, '', {});\n  if (!_.isObjectLike(logs)) {\n    _.set(stat_data, '', {});\n    return;\n  }\n  const entries = Object.entries(logs as Record<string, string>);\n  if (entries.length <= keep) return;\n  _.set(stat_data, '', Object.fromEntries(entries.slice(-keep)));\n}\n\nfunction ensureAirCombatData(stat_data: any): void {\n  if (!stat_data || typeof stat_data !== 'object') return;\n  if (!_.isObjectLike(_.get(stat_data, '.'))) {\n    _.set(stat_data, '.', { : false, : '', : 0 });\n  }\n  if (!_.isObjectLike(_.get(stat_data, '..'))) {\n    _.set(stat_data, '..', {});\n  }\n  if (!_.isObjectLike(_.get(stat_data, '..'))) {\n    _.set(stat_data, '..', {\n      : false,\n      : '',\n      : '',\n      : 11,\n      : 5,\n      : 0,\n      : 1,\n      : '',\n      : 500,\n      : { : 0, : 0, : 0, : 0, : 0, : 0 },\n      : { : 0, : 0, : 0, : 0, : 0, : 0 },\n      : 0,\n      : 0,\n      : 0,\n      : '',\n      : false,\n      : '',\n      : [],\n      : [],\n      : '',\n      : '',\n      : 0,\n      : 0,\n      : 3,\n      : 3,\n      : 0,\n      : 0,\n      : '',\n      : 100,\n      : 100,\n      : 0,\n      : '',\n    });\n  } else {\n    const air = _.get(stat_data, '..');\n    _.defaultsDeep(air, {\n      : false,\n      : '',\n      : '',\n      : 11,\n      : 5,\n      : 0,\n      : 1,\n      : '',\n      : 500,\n      : { : 0, : 0, : 0, : 0, : 0, : 0 },\n      : { : 0, : 0, : 0, : 0, : 0, : 0 },\n      : 0,\n      : 0,\n      : 0,\n      : '',\n      : false,\n      : '',\n      : [],\n      : [],\n      : '',\n      : '',\n      : 0,\n      : 0,\n      : 3,\n      : 3,\n      : 0,\n      : 0,\n      : '',\n      : 100,\n      : 100,\n      : 0,\n      : '',\n    });\n  }\n}\n\nconst battle_activate_pattern = /|||||/i;\nconst battle_action_pattern = /||||||||||/i;\nconst battle_end_pattern = /|||||||/i;\n\nfunction getWeaponLevel(stat_data: any): number {\n  const weapons = _.get(stat_data, '..', {});\n  if (!_.isObjectLike(weapons)) return 1;\n  const first = Object.values(weapons as Record<string, any>)[0];\n  return Math.max(1, asNumber(_.get(first, '', 1), 1));\n}\n\nfunction buildAirBattleSummary(stat_data: any, end_reason: string): string {\n  const air = _.get(stat_data, '..', {});\n  const logs = Object.entries(_.get(stat_data, '', {})).slice(-3).map(([k, v]) => `${k}:${v}`).join('');\n  return `(${end_reason})${asNumber(air., 0)}=${air.}(${asNumber(air., 0)})=${_.get(stat_data, '..', '')}=${asNumber(air., 0)}=${asNumber(air., 0)}=${logs}`;\n}\n\nfunction startAirBattleIfTriggered(stat_data: any, content: string): boolean {\n  ensureAirCombatData(stat_data);\n  if (!battle_activate_pattern.test(content)) return false;\n\n  const in_battle = Boolean(_.get(stat_data, '..', false));\n  if (in_battle) return true;\n\n  _.set(stat_data, '..', '');\n  _.set(stat_data, '..', true);\n  _.set(stat_data, '...', true);\n  _.set(stat_data, '...', '');\n  _.set(stat_data, '...', 0);\n\n  const threat = String(_.get(stat_data, '.', ''));\n  const enemy_hp = threat === '' ? 180 : threat === '' ? 140 : threat === '' ? 110 : 90;\n  _.set(stat_data, '...', asNumber(_.get(stat_data, '..', 100), 100));\n  _.set(stat_data, '...', Math.max(30, asNumber(_.get(stat_data, '...', enemy_hp), enemy_hp)));\n\n  const source =\n    //i.test(content) ? ''\n      : //i.test(content) ? ''\n        : //i.test(content) ? ''\n          : '';\n  const ambush = /|/i.test(content);\n  _.set(stat_data, '...', ambush);\n  _.set(stat_data, '...', ambush ? source : '');\n  if (ambush) {\n    _.set(stat_data, '..', asNumber(_.get(stat_data, '..', 1), 1) + 1);\n  }\n\n  _.set(stat_data, `.-${Date.now()}`, `${source}`);\n  trimBattleLogs(stat_data, 3);\n  return true;\n}\n\nfunction resolveAirCombatRound(stat_data: any, content: string): boolean {\n  ensureAirCombatData(stat_data);\n  if (_.get(stat_data, '..', '') !== '') return false;\n  if (!Boolean(_.get(stat_data, '..', false))) return false;\n  if (!battle_action_pattern.test(content) && !battle_end_pattern.test(content)) return false;\n\n  const air = _.get(stat_data, '..');\n  let self_hp = asNumber(_.get(air, '', _.get(stat_data, '..', 100)), 100);\n  let enemy_hp = asNumber(_.get(air, '', 100), 100);\n  const weather_mod = _.clamp(Math.trunc(asNumber(_.get(air, '', 0), 0) / 10), -2, 2);\n  const sup_mod = _.clamp(asNumber(_.get(air, '', 0), 0), -1, 1);\n  const weapon_lv = getWeaponLevel(stat_data);\n  const heavy_condition = String(_.get(air, '', ''));\n  const need_assist = /|.*/.test(heavy_condition);\n  const has_assist = asNumber(_.get(air, '.', 0), 0) > 0 || asNumber(_.get(air, '.', 0), 0) > 0;\n\n  const self_near_miss_stack = asNumber(_.get(air, '', 0), 0);\n  const enemy_near_miss_stack = asNumber(_.get(air, '', 0), 0);\n  const enemy_dodge = asNumber(_.get(air, '', 3), 3);\n  const self_dodge = asNumber(_.get(air, '', 3), 3);\n  const full_auto = /||/.test(content);\n\n  const calcSingleShot = (hit_bonus: number, dodge_value: number, base_damage_mult = 1): { diff: number; damage: number; note: string; near_miss: boolean; invalid: boolean } => {\n    const hit_roll = rollD6() + hit_bonus;\n    const diff = hit_roll - dodge_value;\n    const base_damage = Math.max(1, (rollD6() + weapon_lv) * base_damage_mult);\n    if (diff > 6) return { diff, damage: base_damage + weapon_lv * rollD10(), note: '', near_miss: false, invalid: false };\n    if (diff > 4) return { diff, damage: base_damage, note: '', near_miss: false, invalid: false };\n    if (diff > 2) return { diff, damage: Math.max(1, Math.floor(base_damage / 2)), note: '', near_miss: false, invalid: false };\n    if (diff > 1) return { diff, damage: Math.max(1, weapon_lv * _.random(1, 2)), note: '', near_miss: false, invalid: false };\n    if (diff === 1 || diff === 0) return { diff, damage: 0, note: '', near_miss: true, invalid: false };\n    return { diff, damage: 0, note: '', near_miss: false, invalid: true };\n  };\n\n  let dealt = 0;\n  let diff = 0;\n  let self_hit_note = '';\n  if (need_assist && !has_assist) {\n    self_hit_note = '/';\n  } else {\n    const hit_bonus_base = weather_mod + sup_mod + self_near_miss_stack;\n    const first_shot = calcSingleShot(hit_bonus_base, enemy_dodge);\n    diff = first_shot.diff;\n    dealt += first_shot.damage;\n    self_hit_note = first_shot.note;\n    _.set(air, '', first_shot.near_miss ? self_near_miss_stack + 10 : 0);\n\n    if (full_auto) {\n      let shot_index = 1;\n      let expected_next_bonus = hit_bonus_base - 10;\n      while (shot_index < 6 && expected_next_bonus + 6 >= enemy_dodge) {\n        const shot = calcSingleShot(expected_next_bonus, enemy_dodge);\n        dealt += shot.damage;\n        self_hit_note += ` / ${shot_index + 1}:${shot.note}`;\n        if (shot.near_miss) _.set(air, '', asNumber(_.get(air, '', 0), 0) + 10);\n        if (!shot.invalid) diff = shot.diff;\n        shot_index += 1;\n        expected_next_bonus -= 10;\n      }\n    }\n  }\n  enemy_hp = Math.max(0, enemy_hp - dealt);\n\n  const enemy_hit = calcSingleShot(Math.max(0, -sup_mod) + enemy_near_miss_stack, self_dodge);\n  const enemy_diff = enemy_hit.diff;\n  const taken = enemy_hit.damage;\n  _.set(air, '', enemy_hit.near_miss ? enemy_near_miss_stack + 10 : 0);\n  self_hp = Math.max(0, self_hp - taken);\n\n  _.set(stat_data, '..', self_hp);\n  _.set(air, '', self_hp);\n  _.set(air, '', enemy_hp);\n  _.set(air, '', asNumber(_.get(air, '', 0), 0) + 1);\n  const round_summary = `${_.get(air, '', 0)}${self_hit_note}(${diff})${dealt}${enemy_hit.note}(${enemy_diff})${taken}`;\n  _.set(air, '', round_summary);\n  _.set(air, '', round_summary);\n  _.set(stat_data, `.-${Date.now()}`, round_summary);\n  trimBattleLogs(stat_data, 3);\n\n  const end_by_text = battle_end_pattern.test(content);\n  const end_by_hp = self_hp <= 0 || enemy_hp <= 0;\n  if (!(end_by_text || end_by_hp)) return true;\n\n  _.set(stat_data, '..', false);\n  _.set(stat_data, '..', '');\n  _.set(air, '', '');\n  const reason = self_hp <= 0 ? '' : enemy_hp <= 0 ? '' : '';\n  const summary = buildAirBattleSummary(stat_data, reason);\n  _.set(stat_data, '.', {\n    : true,\n    : summary,\n    : Date.now(),\n  });\n  _.set(stat_data, '..', summary);\n  _.set(stat_data, `.-${Date.now()}`, summary);\n  trimBattleLogs(stat_data, 3);\n  return true;\n}\n\nfunction extractDisplayText(content: string): string {\n  const without_update = content\n    .replace(/<update(?:variable)?>[\\s\\S]*?<\\/update(?:variable)?>/gim, '')\n    .replace(/<update(?:variable)?>[\\s\\S]*$/gim, '');\n\n  const without_placeholder = without_update\n    .replace(/<StatusPlaceHolderImpl\\/>/gim, '')\n    .replace(/<OnStageCharacters>[\\s\\S]*?<\\/OnStageCharacters>/gim, '')\n    .replace(/<NpcRelationHints>[\\s\\S]*?<\\/NpcRelationHints>/gim, '');\n\n  let text = without_placeholder.replace(/```[\\s\\S]*?\\$\\('body'\\)\\.load\\([\\s\\S]*?```/gim, '');\n\n  const content_match = text.match(/<content>([\\s\\S]*?)<\\/content>/im);\n  if (content_match?.[1]) {\n    text = content_match[1];\n  } else {\n    text = text\n      .replace(/<(?:think|thinking|context|disclaimer|tucao|current_event|progress)[^>]*>[\\s\\S]*?<\\/(?:think|thinking|context|disclaimer|tucao|current_event|progress)>/gim, '')\n      .replace(/<(?:think|thinking|context|disclaimer|tucao|current_event|progress)[^>]*\\/>/gim, '');\n  }\n\n  text = text\n    .replace(/```[\\s\\S]*?```/gim, '')\n    .replace(/<\\|im_end\\|>/gim, '')\n    .replace(/<\\/?[^>\\n]+>/g, '')\n    .replace(/\\r/g, '')\n    .replace(/\\n{3,}/g, '\\n\\n')\n    .trim();\n\n  return text;\n}\n\ntype OnStageCharacter = {\n  : string;\n  : number;\n  : string;\n  : string;\n  : Record<string, number>;\n  : number;\n};\n\ntype NpcRelationHint = {\n  : string;\n  : string[];\n};\n\nconst npc_name_stop_words = new Set([\n  '', '', '', '', '', '', '', '', '', '', '',\n  '', '', '', '', '', '', '', '', '', '', '',\n  '', '', '', '', '', '', '', '', '', '', '',\n]);\nconst npc_name_bad_prefix = /^(|||||||||||)/;\nconst npc_name_bad_contains = /(||||||||||||||||||||||||||)/;\n\nfunction normalizeNpcName(raw: string): string {\n  return String(raw ?? '')\n    .trim()\n    .replace(/^[\"\\[\\(]+|[\"\\]\\)]+$/g, '')\n    .replace(/[,\\.\\?!;:]/g, '')\n    .trim();\n}\n\nfunction isLikelyNpcName(name: string, excluded: Set<string>): boolean {\n  if (!name) return false;\n  if (excluded.has(name)) return false;\n  if (npc_name_stop_words.has(name)) return false;\n  if (npc_name_bad_contains.test(name)) return false;\n  if (npc_name_bad_prefix.test(name)) return false;\n  if (/[0-9-]/.test(name)) return false;\n  if (/(||||||)$/.test(name)) return false;\n  if (!/^[\\u4e00-\\u9fa5]{2,6}$/.test(name)) return false;\n  if (/(||||||||)$/.test(name)) return false;\n  return true;\n}\n\nfunction sanitizeOnStageCharacters(list: OnStageCharacter[], excluded: Set<string>): OnStageCharacter[] {\n  return list.filter(v => isLikelyNpcName(String(v?. ?? ''), excluded));\n}\n\nfunction extractNameContext(text: string, name: string): string {\n  const lines = String(text ?? '').split(/[\\n]/).map(v => v.trim()).filter(Boolean);\n  const hit = lines.find(v => v.includes(name));\n  if (!hit) return '';\n  return hit.slice(0, 48);\n}\n\nfunction inferAttitudeByContext(context: string): string {\n  const t = String(context ?? '');\n  if (/|||/.test(t)) return '';\n  if (/||||/.test(t)) return '';\n  if (/||||/.test(t)) return '';\n  if (/|||/.test(t)) return '';\n  return '';\n}\n\nfunction refreshOnStageThoughtsByAiText(stat_data: any, ai_content: string): void {\n  const list = Array.isArray(_.get(stat_data, '.')) ? (_.get(stat_data, '.') as OnStageCharacter[]) : [];\n  if (list.length === 0) return;\n  const text = extractDisplayText(String(ai_content ?? ''));\n  if (!text) return;\n\n  const next = list.map(char => {\n    const name = String(char?. ?? '');\n    if (!name || !text.includes(name)) return char;\n    const context = extractNameContext(text, name);\n    return {\n      ...char,\n      : inferAttitudeByContext(context) || String(char. ?? ''),\n      : context ? `${context}` : `${name}`,\n      : Date.now(),\n    };\n  });\n  _.set(stat_data, '.', next);\n}\n\nfunction inferOnStageCharactersFromText(content: string, options?: { exclude_names?: string[]; old_onstage?: OnStageCharacter[] }): OnStageCharacter[] {\n  const text = extractDisplayText(String(content ?? ''));\n  if (!text) return [];\n\n  const excluded = new Set<string>(options?.exclude_names ?? []);\n  const old_onstage = options?.old_onstage ?? [];\n  const old_map = new Map(old_onstage.map(v => [v., v]));\n  const score = new Map<string, number>();\n\n  const pushScore = (raw_name: string, delta: number) => {\n    const name = normalizeNpcName(raw_name);\n    if (!isLikelyNpcName(name, excluded)) return;\n    score.set(name, (score.get(name) ?? 0) + delta);\n  };\n\n  // ///\n  for (const m of text.matchAll(/(?:||||)([\\u4e00-\\u9fa5]{2,6})/g)) {\n    pushScore(m[1], 3);\n  }\n  // X/////\n  for (const m of text.matchAll(/([\\u4e00-\\u9fa5]{2,6})(?:||||||||||||||||||||)/g)) {\n    pushScore(m[1], 2);\n  }\n  // /\n  for (const m of text.matchAll(/([\\u4e00-\\u9fa5]{2,6})[]\\s*(?:[\"]||||||||||||)/g)) {\n    pushScore(m[1], 1.6);\n  }\n  // \n  for (const m of text.matchAll(/([\\u4e00-\\u9fa5]{2,6})/g)) {\n    pushScore(m[1], 0.05);\n  }\n\n  // \n  for (const name of old_map.keys()) {\n    if (text.includes(name)) score.set(name, Math.max(score.get(name) ?? 0, 2));\n  }\n\n  const result: OnStageCharacter[] = [];\n  for (const [name, s] of score.entries()) {\n    if (s < 2.8) continue;\n    const old = old_map.get(name);\n    const context = extractNameContext(text, name);\n    result.push({\n      : name,\n      : clampAffection(old?. ?? 0, 0),\n      : old?. || inferAttitudeByContext(context),\n      : old?. || (context ? `${context}` : ''),\n      : _.isObjectLike(old?.) ? _.cloneDeep(old?.) : {},\n      : Date.now(),\n    });\n  }\n  return result;\n}\n\nfunction parseOnStageCharacters(content: string): OnStageCharacter[] | undefined {\n  const match = content.match(/<OnStageCharacters>([\\s\\S]*?)<\\/OnStageCharacters>/im);\n  if (!match?.[1]) return undefined;\n\n  try {\n    const parsed = JSON.parse(match[1]);\n    if (!Array.isArray(parsed)) return undefined;\n\n    return parsed\n      .filter(item => _.isObjectLike(item))\n      .map(item => {\n        const attrs = _.isObjectLike((item as any).) ? (item as any). as Record<string, unknown> : {};\n        const normalized_attrs = Object.fromEntries(\n          Object.entries(attrs).map(([k, v]) => [k, asNumber(v, 0)]),\n        ) as Record<string, number>;\n        return {\n          : String((item as any). ?? ''),\n          : _.clamp(asNumber((item as any)., 0), -200, 1000),\n          : String((item as any). ?? ''),\n          : String((item as any). ?? ''),\n          : normalized_attrs,\n          : Date.now(),\n        };\n      });\n  } catch {\n    return undefined;\n  }\n}\n\nfunction parseNpcRelationHints(content: string): NpcRelationHint[] | undefined {\n  const match = content.match(/<NpcRelationHints>([\\s\\S]*?)<\\/NpcRelationHints>/im);\n  if (!match?.[1]) return undefined;\n  try {\n    const parsed = JSON.parse(match[1]);\n    if (!Array.isArray(parsed)) return undefined;\n    return parsed\n      .filter(item => _.isObjectLike(item))\n      .map(item => ({\n        : String((item as any). ?? ''),\n        : Array.isArray((item as any).) ? (item as any)..map((v: unknown) => String(v)) : [],\n      }))\n      .filter(v => v.);\n  } catch {\n    return undefined;\n  }\n}\n\nfunction ensureNpcData(stat_data: any): void {\n  if (!_.isObjectLike(_.get(stat_data, ''))) _.set(stat_data, '', {});\n  if (!Array.isArray(_.get(stat_data, '.'))) _.set(stat_data, '.', []);\n  if (!_.isObjectLike(_.get(stat_data, '.'))) {\n    _.set(stat_data, '.', { : false, NPC: false });\n  } else {\n    _.defaults(_.get(stat_data, '.'), { : false, NPC: false });\n  }\n  if (!_.isObjectLike(_.get(stat_data, '.NPC'))) _.set(stat_data, '.NPC', {});\n  if (!_.isObjectLike(_.get(stat_data, '.NPC'))) _.set(stat_data, '.NPC', {});\n  if (!_.isObjectLike(_.get(stat_data, ''))) _.set(stat_data, '', {});\n  _.defaultsDeep(_.get(stat_data, ''), {\n    : false,\n    : {},\n    : {},\n    : {\n      : false,\n      : '',\n      : '',\n      : '',\n      : 0,\n      : 0,\n      : 0,\n      : '',\n      : '',\n      : [],\n    },\n    : {\n      : 0,\n      : 0,\n      : {},\n      : [],\n    },\n  });\n}\n\nfunction resetNpcStateBeforeCreate(stat_data: any): void {\n  if (!stat_data || typeof stat_data !== 'object') return;\n  if (Boolean(_.get(stat_data, '..', false))) return;\n  _.set(stat_data, '.', []);\n  _.set(stat_data, '.NPC', {});\n  _.set(stat_data, '.NPC', {});\n}\n\nfunction clampAffection(value: unknown, fallback = 0): number {\n  return _.clamp(asNumber(value, fallback), -200, 1000);\n}\n\nfunction calcAffectionStage(score: number, is_partner = false): string {\n  if (is_partner) return '';\n  if (score <= -50) return '';\n  if (score <= -20) return '';\n  if (score <= 0) return '';\n  if (score <= 100) return '';\n  if (score <= 400) return '';\n  if (score <= 600) return '';\n  return '';\n}\n\nfunction mergeOnStageCharacters(old_list: OnStageCharacter[], incoming: OnStageCharacter[]): OnStageCharacter[] {\n  const merged_map = new Map<string, OnStageCharacter>();\n  for (const old of old_list) {\n    merged_map.set(old., {\n      : String(old. || ''),\n      : clampAffection(old., 0),\n      : String(old. || ''),\n      : String(old. || ''),\n      : _.isObjectLike(old.) ? _.cloneDeep(old.) : {},\n      : asNumber(old., 0),\n    });\n  }\n  for (const next of incoming) {\n    const name = String(next. || '');\n    const prev = merged_map.get(name);\n    if (!prev) {\n      merged_map.set(name, {\n        : name,\n        : clampAffection(next., 0),\n        : String(next. || ''),\n        : String(next. || ''),\n        : _.isObjectLike(next.) ? _.cloneDeep(next.) : {},\n        : Date.now(),\n      });\n      continue;\n    }\n    const requested = clampAffection(next., prev.);\n    const merged_affection = requested > prev. ? Math.min(prev. + 5, requested) : requested;\n    merged_map.set(name, {\n      : name,\n      : clampAffection(merged_affection, prev.),\n      : String(next. || prev. || ''),\n      : String(next. || prev. || ''),\n      : {\n        ...(prev. ?? {}),\n        ...(_.isObjectLike(next.) ? next. : {}),\n      },\n      : Date.now(),\n    });\n  }\n  return [...merged_map.values()];\n}\n\nfunction detectMentionedNames(content: string, names: string[]): Set<string> {\n  const text = String(content ?? '');\n  const mentions = new Set<string>();\n  for (const name of names) {\n    if (!name) continue;\n    if (text.includes(name)) mentions.add(name);\n  }\n  return mentions;\n}\n\nfunction getTracker(stat_data: any, name: string): any {\n  const key = `.NPC.${name}`;\n  if (!_.isObjectLike(_.get(stat_data, key))) {\n    _.set(stat_data, key, {\n      : 0,\n      : 0,\n      : 0,\n      : 0,\n      : false,\n    });\n  }\n  return _.get(stat_data, key);\n}\n\nfunction upsertLongTermNpc(stat_data: any, name: string, payload?: Partial<OnStageCharacter>): any {\n  const key = `.NPC.${name}`;\n  const existing = _.get(stat_data, key);\n  const base = _.isObjectLike(existing) ? existing : {\n    : name,\n    : 0,\n    : '',\n    : '',\n    : '',\n    : {},\n    : 0,\n    : '',\n    : [],\n    : Date.now(),\n    : 0,\n  };\n  const next_affection = clampAffection(payload?., base.);\n  const current_affection = clampAffection(base., 0);\n  const merged_affection = next_affection > current_affection ? Math.min(current_affection + 5, next_affection) : next_affection;\n  const is_partner = Array.isArray(base.) && base..includes('');\n  const next = {\n    ...base,\n    : name,\n    : merged_affection,\n    : String(payload?. || base. || ''),\n    : String(payload?. || base. || ''),\n    : {\n      ...(base. ?? {}),\n      ...(payload?. ?? {}),\n    },\n    : Date.now(),\n  };\n  next. = calcAffectionStage(next., is_partner);\n  _.set(stat_data, key, next);\n  return next;\n}\n\nfunction promoteToLongTermByName(stat_data: any, name: string, reason: string): void {\n  const onstage_list = (_.get(stat_data, '.', []) as OnStageCharacter[]);\n  const onstage = onstage_list.find(v => v. === name);\n  const npc = upsertLongTermNpc(stat_data, name, onstage);\n  const tracker = getTracker(stat_data, name);\n  tracker. = true;\n  _.set(stat_data, `.NPC.${name}.`, _.uniq([...(npc. ?? []), reason]));\n}\n\nconst npc_follow_pattern = /|||||/;\nconst npc_partner_ai_pattern = /||/;\nconst npc_partner_user_confirm_pattern = /||||/;\nconst npc_sex_pattern = /||||/;\n\nfunction applyUserNpcRequest(stat_data: any, user_content: string): boolean {\n  if (!npc_follow_pattern.test(user_content)) return false;\n  const onstage_list = (_.get(stat_data, '.', []) as OnStageCharacter[]);\n  const names = onstage_list.map(v => v.);\n  const mentioned = [...detectMentionedNames(user_content, names)];\n  const targets = mentioned.length > 0 ? mentioned : (names.length === 1 ? [names[0]] : []);\n  if (targets.length === 0) return false;\n  for (const name of targets) {\n    const tracker = getTracker(stat_data, name);\n    tracker. = asNumber(tracker., 0) + 1;\n    tracker. = Date.now();\n    promoteToLongTermByName(stat_data, name, '');\n  }\n  return true;\n}\n\nfunction applyNpcLongTermRules(stat_data: any, ai_content: string, user_content: string, parsed_onstage?: OnStageCharacter[], hints?: NpcRelationHint[]): void {\n  ensureNpcData(stat_data);\n  const onstage_list = (_.get(stat_data, '.', []) as OnStageCharacter[]);\n  const long_map = _.get(stat_data, '.NPC', {}) as Record<string, any>;\n  const name_pool = _.uniq([\n    ...onstage_list.map(v => v.),\n    ...Object.keys(long_map),\n    ...(parsed_onstage?.map(v => v.) ?? []),\n  ]);\n  const structured_names = new Set((parsed_onstage ?? []).map(v => v.));\n  const text_mentions = detectMentionedNames(ai_content, name_pool);\n  const appeared = new Set<string>([...structured_names, ...text_mentions]);\n  const round = asNumber(_.get(stat_data, '..', 1), 1);\n\n  for (const name of name_pool) {\n    const tracker = getTracker(stat_data, name);\n    if (appeared.has(name)) {\n      tracker. = asNumber(tracker., 0) + 1;\n      tracker. = round;\n    } else {\n      tracker. = Math.max(0, asNumber(tracker., 0) - 1);\n    }\n    if (tracker. >= 5 && !tracker.) {\n      promoteToLongTermByName(stat_data, name, '');\n    }\n  }\n\n  for (const onstage of onstage_list) {\n    if (_.has(stat_data, `.NPC.${onstage.}`)) {\n      upsertLongTermNpc(stat_data, onstage., onstage);\n    }\n  }\n\n  for (const hint of hints ?? []) {\n    if (!_.has(long_map, hint.)) continue;\n    const curr = _.get(stat_data, `.NPC.${hint.}.`, []);\n    _.set(stat_data, `.NPC.${hint.}.`, _.uniq([...(curr ?? []), ...hint.]));\n  }\n\n  const ai_has_partner_signal = npc_partner_ai_pattern.test(ai_content);\n  const user_confirm = npc_partner_user_confirm_pattern.test(user_content);\n  if (ai_has_partner_signal && user_confirm) {\n    for (const name of detectMentionedNames(ai_content, Object.keys(_.get(stat_data, '.NPC', {})))) {\n      const score = clampAffection(_.get(stat_data, `.NPC.${name}.`, 0), 0);\n      if (score < 601) continue;\n      const current_tags = _.get(stat_data, `.NPC.${name}.`, []);\n      const tags = _.uniq([...(Array.isArray(current_tags) ? current_tags : []), '']);\n      _.set(stat_data, `.NPC.${name}.`, tags);\n      _.set(stat_data, `.NPC.${name}.`, '');\n      _.set(stat_data, `.NPC.${name}.`, Date.now());\n    }\n  }\n\n  if (npc_sex_pattern.test(ai_content)) {\n    for (const name of detectMentionedNames(ai_content, Object.keys(_.get(stat_data, '.NPC', {})))) {\n      const count = asNumber(_.get(stat_data, `.NPC.${name}.`, 0), 0) + 1;\n      _.set(stat_data, `.NPC.${name}.`, count);\n      _.set(stat_data, `.NPC.${name}.`, '');\n      _.set(stat_data, `.NPC.${name}.`, Date.now());\n    }\n  }\n}\n\nfunction applyVivianaArc(stat_data: any): void {\n  const current_place = String(_.get(stat_data, '.', ''));\n  const in_library = //.test(current_place);\n  const onstage = _.get(stat_data, '.', []) as OnStageCharacter[];\n  const long_map = _.get(stat_data, '.NPC', {}) as Record<string, any>;\n  const names = _.uniq([\n    ...onstage.map(v => String(v. || '')),\n    ...Object.keys(long_map),\n  ]).filter(v => //.test(v));\n  if (names.length === 0) return;\n\n  for (const name of names) {\n    if (!in_library) {\n      _.remove(onstage, v => String(v?. ?? '') === name);\n      continue;\n    }\n    const npc = _.get(stat_data, `.NPC.${name}`, {});\n    const score = clampAffection(_.get(npc, '', 0), 0);\n    const stage = String(_.get(npc, '', calcAffectionStage(score)));\n    const is_partner = stage === '' || (Array.isArray(_.get(npc, '')) && _.get(npc, '').includes(''));\n\n    let attitude = '';\n    let thought = '';\n    if (score >= 1) {\n      attitude = '';\n      thought = '';\n    }\n    if (score >= 101) {\n      attitude = '';\n      thought = '';\n    }\n    if (score >= 401) {\n      attitude = '';\n      thought = '';\n    }\n    if (score >= 601) {\n      attitude = '';\n      thought = '';\n    }\n    if (is_partner) {\n      attitude = '';\n      thought = '';\n      _.set(stat_data, `.NPC.${name}.`, '');\n    }\n\n    _.set(stat_data, `.NPC.${name}.`, attitude);\n    _.set(stat_data, `.NPC.${name}.`, thought);\n    _.set(stat_data, `.NPC.${name}.`, Date.now());\n\n    const idx = onstage.findIndex(v => String(v?. ?? '') === name);\n    if (idx >= 0) {\n      onstage[idx]. = attitude;\n      onstage[idx]. = `${thought}`;\n      onstage[idx]. = Date.now();\n    }\n  }\n}\n\nfunction sanitizeThoughtText(raw: string): string {\n  const thought = String(raw ?? '').trim();\n  if (!thought) return '';\n  if (/AI|||||JSON||mvu|statusplaceholder/i.test(thought)) {\n    return '';\n  }\n  return thought.slice(0, 120);\n}\n\nfunction buildPersonaInnerThought(name: string, score: number, is_partner: boolean, fallback: string): { attitude: string; thought: string } {\n  const clean_fallback = sanitizeThoughtText(fallback);\n\n  if (/|victorica/i.test(name)) {\n    if (is_partner) return { attitude: '', thought: '' };\n    if (score >= 601) return { attitude: '', thought: '' };\n    if (score >= 401) return { attitude: '', thought: '' };\n    if (score >= 101) return { attitude: '', thought: '' };\n    if (score >= 1) return { attitude: '', thought: '' };\n    return { attitude: '', thought: '' };\n  }\n\n  if (/|/i.test(name)) {\n    if (is_partner) return { attitude: '', thought: '' };\n    if (score >= 601) return { attitude: '', thought: '' };\n    if (score >= 401) return { attitude: '', thought: '' };\n    if (score >= 101) return { attitude: '', thought: '' };\n    if (score >= 1) return { attitude: '', thought: '' };\n    return { attitude: '', thought: '' };\n  }\n\n  if (clean_fallback) {\n    return { attitude: '', thought: clean_fallback };\n  }\n  return { attitude: '', thought: '' };\n}\n\nfunction applyNpcPersonaConsistency(stat_data: any): void {\n  const onstage = (_.get(stat_data, '.', []) as OnStageCharacter[]) ?? [];\n  const long_map = (_.get(stat_data, '.NPC', {}) as Record<string, any>) ?? {};\n  const all_names = _.uniq([\n    ...onstage.map(v => String(v?. ?? '')),\n    ...Object.keys(long_map),\n  ]).filter(Boolean);\n\n  for (const name of all_names) {\n    const long_key = `.NPC.${name}`;\n    const long_npc = _.get(stat_data, long_key, {});\n    const score = clampAffection(_.get(long_npc, '', 0), 0);\n    const tags = _.get(long_npc, '', []);\n    const is_partner = String(_.get(long_npc, '', '')) === '' || (Array.isArray(tags) && tags.includes(''));\n    const fallback = String(_.get(long_npc, '', '') || onstage.find(v => v. === name)?. || '');\n    const persona = buildPersonaInnerThought(name, score, is_partner, fallback);\n\n    if (_.has(stat_data, long_key)) {\n      _.set(stat_data, `${long_key}.`, persona.attitude);\n      _.set(stat_data, `${long_key}.`, persona.thought);\n      _.set(stat_data, `${long_key}.`, Date.now());\n      if (is_partner) _.set(stat_data, `${long_key}.`, '');\n    }\n\n    const idx = onstage.findIndex(v => String(v?. ?? '') === name);\n    if (idx >= 0) {\n      onstage[idx]. = persona.attitude;\n      onstage[idx]. = `${persona.thought}`;\n      onstage[idx]. = Date.now();\n    }\n  }\n}\n\nconst dungeon_enter_pattern = /|||||/i;\nconst dungeon_leave_pattern = /||||/i;\nconst dungeon_move_pattern = /||||||/i;\nconst dungeon_search_pattern = /||||||/i;\nconst dungeon_blow_pattern = /||||/i;\n\nconst lab_level_options = ['', '', '', ''] as const;\nconst lab_room_pool: Record<'' | '' | '' | '', string[]> = {\n  : ['', '', '', '', '', '', '', ''],\n  : ['', '', '', '', '', '', '', '', ''],\n  : ['', '', '', '', '', '', ''],\n  : ['', '', '', '', '', ''],\n};\n\ntype ItemTier = '' | '' | '' | '' | '' | '';\nconst tier_value_range: Record<ItemTier, [number, number]> = {\n  : [1, 1000],\n  : [1001, 5000],\n  : [5001, 20000],\n  : [20001, 50000],\n  : [50001, 200000],\n  : [200001, 20000000],\n};\nconst tier_affix_count: Record<ItemTier, number> = {\n  : 0,\n  : 1,\n  : 2,\n  : 3,\n  : 4,\n  : 5,\n};\nconst affix_pool = [\n  '', '', '', '', '', '', '', '', '', '',\n];\nconst trade_only_items = ['', '', '', '', ''];\nconst black_market_trade_pattern = /.*(||||)/i;\nconst black_market_buy_pattern = /.*(|||)/i;\n\nfunction parseLabLevel(content: string): (typeof lab_level_options)[number] {\n  if (//.test(content)) return '';\n  if (//.test(content)) return '';\n  if (//.test(content)) return '';\n  return '';\n}\n\nfunction parseMapScale(content: string, level: (typeof lab_level_options)[number]): '' | '' | '' {\n  if (//.test(content)) return '';\n  if (//.test(content)) return '';\n  if (//.test(content)) return '';\n  if (level === '' || level === '') return '';\n  if (level === '') return '';\n  return '';\n}\n\nfunction rollRoomTypeByLuck(luck: number): '' | '' | '' | '' {\n  // 1.012~34~7/8~910\n  // 20 +0.1/\n  const shift = Math.max(0, Math.floor(luck / 20));\n  let good_weight = 2 + shift;\n  let normal_weight = Math.max(1, 4 - shift);\n  let danger_weight = 1;\n  let risky_weight = 2;\n  if (shift >= 2) {\n    risky_weight = Math.max(1, risky_weight - Math.floor(shift / 2));\n  }\n  const hidden_weight = 1;\n  const total = hidden_weight + good_weight + normal_weight + risky_weight + danger_weight;\n  const r = Math.random() * total;\n  if (r < hidden_weight) return '';\n  if (r < hidden_weight + good_weight) return '';\n  if (r < hidden_weight + good_weight + normal_weight) return '';\n  // /\n  return '';\n}\n\nfunction buildRoomContainer(room_type: '' | '' | '' | ''): { : number; : number; : boolean; : boolean } {\n  if (room_type === '') return { : 0, : 4, : false, : false };\n  if (room_type === '') {\n    const locked = Math.random() < 0.35;\n    return locked\n      ? { : 0, : _.random(2, 5), : true, : false }\n      : { : 1, : 1, : false, : false };\n  }\n  if (room_type === '') return { : 2, : 0, : false, : false };\n  const trap_or_danger = Math.random() < 0.7; // /1\n  return { : trap_or_danger ? 1 : 0, : 0, : false, : false };\n}\n\nfunction generateDungeonMap(level: (typeof lab_level_options)[number], scale: '' | '' | '', luck: number): any[] {\n  const count = scale === '' ? 5 : scale === '' ? 12 : 20;\n  const rooms: any[] = [];\n  for (let i = 1; i <= count; i += 1) {\n    const room_type = rollRoomTypeByLuck(luck);\n    // /\n    const room_name = _.sample(lab_room_pool[room_type]) ?? (room_type === '' ? '' : '');\n    rooms.push({\n      : i,\n      : room_name,\n      : room_type,\n      : buildRoomContainer(room_type),\n    });\n  }\n  return rooms;\n}\n\nfunction pickLootQuality(level: (typeof lab_level_options)[number], is_advanced: boolean): ItemTier {\n  const roll = _.random(1, 100);\n  if (level === '') {\n    if (roll >= 96) return '';\n    if (roll >= 75) return '';\n    if (roll >= 45) return '';\n    if (roll >= 20) return '';\n    return is_advanced ? '' : '';\n  }\n  if (level === '') {\n    if (roll >= 97) return '';\n    if (roll >= 82) return '';\n    if (roll >= 55) return '';\n    if (roll >= 25) return '';\n    return is_advanced ? '' : '';\n  }\n  if (level === '') {\n    if (roll >= 95) return '';\n    if (roll >= 75) return '';\n    if (roll >= 45) return '';\n    if (roll >= 20) return '';\n    return '';\n  }\n  if (roll >= 98) return '';\n  if (roll >= 85) return '';\n  if (roll >= 60) return '';\n  if (roll >= 30) return '';\n  return '';\n}\n\nfunction addWarehouseItem(stat_data: any, item_name: string, quality: ItemTier, count: number, category: string, desc: string, value: number, tags: string[], tradeable = true): void {\n  if (item_name === '') {\n    _.set(stat_data, '..', asNumber(_.get(stat_data, '..', 0), 0) + count);\n    return;\n  }\n  if (item_name === '') {\n    _.set(stat_data, '..', asNumber(_.get(stat_data, '..', 0), 0) + count);\n    return;\n  }\n  const key = `...${item_name}`;\n  const old_count = asNumber(_.get(stat_data, `${key}.`, 0), 0);\n  const old_tags = _.get(stat_data, `${key}.`, []);\n  _.set(stat_data, key, {\n    : quality,\n    : old_count + count,\n    : value,\n    : category,\n    : desc,\n    : _.uniq([...(Array.isArray(old_tags) ? old_tags : []), ...tags]),\n    : tradeable,\n  });\n  if (/||/.test(quality)) {\n    const curr = _.get(stat_data, '..', []);\n    _.set(stat_data, '..', _.uniq([...(Array.isArray(curr) ? curr : []), item_name]));\n  }\n}\n\nfunction generateLootFromContainer(stat_data: any, level: (typeof lab_level_options)[number], container_type: '' | '', slot_override?: number): Record<string, any> {\n  const slots = slot_override ?? (container_type === '' ? 3 : 2);\n  const loot: Record<string, any> = {};\n  const pools = {\n    : ['', '', '', '', ''],\n    : ['', '', '', ''],\n    : ['', '', '', ''],\n    : ['', '', ''],\n  };\n  for (let i = 0; i < slots; i += 1) {\n    const quality = pickLootQuality(level, container_type === '');\n    const category = quality === '' || quality === ''\n      ? _.sample(['', '', '']) ?? ''\n      : _.sample(['', '', '']) ?? '';\n    const is_trade_only = category === '' && Math.random() < 0.45;\n    const item_name = (() => {\n      if (is_trade_only) return _.sample(trade_only_items) ?? '';\n      if (quality === '') return Math.random() < 0.25 ? '' : '';\n      if (quality === '') return '';\n      if (quality === '') return '';\n      return _.sample((pools as any)[category]) ?? '';\n    })();\n    const count = item_name === '' ? _.random(40, 280) : item_name === '' ? _.random(1, 4) : 1;\n    const [vmin, vmax] = tier_value_range[quality];\n    const value = _.random(vmin, vmax);\n    const tags = is_trade_only ? [] : _.sampleSize(affix_pool, tier_affix_count[quality]);\n    loot[item_name] = {\n      : quality,\n      : asNumber(_.get(loot, `${item_name}.`, 0), 0) + count,\n      : value,\n    };\n    addWarehouseItem(stat_data, item_name, quality, count, category, `${container_type}`, value, tags, true);\n  }\n  return loot;\n}\n\nfunction mergeLootRecord(target: Record<string, any>, incoming: Record<string, any>): void {\n  for (const [name, item] of Object.entries(incoming)) {\n    const old_count = asNumber(_.get(target, `${name}.`, 0), 0);\n    target[name] = {\n      : String((item as any)?. ?? _.get(target, `${name}.`, '')),\n      : old_count + asNumber((item as any)?., 0),\n      : asNumber((item as any)?., asNumber(_.get(target, `${name}.`, 1), 1)),\n    };\n  }\n}\n\nfunction applyDungeonLootSystem(stat_data: any, content: string): void {\n  ensureNpcData(stat_data);\n  const level = parseLabLevel(content);\n  const scale = parseMapScale(content, level);\n  const luck = asNumber(_.get(stat_data, '..', 1), 1) * 20;\n\n  if (dungeon_enter_pattern.test(content)) {\n    const map = generateDungeonMap(level, scale, luck);\n    _.set(stat_data, '.', {\n      : true,\n      : '',\n      : level,\n      : scale,\n      : map.length,\n      : 0,\n      : 1,\n      : map[0]?. ?? '',\n      : `${level}/${scale}/${map.length}`,\n      : map,\n    });\n    _.set(stat_data, '.', true);\n    _.set(stat_data, '..', `${level}${scale}`);\n    return;\n  }\n\n  if (!Boolean(_.get(stat_data, '..', false))) return;\n  const rooms = _.get(stat_data, '..', []) as any[];\n  if (!Array.isArray(rooms) || rooms.length === 0) return;\n  let idx = _.clamp(asNumber(_.get(stat_data, '..', 0), 0), 0, rooms.length - 1);\n\n  if (dungeon_move_pattern.test(content)) {\n    idx = Math.min(rooms.length - 1, idx + 1);\n    _.set(stat_data, '..', idx);\n    _.set(stat_data, '..', Math.max(asNumber(_.get(stat_data, '..', 1), 1), idx + 1));\n    _.set(stat_data, '..', String(rooms[idx]?. ?? ''));\n  }\n\n  if (dungeon_search_pattern.test(content)) {\n    const room = rooms[idx];\n    if (room?.?.) {\n      _.set(stat_data, '.', {});\n      _.set(stat_data, '..', `${idx + 1}`);\n      _.set(stat_data, '.', true);\n    } else {\n      const merged_loot: Record<string, any> = {};\n      const is_blow = dungeon_blow_pattern.test(content) && Boolean(room?.?.);\n      const slot_override = is_blow ? 1 : undefined;\n      const normal_count = asNumber(room?.?., 0);\n      const advanced_count = asNumber(room?.?., 0);\n\n      for (let i = 0; i < normal_count; i += 1) {\n        const loot = generateLootFromContainer(stat_data, _.get(stat_data, '..', level), '', slot_override);\n        mergeLootRecord(merged_loot, loot);\n      }\n      for (let i = 0; i < advanced_count; i += 1) {\n        const loot = generateLootFromContainer(stat_data, _.get(stat_data, '..', level), '', slot_override);\n        mergeLootRecord(merged_loot, loot);\n      }\n\n      _.set(room, '.', true);\n      _.set(stat_data, '.', merged_loot);\n      _.set(stat_data, '.', true);\n      _.set(stat_data, '..', is_blow ? '1/' : `${idx + 1}`);\n      _.set(stat_data, `.-${Date.now()}`, `${idx + 1}:${room?. ?? ''} `);\n      trimBattleLogs(stat_data, 3);\n    }\n  }\n\n  if (dungeon_leave_pattern.test(content)) {\n    _.set(stat_data, '..', false);\n    _.set(stat_data, '..', '');\n  }\n}\n\nfunction applyBlackMarketTrade(stat_data: any, content: string): void {\n  if (!/|/.test(content)) return;\n  const market_place = '';\n  if (/|||/.test(content)) {\n    _.set(stat_data, '.', market_place);\n    _.set(stat_data, '..', '');\n  }\n\n  const items = _.get(stat_data, '..', {}) as Record<string, any>;\n  const names = Object.keys(items);\n  if (black_market_trade_pattern.test(content)) {\n    const targets = [...detectMentionedNames(content, names)];\n    for (const name of targets) {\n      const qty_match = content.match(new RegExp(`${_.escapeRegExp(name)}\\\\D*(\\\\d+)`, 'i'));\n      const sell_qty = Math.max(1, asNumber(qty_match?.[1], 1));\n      const own_qty = asNumber(_.get(stat_data, `...${name}.`, 0), 0);\n      if (own_qty <= 0) continue;\n      const use_qty = Math.min(own_qty, sell_qty);\n      const value = asNumber(_.get(stat_data, `...${name}.`, 1), 1);\n      const tradeable = Boolean(_.get(stat_data, `...${name}.`, true));\n      if (!tradeable) continue;\n      const income = Math.floor(value * use_qty * 0.1); // 90%\n      _.set(stat_data, '..', asNumber(_.get(stat_data, '..', 0), 0) + income);\n      const left = own_qty - use_qty;\n      if (left <= 0) _.unset(stat_data, `...${name}`);\n      else _.set(stat_data, `...${name}.`, left);\n      _.set(stat_data, '..', ` ${name} x${use_qty}${income}90%`);\n    }\n  }\n\n  if (black_market_buy_pattern.test(content)) {\n    const want_tier = (['', '', '', '', '', ''] as ItemTier[]).find(t => content.includes(t)) ?? '';\n    const [vmin, vmax] = tier_value_range[want_tier];\n    const price = _.random(vmin, vmax);\n    const money = asNumber(_.get(stat_data, '..', 0), 0);\n    if (money >= price) {\n      _.set(stat_data, '..', money - price);\n      const item_name = `${want_tier}-${Date.now().toString().slice(-4)}`;\n      const tags = _.sampleSize(affix_pool, tier_affix_count[want_tier]);\n      addWarehouseItem(stat_data, item_name, want_tier, 1, '', '', price, tags, true);\n      _.set(stat_data, '..', ` ${item_name}${want_tier} ${price}`);\n    } else {\n      _.set(stat_data, '..', `${price}${money}`);\n    }\n  }\n}\n\nfunction hasExplicitUpdateTag(content: string): boolean {\n  return /<update(?:variable)?>[\\s\\S]*?<\\/update(?:variable)?>|<update(?:variable)?>[\\s\\S]*$/im.test(content);\n}\n\nfunction patchGameplayState(stat_data: any, content: string): void {\n  if (!stat_data || typeof stat_data !== 'object') return;\n\n  const profession = _.get(stat_data, '..', '');\n  const is_warmaid = profession === '' || String(_.get(stat_data, '..', '')).includes('');\n  if (!is_warmaid) {\n    _.set(stat_data, '..', false);\n    _.set(stat_data, '.', false);\n    return;\n  }\n\n  const current_round = asNumber(_.get(stat_data, '..', 0), 0);\n  const line = String(_.get(stat_data, '..', ''));\n  const threat = String(_.get(stat_data, '.', ''));\n  const manual_toggle = Boolean(_.get(stat_data, '..', false));\n\n  const battle_by_state = current_round > 1 || line === '' || line === '' || threat === '' || threat === '';\n  const battle_by_text = /||||||||||/i.test(content);\n  const in_battle = battle_by_state || battle_by_text;\n\n  const was_enabled = Boolean(_.get(stat_data, '..', false));\n  const should_enable = manual_toggle || in_battle;\n  _.set(stat_data, '..', should_enable);\n\n  let last_round = asNumber(_.get(stat_data, '..', 0), 0);\n  if (!was_enabled && should_enable) {\n    last_round = current_round;\n    _.set(stat_data, '..', current_round);\n  }\n\n  if (should_enable) {\n    const round_delta = Math.max(0, current_round - last_round);\n    if (round_delta > 0) {\n      const magic_cost = asNumber(_.get(stat_data, '..', 0), 0) * round_delta;\n      const slot_cost = asNumber(_.get(stat_data, '..', 0), 0) * round_delta;\n\n      const current_magic = asNumber(_.get(stat_data, '..', 0), 0);\n      const current_slot = asNumber(_.get(stat_data, '..', 0), 0);\n      const next_magic = Math.max(0, current_magic - magic_cost);\n      const next_slot = Math.max(0, current_slot - slot_cost);\n\n      _.set(stat_data, '..', next_magic);\n      _.set(stat_data, '..', next_slot);\n      _.set(stat_data, '..', current_round);\n\n      if (next_magic <= 0 || next_slot <= 0) {\n        _.set(stat_data, '..', false);\n        _.set(stat_data, '..', false);\n      }\n    }\n  } else if (last_round > current_round) {\n    _.set(stat_data, '..', current_round);\n  }\n\n  // /\n}\n\nfunction getWarmaidType(stat_data: any): string {\n  return String(\n    _.get(stat_data, '..', '').trim()\n      || _.get(stat_data, '..', '').replace('-', '').trim(),\n  );\n}\n\nfunction applyBattleSystemConstraints(stat_data: any, content: string): void {\n  if (!stat_data || typeof stat_data !== 'object') return;\n  ensureAirCombatData(stat_data);\n\n  const mode_by_text =\n    /|||||/i.test(content) ? ''\n      : /||||/i.test(content) ? ''\n        : '';\n  const current_round = asNumber(_.get(stat_data, '..', 1), 1);\n  const threat = String(_.get(stat_data, '.', ''));\n  const line = String(_.get(stat_data, '..', ''));\n  const in_battle_by_state = current_round > 1 || line === '' || line === '' || threat === '' || threat === '';\n  const in_battle_by_text = /||||||||||/i.test(content);\n  const in_battle = in_battle_by_state || in_battle_by_text;\n\n  const mode = in_battle ? (mode_by_text === '' ? '' : mode_by_text) : '';\n  _.set(stat_data, '..', mode);\n  _.set(stat_data, '..', in_battle);\n\n  if (!in_battle) {\n    _.set(stat_data, '..', 1);\n    _.set(stat_data, '..', 1);\n    _.set(stat_data, '..', '');\n    return;\n  }\n\n  const profession = _.get(stat_data, '..', '');\n  const warmaid_type = getWarmaidType(stat_data);\n  const is_commander = profession === '';\n  const is_authority = profession === '';\n\n  let ap = 1;\n  let mp = 1;\n  let penalty = '';\n\n  if (mode === '') {\n    const agi = asNumber(_.get(stat_data, '..', 1), 1);\n    ap = Math.max(1, Math.floor(agi / 3));\n    mp = warmaid_type === '' ? 0 : 1;\n  } else if (is_commander) {\n    ap = 1;\n    mp = 1;\n    if (line !== '') {\n      _.set(stat_data, '..', '');\n    }\n  } else if (is_authority) {\n    ap = 1;\n    mp = 1;\n  } else {\n    if (warmaid_type === '') {\n      ap = 1; mp = 2;\n    } else if (warmaid_type === '') {\n      ap = 2; mp = 1;\n    } else if (warmaid_type === '') {\n      ap = 1; mp = 1;\n    } else if (warmaid_type === '') {\n      ap = 1;\n      const move_counter = asNumber(_.get(stat_data, '..', 0), 0) + 1;\n      _.set(stat_data, '..', move_counter % 2);\n      mp = move_counter % 2 === 0 ? 1 : 0;\n      if (line === '') penalty = '-1/3';\n      if (line === '') penalty = '-1/2';\n    } else if (warmaid_type === '') {\n      ap = 1;\n      mp = 0;\n      if (line === '') penalty = '-1/2';\n      if (line === '' || line === '') penalty = '/';\n    } else if (warmaid_type === '') {\n      ap = 1; mp = 1;\n    }\n  }\n\n  _.set(stat_data, '..', ap);\n  _.set(stat_data, '..', mp);\n  if (mode === '') {\n    const weather_hit = asNumber(_.get(stat_data, '...', 0), 0);\n    const superiority = asNumber(_.get(stat_data, '...', 0), 0);\n    const heavy_condition = String(_.get(stat_data, '...', ''));\n    const transform_on = Boolean(_.get(stat_data, '..', false));\n    const airflow_penalty = `: ${weather_hit >= 0 ? '+' : ''}${weather_hit} / ${superiority >= 0 ? '+' : ''}${superiority} | :${heavy_condition}`;\n    penalty = penalty === '' ? airflow_penalty : `${penalty}${airflow_penalty}`;\n    if (!transform_on && !is_commander && !is_authority) {\n      penalty = `${penalty}: `;\n    }\n  }\n\n  _.set(stat_data, '..', penalty);\n}\n\nfunction applyHumanTraining(stat_data: any, content: string): void {\n  if (!stat_data || typeof stat_data !== 'object') return;\n  const attrs: Array<'' | '' | '' | '' | '' | '' | ''> = [\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n  ];\n\n  const keyword_map: Record<(typeof attrs)[number], RegExp> = {\n    : /|||||||/i,\n    : /||||||/i,\n    : /||||||/i,\n    : /|||||||/i,\n    : /||||||/i,\n    : /||||||/i,\n    : /|||||||/i,\n  };\n\n  attrs.forEach(attr => {\n    const matched = keyword_map[attr].test(content);\n    if (!matched) return;\n\n    const current_attr = asNumber(_.get(stat_data, `..${attr}`, 1), 1);\n    if (current_attr >= 5) {\n      _.set(stat_data, `..${attr}`, 100);\n      return;\n    }\n\n    const current_train = asNumber(_.get(stat_data, `..${attr}`, 0), 0);\n    const next_train = Math.min(100, current_train + 1);\n\n    if (next_train >= 100) {\n      _.set(stat_data, `..${attr}`, Math.min(5, current_attr + 1));\n      _.set(stat_data, `..${attr}`, 0);\n    } else {\n      _.set(stat_data, `..${attr}`, next_train);\n    }\n  });\n}\n\ntype SkillAttr = '' | '' | '' | '' | '' | '' | '' | '';\n\nfunction rollD10(): number {\n  return Math.floor(Math.random() * 10) + 1;\n}\n\nfunction inferSkillAttr(content: string): SkillAttr {\n  const map: Array<{ attr: SkillAttr; pattern: RegExp }> = [\n    { attr: '', pattern: /||||||||||||||||||||||/i },\n    { attr: '', pattern: /|||||||||||/i },\n    { attr: '', pattern: /|||||||||||/i },\n    { attr: '', pattern: /|||||||||||/i },\n    { attr: '', pattern: /||||||san||||/i },\n    { attr: '', pattern: /||||||||||/i },\n    { attr: '', pattern: /|||||||||||||||/i },\n  ];\n  const hit = map.find(item => item.pattern.test(content));\n  return hit?.attr ?? '';\n}\n\nfunction inferActionTag(content: string): string {\n  const rules: Array<{ tag: string; pattern: RegExp }> = [\n    { tag: '', pattern: /|||||||/i },\n    { tag: '', pattern: /|||/i },\n    { tag: '', pattern: /||||/i },\n    { tag: '', pattern: /||/i },\n    { tag: '', pattern: /||/i },\n    { tag: '', pattern: /||||/i },\n    { tag: '', pattern: /|||/i },\n    { tag: '', pattern: /|||/i },\n    { tag: '', pattern: /|||/i },\n  ];\n  return rules.find(r => r.pattern.test(content))?.tag ?? '';\n}\n\nfunction inferDifficulty(content: string, attr: SkillAttr): { penalty: number; label: string } {\n  let penalty = 0;\n  const hard = /|||||||||||||/i.test(content);\n  const extreme = /|||||||/i.test(content);\n\n  if (hard) penalty += 2;\n  if (extreme) penalty += 2;\n\n  if (attr === '' && /||||||/i.test(content) && hard) {\n    penalty += 1;\n  }\n\n  if (penalty <= 0) return { penalty: 0, label: '' };\n  if (penalty <= 2) return { penalty, label: '' };\n  if (penalty <= 4) return { penalty, label: '' };\n  return { penalty: Math.min(6, penalty), label: '' };\n}\n\ntype SkillOutcome = {\n  attr: SkillAttr;\n  action_tag: string;\n  current_round: number;\n  raw: number;\n  bonus: number;\n  difficulty_penalty: number;\n  difficulty_label: string;\n  total: number;\n  result: '' | '' | '' | '';\n  desc: string;\n  lock_to_round: number;\n  hp_loss: number;\n  mp_loss: number;\n};\n\ntype PendingSkillState = {\n  user_message_id: number;\n  source_content: string;\n  outcome: SkillOutcome;\n  feedback_prompt: string;\n  injected: boolean;\n  game_over: boolean;\n};\n\nfunction resolveSkillOutcome(stat_data: any, content: string, raw_override?: number): SkillOutcome | undefined {\n  const has_explicit_check = /||/i.test(content);\n  const has_action_verb = /||||||||||||||||||||||||||||||san||||||||/i.test(content);\n  const inferred_attr = inferSkillAttr(content);\n  const should_check = has_explicit_check || (has_action_verb && inferred_attr !== '');\n  if (!should_check) return undefined;\n\n  const attr = inferred_attr;\n  const action_tag = inferActionTag(content);\n  const current_round = asNumber(_.get(stat_data, '..', 1), 1);\n  const lock_action = String(_.get(stat_data, '..', ''));\n  const lock_until = asNumber(_.get(stat_data, '..', 0), 0);\n\n  if (lock_action && lock_action === action_tag && current_round <= lock_until) {\n    return {\n      attr,\n      action_tag,\n      current_round,\n      raw: 1,\n      bonus: 0,\n      difficulty_penalty: 0,\n      difficulty_label: '',\n      total: 0,\n      result: '',\n      desc: `${action_tag}  ${lock_until} `,\n      lock_to_round: lock_until,\n      hp_loss: 0,\n      mp_loss: 0,\n    };\n  }\n\n  const bonus = attr === '' ? 0 : asNumber(_.get(stat_data, `..${attr}`, 0), 0);\n  const difficulty = inferDifficulty(content, attr);\n  const raw = _.clamp(raw_override ?? rollD10(), 1, 10);\n  const total = Math.max(0, raw + bonus - difficulty.penalty);\n\n  let result: '' | '' | '' | '' = '';\n  let desc = '';\n  if (raw === 10) {\n    result = '';\n    desc = '=10';\n  } else if (raw === 1) {\n    result = '';\n    desc = '=1';\n  } else if (total > 5) {\n    result = '';\n    desc = ` ${total - 5}`;\n  } else {\n    result = '';\n    desc = ` ${5 - total}`;\n  }\n\n  let lock_to_round = 0;\n  let hp_loss = 0;\n  let mp_loss = 0;\n  if (result === '' || result === '') {\n    const lock_rounds = result === '' ? 4 : 2;\n    lock_to_round = current_round + lock_rounds;\n    hp_loss = result === '' ? 12 : 4;\n    mp_loss = result === '' ? 15 : 5;\n    desc += ` -${hp_loss}-${mp_loss} ${lock_to_round} `;\n  }\n\n  return {\n    attr,\n    action_tag,\n    current_round,\n    raw,\n    bonus,\n    difficulty_penalty: difficulty.penalty,\n    difficulty_label: difficulty.label,\n    total,\n    result,\n    desc,\n    lock_to_round,\n    hp_loss,\n    mp_loss,\n  };\n}\n\nfunction applyResolvedSkillOutcome(stat_data: any, content: string, outcome: SkillOutcome): void {\n  if (outcome.result === '' || outcome.result === '') {\n    const lock_rounds = outcome.result === '' ? 4 : 2;\n    _.set(stat_data, '..', outcome.action_tag);\n    _.set(stat_data, '..', outcome.lock_to_round);\n    _.set(\n      stat_data,\n      `..${outcome.action_tag}`,\n      {\n        : outcome.result === '' ? '' : '',\n        : outcome.result === '' ? '' : '',\n        : lock_rounds,\n      },\n    );\n    _.set(stat_data, '..', Math.max(0, asNumber(_.get(stat_data, '..', 0), 0) - outcome.hp_loss));\n    _.set(stat_data, '..', Math.max(0, asNumber(_.get(stat_data, '..', 0), 0) - outcome.mp_loss));\n  } else {\n    _.set(stat_data, '..', '');\n    _.set(stat_data, '..', 0);\n  }\n\n  _.set(stat_data, '.', {\n    : content.slice(0, 80),\n    : outcome.attr,\n    : outcome.raw,\n    : outcome.bonus,\n    : outcome.difficulty_penalty,\n    : outcome.difficulty_label,\n    : outcome.total,\n    : outcome.result,\n    : outcome.desc,\n    : outcome.result === '' || outcome.result === '' ? outcome.action_tag : '',\n    : outcome.lock_to_round,\n    : Date.now(),\n  });\n\n  _.set(\n    stat_data,\n    `.-${Date.now()}`,\n    `${outcome.action_tag} | ${outcome.attr} | ${outcome.raw}+${outcome.bonus}-${outcome.difficulty_penalty}=${outcome.total} | ${outcome.difficulty_label} | ${outcome.result} | ${outcome.desc}`,\n  );\n  trimBattleLogs(stat_data, 3);\n  _.set(\n    stat_data,\n    '..',\n    `${outcome.action_tag}(${outcome.attr})=${outcome.result}${outcome.total}${outcome.raw}${outcome.difficulty_penalty}`,\n  );\n}\n\nfunction applySkillCheckSystem(stat_data: any, content: string): SkillOutcome | undefined {\n  const outcome = resolveSkillOutcome(stat_data, content);\n  if (!outcome) return undefined;\n  applyResolvedSkillOutcome(stat_data, content, outcome);\n  return outcome;\n}\n\nfunction enforceGameOver(stat_data: any, reason: string): boolean {\n  const hp = asNumber(_.get(stat_data, '..', 0), 0);\n  if (hp > 0) return false;\n\n  _.set(stat_data, '..', 0);\n  _.set(stat_data, '..', false);\n  _.set(stat_data, '..', false);\n  _.set(stat_data, '..', false);\n  _.set(stat_data, '..', '');\n  _.set(stat_data, '..', true);\n  _.set(stat_data, '..', reason);\n  _.set(stat_data, '..', Date.now());\n  _.set(stat_data, `.-${Date.now()}`, reason);\n  trimBattleLogs(stat_data, 3);\n  _.set(stat_data, '..', '');\n  return true;\n}\n\nconst battle_time_pattern = /||||||||||/i;\nconst dialogue_time_pattern = /|||||||||/i;\nconst jump_time_pattern = /(?:|||)\\s*([^\\n,;]+)/i;\n\nfunction formatUnionDateTime(date: Date): string {\n  const union_year = Math.max(1, date.getFullYear() - 2000);\n  const month = date.getMonth() + 1;\n  const day = date.getDate();\n  const hour = `${date.getHours()}`.padStart(2, '0');\n  const minute = `${date.getMinutes()}`.padStart(2, '0');\n  return `${union_year}${month}${day} ${hour}:${minute}`;\n}\n\nfunction parseWorldDateTime(value: unknown): Date {\n  const text = String(value ?? '').trim();\n  if (!text) return new Date(2177, 7, 28, 8, 0, 0, 0);\n\n  const union_match = text.match(/\\s*(\\d+)\\s*\\s*(\\d{1,2})\\s*\\s*(\\d{1,2})\\s*(?:\\s*(\\d{1,2})[:](\\d{1,2}))?/);\n  if (union_match) {\n    const year = 2000 + asNumber(union_match[1], 177);\n    const month = asNumber(union_match[2], 8);\n    const day = asNumber(union_match[3], 28);\n    const hour = asNumber(union_match[4], 8);\n    const minute = asNumber(union_match[5], 0);\n    return new Date(year, month - 1, day, hour, minute, 0, 0);\n  }\n\n  const iso_like = text.match(/(\\d{4})[-/](\\d{1,2})[-/](\\d{1,2})(?:\\s+(\\d{1,2})[:](\\d{1,2}))?/);\n  if (iso_like) {\n    const year = asNumber(iso_like[1], 2026);\n    const month = asNumber(iso_like[2], 1);\n    const day = asNumber(iso_like[3], 1);\n    const hour = asNumber(iso_like[4], 8);\n    const minute = asNumber(iso_like[5], 0);\n    return new Date(year, month - 1, day, hour, minute, 0, 0);\n  }\n\n  return new Date(2177, 7, 28, 8, 0, 0, 0);\n}\n\nfunction parseTimeJumpTarget(text: string, current: Date): Date | undefined {\n  const source = String(text ?? '').trim();\n  if (!source) return undefined;\n\n  const full_match = source.match(/(?:(?:)?\\s*(\\d+)\\s*)?\\s*(\\d{1,2})\\s*\\s*(\\d{1,2})\\s*(?:\\s*(\\d{1,2})[:](\\d{1,2})?)?/);\n  if (full_match) {\n    const year = full_match[1] ? 2000 + asNumber(full_match[1], current.getFullYear() - 2000) : current.getFullYear();\n    const month = asNumber(full_match[2], current.getMonth() + 1);\n    const day = asNumber(full_match[3], current.getDate());\n    const hour = full_match[4] ? asNumber(full_match[4], 8) : current.getHours();\n    const minute = full_match[5] ? asNumber(full_match[5], 0) : current.getMinutes();\n    return new Date(year, month - 1, day, hour, minute, 0, 0);\n  }\n\n  const day_only_match = source.match(/(\\d{1,2})\\s*\\s*(\\d{1,2})\\s*/);\n  if (day_only_match) {\n    const month = asNumber(day_only_match[1], current.getMonth() + 1);\n    const day = asNumber(day_only_match[2], current.getDate());\n    const hm = source.match(/(\\d{1,2})[:](\\d{1,2})/);\n    const hour = hm ? asNumber(hm[1], 8) : current.getHours();\n    const minute = hm ? asNumber(hm[2], 0) : current.getMinutes();\n    return new Date(current.getFullYear(), month - 1, day, hour, minute, 0, 0);\n  }\n\n  const hm_only = source.match(/(\\d{1,2})[:](\\d{1,2})/);\n  if (hm_only) {\n    const hour = asNumber(hm_only[1], current.getHours());\n    const minute = asNumber(hm_only[2], current.getMinutes());\n    return new Date(current.getFullYear(), current.getMonth(), current.getDate(), hour, minute, 0, 0);\n  }\n\n  return undefined;\n}\n\nfunction advanceWorldTimeByAction(stat_data: any, content: string): void {\n  if (!stat_data || typeof stat_data !== 'object') return;\n  const prev_text = String(_.get(stat_data, '.', '')).trim();\n  const prev_date = parseWorldDateTime(prev_text);\n\n  const jump_match = content.match(jump_time_pattern);\n  if (jump_match?.[1]) {\n    const jump_target = parseTimeJumpTarget(jump_match[1], prev_date);\n    if (jump_target) {\n      const next_text = formatUnionDateTime(jump_target);\n      _.set(stat_data, '.', next_text);\n      _.set(stat_data, '..', `${prev_text || formatUnionDateTime(prev_date)} -> ${next_text}`);\n      return;\n    }\n  }\n\n  const delta_minutes = battle_time_pattern.test(content)\n    ? _.random(240, 360)\n    : dialogue_time_pattern.test(content)\n      ? 5\n      : 20;\n\n  const next_date = new Date(prev_date.getTime() + delta_minutes * 60 * 1000);\n  const next_text = formatUnionDateTime(next_date);\n  const reason = battle_time_pattern.test(content)\n    ? `${delta_minutes}`\n    : dialogue_time_pattern.test(content)\n      ? '5'\n      : '20';\n  _.set(stat_data, '.', next_text);\n  _.set(stat_data, '..', `${prev_text || formatUnionDateTime(prev_date)} -> ${next_text}${reason}`);\n}\n\nconst player_background_trigger_pattern = /(||||||||)/;\nconst player_background_strip_pattern = /|||||||||/;\nconst training_keyword_pattern = /|||||||||/;\n\nfunction summarizePlayerBackground(raw: string): string {\n  const text = String(raw ?? '')\n    .replace(/\\r/g, '')\n    .replace(/[ \\t]+/g, ' ')\n    .trim();\n  if (!text) return '';\n\n  const lines = text\n    .split('\\n')\n    .map(v => v.trim())\n    .filter(Boolean)\n    .filter(v => !player_background_strip_pattern.test(v));\n\n  const merged = lines.join(' ');\n  if (!merged) return '';\n  return merged.length > 180 ? `${merged.slice(0, 180)}...` : merged;\n}\n\nfunction applyPlayerBackgroundInput(stat_data: any, content: string): boolean {\n  const source = String(content ?? '').trim();\n  if (!source) return false;\n  if (!player_background_trigger_pattern.test(source)) return false;\n  if (source.length < 24) return false;\n\n  const cleaned = source\n    .replace(/^.*?(||||||||)[:]?\\s*/i, '')\n    .trim();\n  const raw = cleaned || source;\n  const summary = summarizePlayerBackground(raw);\n  if (!summary) return false;\n\n  _.set(stat_data, '..', raw);\n  _.set(stat_data, '..', summary);\n  _.set(stat_data, '..', `${summary}`);\n  return true;\n}\n\nfunction detectTrainingStateFromBackground(stat_data: any): '' | '' {\n  const raw = String(_.get(stat_data, '..', ''));\n  const summary = String(_.get(stat_data, '..', ''));\n  return training_keyword_pattern.test(`${raw}\\n${summary}`) ? '' : '';\n}\n\nfunction ensureStoryGuideState(stat_data: any): void {\n  if (!_.isObjectLike(_.get(stat_data, ''))) _.set(stat_data, '', {});\n  if (!_.isObjectLike(_.get(stat_data, '.'))) _.set(stat_data, '.', {});\n  if (!_.isObjectLike(_.get(stat_data, '.'))) {\n    _.set(stat_data, '.', {\n      : false,\n      : '',\n      : '',\n      : 0,\n      : 0,\n      : false,\n      : false,\n      : false,\n      : '',\n    });\n  } else {\n    _.defaultsDeep(_.get(stat_data, '.'), {\n      : false,\n      : '',\n      : '',\n      : 0,\n      : 0,\n      : false,\n      : false,\n      : false,\n      : '',\n    });\n  }\n\n  const mode_by_card = Boolean(_.get(stat_data, '..', false));\n  _.set(stat_data, '..', mode_by_card || Boolean(_.get(stat_data, '..', false)));\n  _.set(stat_data, '..', detectTrainingStateFromBackground(stat_data));\n}\n\nconst admission_keyword_pattern = /|||||||/;\nconst course_keyword_pattern = /||||||||/;\nconst hilton_keyword_pattern = /||||||/;\n\nfunction progressStoryGuideByContent(stat_data: any, content: string): void {\n  ensureStoryGuideState(stat_data);\n  const guide = _.get(stat_data, '.');\n  if (!guide || !guide.) return;\n\n  const text = String(content ?? '');\n  if (!text.trim()) return;\n  const stage = String(guide. || '');\n\n  if (stage === '') {\n    if (!admission_keyword_pattern.test(text)) return;\n    guide. = _.clamp(asNumber(guide., 0) + 1, 0, 4);\n    guide. = ` ${guide.}/4`;\n    _.set(stat_data, '..', `1/3 ${guide.}/4`);\n    if (guide. >= 4) {\n      guide. = true;\n      guide. = '';\n      guide. = '';\n      _.set(stat_data, '..', '2/3 0/7');\n      _.set(stat_data, '..', '');\n    }\n    return;\n  }\n\n  if (stage === '') {\n    if (!course_keyword_pattern.test(text)) return;\n    guide. = _.clamp(asNumber(guide., 0) + 1, 0, 7);\n    guide. = ` ${guide.}/7`;\n    _.set(stat_data, '..', `2/3 ${guide.}/7`);\n    if (guide. >= 7) {\n      guide. = true;\n      guide. = '';\n      guide. = '';\n      _.set(stat_data, '..', '3/3 ');\n      _.set(stat_data, '..', '');\n    }\n    return;\n  }\n\n  if (stage === '') {\n    if (!hilton_keyword_pattern.test(text)) return;\n    guide. = true;\n    guide. = '';\n    guide. = '';\n    _.set(stat_data, '..', '');\n  }\n}\n\nfunction buildOutcomePrompt(outcome: SkillOutcome, game_over: boolean): string {\n  const lines = [\n    '[-]',\n    `: ${outcome.action_tag}`,\n    `: ${outcome.attr}`,\n    `: D10(${outcome.raw}) + (${outcome.bonus}) - (${outcome.difficulty_penalty}) = ${outcome.total}`,\n    `: ${outcome.difficulty_label}`,\n    `: ${outcome.result}`,\n    `: ${outcome.desc}`,\n    ': ',\n  ];\n  if (game_over) {\n    lines.push(': /');\n  }\n  return lines.join('\\n');\n}\n\nfunction toShortText(value: unknown, fallback = '-'): string {\n  const text = String(value ?? '').trim();\n  return text || fallback;\n}\n\nfunction toInt(value: unknown, fallback = 0): number {\n  return Math.trunc(asNumber(value, fallback));\n}\n\nfunction pickTailEntries(source: unknown, keep = 2): Array<[string, string]> {\n  if (!_.isObjectLike(source)) return [];\n  return Object.entries(source as Record<string, unknown>)\n    .slice(-keep)\n    .map(([k, v]) => [k, toShortText(v)]);\n}\n\nfunction buildMvuSummaryPrompt(chat_data: any): string {\n  const stat = _.isObjectLike(chat_data?.stat_data) ? chat_data.stat_data : {};\n\n  const world_time = toShortText(_.get(stat, '.', _.get(stat, '.')));\n  const world_place = toShortText(_.get(stat, '.', _.get(stat, '.')));\n  const world_weather = toShortText(_.get(stat, '.'));\n  const world_threat = toShortText(_.get(stat, '.', ''));\n\n  const name = toShortText(_.get(stat, '..', _.get(stat, '..')));\n  const profession = toShortText(_.get(stat, '..'));\n  const path = toShortText(_.get(stat, '..'));\n\n  const hp = toInt(_.get(stat, '..', 0), 0);\n  const hp_max = toInt(_.get(stat, '..', hp), hp);\n  const mp = toInt(_.get(stat, '..', 0), 0);\n  const mp_max = toInt(_.get(stat, '..', mp), mp);\n  const action_point = toInt(_.get(stat, '..', 1), 1);\n  const move_point = toInt(_.get(stat, '..', 1), 1);\n  const slot_now = toInt(_.get(stat, '..', 0), 0);\n  const slot_max = toInt(_.get(stat, '..', slot_now), slot_now);\n  const corruption = toInt(_.get(stat, '..', 0), 0);\n\n  const in_battle = Boolean(_.get(stat, '..', false));\n  const mode = toShortText(_.get(stat, '..', ''));\n  const line = toShortText(_.get(stat, '..', ''));\n  const round = toInt(_.get(stat, '..', 1), 1);\n  const air_sup = toShortText(_.get(stat, '..', ''));\n  const fire_penalty = toShortText(_.get(stat, '..', ''));\n\n  const warmaid_lv = toInt(_.get(stat, '..', 0), 0);\n  const authority_lv = toInt(_.get(stat, '..', 0), 0);\n  const magic_shard = toInt(_.get(stat, '..', 0), 0);\n  const next_magic_shard = toInt(_.get(stat, '..', 0), 0);\n  const authority_shard = toInt(_.get(stat, '..', 0), 0);\n  const has_origin = Boolean(_.get(stat, '..', false));\n\n  const skill_result = toShortText(_.get(stat, '..', ''));\n  const skill_attr = toShortText(_.get(stat, '..', ''));\n  const skill_total = toInt(_.get(stat, '..', 0), 0);\n  const bg_summary = toShortText(_.get(stat, '..', ''), '');\n  const plot_mode = Boolean(_.get(stat, '..', _.get(stat, '..', false)));\n  const training_state = toShortText(_.get(stat, '..', ''));\n  const guide_stage = toShortText(_.get(stat, '..', ''));\n  const admission_progress = toInt(_.get(stat, '..', 0), 0);\n  const course_progress = toInt(_.get(stat, '..', 0), 0);\n  const guide_note = toShortText(_.get(stat, '..', ''), '');\n\n  const recent_affairs = pickTailEntries(_.get(stat, '.', {}), 2);\n  const recent_logs = pickTailEntries(_.get(stat, '', {}), 2);\n\n  const lines = [\n    '[MVU-]',\n    `: =${world_time} | =${world_place} | =${world_weather} | =${world_threat}`,\n    `: =${name} | =${profession} | =${path}`,\n    `: HP=${hp}/${hp_max} | MP=${mp}/${mp_max} | AP=${action_point} | Move=${move_point} | =${slot_now}/${slot_max} | =${corruption}`,\n    `: =${in_battle ? '' : ''} | =${mode} | =${line} | =${round} | =${air_sup} | =${fire_penalty}`,\n    `: =${warmaid_lv} | =${authority_lv} | =${magic_shard}(${next_magic_shard}) | =${authority_shard} | =${has_origin ? '' : ''}`,\n    `: =${skill_result} | =${skill_attr} | =${skill_total}`,\n  ];\n  if (bg_summary) {\n    lines.push(`: ${bg_summary}`);\n  }\n  if (plot_mode) {\n    lines.push(`:  | =${training_state} | =${guide_stage}`);\n    lines.push(`: =${admission_progress}/4 | =${course_progress}/7`);\n    if (guide_note) lines.push(`: ${guide_note}`);\n    lines.push(': ');\n    if (guide_stage === '') {\n      lines.push('');\n    } else if (guide_stage === '') {\n      lines.push('//');\n    } else if (guide_stage === '') {\n      lines.push('');\n    }\n  } else {\n    lines.push(': ');\n  }\n\n  if (recent_affairs.length > 0) {\n    lines.push(`: ${recent_affairs.map(([k, v]) => `${k}:${v}`).join('')}`);\n  }\n  if (recent_logs.length > 0) {\n    lines.push(`: ${recent_logs.map(([k, v]) => `${k}:${v}`).join('')}`);\n  }\n\n  lines.push(': ');\n  lines.push(':  <OnStageCharacters>JSON');\n  lines.push(': /');\n  lines.push(': ');\n  lines.push(': =');\n  lines.push('JSON: (string), (-200~1000), (string), (string), (object<number>)');\n  lines.push(': <NpcRelationHints>JSON</NpcRelationHints>: (string), (string[])');\n  return lines.join('\\n');\n}\n\nfunction trySendActionToChatInput(action: string): boolean {\n  const text = String(action ?? '').trim();\n  if (!text) return false;\n\n  const textarea_selectors = [\n    '#send_textarea',\n    'textarea#send_textarea',\n    'textarea[id*=\"send\"]',\n    'textarea',\n  ];\n  const send_btn_selectors = [\n    '#send_but',\n    'button#send_but',\n    '#send-button',\n    'button[type=\"submit\"]',\n  ];\n\n  let input_el: HTMLTextAreaElement | null = null;\n  for (const sel of textarea_selectors) {\n    const el = document.querySelector(sel);\n    if (el instanceof HTMLTextAreaElement) {\n      input_el = el;\n      break;\n    }\n  }\n  if (!input_el) return false;\n\n  input_el.value = text;\n  input_el.dispatchEvent(new Event('input', { bubbles: true }));\n  input_el.dispatchEvent(new Event('change', { bubbles: true }));\n\n  for (const sel of send_btn_selectors) {\n    const btn = document.querySelector(sel);\n    if (btn instanceof HTMLElement) {\n      btn.click();\n      return true;\n    }\n  }\n  return false;\n}\n\n$(() => {\n  errorCatched(async () => {\n    const global_key = '__apocalypse_dawn_variable_bridge_installed__';\n    if ((window as any)[global_key]) return;\n    (window as any)[global_key] = true;\n\n    installHideOriginalReplyStyle();\n    registerMvuSchema(Schema);\n    await waitGlobalInitialized('Mvu');\n\n    const syncing_message_ids = new Set<number>();\n    const synced_message_content = new Map<number, string>();\n      const pending_skill_by_user_message = new Map<number, PendingSkillState>();\n    const processed_user_messages = new Set<number>();\n\n    //  iframe  postMessage \n    window.addEventListener('message', evt => {\n      const payload = evt.data;\n      if (!_.isObjectLike(payload)) return;\n      if ((payload as any).type !== 'apocalypse-dawn:send_action') return;\n      if ((payload as any).source !== 'apocalypse_dawn_mvu') return;\n      const action = String((payload as any).action ?? '').trim();\n      if (!action) return;\n      const sent = trySendActionToChatInput(action);\n      if (!sent) {\n        console.warn('[][] ');\n      }\n    });\n\n    async function processUserAction(message_id: number): Promise<void> {\n      if (processed_user_messages.has(message_id)) return;\n      const user_message = getChatMessages(message_id, { include_swipes: false })[0];\n      if (!user_message || user_message.role !== 'user' || user_message.is_hidden) return;\n\n      const source_content = String(user_message.message ?? '').trim();\n      if (!source_content) return;\n\n      const assistant_before = getChatMessages(`0-${Math.max(0, message_id - 1)}`, {\n        role: 'assistant',\n        include_swipes: false,\n      });\n      const anchor_assistant = assistant_before.length > 0 ? assistant_before[assistant_before.length - 1] : undefined;\n      const source_data = anchor_assistant\n        ? Mvu.getMvuData({ type: 'message', message_id: anchor_assistant.message_id })\n        : Mvu.getMvuData({ type: 'chat' });\n      const next_data = _.cloneDeep(source_data ?? {});\n      next_data.stat_data = _.isObjectLike(next_data?.stat_data) ? _.cloneDeep(next_data.stat_data) : {};\n      ensureAirCombatData(next_data.stat_data);\n      ensureNpcData(next_data.stat_data);\n      ensureStoryGuideState(next_data.stat_data);\n      resetNpcStateBeforeCreate(next_data.stat_data);\n      applyPlayerBackgroundInput(next_data.stat_data, source_content);\n      ensureStoryGuideState(next_data.stat_data);\n      progressStoryGuideByContent(next_data.stat_data, source_content);\n      advanceWorldTimeByAction(next_data.stat_data, source_content);\n      const user_npc_request_hit = applyUserNpcRequest(next_data.stat_data, source_content);\n\n      applyBattleSystemConstraints(next_data.stat_data, source_content);\n      patchGameplayState(next_data.stat_data, source_content);\n      applyDungeonLootSystem(next_data.stat_data, source_content);\n      applyBlackMarketTrade(next_data.stat_data, source_content);\n      applyVivianaArc(next_data.stat_data);\n      applyNpcPersonaConsistency(next_data.stat_data);\n      applyHumanTraining(next_data.stat_data, source_content);\n      reconcileGrowthLevel(next_data.stat_data);\n      const battle_started = startAirBattleIfTriggered(next_data.stat_data, source_content);\n      const battle_resolved = resolveAirCombatRound(next_data.stat_data, source_content);\n      const in_air_battle = Boolean(_.get(next_data.stat_data, '..', false))\n        && _.get(next_data.stat_data, '..', '') === '';\n\n      if (battle_started || battle_resolved || in_air_battle) {\n        processed_user_messages.add(message_id);\n        trimBattleLogs(next_data.stat_data, 3);\n        await Mvu.replaceMvuData(next_data, { type: 'chat' });\n        if (anchor_assistant) {\n          await Mvu.replaceMvuData(next_data, { type: 'message', message_id: anchor_assistant.message_id });\n        }\n        console.info(`[][]  ${message_id}`);\n        return;\n      }\n\n      const outcome = applySkillCheckSystem(next_data.stat_data, source_content);\n      if (!outcome) {\n        if (user_npc_request_hit) {\n          trimBattleLogs(next_data.stat_data, 3);\n          await Mvu.replaceMvuData(next_data, { type: 'chat' });\n          if (anchor_assistant) {\n            await Mvu.replaceMvuData(next_data, { type: 'message', message_id: anchor_assistant.message_id });\n          }\n        }\n        return;\n      }\n      processed_user_messages.add(message_id);\n\n      const game_over = enforceGameOver(\n        next_data.stat_data,\n        `${outcome.action_tag} / ${outcome.result}`,\n      );\n      const feedback_prompt = buildOutcomePrompt(outcome, game_over);\n      injectPrompts(\n        [{\n          id: `apocalypse-dawn-skill-feedback-pre-${message_id}-${Date.now()}`,\n          position: 'in_chat',\n          depth: 0,\n          role: 'system',\n          content: feedback_prompt,\n          should_scan: true,\n        }],\n        { once: true },\n      );\n      pending_skill_by_user_message.set(message_id, {\n        user_message_id: message_id,\n        source_content,\n        outcome,\n        feedback_prompt,\n        injected: true,\n        game_over,\n      });\n      trimBattleLogs(next_data.stat_data, 3);\n\n      await Mvu.replaceMvuData(next_data, { type: 'chat' });\n      if (anchor_assistant) {\n        await Mvu.replaceMvuData(next_data, { type: 'message', message_id: anchor_assistant.message_id });\n      }\n      console.info(`[][]  ${message_id}`);\n    }\n\n    async function syncMessageToMvu(message_id: number): Promise<void> {\n      if (syncing_message_ids.has(message_id)) return;\n\n      const message = getChatMessages(message_id, { include_swipes: false })[0];\n      if (!message || message.role !== 'assistant' || message.is_hidden) return;\n\n      const content = message.message?.trim() ?? '';\n      if (!content) return;\n      if (synced_message_content.get(message_id) === content) return;\n\n      syncing_message_ids.add(message_id);\n      try {\n        const old_data = Mvu.getMvuData({ type: 'message', message_id });\n        const new_data = await Mvu.parseMessage(content, old_data);\n\n        //  MVU \n        if (!hasExplicitUpdateTag(content)) {\n          new_data.stat_data = _.isObjectLike(old_data?.stat_data) ? _.cloneDeep(old_data.stat_data) : {};\n        }\n\n        if (!new_data.stat_data || typeof new_data.stat_data !== 'object') {\n          new_data.stat_data = {};\n        }\n        ensureAirCombatData(new_data.stat_data);\n        ensureNpcData(new_data.stat_data);\n        ensureStoryGuideState(new_data.stat_data);\n        resetNpcStateBeforeCreate(new_data.stat_data);\n        if (!new_data.stat_data. || typeof new_data.stat_data. !== 'object') {\n          new_data.stat_data. = {};\n        }\n        const parsed_onstage = parseOnStageCharacters(content);\n        const old_onstage = Array.isArray(_.get(new_data.stat_data, '.')) ? _.get(new_data.stat_data, '.') : [];\n        const inferred_onstage = inferOnStageCharactersFromText(content, {\n          exclude_names: [\n            String(_.get(new_data.stat_data, '..', '')),\n            String(_.get(new_data.stat_data, '..', '')),\n          ].filter(Boolean),\n          old_onstage,\n        });\n        const relation_hints = parseNpcRelationHints(content);\n        const incoming_onstage = [...(parsed_onstage ?? []), ...inferred_onstage];\n        const name_excluded = new Set<string>([\n          String(_.get(new_data.stat_data, '..', '')),\n          String(_.get(new_data.stat_data, '..', '')),\n        ].filter(Boolean));\n\n        if (incoming_onstage.length > 0) {\n          const merged = mergeOnStageCharacters(old_onstage, incoming_onstage);\n          new_data.stat_data.. = sanitizeOnStageCharacters(merged, name_excluded);\n          _.set(\n            new_data.stat_data,\n            '..',\n            `AI${_.uniq(incoming_onstage.map(v => v.)).join('')}`,\n          );\n        } else {\n          const current = Array.isArray(_.get(new_data.stat_data, '.')) ? _.get(new_data.stat_data, '.') : [];\n          new_data.stat_data.. = sanitizeOnStageCharacters(current, name_excluded);\n        }\n        refreshOnStageThoughtsByAiText(new_data.stat_data, content);\n\n        const previous_message = getChatMessages(message_id - 1, { include_swipes: false })[0];\n        const user_context = previous_message && previous_message.role === 'user' ? String(previous_message.message ?? '') : '';\n        const trigger_context = `${user_context}\\n${content}`;\n        const skill_context = user_context.trim() || content;\n        const pending_skill = previous_message && previous_message.role === 'user'\n          ? pending_skill_by_user_message.get(previous_message.message_id)\n          : undefined;\n\n        applyBattleSystemConstraints(new_data.stat_data, trigger_context);\n        patchGameplayState(new_data.stat_data, trigger_context);\n        applyDungeonLootSystem(new_data.stat_data, content);\n        applyBlackMarketTrade(new_data.stat_data, user_context);\n        applyHumanTraining(new_data.stat_data, trigger_context);\n        reconcileGrowthLevel(new_data.stat_data);\n        startAirBattleIfTriggered(new_data.stat_data, trigger_context);\n        if (pending_skill) {\n          applyResolvedSkillOutcome(new_data.stat_data, pending_skill.source_content, pending_skill.outcome);\n          if (pending_skill.game_over) {\n            enforceGameOver(\n              new_data.stat_data,\n              `${pending_skill.outcome.action_tag} / ${pending_skill.outcome.result}`,\n            );\n          }\n          pending_skill_by_user_message.delete(previous_message.message_id);\n        } else {\n          const in_air_battle = Boolean(_.get(new_data.stat_data, '..', false))\n            && _.get(new_data.stat_data, '..', '') === '';\n          if (!in_air_battle) applySkillCheckSystem(new_data.stat_data, skill_context);\n        }\n        enforceGameOver(new_data.stat_data, '');\n        applyNpcLongTermRules(new_data.stat_data, content, user_context, incoming_onstage, relation_hints);\n        applyVivianaArc(new_data.stat_data);\n        applyNpcPersonaConsistency(new_data.stat_data);\n\n        new_data.stat_data.. = {\n          : extractDisplayText(content),\n          : content,\n          : Date.now(),\n        };\n        trimBattleLogs(new_data.stat_data, 3);\n\n        await Mvu.replaceMvuData(new_data, { type: 'message', message_id });\n        synced_message_content.set(message_id, content);\n        console.info(`[][MVU]  ${message_id}`);\n      } catch (error) {\n        console.warn(`[][MVU]  ${message_id} `, error);\n      } finally {\n        syncing_message_ids.delete(message_id);\n      }\n    }\n\n    eventOn(tavern_events.MESSAGE_RECEIVED, message_id => {\n      void syncMessageToMvu(message_id);\n    });\n\n    eventOn(tavern_events.MESSAGE_UPDATED, message_id => {\n      void syncMessageToMvu(message_id);\n    });\n\n    eventOn(tavern_events.MESSAGE_SENT, message_id => {\n      void processUserAction(message_id);\n    });\n\n    eventOn(tavern_events.GENERATION_AFTER_COMMANDS, () => {\n      const latest_user = getChatMessages(-1, { role: 'user', include_swipes: false })[0];\n      if (!latest_user || latest_user.role !== 'user') return;\n\n      const chat_data = Mvu.getMvuData({ type: 'chat' });\n      const mvu_summary_prompt = buildMvuSummaryPrompt(chat_data);\n      injectPrompts(\n        [{\n          id: `apocalypse-dawn-mvu-summary-${latest_user.message_id}-${Date.now()}`,\n          position: 'in_chat',\n          depth: 0,\n          role: 'system',\n          content: mvu_summary_prompt,\n          should_scan: true,\n        }],\n        { once: true },\n      );\n\n      const pending = pending_skill_by_user_message.get(latest_user.message_id);\n      if (pending && !pending.injected) {\n        injectPrompts(\n          [{\n            id: `apocalypse-dawn-skill-feedback-${latest_user.message_id}-${Date.now()}`,\n            position: 'in_chat',\n            depth: 0,\n            role: 'system',\n            content: pending.feedback_prompt,\n            should_scan: true,\n          }],\n          { once: true },\n        );\n        pending.injected = true;\n        return;\n      }\n\n      const air_pending = Boolean(_.get(chat_data, 'stat_data...', false));\n      const air_summary = String(_.get(chat_data, 'stat_data...', '')).trim();\n      if (air_pending && air_summary) {\n        injectPrompts(\n          [{\n            id: `apocalypse-dawn-airbattle-${Date.now()}`,\n            position: 'in_chat',\n            depth: 0,\n            role: 'system',\n            content: `[-]\\n${air_summary}\\n`,\n            should_scan: true,\n          }],\n          { once: true },\n        );\n        const next_chat_data = _.cloneDeep(chat_data ?? {});\n        if (!_.isObjectLike(next_chat_data.stat_data)) next_chat_data.stat_data = {};\n        if (!_.isObjectLike(next_chat_data.stat_data.)) next_chat_data.stat_data. = {};\n        next_chat_data.stat_data.. = {\n          : false,\n          : air_summary,\n          : Date.now(),\n        };\n        void Mvu.replaceMvuData(next_chat_data, { type: 'chat' });\n      }\n      const ended = Boolean(_.get(chat_data, 'stat_data...', false));\n      if (ended) {\n        injectPrompts(\n          [{\n            id: `apocalypse-dawn-gameover-${Date.now()}`,\n            position: 'in_chat',\n            depth: 0,\n            role: 'system',\n            content: '/',\n            should_scan: true,\n          }],\n          { once: true },\n        );\n      }\n    });\n\n    eventOn(tavern_events.CHAT_CHANGED, () => {\n      syncing_message_ids.clear();\n      synced_message_content.clear();\n      pending_skill_by_user_message.clear();\n\n      const latest = getChatMessages(-1, { include_swipes: false })[0];\n      if (latest && latest.role === 'assistant') {\n        void syncMessageToMvu(latest.message_id);\n      }\n    });\n\n    const latest = getChatMessages(-1, { include_swipes: false })[0];\n    if (latest && latest.role === 'assistant') {\n      void syncMessageToMvu(latest.message_id);\n    }\n  })();\n});\n"],"names":["z","Schema","object","boolean","prefault","string","enum","coerce","number","transform","v","_","clamp","array","record","describe","asNumber","value","fallback","numeric","Number","isFinite","rollD6","Math","floor","random","warmaid_rank_steps","name","need","reconcileGrowthLevel","stat_data","profession","String","get","is_warmaid","includes","is_authority","level","length","shards","max","set","shard","has_origin","Boolean","trimBattleLogs","keep","logs","isObjectLike","entries","Object","fromEntries","slice","ensureAirCombatData","air","defaultsDeep","battle_activate_pattern","battle_action_pattern","battle_end_pattern","startAirBattleIfTriggered","content","test","threat","enemy_hp","source","ambush","Date","now","resolveAirCombatRound","self_hp","weather_mod","trunc","sup_mod","weapon_lv","weapons","first","values","getWeaponLevel","heavy_condition","need_assist","has_assist","self_near_miss_stack","enemy_near_miss_stack","enemy_dodge","self_dodge","full_auto","calcSingleShot","hit_bonus","dodge_value","base_damage_mult","diff","base_damage","damage","rollD10","note","near_miss","invalid","dealt","self_hit_note","hit_bonus_base","first_shot","shot_index","expected_next_bonus","shot","enemy_hit","enemy_diff","taken","round_summary","summary","end_reason","map","k","join","buildAirBattleSummary","extractDisplayText","text","replace","content_match","match","trim","npc_name_stop_words","Set","npc_name_bad_prefix","npc_name_bad_contains","isLikelyNpcName","excluded","has","sanitizeOnStageCharacters","list","filter","extractNameContext","hit","split","find","inferAttitudeByContext","context","t","inferOnStageCharactersFromText","options","exclude_names","old_map","Map","old_onstage","score","pushScore","raw_name","delta","m","matchAll","keys","result","s","old","push","clampAffection","cloneDeep","ensureNpcData","Array","isArray","defaults","resetNpcStateBeforeCreate","calcAffectionStage","is_partner","detectMentionedNames","names","mentions","add","getTracker","key","upsertLongTermNpc","payload","existing","base","next_affection","current_affection","merged_affection","min","next","promoteToLongTermByName","reason","onstage","npc","uniq","npc_follow_pattern","npc_partner_ai_pattern","npc_partner_user_confirm_pattern","npc_sex_pattern","applyVivianaArc","current_place","in_library","long_map","remove","attitude","thought","idx","findIndex","buildPersonaInnerThought","clean_fallback","raw","sanitizeThoughtText","applyNpcPersonaConsistency","all_names","long_key","long_npc","tags","persona","dungeon_enter_pattern","dungeon_leave_pattern","dungeon_move_pattern","dungeon_search_pattern","dungeon_blow_pattern","lab_room_pool","tier_value_range","tier_affix_count","affix_pool","trade_only_items","black_market_trade_pattern","black_market_buy_pattern","rollRoomTypeByLuck","luck","shift","good_weight","normal_weight","risky_weight","total","r","buildRoomContainer","room_type","pickLootQuality","is_advanced","roll","addWarehouseItem","item_name","quality","count","category","desc","tradeable","old_count","old_tags","curr","generateLootFromContainer","container_type","slot_override","slots","loot","pools","i","sample","is_trade_only","vmin","vmax","sampleSize","mergeLootRecord","target","incoming","item","applyDungeonLootSystem","parseLabLevel","scale","parseMapScale","rooms","room_name","generateDungeonMap","room","merged_loot","is_blow","undefined","normal_count","advanced_count","applyBlackMarketTrade","items","targets","qty_match","RegExp","escapeRegExp","sell_qty","own_qty","use_qty","income","left","unset","want_tier","price","money","toString","patchGameplayState","current_round","line","manual_toggle","battle_by_state","battle_by_text","in_battle","was_enabled","should_enable","last_round","round_delta","magic_cost","slot_cost","current_magic","current_slot","next_magic","next_slot","applyBattleSystemConstraints","mode_by_text","in_battle_by_state","in_battle_by_text","mode","warmaid_type","getWarmaidType","is_commander","ap","mp","penalty","agi","move_counter","weather_hit","superiority","airflow_penalty","applyHumanTraining","keyword_map","forEach","attr","current_attr","current_train","next_train","resolveSkillOutcome","raw_override","has_explicit_check","has_action_verb","inferred_attr","pattern","inferSkillAttr","action_tag","tag","inferActionTag","lock_action","lock_until","bonus","difficulty_penalty","difficulty_label","lock_to_round","hp_loss","mp_loss","difficulty","hard","label","inferDifficulty","applyResolvedSkillOutcome","outcome","lock_rounds","applySkillCheckSystem","enforceGameOver","battle_time_pattern","dialogue_time_pattern","jump_time_pattern","formatUnionDateTime","date","getFullYear","getMonth","getDate","getHours","padStart","getMinutes","advanceWorldTimeByAction","prev_text","prev_date","union_match","year","month","day","hour","minute","iso_like","parseWorldDateTime","jump_match","jump_target","current","full_match","day_only_match","hm","hm_only","parseTimeJumpTarget","next_text","delta_minutes","getTime","player_background_trigger_pattern","player_background_strip_pattern","training_keyword_pattern","applyPlayerBackgroundInput","merged","summarizePlayerBackground","ensureStoryGuideState","mode_by_card","detectTrainingStateFromBackground","admission_keyword_pattern","course_keyword_pattern","hilton_keyword_pattern","toShortText","toInt","pickTailEntries","$","errorCatched","async","global_key","window","host_document","parent","document","style_id","getElementById","style","createElement","id","textContent","head","appendChild","installHideOriginalReplyStyle","waitGlobalInitialized","syncing_message_ids","synced_message_content","pending_skill_by_user_message","processed_user_messages","processUserAction","message_id","user_message","getChatMessages","include_swipes","role","is_hidden","source_content","message","assistant_before","anchor_assistant","source_data","Mvu","getMvuData","type","next_data","guide","stage","progressStoryGuideByContent","user_npc_request_hit","user_content","mentioned","tracker","applyUserNpcRequest","battle_started","battle_resolved","in_air_battle","replaceMvuData","console","info","game_over","feedback_prompt","lines","buildOutcomePrompt","injectPrompts","position","depth","should_scan","once","user_message_id","injected","syncMessageToMvu","old_data","new_data","parseMessage","hasExplicitUpdateTag","parsed_onstage","parsed","JSON","parse","attrs","normalized_attrs","parseOnStageCharacters","inferred_onstage","relation_hints","parseNpcRelationHints","incoming_onstage","name_excluded","old_list","merged_map","prev","requested","mergeOnStageCharacters","ai_content","char","refreshOnStageThoughtsByAiText","previous_message","user_context","trigger_context","skill_context","pending_skill","delete","hints","onstage_list","name_pool","structured_names","text_mentions","appeared","round","hint","ai_has_partner_signal","user_confirm","current_tags","applyNpcLongTermRules","error","warn","addEventListener","evt","data","action","sent","textarea_selectors","send_btn_selectors","input_el","sel","el","querySelector","HTMLTextAreaElement","dispatchEvent","Event","bubbles","btn","HTMLElement","click","trySendActionToChatInput","eventOn","tavern_events","MESSAGE_RECEIVED","MESSAGE_UPDATED","MESSAGE_SENT","GENERATION_AFTER_COMMANDS","latest_user","chat_data","mvu_summary_prompt","stat","world_time","world_place","world_weather","world_threat","path","hp","hp_max","mp_max","action_point","move_point","slot_now","slot_max","corruption","air_sup","fire_penalty","warmaid_lv","authority_lv","magic_shard","next_magic_shard","authority_shard","skill_result","skill_attr","skill_total","bg_summary","plot_mode","training_state","guide_stage","admission_progress","course_progress","guide_note","recent_affairs","recent_logs","buildMvuSummaryPrompt","pending","air_pending","air_summary","next_chat_data","CHAT_CHANGED","clear","latest"],"sourceRoot":""}